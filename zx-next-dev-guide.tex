\documentclass[12pt,twoside,openright,a4paper]{book}

\usepackage{fancyhdr}
\usepackage{fancyvrb}
\usepackage{a4wide}
\usepackage{url}
\usepackage{array}
\usepackage{multicol}
\usepackage{multirow}
\usepackage{enumitem}
\usepackage{etoolbox}
\usepackage{mdwlist}
\usepackage{minitoc}
\usepackage{environ}
\usepackage{tabularx}
\usepackage{amssymb}
\usepackage{xfp}
\usepackage{numprint}
\usepackage{xstring}
\usepackage[table]{xcolor}
\usepackage[nottoc,numbib]{tocbibind}

% redefine the default "plain" pagestyle (used by chapter pages)
\fancypagestyle{plain}{
	\fancyhf{} 
	\fancyhead{}
	\fancyfoot[L]{\thepage}
	\renewcommand{\headrulewidth}{0pt}
	\renewcommand{\footrulewidth}{0pt}
}

% define style used for normal pages
\fancypagestyle{clean}{
	\fancyhf{}
	\fancyhead[RE,LO]{\leftmark}
	\fancyfoot[RE,LO]{\thepage}
}

% define default paragraph styles
\setlength{\parindent}{0em}
\setlength{\parskip}{1.5ex}

% don't stretch content into empty space vertically
\raggedbottom

% same as p{size} but centers text horizontally
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}

% empty pages before chapters should use empty style (aka nothing)
\let\mtcleardoublepage\cleardoublepage
\renewcommand{\cleardoublepage}{\clearpage{\pagestyle{empty}\mtcleardoublepage}}

% top and bottom "struts" for instruction lines
\newcommand{\instrt}{\rule{0pt}{2.5ex}}
\newcommand{\instrb}{\rule[-1.4ex]{0pt}{0pt}}

% top and bottom "struts" for note lines
\newcommand{\notet}{\rule{0pt}{2.4ex}}
\newcommand{\noteb}{\rule[-1.3ex]{0pt}{0pt}}

% couple shorthands that can be used throughout the document
\newcommand{\ddd}{\makebox[1em][c]{.\hfil.\hfil.}}
\newcommand{\See}[1]{\textsuperscript{#1}}
\newcommand{\UNDOC}{\textnormal{\textsuperscript{**}}}
\newcommand{\ZXN}{\textnormal{\textsuperscript{ZX}}}

% we can use this for pages that are intentionally left blank
\newcommand{\intentiallyempty}{
	\mbox{}
	\vfill
	\begin{center}
	This page intentionally left empty
	\end{center}
	\vfill
	\mbox{}
}

% customize Verbatim environment wiht default settings
\RecustomVerbatimEnvironment{Verbatim}{Verbatim}{
	numbers=left,
	xleftmargin=5mm,
	tabsize=4,
	fontsize=\small
}


% use empty style for first couple pages, until defined otherwise
\pagestyle{empty}

\begin{document}

% use arabic numerals for starting pages
\frontmatter

% TODO
% - Describe BIT A,(HL) undocumented flags from internal MEMPRT/WZ register
% - Add testing code to appendices

\title{ZX Spectrum Next Developer Guide}
\author{Tomaz Kragelj}
\date{Version 1.0, \today}

\maketitle




\chapter*{Copyright Statement}

Copyright {\copyright} 2021 Tomaz Kragelj\\
Copyright {\copyright} 2005 Jan Wilmans\\
Copyright {\copyright} 1997, 1998, 2001, 2003, 2005 Sean Young

Permission is granted to copy, distribute and/or modify this document under the terms of the GNU Free Documentation License, Version 1.1 or any later version published by the Free Software Foundation; with no Invariant Sections, with no Front-Cover Texts, and with no Back-Cover Texts. A copy of the license is included in the section entitled ``GNU Free Documentation License''.



% start numbering pages with table of contents, set style to clean so page numbers will be visible and other page styles reflected
\setcounter{page}{0}
\pagestyle{clean}


% print table of contents, but just chapters and sections, we'll print toc for each chapter separately that will include subsection as well
\setcounter{tocdepth}{1}
\dominitoc \tableofcontents

% setup formatting for section toc - no horizontal delimiters, offsets etc.
\noptcrule
\nomtcrule									% no horizontal delimiters on top and bottom
\renewcommand{\mtcoffset}{-1.5em}			% render minitoc a bit more to the left for more centralized appearance
\mtcsetfeature{minitoc}{open}{\vspace{1em}}	% add some vertical spacing between contents title and toc
\def\mtcSfont{\normalsize}
\def\mtcSSfont{\small}



% use arabic numerals for page numbers and clean page style for the rest of the document
\mainmatter



\chapter{Introduction}

\minitoc


\section{Where to get this document}

ZX Spectrum Next guide is community oriented project. It's available free of charge as downloadable pdf file on releases tab of below github page. You can also find source {\LaTeX} there so you can freely edit it to your preferences! I also made it available as printed book on lulu, for those who prefer physical copy. Printing is done on demand with third party service, so it's not free, but I only set minimal price that will cover printing costs (printing services exist in many countries, so shipping costs should be minimal). Book is coil bound for easy flipping with additional cover that is not available in downloadable version, so definitely take a look if interested:

{\tt \url{https://github.com/tomaz/zx-next-dev-guide}}\\
{\tt \url{https://www.lulu.com/TODO}}

The latest version of original Z80 undocumented is available at:

{\tt \url{http://www.myquest.nl/z80undocumented/}}


\pagebreak
\section{Background}

\begin{description}[style=unboxed,leftmargin=0cm]

	\item[Sean]\hfill
	
	Ever since I first started working on an MSX emulator, I've been very interested in getting the emulation absolutely correct - including the undocumented features. Not just to make sure that all games work, but also to make sure that if a program crashes, it crashes exactly the same way if running on an emulator as on the real thing. Only then is perfection achieved.

	I set about collecting information. I found pieces of information on the Internet, but not everything there is to know. So I tried to fill in the gaps, the results of which I put on my website. Various people have helped since then; this is the result of all those efforts and to my knowledge this document is the most complete.

	\item[Jan]\hfill

	Interested in emulation for a long time, but a few years after Sean started writing this document, I have also started writing my own MSX emulator in 2003 and I've used this document quite a lot. Now (2005) the Z80 emulation is nearing perfection, I decided to add what extra I have learned and comments various people have sent to Sean, to this document.

	I have restyled the document (although very little) to fit my personal needs and I have checked a lot of things that were already in here.

	\item[Tomaz]\hfill
	
	My first computer was ZX Spectrum 48K. Initially it was only used to play games, but my creative mind soon set me on path of creating simple games of my own in BASIC. While too young to master assembler, the idea stayed with me. ZX Spectrum Next revived my wish to learn Z80 and return to writing games for the platform.
	
	My original intent was to have coil bound list of all ZX Next instructions so I can quickly compare. However after finding this document, it felt like a perfect starting point. And with additional information it included, it also encouraged me to extend mere instruction set with additional description.
 
\end{description}


\section{Feedback}

\begin{description}[style=unboxed,leftmargin=0cm]

	\item[Tomaz]\hfill

	If you find any mistake, or have any other kind of feedback, feel free to open an issue on gitub. Pull requests are also welcome! If you want to contribute but are unsure of what, you can check todo section in the readme file for pointers or contact me at {\tt tkragelj(AT)gmail(DOT)com}. Either way, please keep in mind English is not my native tounge and for this free/low cost project I can't justify editor/proof reader costs. If you find mistakes, please let me know (or even better, create pull request with fixes). I will do my best to periodically refresh printed version as well!

	\item[Jan]\hfill
	
	I welcome any kind of feedback. I would like to hear about any corrections or additions you might have. Also note that there are a few flags which are still unknown, it would be great if someone found out how they work. You can reach me at {\tt jw(AT)dds(DOT)nl} and my website can be found at \url{http://www.myquest.nl/z80undocumented/}. Sean's website is at \url{http://www.msxnet.org/}.

\end{description}


\pagebreak
\section{ChangeLog}
\begin{description}

\item[29th March 2021 (Version 1.0)]
Added ZX Spectrum Next information and instructions and restructured text for better maintainability and readability.

\item[15th Juni 2005 (version 0.9)]
Corrected improper notation of JP x,nn mnemonics in opcode list, thanks to
Laurens Holst. Corrected a mistake in the INI, INIR, IND, INDR section 
and documented a mistake in offical Z80 documentation concerning Interrupt 
Mode 2, thanks to Boris Donko. Thanks to Aaldert Dekker for his ideas, for 
verifying many assumptions and writing instruction exercisers for various 
instruction groups.

\item[18th May 2005 (version 0.8)]
Added an alphabetical list of instructions for easy reference and corrected an 
error in the 16-bit arithmetic section, SBC HL,nn sets the N-flag just like
other subtraction instructions, thanks to Fredrik Olssen for pointing that out.

\item[4th April 2005 (version 0.7)]
I (Jan $<$jw@dds.nl$>$) will be maintaining this document from this version on.
I restyled the document to fix the page numbering issues, 
corrected an error in the I/O Block Instructions section, added 
graphics for the RLD and RRD instructions and corrected the spelling in several places.

\item[20th November 2003 (version 0.6)]
Again, thanks to Ramsoft, added PF flag to {\tt OUTI}, {\tt INI} and
friends. Minor fix to {\tt DAA} tables, other minor fixes.

\item[13th November 2003 (version 0.5)]
Thanks to Ramsoft, add the correct tables for the {\tt DAA} instruction
(section \ref{daa}). Minor corrections \& typos, thanks to Jim Battle,
David Sutherland and most of all Fred Limouzin.

\item[September 2001 (version 0.4)]
Previous documents I had written were in plain text and Microsoft
Word, which I now find very embarrassing, so I decided to combine them all 
and use {\LaTeX}. Apart from a full re-write, the only changed information is
``Power on defaults'' (section \ref{pon}) and the algorithm for the CF 
and HF flags for {\tt OTIR} and friends (section \ref{block_io}).

\end{description}




\chapter{Zilog Z80}

\minitoc

\pagebreak
\section{Overview}
\subsection{History of the Z80}

In 1969 Intel was approached by a Japanese company called Busicom to produce  chips for Busicom's electronic desktop calculator. Intel suggested that the calculator should be built around a single-chip generalized computing engine and thus was born the first microprocessor - the 4004. Although it was based on ideas from much larger mainframe and mini-computers the 4004 was cut down to fit onto a 16-pin chip, the largest that was available at the time, so that its data bus and address bus were each only 4-bits wide. 

Intel went on to improve the design and produced the 4040 (an improved 4-bit design) the 8008 (the first 8-bit microprocessor) and then in 1974 the 8080. This last one turned out to be a very useful and popular design and was used in the first home computer, the Altair 8800, and CP/M. 

In 1975 Federico Faggin who had had worked at Intel on the 4004 and its successors left the company and joined forces with Masatoshi Shima to from Zilog. At their new company Faggin and Shima designed a microprocessor that was compatible with Intel's 8080 (it ran all 78 instructions of the 8080 in almost the same way that Intel's chip did)\footnote{Thanks to Jim Battle $<$frustum@pacbell.net$>$: the 8080 always puts the parity in the PF flag; VF does not exist and the timing is different. Possibly there are other differences.} but had many more abilities (an extra 120 instructions, many more registers, simplified connection to hardware). Thus was born the mighty Z80! and thus was the empire forged.

The original Z80 was first released in July 1976, coincidentally Jan was born in the very same month. Since then newer versions have appeared with much of the same architecture but running at higher speeds. The original Z80 ran with a clock rate of 2.5MHz, the Z80A runs at 4MHz, the Z80B at 6MHz and the Z80H at 8Mhz. 

Many companies produced machines based around Zilog's improved chip during the 1970's and 80's and because the chip could run 8080 code without needing any changes to the code the perfect choice of operating system was CP/M. 

Also Zilog has created a Z280, an enhanced version of the Zilog Z80 with a 16 bit architecture, introduced in July, 1987. It added an MMU to expand addressing to 16Mb, features for multitasking, a 256 byte cache, and a huge number of new opcodes (giving a total of over 2000!). Its internal clock runs at 2 or 4 times the external clock (e.g. a 16MHz CPU with a 4MHz bus

The Z380 CPU incorporates advanced architectural while maintaining Z80/Z180 object code compatibility. The Z380 CPU is an enhanced version of the Z80 CPU. The Z80 instruction set has been retained, adding a full complement of 16-bit arithmetic and logical operations, multiply and divide, a complete set of register-to-register loads and exchanges, plus 32-bit load and exchange, and 32-bit arithmetic operations for address calculations.

The addressing modes of the Z80 have been enhanced with Stack pointer relative loads and stores, 16-bit and 24-bit indexed offsets and more flexible indirect register addressing. All of the addressing modes allow access to the entire 32-bit addressing space.


\subsection{Registers}

The following accessible registers exist in the Z80.

\begin{tabular}{|c|c|l}
	\cline{1-2}
	\tt A & \tt F & Accumulator and Flags \\ \cline{1-2} \cline{1-2}
	\multicolumn{2}{|c|}{\tt BC} & \\ \cline{1-2}
	\multicolumn{2}{|c|}{\tt DE} & General purpose registers \\ \cline{1-2}
	\multicolumn{2}{|c|}{\tt HL} & \\ \cline{1-2}
	\multicolumn{2}{|c|}{\tt IX} & \\ \cline{1-2}
	\multicolumn{2}{|c|}{\tt IY} & \raisebox{1.5ex}[0pt]{Index registers} \\ \cline{1-2}
	\multicolumn{2}{|c|}{\tt PC} & \\ \cline{1-2}
	\multicolumn{2}{|c|}{\tt SP} & Special purpose registers \\ \cline{1-2}
	\tt I & \tt R & \\ \cline{1-2}
	\multicolumn{2}{|c|}{\tt AF'} & \\ \cline{1-2}
	\multicolumn{2}{|c|}{\tt BC'} & \\ \cline{1-2}
	\multicolumn{2}{|c|}{\tt DE'} & \raisebox{1.5ex}[0pt]{Alternate general purpose registers}\\ \cline{1-2}
	\multicolumn{2}{|c|}{\tt HL'} & \\ \cline{1-2}
\end{tabular}

For interrupts, there are two interrupt flop-flops, IFF1 and IFF2, and the interrupt mode is retained. See chapter \ref{interrupts} for more about interrupts. Also there is an internal register which is described in section \ref{block_io}.


\subsection{Flags}
\label{flags}

The conventional way of denoting the flags is with one letter, `C' for the carry flag for example. It could be confused with the C register, so I've chosen to use the `CF' notation for flags. Also in previous things I've written I called the two undocumented flags 5 and 3, but now I've changed to the same notation used in MAME\footnote{http://www.mame.net/}, which is YF and XF, respectively. Note that in mnemonics the original way is still maintained.

\pagebreak
\begin{tabular}{|l|c|c|c|c|c|c|c|c|} 
	\hline
	bit & 7 & 6 & 5 & 4 & 3 & 2 & 1 & 0 \instrt\instrb \\
	\hline
	flag & SF & ZF & YF & HF & XF & PF & NF & CF \instrt\instrb \\ 
	\hline
\end{tabular}

\begin{description}

	\item[SF flag]
	Set if the 2-complement value is negative. It's simply a copy of the most significant bit.

	\item[ZF flag]
	Set if the result is zero.

	\item[YF flag]
	A copy of bit 5 of the result.

	\item[HF flag]
	The half-carry of an addition/subtraction (from bit 3 to 4). Needed for BCD correction with {\tt DAA}.

	\item[XF flag]
	A copy of bit 3 of the result.

	\item[PF flag]
	This flag can either be the parity of the result (PF), or the \\ 2-complement signed overflow (VF): set if 2-complement value doesn't fit in the register.

	\item[NF flag]
	Shows whether the last operation was an addition (0) or an subtraction (1). This information is needed for {\tt DAA}.\footnote{Wouldn't it be better to have separate instructions for {\tt DAA} after addition and subtraction, like the 80x86 has in stead of sacrificing a bit in the flag register?}

	\item[CF flag]
	The carry flag, set if there was a carry after the most significant bit.

\end{description}

Note that the only way to read the XF, YF and NF can be read using
{\tt PUSH AF}.


\subsection{Power on defaults}
\label{pon}

Matt\footnote{redflame@xmission.com} has done some excellent research on this. He found that AF and SP are always set to \$FFFF after a reset, and all other registers are undefined (different depending on how long the CPU has been powered off, different for different Z80 chips). Of course the PC should be set to 0 after a reset, and so should the IFF1 and IFF2 flags (otherwise strange things could happen). Also since the Z80 is 8080 compatible, interrupt mode is probably 0.

Probably the best way to simulate this in an emulator is set PC, IFF1, IFF2, IM to 0 and set all other registers to \$FFFF.


\subsection{Pin Descriptions \cite{datasheet}}

This section might also relevant even if you don't do anything with hardware; it might give so insight into how the Z80 operates. Besides, it took me hours to draw this.

{\tt 
	\setlength{\unitlength}{1mm}
	\begin{picture}(50,80)
		\multiput(11.8,2)(0,3.9){20}{\framebox(2,2){}}
		\multiput(36.2,2)(0,3.9){20}{\framebox(2,2){}}
		\thicklines \footnotesize
		\put(14,0){\framebox(22,80){Z80 CPU}}
		\put(25,80){\oval(3,3)[b]}
		\thinlines 
		\newcounter{pinno}
		\multiput(15,76)(0,-3.9){20}{\stepcounter{pinno}\makebox(2,2){\arabic{pinno}}}
		\multiput(33,2)(0,3.9){20}{\stepcounter{pinno}\makebox(2,2)[r]{\arabic{pinno}}}

		\put(9,2){\makebox(2,2)[r]{$\mathtt{\overline{IORQ}}$}}
		\put(9,5.9){\makebox(2,2)[r]{$\mathtt{\overline{MREQ}}$}}
		\put(9,9.8){\makebox(2,2)[r]{$\mathtt{\overline{HALT}}$}}
		\put(9,13.7){\makebox(2,2)[r]{$\mathtt{\overline{NMI}}$}}
		\put(9,17.6){\makebox(2,2)[r]{$\mathtt{\overline{INT}}$}}
		\put(9,21.5){\makebox(2,2)[r]{$\mathtt{D_1}$}}
		\put(9,25.4){\makebox(2,2)[r]{$\mathtt{D_0}$}}
		\put(9,29.3){\makebox(2,2)[r]{$\mathtt{D_7}$}}
		\put(9,33.2){\makebox(2,2)[r]{$\mathtt{D_2}$}}
		\put(9,37.1){\makebox(2,2)[r]{$\mathtt{+ 5V}$}}
		\put(9,41){\makebox(2,2)[r]{$\mathtt{D_6}$}}
		\put(9,44.9){\makebox(2,2)[r]{$\mathtt{D_5}$}}
		\put(9,48.8){\makebox(2,2)[r]{$\mathtt{D_3}$}}
		\put(9,52.7){\makebox(2,2)[r]{$\mathtt{D_4}$}}
		\put(9,56.6){\makebox(2,2)[r]{$\mathtt{CLK}$}}
		\put(9,60.5){\makebox(2,2)[r]{$\mathtt{A_{15}}$}}
		\put(9,64.4){\makebox(2,2)[r]{$\mathtt{A_{14}}$}}
		\put(9,68.3){\makebox(2,2)[r]{$\mathtt{A_{13}}$}}
		\put(9,72.2){\makebox(2,2)[r]{$\mathtt{A_{12}}$}}
		\put(9,76.1){\makebox(2,2)[r]{$\mathtt{A_{11}}$}}

		\put(39,2){\makebox(2,2)[l]{$\mathtt{\overline{RD}}$}}
		\put(39,5.9){\makebox(2,2)[l]{$\mathtt{\overline{WR}}$}}
		\put(39,9.8){\makebox(2,2)[l]{$\mathtt{\overline{BUSACK}}$}}
		\put(39,13.7){\makebox(2,2)[l]{$\mathtt{\overline{WAIT}}$}}
		\put(39,17.6){\makebox(2,2)[l]{$\mathtt{\overline{BUSREQ}}$}}
		\put(39,21.5){\makebox(2,2)[l]{$\mathtt{\overline{RESET}}$}}
		\put(39,25.4){\makebox(2,2)[l]{$\mathtt{\overline{M1}}$}}
		\put(39,29.3){\makebox(2,2)[l]{$\mathtt{\overline{RFSH}}$}}
		\put(39,33.2){\makebox(2,2)[l]{$\mathtt{GND}$}}
		\put(39,37.1){\makebox(2,2)[l]{$\mathtt{A_0}$}}
		\put(39,41.0){\makebox(2,2)[l]{$\mathtt{A_1}$}}
		\put(39,44.9){\makebox(2,2)[l]{$\mathtt{A_2}$}}
		\put(39,48.8){\makebox(2,2)[l]{$\mathtt{A_3}$}}
		\put(39,52.7){\makebox(2,2)[l]{$\mathtt{A_4}$}}
		\put(39,56.6){\makebox(2,2)[l]{$\mathtt{A_5}$}}
		\put(39,60.5){\makebox(2,2)[l]{$\mathtt{A_{6}}$}}
		\put(39,64.4){\makebox(2,2)[l]{$\mathtt{A_{7}}$}}
		\put(39,68.3){\makebox(2,2)[l]{$\mathtt{A_{8}}$}}
		\put(39,72.2){\makebox(2,2)[l]{$\mathtt{A_{9}}$}}
		\put(39,76.1){\makebox(2,2)[l]{$\mathtt{A_{10}}$}}

	\end{picture}
}

\begin{description}[leftmargin=1.5em]

	\item[$\mathtt{A_{15}-A_0}$] 
	{\em Address bus} (output, active high, 3-state). This bus is used for 
	accessing the memory and for I/O ports. During the refresh cycle the IR 
	register is put on this bus.

	\item[$\mathtt{\overline{BUSACK}}$]
	{\em Bus Acknowledge} (output, active low). Bus Acknowledge indicates 
	to the requesting device that the CPU address bus, data bus, and control
	signals $\mathtt{\overline{MREQ}}$, 
	$\mathtt{\overline{IORQ}}$, 
	$\mathtt{\overline{RD}}$ and $\mathtt{\overline{WR}}$ have been entered into
	their high-impedance states. The external device now control these lines.

	\item[$\mathtt{\overline{BUSREQ}}$]
	{\em Bus Request} (input, active low). Bus Request has a higher priority than
	$\mathtt{\overline{NMI}}$ and is always recognised at the end of the current
	machine cycle. $\mathtt{\overline{BUSREQ}}$ forces the CPU address bus, data
	bus and control signals $\mathtt{\overline{MREQ}}$,  
	$\mathtt{\overline{IORQ}}$, 
	$\mathtt{\overline{RD}}$ and $\mathtt{\overline{WR}}$ to go to a 
	high-impedance state so that other devices can control these lines. 
	$\mathtt{\overline{BUSREQ}}$ is normally wired-OR and requires an external 
	pullup for these applications. Extended $\mathtt{\overline{BUSREQ}}$ 
	periods due to extensive DMA operations can prevent the CPU from refreshing
	dynamic RAMs.

	\item[$\mathtt{D_7-D_0}$]
	{\em Data Bus} (input/output, active low, 3-state). Used for data exchanges
	with memory, I/O and interrupts.

	\item[$\mathtt{\overline{HALT}}$]
	{\em Halt State} (output, active low). Indicates that the CPU has executed 
	a {\tt HALT} instruction and is waiting for either a maskable or nonmaskable 
	interrupt (with the mask enabled) before operation can resume. While halted,
	the CPU stops increasing the PC so the instruction is re-executed, to
	maintain memory refresh.

	\item[$\mathtt{\overline{INT}}$]
	{\em Interrupt Request} (input, active low). Interrupt Request is generated
	by I/O devices. The CPU honours a request at the end of the current 
	instruction if IFF1 is set. $\mathtt{\overline{INT}}$ is normally wired-OR
	and requires an external pullup for these applications.

	\item[$\mathtt{\overline{IORQ}}$]
	{\em Input/Output Request} (output, active low, 3-state). Indicates that
	the address bus holds a vailid I/O address for an I/O read or write 
	operation. $\mathtt{\overline{IORQ}}$ is also generated concurrently with
	$\mathtt{\overline{M1}}$ during an interrupt acknowledge cycle to indicate
	that an interrupt response vector can be placed on the databus.

	\item[$\mathtt{\overline{M1}}$]
	{\em Machine Cycle One} (output, active low). $\mathtt{\overline{M1}}$,
	together with $\mathtt{\overline{MREQ}}$, indicates that the current 
	machine cycle is the opcode fetch cycle of an instruction execution.
	$\mathtt{\overline{M1}}$, together with $\mathtt{\overline{IORQ}}$,
	indicates an interrupt acknowledge cycle.

	\item[$\mathtt{\overline{MREQ}}$]
	{\em Memory Request} (output, active low, 3-state). Indicates that the
	address holds a valid address for a memory read or write cycle operations.

	\item[$\mathtt{\overline{NMI}}$]
	{\em Non-Maskable Interrupt} (input, negative edge-triggered). 
	$\mathtt{\overline{NMI}}$ has a higher priority than 
	$\mathtt{\overline{INT}}$. $\mathtt{\overline{NMI}}$ is always recognised 
	at the end of an instruction, independent of the status of the 
	interrupt flip-flops and automatically forces the CPU to restart at 
	location \$0066.

	\item[$\mathtt{\overline{RD}}$]
	{\em Read} (output, active low, 3-state). Indicates that the 
	CPU wants to read data from memory or an I/O device. The addressed I/O device
	or memory should use this signal to place data onto the data bus.

	\item[$\mathtt{\overline{RESET}}$]
	{\em Reset} (input, active low). Initializes the CPU as follows: it resets
	the interrupt flip-flops, clears the PC and IR registes, and set the 
	interrupt mode to 0. During reset time, the address bus and data bus go
	to a high-impedance state, and all control output signals go to 
	the inactive state. Note that $\mathtt{\overline{RESET}}$ must be active
	for a minimum of three full clock cycles before the reset operation is
	complete. Note that Matt found that SP and AF are set to \$FFFF.

	\item[$\mathtt{\overline{RFSH}}$]
	{\em Refresh} (output, active low). $\mathtt{\overline{RFSH}}$, together
	with $\mathtt{\overline{MREQ}}$, indicates that the IR registers are on
	the address bus (note that only the lower 7 bits are useful) and can be 
	used for the refresh of dynamic memories.

	\item[$\mathtt{\overline{WAIT}}$]
	{\em Wait} (input, active low). Indicates to the CPU that the addressed
	memory or I/O device are not ready for data transfer. The CPU continues
	to enter a wait state as long as this signal is active. Note that during
	this period memory is not refreshed.

	\item[$\mathtt{\overline{WR}}$]
	{\em Write} (output, active low, 3-state). Indicates that the 
	CPU wants to write data to memory or an I/O device. The addressed I/O device
	or memory should use this signal to store the data on the data bus.

\end{description}


\section{Undocumented Opcodes}

There are quite a few undocumented opcodes/instructions. This section should describe every possible opcode so you know what will be executed, whatever the value of the opcode is.

The following prefixes exist: CB, ED, DD, FD, DDCB and FDCB. Prefixes change the way the following opcodes are interpreted. All instructions without a prefix (not a value of one the above) are single byte opcodes\footnote{Without the operand, that is.}, which are documented in the official documentation.


\subsection{CB Prefix \cite{gerton}}
\label{prefix_cb}

An opcode with a CB prefix is a rotate, shift or bit test/set/reset instruction. There are a few instructions missing from the official list, which are usually denoted with {\tt SLL} (Shift Logical Left). It works like {\tt SLA}, for one exception: it sets bit 0 ({\tt SLA} resets it).

{\tt 
  \begin{tabbing}
    {\qquad}\=CB30\qquad\=SLL B \+\\
       CB31\>SLL C\\
       CB32\>SLL D\\
       CB33\>SLL E\\
       CB34\>SLL H\\
       CB35\>SLL L\\
       CB36\>SLL (HL)\\
       CB37\>SLL A
	\end{tabbing}
}


\subsection{DD Prefix \cite{gerton}}

In general, the instruction following the DD prefix is executed as is, but if the HL register is supposed to be used the IX register is used instead. Here are the rules:

\begin{itemize}
	\item Any usage of HL is treated as an access to IX (except {\tt EX DE,HL} and {\tt EXX} and the ED prefixed instructions that use HL).
	
	\item Any access to (HL) is changed to (IX+d), where `d' is a signed displacement byte placed after the main opcode - except {\tt JP (HL)}, which isn't indirect anyway. The mnemonic should be {\tt JP HL}.
	
	\item Any access to H is treated as an access to IXh (the high byte of IX)
	Except if (IX+d) is used as well.
	
	\item Any access to L is treated as an access to IXl (the low byte of IX)Except if (IX+d) is used as well.
	
	\item A DD prefix before a CB selects a completely different instruction set, see Section {\ref{prefix_cbdd}}.
\end{itemize}

Some examples:

{\tt 
	\begin{tabbing}
		{\qquad}\={\rm Without DD prefix}\qquad\={\rm With DD prefix}\+ \\
		LD H,(HL)\>LD H,(IX+d)\\
		LD H,A\>LD IXh,A\\
		LD L,H\>LD IXl,IXh\\
		JP (HL)\>JP (IX)\\
		LD DE,0\>LD DE,0\\
		LD HL,0\>LD IX,0\\
	\end{tabbing}
}


\subsection{FD Prefix \cite{gerton}}

This prefix has the same effect as the DD prefix, though IY is used instead of IX.  Note {\tt LD IXl,IYh} is not possible: only IX or IY is accessed in one instruction, never both.


\subsection{ED Prefix \cite{gerton}}

There are a number of undocumented EDxx instructions, of which most are duplicates of documented instructions. Any instruction not listed has no effect (same behaviour as 2 {\tt NOP} instructions).

The complete list except for the block instructions:

\renewcommand{\thefootnote}{\fnsymbol{footnote}}
{\footnotetext[7]{Undocumented instruction}}
{\tt 
	\begin{tabbing}
		{\qquad}ED40\quad\=IN B,(C)\qquad\qquad\=ED60\quad\=IN H,(C)\\ 
		{\qquad}ED41\>OUT (C),B\>ED61\>OUT (C),H\\ 
		{\qquad}ED42\>SBC HL,BC\>ED62\>SBC HL,HL\\  
		{\qquad}ED43\>LD (nn),BC\>ED63\>LD (nn),HL\\ 
		{\qquad}ED44\>NEG\>ED64\>NEG{\See{7}}\\ 
		{\qquad}ED45 \> RETN\> ED65\> RETN{\See{7}}\\
		{\qquad}ED46\>IM 0\>ED66\>IM 0{\See{7}}\\
		{\qquad}ED47\>LD I,A\>ED67\>RRD\\
		{\qquad}ED48\>IN C,(C)\>ED68\>IN L,(C)\\
		{\qquad}ED49\>OUT (C),C\>ED69\>OUT (C),L\\
		{\qquad}ED4A\>ADC HL,BC\>ED6A\>ADC HL,HL\\
		{\qquad}ED4B\>LD BC,(nn)\>ED6B\>LD HL,(nn)\\
		{\qquad}ED4C\>NEG{\See{7}}\>ED6C\>NEG{\See{7}}\\
		{\qquad}ED4D\>RETI\>ED6D\>RETN\See{7}\\
		{\qquad}ED4E\>IM 0{\See{7}}\>ED6E\>IM 0{\See{7}}\\
		{\qquad}ED4F\>LD R,A\>ED6F\>RLD\\
		{\qquad}\\
		{\qquad}ED50\>IN D,(C)\>ED70\>IN (C) / IN F,(C){\See{7}}\\
		{\qquad}ED51\>OUT (C),D\>ED71\>OUT (C),0{\See{7}}\\
		{\qquad}ED52\>SBC HL,DE\>ED72\>SBC HL,SP\\
		{\qquad}ED53\>LD (nn),DE\>ED73\>LD (nn),SP\\
		{\qquad}ED54\>NEG{\See{7}}\>ED74\>NEG{\See{7}}\\
		{\qquad}ED55\>RETN{\See{7}}\>ED75\>RETN{\See{7}}\\
		{\qquad}ED56\>IM 1\>ED76\>IM 1{\See{7}}\\
		{\qquad}ED57\>LD A,I\>ED77\>NOP{\See{7}}\\
		{\qquad}ED58\>IN E,(C)\>ED78\>IN A,(C)\\
		{\qquad}ED59\>OUT (C),E\>ED79\>OUT (C),A\\
		{\qquad}ED5A\>ADC HL,DE\>ED7A\>ADC HL,SP\\
		{\qquad}ED5B\>LD DE,(nn)\>ED7B\>LD SP,(nn)\\
		{\qquad}ED5C\>NEG{\See{7}}\>ED7C\>NEG{\See{7}}\\
		{\qquad}ED5D\>RETN{\See{7}}\>ED7D\>RETN{\See{7}}\\
		{\qquad}ED5E\>IM 2\>ED7E\>IM 2{\See{7}}\\
		{\qquad}ED5F\>LD A,R\>ED7F\>NOP{\See{7}}\\
	\end{tabbing}
}
\renewcommand{\thefootnote}{\arabic{footnote}}

The ED70 instruction reads from I/O port C, but does not store the result. It just affects the flags like the other {\tt IN x,(C)} instructions. ED71 simply outs the value 0 to I/O port C.

The ED63 is a duplicate of the 22 opcode ({\tt LD (nn),HL}) and similarly ED6B is a duplicate of the 2A opcode. Of course the timings are different. These instructions are listed in the official documentation.

According to Gerton Lunter\footnote{gerton@math.rug.nl}:

\begin{quote}
	The instructions ED 4E and ED 6E are {\tt IM 0} equivalents: when FF was put on the bus (physically) at interrupt time, the Spectrum continued to execute normally, whereas when an EF ({\tt RST \$28}) was put on the bus it crashed, just as it does in that case when the Z80 is in the official interrupt mode 0. In {\tt IM 1} the Z80 just executes a {\tt RST \$38} (opcode FF) no matter what is on the bus.
\end{quote}

All the {\tt RETI/RETN} instructions are the same, all like the {\tt RETN}instruction. So they all, including {\tt RETI}, copy IFF2 to IFF1. More information on {\tt RETI} and {\tt RETN} and {\tt IM x} is in section \ref{flipflop}.


\subsection{DDCB Prefix}
\label{prefix_cbdd}

The undocumented DDCB instructions store the result (if any) of the operation in one of the seven all-purpose registers, which one depends on the lower 3 bits of the last byte of the opcode (not operand, so not the offset).

\begin{tabbing}
	{\qquad}000\quad\=B\\
	{\qquad}001\>C\\
	{\qquad}010\>D\\
	{\qquad}011\>E\\
	{\qquad}100\>H\\
	{\qquad}101\>L\\
	{\qquad}110\>(none: documented opcode)\\
	{\qquad}111\>A
\end{tabbing}

The documented DDCB0106 is {\tt RLC (IX+\$01)}. So, clear the lower three bits (DDCB0100) and something is done to register B. The result of the RLC (which is stored in (IX+\$01)) is now also stored in register B. Effectively, it does the following:

{\tt 
	\begin{tabbing}
		{\qquad}\=LD B,(IX+\$01)\+\\
		RLC B\\
		LD (IX+\$01),B
	\end{tabbing}
}

So you get double value for money. The result is stored in B and (IX+\$01). The most common notation is: {\tt RLC (IX+\$01),B}

I've once seen this notation:
 
{\tt 
	\begin{tabbing}
		{\qquad}\=RLC (IX+\$01)\+\\
		LD B,(IX+\$01)
	\end{tabbing}
}

That's not correct: B contains the rotated value, even if (IX+\$01) points to ROM. The DDCB SET and RES instructions do the same thing as the shift/rotate instructions:

{\tt 
	\begin{tabbing}
		{\qquad}\=DDCB10C0{\qquad}\=SET 0,(IX+\$10),B\+\\
		DDCB10C1	\>SET 0,(IX+\$10),C\\
		DDCB10C2	\>SET 0,(IX+\$10),D\\
		DDCB10C3	\>SET 0,(IX+\$10),E\\
		DDCB10C4	\>SET 0,(IX+\$10),H\\
		DDCB10C5	\>SET 0,(IX+\$10),L\\
		DDCB10C6	\>SET 0,(IX+\$10) {\rm - documented instruction}\\
		DDCB10C7	\>SET 0,(IX+\$10),A
	\end{tabbing}
}

So for example with the last instruction, the value of (IX+\$10) with bit 0 set is also stored in register A.

The DDCB BIT instructions do not store any value; they merely test a bit. That's why the undocumented DDCB BIT instructions are no different from the official ones:

{\tt 
	\begin{tabbing}
		{\qquad}\=DDCB d 78{\qquad}\=BIT 7,(IX+d)\+\\
		DDCB d 79\>BIT 7,(IX+d)\\
		DDCB d 7A\>BIT 7,(IX+d)\\
		DDCB d 7B\>BIT 7,(IX+d)\\
		DDCB d 7C\>BIT 7,(IX+d)\\
		DDCB d 7D\>BIT 7,(IX+d)\\
		DDCB d 7E\>BIT 7,(IX+d) {\rm - documented instruction}\\
		DDCB d 7F\>BIT 7,(IX+d)
	\end{tabbing}
}


\subsection{FDCB Prefixes}

Same as for the DDCB prefix, though IY is used instead of IX.


\subsection{Combinations of Prefixes}

This part may be of some interest to emulator coders. Here we define what happens if strange sequences of prefixes appear in the instruction cycle of the Z80.

If CB or ED is encountered, that byte plus the next make up an instruction. FD or DD should be seen as prefix setting a flag which says ``use IX or IY instead of HL'', and not an instruction. In a large sequence of DD and FD bytes, it is the last one that counts. Also any other byte (or instruction) resets this flag.

{\tt {\qquad}FD DD 00 21 00 10{\qquad}NOP NOP NOP LD HL,\$1000}




\section{Undocumented Effects}

\subsection{BIT instructions}
\label{bit_flags}

{\tt BIT n,r} behaves much like {\tt AND r,2{\raisebox{1ex}{n}}} with the result thrown away, and CF flag unaffected. Compare {\tt BIT 7,A} with {\tt AND \$80}: flag YF and XF are reset, SF is set if bit 7 was actually set; ZF is set if the result was 0 (bit was reset), and PF is effectively set if ZF is set (the result of the AND leaves either no bits set (PF set - parity even) or one bit set (PF reset - parity odd). So the rules for the flags are:

\begin{description}

	\item[SF flag]
	Set if n = 7 and tested bit is set.

	\item[ZF flag]
	Set if the tested bit is reset.

	\item[YF flag]
	Set if n = 5 and tested bit is set.

	\item[HF flag]
	Always set.

	\item[XF flag]
	Set if n = 3 and tested bit is set.

	\item[PF flag]
	Set just like ZF flag.

	\item[NF flag]
	Always reset. 

	\item[CF flag]
	Unchanged.

\end{description}

This is where things start to get strange. With the {\tt BIT n,(IX+d)}instructions, the flags behave just like the {\tt BIT n,r} instruction, except for YF and XF. These are not copied from the result but from something completely different, namely bit 5 and 3 of the high byte of IX+d (so IX plus the displacement).

Things get more bizarre with the {\tt BIT n,(HL)} instruction. Again, except for YF and XF the flags are the same. YF and XF are copied from some sort of internal register. This register is related to 16 bit additions. Most instructions do not change this register. Unfortunately, I haven't tested all instructions yet, but here is the list so far.

\begin{description}

	\item[{\tt ADD HL,xx}]
	Use the high byte of HL, ie. H before the addition.

	\item[{\tt LD r,(IX+d)}]
	Use high byte of the resulting address IX+d.

	\item[{\tt JR d}]
	Use high byte target address of the jump.

	\item[{\tt LD r,r'}]
	Doesn't change this register.

\end{description}

Any help here would be most appreciated!


\subsection{Memory Block Instructions \cite{mrison}}
\label{block_mem}

The {\tt LDI/LDIR/LDD/LDDR} instructions affect the flags in a strange way. At every iteration, a byte is copied. Take that byte and add the value of register A to it. Call that value n. Now, the flags are:

\begin{description}
 
	\item[YF flag]
	A copy of bit 1 of n.

	\item[HF flag]
	Always reset.

	\item[XF flag]
	A copy of bit 3 of n.

	\item[PF flag]
	Set if BC not 0.

	\item[SF, ZF, CF flags]
	These flags are unchanged.

\end{description}

And now for {\tt CPI/CPIR/CPD/CPDR}. This instruction compares a series of bytes in memory to register A. Effectively, it can be said it does {\tt CP (HL)} at every iteration. The result of that compare sets the HF flag, which is important for the next step. Take the value of register A, subtract the value of the memory address, and finally subtract the value of HF flag, which is set or reset by the hypothetical {\tt CP (HL)}. So, {\tt n = A - (HL) - HF}.

\begin{description}

	\item[SF, ZF, HF flags]
	Set by the hypothetical {\tt CP (HL)}.

	\item[YF flag]
	A copy of bit 1 of n.

	\item[XF flag]
	A copy of bit 3 of n.

	\item[PF flag]
	Set if BC is not 0.

	\item[NF flag]
	Always set.

	\item[CF flag]
	Unchanged.

\end{description}


\subsection{I/O Block Instructions}
\label{block_io}

These are the most be bizarre instructions, as far as flags is concerned. Ramsoft found all of the flags. The out instructions behave differently than the in instructions, which doesn't make the CPU very symmetrical. 

First of all, all instructions affect the following flags:

\begin{description}

	\item[SF, ZF, YF, XF flags]
	Affected by decreasing register B, as in {\tt DEC B}.

	\item[NF flag]
	A copy of bit 7 of the value read from or written to an I/O port.

\end{description}

\pagebreak	% this break allows above list to be fully included on preceeding page

And now the for {\tt OUTI/OTIR/OUTD/OTDR} instructions. Take state of the L after the increment or decrement of HL; add the value written to the I/O port to; call that k for now. If k $>$ 255, then the CF and HF flags are set. The PF flags is set like the parity of k bitwise and'ed with 7, bitwise xor'ed with B.

\begin{description}

	\item[HF and CF]
	Both set if {\tt ((HL) + L  $>$ 255)}

	\item[PF]
	The parity of {\tt ((((HL) + L) \& 7) xor B)}

\end{description}

{\tt INI/INIR/IND/INDR} use the C register in stead of the L register. There is a catch though, because not the value of C is used, but C + 1 if it's {\tt INI/INIR} or C - 1 if it's {\tt IND/INDR}. So, first of all {\tt INI/INIR}:

\begin{description}

	\item[HF and CF]
	Both set if {\tt ((HL) + ((C + 1) \& 255)  $>$ 255)}

	\item[PF]
	The parity of {\tt (((HL) + ((C + 1) \& 255)) \& 7) xor B)}

\end{description}

And last {\tt IND/INDR}:

\begin{description}

	\item[HF and CF]
	Both set if {\tt ((HL) + ((C - 1) \& 255) $>$ 255)}

	\item[PF]
	The parity of {\tt (((HL) + ((C - 1) \& 255)) \& 7) xor B)}

\end{description}


\subsection{16 Bit I/O ports}

Officially the Z80 has an 8 bit I/O port address space. When using the I/O ports, the 16 address lines are used. And in fact, the high 8 bit do actually have some value, so you can use 65536 ports after all. {\tt IN r,(C)}, {\tt OUT (C),r}, and the Block I/O instructions  actually place the entire BC register on the address bus. Similarly {\tt IN A,(n)} and {\tt OUT (n),A} put A $\times$ 256 + n on the address bus.

The {\tt INI}, {\tt INIR}, {\tt IND} and {\tt INDR} instructions use {\tt BC} after decrementing {\tt B}, and the {\tt OUTI}, {\tt OTIR}, {\tt OUTD} and {\tt OTDR} instructions before.


\subsection{Block Instructions}

The repeated block instructions simply decrease the {\tt PC} by two so the instruction is simply re-executed. So interrupts can occur during block instructions. So, {\tt LDIR} is simply {\tt LDI} + if {\tt BC} is not {\tt 0}, decrease {\tt PC} by {\tt 2}.


\subsection{16 Bit Additions}

The 16 bit additions are a bit more complicated than 8 bit ones. Since the Z80 is an 8-bit CPU, 16 bit additions are done in two stages: first the lower bytes are added, then the two higher bytes. The SF, YF, HF, XF flags are affected as by the second (high) 8 bit addition. ZF is set if the whole 16 bit result is 0.


\subsection{DAA Instruction}
\label{daa}

This instruction is useful when you're using BCD values. After an addition or subtraction, {\tt DAA} corrects the value back to BCD again.  Note that it uses the CF flag, so it cannot be used after {\tt INC} and {\tt DEC}.

Stefano Donati from Ramsoft\footnote{http://www.ramsoft.bbk.org/} has found the tables which describe the {\tt DAA} operation. The input is the A register and the CF, NF, HF flags. Result is as follows:

{
	\footnotesize

	\begin{tabular}{b{5.8cm}b{4.8cm}b{4.8cm}}
		Depending on the NF flag, the `diff' from this table must be added (NF is reset) or subtracted (NF is set) to {\tt A}:
		&
		CF flag is affected:
		&
		NF flags is affected: \\
	\end{tabular}

	\begin{tabular}{p{5.8cm}p{4.8cm}p{4.8cm}}

		% ----------------------------------
		% | NF | CF |  hi | HF |  lo | add |
		% |----|----|-----|----|-----|-----|
		% |  0 |  0 | 0-9 |  0 | 0-9 |  00 |
		% |  0 |  0 | 0-9 |  1 | 0-9 |  06 |
		% |  0 |  0 | 0-8 |  * | a-f |  06 |
		% |  0 |  0 | a-f |  0 | 0-9 |  60 |
		% |  0 |  1 |  *  |  0 | 0-9 |  60 |
		% |  0 |  1 |  *  |  1 | 0-9 |  66 |
		% |  0 |  1 |  *  |  * | a-f |  66 |
		% |  0 |  0 | 9-f |  * | a-f |  66 |
		% |  0 |  0 | a-f |  1 | 0-9 |  66 |
		% ----------------------------------
		% |  1 |  0 | 0-9 |  0 | 0-9 |  00 |
		% |  1 |  0 | 0-9 |  1 | 0-9 |  fa |
		% |  1 |  0 | 0-8 |  * | a-f |  fa |
		% |  1 |  0 | a-f |  0 | 0-9 |  a0 |
		% |  1 |  1 |  *  |  0 | 0-9 |  a0 |
		% |  1 |  1 |  *  |  1 | 0-9 |  9a |
		% |  1 |  1 |  *  |  * | a-f |  9a |
		% |  1 |  0 | 9-f |  * | a-f |  9a |
		% |  1 |  0 | a-f |  1 | 0-9 |  9a |
		% ----------------------------------
		{\tt
			\begin{tabular}[t]{c|c|c|c|c}
				   &  high   &    & low    &  \\
				CF &  nibble & HF & nibble & diff \\
				\hline
				0 & 0-9     &  0 & 0-9    &  00  \\
				0 & 0-9     &  1 & 0-9    &  06  \\
				0 & 0-8     &  * & A-F    &  06  \\
				0 & A-F     &  0 & 0-9    &  60  \\
				1 &  *      &  0 & 0-9    &  60  \\
				1 &  *      &  1 & 0-9    &  66  \\
				1 &  *      &  * & A-F    &  66  \\
				0 & 9-F     &  * & A-F    &  66  \\
				0 & A-F     &  1 & 0-9    &  66  \\
				\hline
			\end{tabular}
		}

		&

		% ------------------------
		% | CF |  hi |  lo | CF' |
		% |----|-----|-----|-----|
		% |  0 | 0-9 | 0-9 |  0  |
		% |  0 | 0-8 | a-f |  0  |
		% |  0 | 9-f | a-f |  1  |
		% |  0 | a-f | 0-9 |  1  |
		% |  1 |  *  |  *  |  1  |
		% ------------------------
		{\tt
			\begin{tabular}[t]{c|c|c|c}
				   & high   & low    & \\
				CF & nibble & nibble & CF' \\ 	
				\hline
				0 & 0-9    & 0-9    &  0  \\
				0 & 0-8    & A-F    &  0  \\
				0 & 9-F    & A-F    &  1  \\
				0 & A-F    & 0-9    &  1  \\
				1 &  *     &  *     &  1  \\ 
				\hline
			\end{tabular}
		}

		&
		
		% -----------------------
		% | NF | HF |  lo | HF' |
		% |----|----|-----|-----|
		% |  0 |  * | 0-9 |  0  |
		% |  0 |  * | a-f |  1  |
		% -----------------------
		% |  1 |  0 |  *  |  0  |
		% |  1 |  1 | 6-f |  0  |
		% |  1 |  1 | 0-5 |  1  |
		% -----------------------
		{\tt
			\begin{tabular}[t]{c|c|c|c}
				   &    & low    & \\
				NF & HF & nibble & HF' \\ 
				\hline
				0 &  * & 0-9    &  0  \\
				0 &  * & A-F    &  1  \\
				1 &  0 &  *     &  0  \\
				1 &  1 & 6-F    &  0  \\
				1 &  1 & 0-5    &  1  \\ 
				\hline
			\end{tabular}
		}
		
		\\

	\end{tabular}
}

SF, YF, XF are copies of bit 7, 5, 3 of the result respectively; ZF is set according to the result and NF is always unchanged.


\pagebreak
\section{Interrupts}
\label{interrupts}

There are two types of interrupts, maskable and non-maskable. The maskable type is ignored if IFF1 is reset. Non-maskable interrupts (NMI) will are always accepted, and they have a higher priority, so if the two are requested at the same time the NMI will be accepted first.

For the interrupts, the following things are important: Interrupt Mode (set with the {\tt IM 0, IM 1, IM 2} instructions), the interrupt flip-flops (IFF1 and IFF2), and the I register. When a maskable interrupt is accepted, a external device can put a value on the databus.

Both types of interrupts increase the R register by one, when accepted.


\subsection{Non-Maskable Interrupts (NMI)}

When a NMI is accepted, IFF1 is reset. At the end of the routine, IFF1 must be restored (so the running program is not affected). That's why IFF2 is there; to keep a copy of IFF1.

An NMI is accepted when the NMI pin on the Z80 is made low (edge-triggered). The Z80 responds to the {\em change} of the line from +5 to 0 - so the interrupt line doesn't have a state, it's just a pulse. When this happens, a call is done to address \$0066 and IFF1 is reset so the routine isn't bothered by maskable interrupts. The routine should end with an {\tt RETN} (RETurn from Nmi) which is just a usual RET, but also copies IFF2 to IFF1, so the IFFs are the same as before the interrupt.

You can check whether interrupts were disabled or not during an NMI by using the {\tt LD A,I} or {\tt LD A,R} instruction. These instructions copy IFF2 to the PF flag.

Accepting an {\tt NMI} costs 11 t-states.


\subsection{Maskable Interrupts (INT)}

If the INT line is low and IFF1 is set, a maskable interrupt is accepted - whether or not the last INT routine has finished. That's why you should not enable interrupts during such a routine, and make sure that the device that generated it has put the INT line up again before ending the routine. So unlike NMI interrupts, the interrupt line has a state; it's not a pulse.

When an INT is accepted, both IFF1 and IFF2 are cleared, preventing another interrupt from occurring which would end up as an infinite loop (and overflowing the stack). What happens next depends on the Interrupt Mode.

A device can place a value on the databus when the interrupt is accepted. Some computer systems do not utilize this feature, and this value ends up being \$FF.

\begin{description}

	\item[Interrupt Mode 0]
	This is the 8080 compatibility mode. The instruction on the bus is executed (usually an {\tt RST} instruction, but it can be anything). The I register is not used. Assuming it a {\tt RST} instruction, accepting this takes 13 t-states.

	\item[Interrupt Mode 1]
	An RST \$38 is executed, no matter what value is put on the bus or what value the I register has. Accepting this type costs 13 t-states.

	\item[Interrupt Mode 2]
	A call is made to the address read from memory. What address is read from is calculated as follows: (I register) $\times$ 256 + (value on bus). Zilog's user manual states (very convincingly) that the least significant bit of the address is always 0, so they calculate the address that is read from as: (I register) $\times$ 256 + (value on bus \& 0xFE). I have tested this and it's not correct. Of course a word (two bytes) are read, making the address where the call is made to. In this way, you can have a vector table for interrupts. Accepting this of interrupt type costs 19 t-states.

\end{description}

At the end of a maskable interrupt, the interrupts should be enabled again. You can assume that was the state of the IFFs because otherwise the interrupt wasn't accepted. So, an INT routine always ends with an {\tt EI} and a {\tt RET} ({\tt RETI} according to the official documentation, more about that later):

\begin{Verbatim}
INT:
	.
	.
	EI
	RETI or RET
\end{Verbatim}

Note a fact about {\tt EI}: a maskable interrupt isn't accepted directly after it, so the next opportunity for an interrupt is after the {\tt RETI}. This is very useful; if the INT line is still low, an interrupt is accepted again.  If this happens a lot and the interrupt is generated before the {\tt RETI}, the stack could overflow (since the routine would be called again and again). But this property of {\tt EI} prevents this.

{\tt DI} is not necessary at the start of the interrupt routine: the interrupt flip-flops are cleared when accepting the interrupt.

You can use {\tt RET} instead of {\tt RETI}, depending on the hardware setup. {\tt RETI} is only useful if you have something like a Z80 PIO to support daisy-chaining: queuing interrupts. The PIO can detect that the routine has ended by the opcode of {\tt RETI}, and let another device generate an interrupt. That is why I called all the undocumented EDxx RET instructions {\tt RETN}: All of them operate alike, the only difference of {\tt RETI} is its specific opcode which the Z80 PIO recognises.


\subsection{Things affecting the Interrupt flip-flops}
\label{flipflop}

All the IFF related things are:

\begin{tabular}{llll}
	Accept NMI	& {\tt IFF1}	& {\tt IFF2} \\
				& {\tt IFF1}	& {\tt IFF2} \\
	CPU reset	& {\tt 0}		& {\tt 0}\\
	{\tt DI}	& {\tt 0}		& {\tt 0}\\
	{\tt EI}	& {\tt 1}		& {\tt 1}\\
	Accept INT	& {\tt 0}		& {\tt 0}\\
	Accept NMI	& {\tt 0}		& -\\
	{\tt RETI/N}& {\tt IFF2}	& - & All the {\tt EDxx} {\tt RETI/N} instructions\\
	{\tt LD A,I / LD A,R} & - & - & Copies {\tt IFF2} into {\tt PF} flag
\end{tabular}

If you're working with a Z80 system without NMIs (like the MSX), you can forget all about the two separate IFFs; since a NMI isn't ever generated, the two will always be the same. 

Some documentation says that when an NMI is accepted, IFF1 is first copied into IFF2 before IFF1 is cleared. If this is true, the state of IFF2 is lost after a nested NMI, which is undesirable. Have tested this in the following way: make sure the Z80 is in {\tt EI} mode, generate an NMI. In the NMI routine, wait for another NMI before executing {\tt RETN}. In the second NMI IFF2 was still set, so IFF1 is {\em not} copied to IFF2 when accepting an NMI.

Another interesting fact is this. I was trying to figure out whether the undocumented ED {\tt RET} instructions were {\tt RETN} or {\tt RETI}. I tested this by putting the machine in {\tt EI} mode, wait for an NMI and end with one of the ED {\tt RET} instructions. Then execute a {\tt HALT} instruction. If IFF1 was not restored, the machine would hang but this did not happen with any of the instructions, including the documented {\tt RETI}!

Since every INT routine must end with {\tt EI} followed by {\tt RETI} officially, It does not matter that RETI copies IFF2 into IFF1; both are set anyway.


\subsection{HALT instruction}

The HALT instruction halts the Z80; it does not increase the PC so that the instruction is re-executed, until a maskable or non-maskable interrupt is accepted. Only then does the Z80 increase the PC again and continues with the next instruction. During the HALT state, the HALT line is set. The PC is increased before the interrupt routine is called.


\subsection{Where interrupts are accepted}

During execution of instructions, interrupts won't be accepted. Only {\em between} instructions. This is also true for prefixed instructions.

Directly after an EI or DI instruction, interrupts aren't accepted. They're accepted again after the instruction after the EI (RET in the following example). So for example, look at this MSX2 routine that reads a scanline from the keyboard:

\begin{Verbatim}
LD C, A
DI
IN A, ($0AA)
AND $0F0
ADD A, C
OUT ($0AA), A
EI
IN A, ($0A9)
RET
\end{Verbatim}

You can assume that there never is an interrupt after the {\tt EI}, before the {\tt IN A,(\$0A9)} - which would be a problem because the MSX interrupt routine reads the keyboard too.

Using this feature of {\tt EI}, it is possible to check whether it is true that interrupts are never accepted during instructions:

\begin{Verbatim}
	DI
	make sure INT is active
	EI
	insert instruction to test
INT:
	store PC where INT was accepted
	RET
\end{Verbatim}

And yes, for all instructions, including the prefixed ones, interrupts are never accepted during an instruction. Only after the tested instruction. Remember that block instructions simply re-execute themselves (by decreasing the PC with 2) so an interrupt is accepted after each iteration.

Another predictable test is this: at the ``insert instruction to test'' insert a large sequence of {\tt EI} instructions. Of course, during execution of the {\tt EI} instructions, no interrupts are accepted. 

But now for the interesting stuff. ED or CB make up instructions, so interrupts are accepted after them. But DD and FD are prefixes, which only slightly affects the next opcode. If you test a large sequence of DDs or FDs, the same happens as with the {\tt EI} instruction: no interrupts are accepted during the execution of these sequences.

This makes sense, if you think of DD and FD as a prefix which set the ``use IX instead of HL'' or ``use IY instead of HL'' flag. If an interrupt was accepted after DD or FD, this flag information would be lost, and:

{\tt 
	{\qquad}DD 21 00 00{\qquad}LD IX,0
}

could be interpreted as a simple {\tt LD HL,0} if the interrupt was after the last DD. Which never happens, so the implementation is correct. Although I haven't tested this, as I imagine the same holds for NMI interrupts.


\subsection{Interrupts on ZX Spectrum Next}

Maskable interrupts on ZX Spectrum:

\begin{itemize}
	\item {\textbf Mode 0}: meant for interrupts triggered by external device. Instruction to be executed needs to be placed on data bus ({\tt RST} or {\tt CALL} for example). On ZX Spectrum this is the mode that is enabled by default when device powers up. However ROM soon sets up mode 1.
	
	\item {\textbf Mode 1}: on ZX Spectrum, this interrupt is triggered by vertical blanking if the screen refresh, roughly 50 times per second. When this occurs, current contents of {\tt PC} counter are pushed onto stack {\tt SP}, then address of {\tt \$0038} is loaded and program stored on that location will start running. On ZX Spectrum Next this interrupt is responsible for updating system variable frame counter and scanning the keyboard.
	
	\item {\textbf Mode 2}: similar to {\tt IM 1} in frequency and handling, but uses vector table to jump to interrupt program instead of executing hard code ROM routine thus allowing user to setup their own interrupt handler.
\end{itemize}

On ZX Spectrum Next interrupt handler can be replaced by either:

\begin{itemize}
	\item Setting Z80 to {\tt IM 2} mode and configuring custom interrupt handler routine
	
	\item Page out ROM (as described in section \ref{zx_next_memorypaging}) and replace it with RAM page with custom interrupt routine at address {\tt \$0038}
\end{itemize}

You can also adjust timing of the interrupts with Next/TBBlue Feature Control Registers {\tt \$22} and {\tt \$23}.

\pagebreak
Example of setting up custom interrupt vectors with {\tt IM 2}\footnote{Based on \url{http://codersbucket.blogspot.com/2015/04/interrupts-on-zx-spectrum-what-are.html}}:

\begin{Verbatim}
	DI
	
	LD HL, vectorTable  ; HL=address of vector table
	LD DE, IM2Handler   ; DE=address of IM2 handler routine
	LD B, 128           ; 128 vector addresses

	LD A, H
	LD I, A             ; I=high byte of vector table

setupVectorTable:       ; fills in vector table 128x
	LD (HL), E
	INC HL
	LD (HL), D
	INC HL
	DJNZ setupVectorTable 

	IM 2                ; enable mode 2 interrupts
	EI
	RET

IM2Handler:             ; this is called every time IM2 interrupt occurs
	...                 ; implement interrupt handler here
	EI                  ; when complete call EI
	RETI                ; end return from interrupt

	ORG $F000           ; needs to be on 256 byte boundary
vectorTable:
	DEFS 256            ; 128x2
\end{Verbatim}

\pagebreak
\section{Timing and R register}

\subsection{R register and memory refresh}

During every first machine cycle (beginning of an instruction or part of it - prefixes have their own M1 two), the memory refresh cycle is issued. The whole IR register is put on the address bus, and the RFSH pin is lowered.  It unclear whether the Z80 increases the R register before or after putting IR on the bus. 

The R register is increased at every first machine cycle (M1). Bit 7 of the register is never changed by this; only the lower 7 bits are included in the addition. So bit 7 stays the same, but it can be changed using the
{\tt LD R,A} instruction.

Instructions without a prefix increase R by one. Instructions with an ED, CB, DD, FD prefix, increase R by two, and so do the DDCBxxxx and FDCBxxxx instructions (weird enough). Just a stray DD or FD increases the R by one. {\tt LD A,R} and {\tt LD R,A} access the R register after it is increased (by the instruction itself). 

Remember that the block instructions simply decrease the PC with two, so the instructions are re-executed. So LDIR increased R by BC times 2 (note that in the case of BC = 0, R is increased by \$10000 times 2, effectively 0).

Accepting an maskable or non-maskable interrupt increases the R by one.

After a hardware reset, or after power on, the R register is reset to 0.

That should cover all there is to say about the R register. It is often used in programs for a random value, which is good but of course not truly random.




\chapter{ZX Spectrum Next}

With modern I/O ports, increased CPU speeds, more memory, better graphics (bye bye color clash), hardware sprites and tiles, to mention just the most obvious, ZX Spectrum Next is exciting platform for retro programmer.

~ % we need some vertrical spacing between text and minitoc

\minitoc

\pagebreak
\section{Ports}

Information in this chapter was compiled from ZX Spectrum Next Official Developer Wiki\footnote{\url{https://wiki.specnext.dev/}} and User Manual as convenience. However including the whole would be far too much over the scope of this booklet, so only the most relevant or frequently used parts are included. Consult either Wiki or your Next manual for details.


\subsection{Mapped Spectrum Ports}

Most Spectrum peripherals did not actually decode all 16 bits of the address bus; they checked only for certain bits, and would respond if those bit values were set correctly, regardless of the other bits. The "bitmask" column for each port shows the bits that are tested for by the device. Traditionally all "unused" bits are set to 1 to avoid conflicts with other devices, which is the basis of the given port numbers; but alternate port numbers may be used in some cases. However, beware of creating clashes: in particular any port which does not intend to access the ULA should have the LSB set, as the ULA checks only for a reset LSB.

The table on next page is a general list of ports and registers on Spectrum Next board. Some of the ports are described in more detail in their own sections, for the rest and for more details see\footnote{
\url{https://wiki.specnext.dev/Extended_Z80_instruction_set/}}

{
	\newcommand{\zxport}[4]{
		\tt {#1} & 
		{\tt \$#2} & 
		\IfEq{#3}{}{}{\tt \%#3} &
		#4\\
	}

	\setlength{\extrarowheight}{5pt}

	\begin{tabularx}{\textwidth}{lllX}
		{\tt RW} & Addr & Mask & Description \\
		
		\hline
		
		\zxport{RW}{103B}{0001 0000 0011 1011}{Sets and reads the I2C SCL line}
		\zxport{RW}{113B}{0001 0001 0011 1011}{Sets and reads the I2C SDA line}
		\zxport{RW }{123B}{0001 0010 0011 1011}{Enables layer 2 and controls paging of layer 2 screen into lower memory}
		\zxport{RW}{133B}{0001 0011 0011 1011}{Sends byte to serial port. If read, tells if data in RX buffer}
		\zxport{RW}{143B}{0001 0100 0011 1011}{Reads data from serial port, write sets the baudrate}
		\zxport{RW}{153B}{0001 0101 0011 1011}{Configuration of UART interfaces}
		\zxport{-W}{1FFD}{0001 ---- ---- --0-}{Controls ROM paging and special paging options from the +2a/+3 (also see section \ref{zx_next_memorypaging})}
		\zxport{RW}{243B}{0010 0100 0011 1011}{Selects active port for TBBlue/Next feature configuration}
		\zxport{--}{253B}{0010 0101 0011 1011}{Reads and/or writes the selected TBBlue control register}
		\zxport{RW}{303B}{0011 0000 0011 1011}{Sets active sprite-attribute index and pattern-slot index, reads sprite status}
		\zxport{-W}{7FFD}{01-- ---- ---- --0-}{Selects active RAM, ROM, and displayed screen (also see section \ref{zx_next_memorypaging})}
		\zxport{-W}{BFFD}{10-- ---- ---- --0-}{Writes to the selected register of the selected sound chip}
		\zxport{-W}{DFFD}{1101 1111 1111 1101}{Provides additional bank select bits for extended memory (also see section \ref{zx_next_memorypaging})}
		\zxport{R-}{FADF}{---- ---0 --0- ----}{Reads buttons on Kempston Mouse.}
		\zxport{R-}{FBDF}{---- -0-1 --0- ----}{X coordinate of Kempston Mouse, 0-255}
		\zxport{R-}{FFDF}{---- -1-1 --0- ----}{Y coordinate of Kempston Mouse, 0-192}
		\zxport{-W}{FFFD}{11-- ---- ---- --0-}{Controls stereo channels and selects active sound chip and sound chip channel}

	\end{tabularx}

	\begin{tabularx}{\textwidth}{lllX}
		{\tt RW} & Addr & Mask & Description \\
		
		\hline

		\zxport{--}{xx0B}{---- ---- 0000 1011}{Controls Z8410 DMA chip via MB02 standard}
		\zxport{R-}{xx1F}{---- ---- 0001 1111}{Reads movement of joysticks using Kempston interface}
		\zxport{RW}{xx37}{}{Kempston interface second joystick variant and controls joystick I/O}
		\zxport{-W}{xx57}{---- ---- 0101 0111}{Uploads sprite positions, visibility, colour type and effect flags}
		\zxport{-W}{xx5B}{---- ---- 0101 1011}{Used to upload the pattern of the selected sprite}
		\zxport{RW}{xx6B}{---- ---- 0110 1011}{Controls zxnDMA chip}
		\zxport{--}{xxDF}{---- ---- --01 1111}{Output to SpecDrum DAC}
		\zxport{R-}{xxFE}{xxxx xxxx ---- ---0}{Keyboard status (see section \ref{zx_next_keyboard})}
		\zxport{-W}{xxFE}{}{Controls border color and base Spectrum audio settings}
		\zxport{-W}{xxFF}{}{Controls Timex Sinclair video modes and colours in hi-res mode}

	\end{tabularx}
}


\pagebreak

\subsection{Next/TBBlue Feature Control Registers}
\label{zx_next_tbblue_registers}

Specific features of the Next are controlled via these register numbers, accessed via TBBlue Register Select\footnote{\url{https://wiki.specnext.dev/TBBlue_Register_Select}} (\$243B / 9275) and TBBlue Register Access\footnote{\url{https://wiki.specnext.dev/TBBlue_Register_Access}} (\$253B / 9531), or via the NEXTREG opcode.

{
	\environbodyname\TBBlueBODY
	\NewEnviron{tbbluereg}{
		\begin{tabularx}{\textwidth}{llX}
			{\tt RW} & Port & Description \\
			\hline
			\TBBlueBODY
		\end{tabularx}
	}

	\newcommand{\nextport}[3]{
		{\tt #1} & 
		{\tt \$#2} & 
		#3 \\
	}

	\setlength{\extrarowheight}{2pt}

	\begin{tbbluereg}
		\nextport{-W}{0}{IdentifiesTBBlueboard type. Should always be 10 on Next}
		\nextport{-W}{1}{Identifies core (FPGA image) version}
		\nextport{RW}{2}{Identifies type of last reset. Can be written to force reset}
		\nextport{RW}{3}{Identifies timing and machine type}
		\nextport{R-}{4}{In config mode, allows RAM to be mapped to ROM area}
		\nextport{RW}{5}{Sets joystick mode, video frequency andScandoubler}
		\nextport{RW}{6}{EnablesCPU Speed key,DivMMC,Multiface,MouseandAY audio}
		\nextport{RW}{7}{SetsCPU Speed, reads actual speed}
		\nextport{RW}{8}{ABC/ACBStereo, Internal Speaker,SpecDrum,Timex Video Modes,Turbo Sound Next, RAM contention and [un]lock 128k paging}
		\nextport{RW}{9}{Sets scanlines, AY mono output, Sprite-id lockstep, reset DivMMC mapram and disable HDMI audio}
		\nextport{RW}{0A}{Mouse buttons and DPI config}
		\nextport{-W}{0E}{Identifies core (FPGA image) version (sub minor number)}
		\nextport{RW}{10}{Used within theAnti-brick system}
		\nextport{RW}{11}{Sets video output timing variant}
		\nextport{RW}{12}{Sets thebanknumber where Layer 2 video memory begins}
		\nextport{RW}{13}{Sets thebanknumber where the Layer 2 shadow screen begins}
		\nextport{RW}{14}{Sets the "transparent" colour for Layer 2, ULA and LoRes pixel data}
		\nextport{RW}{15}{Enables/disablesSpritesandLores Layer, and chooses priority of sprites andLayer 2}
		\nextport{RW}{16}{Sets the pixel offset used for drawing Layer 2 graphics on the screen}
		\nextport{RW}{17}{Sets the Y offset used when drawing Layer 2 graphics on the screen}
		\nextport{RW}{18}{Sets and reads clip-window for Layer 2}
		\nextport{RW}{19}{Sets and reads clip-window for Sprites}
		\nextport{RW}{1A}{Sets and reads clip-window for ULA/LoRes layer}
		\nextport{RW}{1B}{Sets and reads clip-window for Tilemap}
		\nextport{RW}{1C}{Controls (resets) the clip-window registers indices}
		
		\hline
	\end{tbbluereg}

	(continued)
	\pagebreak

	\begin{tbbluereg}
		\nextport{-W}{1E}{Holds the MSB (only, as bit 0) of the raster line currently being drawn}
		\nextport{-W}{1F}{Holds the eight LSBs of the raster line currently being drawn}
		\nextport{RW}{22}{Controls the timing of raster interrupts and the ULA frame interrupt}
		\nextport{RW}{23}{Holds the eight LSBs of the line on which a raster interrupt should occur}
		\nextport{RW}{26}{Pixel X offset (0..255) to use when drawing ULA Layer}
		\nextport{RW}{27}{Pixel Y offset (0..191) to use when drawing ULA Layer}
		\nextport{RW}{28}{PS/2 Keymap address MSB, read (pending) first byte of palette colour}
		\nextport{R-}{29}{PS/2 Keymap address LSB}
		\nextport{R-}{2A}{High data to PS/2 Keymap (MSB of data in bit 0)}
		\nextport{R-}{2B}{Low eight LSBs of PS/2 Keymap data}
		\nextport{RW}{2C}{DAC B mirror, read current I2S left MSB}
		\nextport{RW}{2D}{SpecDrum port 0xDF / DAC A+D mirror, read current I2S LSB}
		\nextport{RW}{2E}{DAC C mirror, read current I2S right MSB}
		\nextport{RW}{2F}{Sets the pixel offset (two high bits) used for drawing Tilemap graphics on the screen}
		\nextport{RW}{30}{Sets the pixel offset (eight low bits) used for drawing Tilemap graphics on the screen}
		\nextport{RW}{31}{Sets the pixel offset used for drawing Tilemap graphics on the screen}
		\nextport{RW}{32}{Pixel X offset (0..255) to use when drawing LoRes Layer}
		\nextport{RW}{33}{Pixel Y offset (0..191) to use when drawing LoRes Layer}
		\nextport{RW}{34}{Selects sprite index 0..127 to be affected by writes to other Sprite ports (and mirrors)}
		\nextport{R-}{35}{Nextreg port-mirror to write directly into "byte 1" ofSprite Attribute \mbox{Upload}(\$xx57/87)}
		\nextport{R-}{36}{Nextreg port-mirror to write directly into "byte 2" ofSprite Attribute \mbox{Upload}(\$xx57/87)}
		\nextport{-W}{37}{Nextreg port-mirror to write directly into "byte 3" ofSprite Attribute \mbox{Upload} (\$xx57/87)}
		\nextport{-W}{38}{Nextreg port-mirror to write directly into "byte 4" ofSprite Attribute \mbox{Upload} (\$xx57/87)}
		\nextport{-W}{39}{Nextreg port-mirror to write directly into "byte 5" ofSprite Attribute \mbox{Upload} (\$xx57/87)}
		\nextport{RW}{40}{Chooses an palette element (index) to manipulate with}
		\nextport{RW}{41}{Use to set/read 8-bit colours of the ULANext palette}
		\nextport{RW}{42}{Specifies mask to extract ink colour from attribute cell value in ULANext mode}
		
		\hline
	\end{tbbluereg}

	(continued)
	\pagebreak

	\begin{tbbluereg}

		\nextport{RW}{43}{Enables or disables Enhanced ULA interpretation of attribute values and toggles active palette}
		\nextport{RW}{44}{Use to set 9-bit (2-byte) colours of the Enhanced ULA palette, or to read second byte of colour}
		\nextport{RW}{4A}{8-bit colour to be used when all layers contain transparent pixel}
		\nextport{RW}{4B}{Index into sprite palette (of "transparent" colour)}
		\nextport{RW}{4C}{Index into Tilemap palette (of "transparent" colour)}
		\nextport{RW}{50}{Selects the 8k-bank stored in 8k-slot 0 (seeMemory map)}
		\nextport{RW}{51}{Selects the 8k-bank stored in 8k-slot 1 (seeMemory map)}
		\nextport{RW}{52}{Selects the 8k-bank stored in 8k-slot 2 (seeMemory map)}
		\nextport{RW}{53}{Selects the 8k-bank stored in 8k-slot 3 (seeMemory map)}
		\nextport{RW}{54}{Selects the 8k-bank stored in 8k-slot 4 (seeMemory map)}
		\nextport{RW}{55}{Selects the 8k-bank stored in 8k-slot 5 (seeMemory map)}
		\nextport{RW}{56}{Selects the 8k-bank stored in 8k-slot 6 (seeMemory map)}
		\nextport{RW}{57}{Selects the 8k-bank stored in 8k-slot 7 (seeMemory map)}
		\nextport{R-}{60}{Used to upload code to theCopper}
		\nextport{RW}{61}{Holds low byte ofCoppercontrol bits}
		\nextport{RW}{62}{Holds high byte ofCoppercontrol flags}
		\nextport{R-}{63}{Used to upload code to theCopper}
		\nextport{RW}{64}{Offset numbering of raster lines in copper/interrupt/active register}
		\nextport{RW}{68}{Disable ULA, controls ULA mixing/blending, enable ULA+}
		\nextport{RW}{69}{Layer2, ULA shadow, Timex \$FF port}
		\nextport{RW}{6A}{LoRes Radastan mode}
		\nextport{RW}{6B}{ControlsTilemapmode}
		\nextport{RW}{6C}{Default tile attribute for 8-bit only maps}
		\nextport{RW}{6E}{Base address of the 40x32 or 80x32 tile map (similar to text-mode of other computers)}
		\nextport{RW}{6F}{Base address of the tiles' graphics}
		\nextport{RW}{70}{Layer 2 resolution, palette offset}
		\nextport{RW}{71}{Sets the pixel offset used for drawing Layer 2 graphics on the screen}
		\nextport{R-}{75}{Same asSprite port-mirror Attribute 0 Register(\$35) (write first byte of sprite-attributes), plus incrementsSprite port-mirror Index Register(\$34)}
		\nextport{R-}{76}{Same asSprite port-mirror Attribute 1 Register(\$36) (write second byte of sprite-attributes), plus incrementsSprite port-mirror Index Register(\$34)}
		\nextport{R-}{77}{Same asSprite port-mirror Attribute 2 Register(\$37) (write third byte of sprite-attributes), plus incrementsSprite port-mirror Index Register(\$34)}
		
		\hline
	\end{tbbluereg}

	(continued)
	\pagebreak

	\begin{tbbluereg}

		\nextport{R-}{78}{Same asSprite port-mirror Attribute 3 Register(\$38) (write fourth byte of sprite-attributes), plus incrementsSprite port-mirror Index Register(\$34)}
		\nextport{R-}{79}{The same asSprite port-mirror Attribute 4 Register(\$39) (write fifth byte of sprite-attributes), plus incrementsSprite port-mirror Index Register(\$34)}
		\nextport{RW}{7F}{8-bit storage for user}
		\nextport{RW}{80}{Expansion bus enable/config}
		\nextport{RW}{81}{Expansion bus controls}
		\nextport{RW}{82}{Enabling internal ports decoding b0-7 Register}
		\nextport{RW}{83}{Enabling internal ports decoding b8-15 Register}
		\nextport{RW}{84}{Enabling internal ports decoding b16-23 Register}
		\nextport{RW}{85}{Enabling internal ports decoding b24-31 Register}
		\nextport{RW}{86}{When expansion bus is enabled: Internal ports decoding mask b0-7 Register}
		\nextport{RW}{87}{When expansion bus is enabled: Internal ports decoding mask b8-15 Register}
		\nextport{RW}{88}{When expansion bus is enabled: Internal ports decoding mask b16-23 Register}
		\nextport{RW}{89}{When expansion bus is enabled: Internal ports decoding mask b24-31 Register}
		\nextport{RW}{8A}{Monitoring internal I/O or adding external keyboard}
		\nextport{RW}{8C}{Enable alternate ROM or lock 48k ROM}
		\nextport{RW}{8E}{Control classic Spectrum memory mapping}
		\nextport{RW}{90-93}{Enables GPIO pins output}
		\nextport{RW}{98-9B}{GPIO pins mapped to Next Register}
		\nextport{RW}{A0}{Enable Pi peripherals: UART, Pi hats, I2C, SPI}
		\nextport{RW}{A2}{Pi I2S controls}
		\nextport{RW}{A3}{Pi I2S clock divide in master mode}
		\nextport{RW}{A8}{ESP WiFi GPIO Output}
		\nextport{RW}{A9}{ESP WiFi GPIO Read/Write}
		\nextport{-W}{B0}{Read Next keyboard compound keys separately}
		\nextport{-W}{B1}{Read Next keyboard compound keys separately}
		\nextport{RW}{B2}{DivMMC trap configuration}
		\nextport{RW}{B4}{DivMMC trap configuration}
		\nextport{R-}{FF}{Turns debug LEDs on and off on TBBlue implementations that have them}

	\end{tbbluereg}
}

\pagebreak
\section{Memory Map and Paging}
\label{zx_next_memorypaging}

\newcommand{\colnoline}[1]{\multicolumn{1}{c}{#1}}

ZX Spectrum Next is 8-bit computer with 16-bit address bus. This means it can access up to 2\textsuperscript{16} = 65.536 bytes or 64K at any given time. This 64K portion of the memory is called "bank" and is further divided into 16K or 8K chunks called "slots".

Unexpanded Next comes with 1024K while expanded with 2048K of memory. To get access to whole of available memory, paging is used. Next supports the following paging schemes:

\subsection{128K and +3 Modes}

Next inherits 128K and 3+ paging modes that divide 64K bank into 16K slots. Of these, bottom 16K is always occupied by ROM:

\begingroup
	\setlength{\tabcolsep}{1pt}
	\begin{tabular}{|ccc|ccc|ccc|ccc|}
		\hline
		\multicolumn{3}{|c}{ROM}\notet\noteb &
			\multicolumn{9}{|c|}{RAM} \\
		\hline
		\multicolumn{3}{|c}{16K}\notet\noteb &
			\multicolumn{3}{|c}{16K} &
			\multicolumn{3}{|c}{16K} &
			\multicolumn{3}{|c|}{16K} \\
		\hline
		\colnoline{$\leftarrow$}\notet & \colnoline{\tt \$0000} & \colnoline{} &
			\colnoline{$\leftarrow$} & \colnoline{\tt \$4000} & \colnoline{} &
			\colnoline{$\leftarrow$} & \colnoline{\tt \$8000} & \colnoline{} &
			\colnoline{$\leftarrow$} & \colnoline{\tt \$C000} & \colnoline{} \\
		\colnoline{} & \colnoline{\tt \$3FFF} & \colnoline{$\rightarrow$} &
			\colnoline{} & \colnoline{\tt \$7FFF} & \colnoline{$\rightarrow$} &
			\colnoline{} & \colnoline{\tt \$BFFF} & \colnoline{$\rightarrow$} &
			\colnoline{} & \colnoline{\tt \$FFFF} & \colnoline{$\rightarrow$} \\
	\end{tabular}
\endgroup

\subsubsection{128K Mode}

Selects 16K ROM to be visible in the bottom 16K slot (memory addresses {\tt \$0000}-{\tt \$3FFF} from 2 possible banks) and 16K RAM to be visible in top 16K slot (memory addresses {\tt \$C000}-{\tt \$FFFF} from 8 possible banks). In other words:

\begin{tabular}{ccccl}
	{\tt \$0000} & {\tt \$4000} & {\tt \$8000} & {\tt \$C000} & \\
	\hline
	$\uparrow$ & & & $\uparrow$ & \\
	\multicolumn{2}{l}{\tt ROM 0-1} & & \multicolumn{2}{l}{{\tt BANK 0-7} on 128K} \\
	& & & \multicolumn{2}{l}{{\tt BANK 0-127} on Next} \\
\end{tabular}

Registers involved are (see section \ref{zx_next_mappingregister} for details):

\begin{itemize}
	\item {\tt \$7FFD} \textbf{Memory Paging Control}
	\item {\tt \$DFFD} \textbf{Next Memory Bank Select}
\end{itemize}

Together 4 bits from {\tt \$DFFD} and 3 from {\tt \$7FFD} form 7 bit bank number.

If you are using the standard interrupt handler or OS routines, then any time you write to Memory Paging Control {\tt \$7FFD} you should also store the value at {\tt \$5B5C}.

Example routine for selecting bank on 128K Spectrum (supports standard interrupt handler and OS routines). Routine takes bank number 0-7 as argument in {\tt B} (on next page):

\begin{Verbatim}[gobble=1]
	switchBank:
		LD A, ($5B5C)     ; get existing value from port
		AND %11111000     ; clear bottom 3 bits
		OR B              ; A now holds the value to be set

		DI                ; interrupts must be disabled

		LD ($5B5C), A     ; write value into $5B5C
		LD BC, $7FFD
		OUT (C), A        ; write same value into $7FFD

		EI                ; enable interrupts
		RET
\end{Verbatim}

To call the routine use:

\begin{Verbatim}
	LD B, 2
	CALL switchBank
\end{Verbatim}

Note: while above routine could be extended to support switching all 127 banks on ZX Spectrum Next by writing top 4 bits to {\tt \$DFFD}, it's much simpler to use Next specific bank switching support as described in section \ref{zx_next_bank_mmu_mode}.

\pagebreak
\subsubsection{+3 ``AllRam'' Mode}

3+ mode allows selecting all 16K slots of 64K bank from limited selection of arrangements. In normal mode, everything works as in 128K Mode, except that we can select from 4 instead of just 2 ROMs:

\begin{tabular}{ccccl}
	{\tt \$0000} & {\tt \$4000} & {\tt \$8000} & {\tt \$C000} & \\
	\hline
	\multirow{2}{*}{$\Big\uparrow$} & & & $\uparrow$ & \\
	& & & {\tt BANK 0-7} \\
	\multicolumn{5}{l}{
		\begin{tabular}{cl}
			{\tt 00} & 0 = 128K editor and menu system \\
			{\tt 01} & 1 = 128K syntax checker \\
			{\tt 10} & 2 = +3 DOS \\
			{\tt 11} & 3 = 48K BASIC \\
			\multicolumn{2}{l}{Hi bit = bit 4 from {\tt \$7FFD}} \\
			\multicolumn{2}{l}{Lo bit = bit 2 from {\tt \$1DDF}} \\
		\end{tabular}
	} \\
\end{tabular}

However, this changes when special mode is enabled by setting bit 0 of {\tt \$1DDF}. In special mode all 4 banks can be changed in the following arrangement:

\begin{tabular}{ccccc}
	& {\tt \$0000} & {\tt \$4000} & {\tt \$8000} & {\tt \$C000} \\
	\hline
	& $\uparrow$ & $\uparrow$ & $\uparrow$ & $\uparrow$\\
	{\tt 00} = & {\tt BANK 0} & {\tt BANK 1} & {\tt BANK 2} & {\tt BANK 3} \\
	{\tt 01} = & {\tt BANK 4} & {\tt BANK 5} & {\tt BANK 6} & {\tt BANK 7} \\
	{\tt 10} = & {\tt BANK 4} & {\tt BANK 5} & {\tt BANK 6} & {\tt BANK 3} \\
	{\tt 11} = & {\tt BANK 4} & {\tt BANK 7} & {\tt BANK 6} & {\tt BANK 3} \\
	\multicolumn{5}{l}{Hi bit = bit 2 from {\tt \$1DDF}} \\
	\multicolumn{5}{l}{Lo bit = bit 1 from {\tt \$1DDF}} \\
\end{tabular}

The following registers control paging in this mode (see section \ref{zx_next_mappingregister} for details):

\begin{itemize}
	\item {\tt \$1FFD} \textbf{Plus 3 Memory Paging Control}
	\item {\tt \$7FFD} \textbf{Memory Paging Control}
	\item {\tt \$DFFD} \textbf{Next Memory Bank Select}
\end{itemize}

Any time you write to Plus 3 Memory Paging Control {\tt \$1FFD} you should also store the value at {\tt \$5B67}.

\pagebreak
\subsection{MMU-based Mode}
\label{zx_next_bank_mmu_mode}

Next unique \textbf{MMU-based Mode} is much more flexible in that it allows mapping 8K chunks into any 8K slot of memory available to CPU. In this mode, 64K memory bank accessible to CPU is divided into 8 slots called MMU0 through MMU7, as shown in diagram below. Physical memory is thus divided into 96 (or 224 in expanded) slots.

\begingroup
	\setlength{\tabcolsep}{1pt}
	\begin{tabular}{|cccc|cccc|cccc|cccc|cccc|cccc|cccc|cccc|}
		\hline
		\multicolumn{4}{|c}{MMU0}\notet\noteb & 
			\multicolumn{4}{|c}{MMU1} & 
			\multicolumn{4}{|c}{MMU2} & 
			\multicolumn{4}{|c}{MMU3} & 
			\multicolumn{4}{|c}{MMU4} & 
			\multicolumn{4}{|c}{MMU5} & 
			\multicolumn{4}{|c}{MMU6} & 
			\multicolumn{4}{|c|}{MMU7} \\
		\hline
		\colnoline{$\leftarrow$}\notet & \multicolumn{2}{c}{\tt \$0000} & \colnoline{} &
			\colnoline{$\leftarrow$}\notet & \multicolumn{2}{c}{\tt \$2000} & \colnoline{} &
			\colnoline{$\leftarrow$}\notet & \multicolumn{2}{c}{\tt \$4000} & \colnoline{} &
			\colnoline{$\leftarrow$}\notet & \multicolumn{2}{c}{\tt \$6000} & \colnoline{} &
			\colnoline{$\leftarrow$}\notet & \multicolumn{2}{c}{\tt \$8000} & \colnoline{} &
			\colnoline{$\leftarrow$}\notet & \multicolumn{2}{c}{\tt \$A000} & \colnoline{} &
			\colnoline{$\leftarrow$}\notet & \multicolumn{2}{c}{\tt \$C000} & \colnoline{} &
			\colnoline{$\leftarrow$}\notet & \multicolumn{2}{c}{\tt \$E000} & \colnoline{} \\
		\colnoline{} & \multicolumn{2}{c}{\tt \$1FFF} & \colnoline{$\rightarrow$} &
			\colnoline{} & \multicolumn{2}{c}{\tt \$3FFF} & \colnoline{$\rightarrow$} &
			\colnoline{} & \multicolumn{2}{c}{\tt \$5FFF} & \colnoline{$\rightarrow$} &
			\colnoline{} & \multicolumn{2}{c}{\tt \$7FFF} & \colnoline{$\rightarrow$} &
			\colnoline{} & \multicolumn{2}{c}{\tt \$9FFF} & \colnoline{$\rightarrow$} &
			\colnoline{} & \multicolumn{2}{c}{\tt \$BFFF} & \colnoline{$\rightarrow$} &
			\colnoline{} & \multicolumn{2}{c}{\tt \$DFFF} & \colnoline{$\rightarrow$} &
			\colnoline{} & \multicolumn{2}{c}{\tt \$FFFF} & \colnoline{$\rightarrow$} \\
	\end{tabular}
\endgroup

MMU selection is set via Next registers:

\begin{itemize}
	\item {\tt \$50}: Selects 8K bank in 8K slot 0
	\item {\tt \$51}: Selects 8K bank in 8K slot 1
	\item {\tt \$52}: Selects 8K bank in 8K slot 2
	\item {\tt \$53}: Selects 8K bank in 8K slot 3
	\item {\tt \$54}: Selects 8K bank in 8K slot 4
	\item {\tt \$55}: Selects 8K bank in 8K slot 5
	\item {\tt \$56}: Selects 8K bank in 8K slot 6
	\item {\tt \$57}: Selects 8K bank in 8K slot 7
\end{itemize}

Each register takes 8-bit page number it should use on memory address it represents. Swapping in 8K bank 10 to address {\tt \$6000-\$7FFF}, can be as simple as:

\begin{Verbatim}[gobble=1]
	NEXTREG $53, 10
\end{Verbatim}


\pagebreak
\subsection{Interaction Between Paging Modes}

In normal 128K mode, changes made in 128K and Next mode memory management are synchronized. The most recent change always has priority. This means that using 128K mode memory management to select a new 16K bank in 16K slot 4 will update the MMU registers for the two 8K slots with the corresponding 8K bank numbers.

However, enabling 3+ "AllRam" mode will override the Next MMU. The bank selections from the 3+ mode will override pages in the Next registers. The MMU registers can still be changed, but they will have no effect until special paging mode is disabled.

Since the 128K mode memory management ports are not readable, there is no synchronization applicable in the other direction.


\subsection{Paging Out ROM}

ROM can be paged out by using +3 "AllRam" or Next MMU-based mode. Beware though that some programs may expect to find ROM routines at fixed addresses between {\tt \$0000} and {\tt \$3FFF}. And if default interrupt mode (IM 1) is set, Z80 will jump PC to {\tt \$0038} expecting to find interrupt handler there.


\subsection{Mapping Mode Registers}
\label{zx_next_mappingregister}

\subsubsection{+3 Memory Paging Control {\tt \$1FFD}}

\begin{tabular}{cp{12cm}}
	Bit & Effect \\
	\hline
	{\tt 7-3}\notet & Unused, use 0 \\
	{\tt 2}\notet & In normal mode high bit of ROM selection, with low bit from bit 4 of {\tt \$7FFD}: \\
	& 
		\begin{tabular}{ll}
			{\tt 00} & ROM0 = 128K editor and menu system \\
			{\tt 01} & ROM1 = 128K syntax checker \\
			{\tt 10} & ROM2 = +3DOS \\
			{\tt 11} & ROM3 = 48K BASIC \\
		\end{tabular}\\
	& In special mode: high bit of memory configuration number \\
	{\tt 1}\notet & In special mode: low bit of memory configuration number \\
	{\tt 0}\notet & Paging mode: 0 = normal, 1 = special \\
\end{tabular}

\subsubsection{Memory Paging Control {\tt \$7FFD}}

\begin{tabular}{cp{12cm}}
	Bit & Effect \\
	\hline
	{\tt 7-6}\notet & 
		Extra two bits for 16K RAM bank if in Pentagon 512K mode (see \textbf{Next Memory Bank Select} \$DFFD) \\
	{\tt 5}\notet &
		Lock memory paging (setting to 1 locks pages and cannot be unlocked until next reset on regular ZX128) \\
	{\tt 4}\notet &
		ROM select (0 = 128k editor, 1 = 48k basic) on 128K, low bit of ROM select on +2/+3 \\
	{\tt 3}\notet &
		ULA layer shadow screen toggle (0 = bank 5, 1 = bank 7) \\
	{\tt 2-0}\notet &
		Bank number for slot 4 (\$C000) \\
\end{tabular}

\subsubsection{Next Memory Bank Select {\tt \$DFFD}}

\begin{tabular}{cp{12cm}}
	Bit & Effect \\
	\hline
	{\tt 7}\notet & 
		1 to set pentagon 512K mode \\
	{\tt 3-0}\notet &
		Most significant bits of the 16K RAM bank selected in \textbf{Memory Paging Control} \$7FFD  \\
\end{tabular}


\pagebreak
\section{Keyboard}
\label{zx_next_keyboard}

Keyboard is read from port {\tt \$ssFE} where bits in result are as follows:

{
	\tt
	\setlength{\extrarowheight}{0pt}
	\def\arraystretch{0.1}
	
	\begin{tabular}{p{0.7cm}|cp{1cm}p{1cm}p{1cm}p{1.3cm}p{1.5cm}}

		~ss & & 4 & 3 & 2 & 1 & 0 \instrb \\
		\hline
		\$7F\instrt & & B & N & M & Symb & Space \\
		\$BF\instrt & & H & J & K & L & Enter \\
		\$DF\instrt & & Y & U & I & O & P \\
		\$EF\instrt & & 6 & 7 & 8 & 9 & 0 \\
		\$F7\instrt & & 5 & 4 & 3 & 2 & 1 \\
		\$FB\instrt & & T & R & E & W & Q \\
		\$FD\instrt & & G & F & D & S & A \\
		\$FE\instrt\instrb & & V & C & X & Z & Caps \\

	\end{tabular}
}

If key is pressed, corresponding bit is set to {\tt 0} and vice versa. Example for checking if P or I is pressed:
	
\begin{Verbatim}
	LD BC, $DFFE   ; We want to read keys:   YUIOP
	IN A, (C)      ; A holds values in bits: 43210
checkP:
	BIT 0, A       ; test bit 0 of A (P key)
	JR NZ checkI   ; if bit0=1, P not pressed
	...            ; P is pressed
checkI:
	BIT 2, A       ; test bit 2 of A (I key)
	JR NZ continue ; if bit2=1, I not pressed
	...            ; I is pressed
continue:
\end{Verbatim}

We can slightly improve performance if we replace first two lines with:

\begin{Verbatim}
	LD A, $DF
	IN ($FE)
\end{Verbatim}

Using 16-bit load requires 10 T states for ``{\tt LD BC,nn}'' + 12 for ``{\tt IN A,(C)}'' whereas later variant requires 7 T states for ``{\tt LD A,nn}'' + 11 for ``{\tt IN (nn)}''. So 22 vs 18. The difference is small, but it can add up as typically keyboard is read multiple times per frame.

First program is more understandable at a glance - port address is given as whole 16-bit value, as usually provided in documentation. The second program splits it into 2 8-bit values, so intent may not be immediately apparent. Of course, one learns the patterns with experience, but it nonetheless demonstrates the compromise between readability and speed.



\chapter{Instructions at a Glance}

This chapters presents all instructions at a glance for quick info and to easily compare them when choosing most optimal combination for task at hand. Instructions are grouped into logical sections based on area they operate on.

\minitoc

\pagebreak

% couple shorthands for keeping text more readable
\newcommand{\FS}{$\updownarrow$} % standard effect
\newcommand{\FN}{-} % no effect
\newcommand{\FU}{?} % unknown effect
\newcommand{\FX}{$\bullet$}
\newcommand{\FPV}{VF} % Overflow
\newcommand{\FPP}{PF} % Parity

\subsubsection{Instruction Execution}

\begin{tabular}{ll}
	B & 
		Number of bytes instruction uses \\
	Mc\notet & 
		Number of machine cycles instruction requires to execute \\
	Ts\notet & 
		Number of states instruction requires to execute \\
\end{tabular}

\subsubsection{Status Flags}

\begin{tabular}{lp{13cm}}
	SF & 
		Set if the 2-complement value is negative.  Its simply a copy of the most significant bit \\
	ZF\notet & 
		Set if the result is zero. \\
	HY\notet & 
		The half-carry of an addition/subtraction (from bit 3 to 4). Needed for BCD correctionwith {\tt DAA} \\
	PF\notet & 
		This flag can either be the parity of the result ({\tt PF}), or the 2-complement signed overflow ({\tt VF}): set if 2-complement value doesnt fit in the register \\
	NF\notet & 
		Shows whether the last operation was an addition (0) or an subtraction  (1). This information is needed for {\tt DAA} \\
	CF\notet & 
		The carry flag, set if there was a carry after the most significant bit \\
\end{tabular}

(copied from section \ref{flags} as convenience; note {\tt YF} and {\tt XF} flags are not represented in the tables; they're irrelevant from programmer point of view; they simply contain a copy of bit 5 and 3 of Accumulator, but special cases are described)

\subsubsection{Effects}

\begin{tabular}{cl}
	{\tt 0}/{\tt 1} & Flag is set to {\tt 0} or {\tt 1} \\
	{\tt \FS} & Flag is modified according to operation \\
	{\tt \FN} & Flag is not affected \\
	{\tt \FU} & Effect on flag is unpredictable \\
	{\tt VF} & P/V flag is used as overflow \\
	{\tt PF} & P/V flag is used as parity \\
	{\tt \FX} & Special case, see description in section \ref{instruction_details}
\end{tabular}


\pagebreak

%------------------------------------------------------------------------------
%
% INSTRUCTION TABLE DECLARATIONS
%
%------------------------------------------------------------------------------

% this is internal definition for instruction table that takes 2 arguments: first 2 column definitions and body. It should only be used by NewEnviron macros, not intended as general purpose macro by itself (it could be used, but then tables would not be defined with begin/end)
\newcommand{\INSTRTABLEBODYDECL}[2]{
	{
		\footnotesize
		\setlength{\fboxsep}{0.25mm}
		\setlength{\tabcolsep}{0.75mm}
		
		\begin{tabularx}{\textwidth}{#1ccccccp{1pt}cccccp{1pt}ccp{1pt}l}
			\hline
			
			% top header line
			\notet & 
			Symbolic &
			\multicolumn{6}{c}{Flags} & &
			\multicolumn{3}{c}{Opcode} &
			& \\
		
			% bottom header line
			Mnemonic & 
			Operation &
			SF & ZF & HF & PV & NF & CF & &
			{\tt 76} & {\tt 543} & {\tt 210} & 
			Hex & B & & 
			Mc & Ts & &
			Comments \\
		
			\hline
		
			#2
		
			\\ % we need this newline in here otherwise \hline below will end in error; it's because hline can only be inserted after \\ - even though \\ will be present by the time table is generated with instruction macros, compiler requires it at this point as well. Consequently, the last instruction in table should use lastinstruction macro to compensate - so far I wasn't able to get better solution (interestingly, this similar approach works for notestable \_()_/)
		
			\hline

		\end{tabularx}
	}
}

% declares instrtable environment that sets up everything for instruction tables; this should suffice for most tables, mnemonic and symbolic operation columns are same width
\environbodyname\INSTRTABLEBODY
\NewEnviron{instrtable}{\INSTRTABLEBODYDECL{XX}{\INSTRTABLEBODY}}
% this table restricts mnemonic witdh and uses all remaining available width for symbolic opreation
\NewEnviron{instrtablesymbol}{\INSTRTABLEBODYDECL{p{6em}X}{\INSTRTABLEBODY}}

% defines instruction environment that embeds each instruction. Instruction mnemonic is taken as parameter, mainly to show it when environment is collapsed in editor. Note this needs to use \xdef and be an ugly mess of oneliner otherwise mnemonic will be right aligned...
\environbodyname\INSTRBODY
\NewEnviron{instruction}[1]{\xdef\instructionbody{\unexpanded{{\tt #1}\instrt&}\unexpanded\expandafter{\INSTRBODY}\unexpanded{\instrb\\}}
\aftergroup\instructionbody
}
\environbodyname\INSTRBODY
\NewEnviron{lastinstruction}[1]{\xdef\instructionbody{\unexpanded{{\tt #1}\instrt&}\unexpanded\expandafter{\INSTRBODY}\unexpanded{\instrb}}
\aftergroup\instructionbody
}

% writes symbolic operation (for the moment nothing special, but we may change it in the future and it will automatically be applied for all items); variant with S with add 3 dots after argument and one with P will add them in front; for multiline expressions
\newcommand{\Symbol}[1]{\scriptsize {\tt #1} &}
\newcommand{\SymbolS}[1]{\scriptsize {\tt #1}\ddd &}
\newcommand{\SymbolP}[1]{\scriptsize \ddd{\tt #1} &}

% writes flags section + couple shorthands for symbolic flags
\newcommand{\Flags}[6]{{\tt #1} & {\tt #2} & {\tt #3} & {\tt #4} & {\tt #5} & {\tt #6} & &}

% writes bitwise opcodes section
\newcommand{\OpCode}[3]{{\tt #1} & {\tt #2} & {\tt #3} &}

% writes given text embedded into left and right arrows; use instead of OpCode
\newcommand{\OpRange}[1]{\multicolumn{3}{c}{{\tt $|\longleftarrow$ #1 $\longrightarrow|$}} &}

% writes hex opcode and number of bytes
\newcommand{\Hex}[2]{{\tt #1} & {\tt #2} & &}

% writes machine cycles and T states
\newcommand{\Cycles}[2]{{\tt #1} & {\tt #2} & &}

% writes a comment
\newcommand{\Comment}[1]{\scriptsize #1}

\newcommand{\SkipToSymbol}{\\ &}
\newcommand{\FromSymbolToOpCode}{& \multicolumn{6}{l}{} &}

% skips whole table up until the opcodes part. difference between the 2 is insertion of new line before; use StartWithOpCode variant for empty line, the other inside instruction block
% note that compiler is not happy with StartWithOpCode without using something in front of \multiline hence given solution
\newcommand{\SkipToOpCode}{\\ \multicolumn{9}{l}{} &}
\newcommand{\StartWithOpCode}{& \multicolumn{8}{l}{} &}

% writes an empty line with optional data in the last column
% note again that we need to use some char before \multicolmn to keep compiler happy
\newcommand{\Empty}[1]{& \multicolumn{16}{l}{} & \Comment{#1} \\}

% writes a table break with vertical spacing so table starts at the same height as on previous page
\newcommand{\InstrTableContinue}{
	\vspace*{-2.5ex}
	{
		\scriptsize
		(continued on next page)
	}
}

%------------------------------------------------------------------------------
%
% NOTES TABLE DECLARATIONS
%
%------------------------------------------------------------------------------

% defines table for notes; unfortunately I wasn't able to add notes to the same table created using above macros, so we need to use separate one. 
% Note: you should embed both tables into minipage to keep them together; while we could create macro for that too, we'd lose ability to collapse in editor
\environbodyname\NOTEBODY
\NewEnviron{notestable}{
	{
		\scriptsize
		\setlength{\fboxsep}{1pt}	% keep fboxes tight to keep notes vertically short
		\renewcommand{\arraystretch}{1}
		
		\begin{tabularx}{\textwidth}{lX}
			Notes:

			\NOTEBODY

			\hline

		\end{tabularx}
	}
}

% writes a note item
\newcommand{\NoteItem}[1]{& #1 \\}

\newcommand{\NoteTableSingleItemSpaceCorrection}{
	\vspace*{-1ex}	% single notes table results in some vertical spacing, so we need to manually move it upwards a bit...
}


\section{8-Bit Arithmetic and Logical}

\begin{minipage}{\textwidth}

\begin{instrtable}

	\begin{instruction}{ADD A,r}
		\Symbol{A$\leftarrow$A+r}
			\Flags{\FS}{\FS}{\FS}{\FPV}{0}{\FS}
			\OpCode{10}{\fbox{000}}{r}
			\Hex{..}{1}
			\Cycles{1}{4}
			\Comment{
				\tt
				\multirow{7}{*}{
					\begin{tabular}{ll}
						r & Reg \\
						\hline
						000 & B \\
						001 & C \\
						010 & D \\
						011 & E \\
						100 & H \\
						101 & L \\
						111 & A \\
					\end{tabular}
				}
			}
	\end{instruction}

	\begin{instruction}{ADD A,p}
		\Symbol{A$\leftarrow$A+p}
			\Flags{\FS}{\FS}{\FS}{\FPV}{0}{\FS}
			\OpCode{11}{011}{101}
			\Hex{DD}{2} 
			\Cycles{2}{8}
		\SkipToOpCode
			\OpCode{10}{\fbox{000}}{p}
			\Hex{..}{}
			\Cycles{}{}
			\instrb
	\end{instruction}

	\begin{instruction}{ADD A,q} 
		\Symbol{A$\leftarrow$A+q}
			\Flags{\FS}{\FS}{\FS}{\FPV}{0}{\FS}
			\OpCode{11}{111}{101}
			\Hex{FD}{2}
			\Cycles{2}{8}
		\SkipToOpCode
			\OpCode{10}{\fbox{000}}{q}
			\Hex{..}{}
			\instrb
	\end{instruction}

	\begin{instruction}{ADD A,n}
		\Symbol{A$\leftarrow$A+n}
			\Flags{\FS}{\FS}{\FS}{\FPV}{0}{\FS}
			\OpCode{11}{\fbox{000}}{110}
			\Hex{C6}{2}
			\Cycles{2}{7}
		\SkipToOpCode
			\OpRange{n}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{ADD A,(HL)}
		\Symbol{A$\leftarrow$A+(HL)}
			\Flags{\FS}{\FS}{\FS}{\FPV}{0}{\FS}
			\OpCode{10}{\fbox{000}}{110}
			\Hex{86}{1} 
			\Hex{2}{7}
			\Comment{
				\multirow{8}{*}{
					\tt
					\begin{tabular}{ll}
						p & Reg \\
						\hline
						000 & B \\
						001 & C \\
						010 & D \\
						011 & E \\
						100 & IXh \\
						101 & IXl \\
						111 & A \\
					\end{tabular}
				}
			}
	\end{instruction}

	\begin{instruction}{ADD A,(IX+d)}
		\Symbol{A$\leftarrow$A+(IX+d)}
			\Flags{\FS}{\FS}{\FS}{\FPV}{0}{\FS}
			\OpCode{11}{011}{101}
			\Hex{DD}{3}
			\Cycles{5}{19}
		\SkipToOpCode
			\OpCode{10}{\fbox{000}}{110}
			\Hex{68}{}
		\SkipToOpCode
			\OpRange{d}
			\Hex{..}{}
	\end{instruction}
	
	\begin{instruction}{ADD A,(IY+d)}
		\Symbol{A$\leftarrow$A+(IY+d)}
			\Flags{\FS}{\FS}{\FS}{\FPV}{0}{\FS}
			\OpCode{11}{111}{101}
			\Hex{FD}{3}
			\Cycles{5}{19}
		\SkipToOpCode
			\OpCode{10}{\fbox{000}}{110}
			\Hex{68}{}
		\SkipToOpCode
			\OpRange{d}
			\Hex{..}{}
	\end{instruction}

	\StartWithOpCode\OpCode{}{$\uparrow$}{}\\

	\begin{instruction}{ADC A,s\See{2}}
		\Symbol{A$\leftarrow$A+s+CF}
		\Flags{\FS}{\FS}{\FS}{\FPV}{0}{\FS}
		\OpCode{..}{\fbox{001}}{...} 
		\Hex{}{}
		\Cycles{}{}
		\Comment{
			\multirow{8}{*}{
				\tt
				\begin{tabular}{ll}
					q & Reg \\
					\hline
					000 & B \\
					001 & C \\
					010 & D \\
					011 & E \\
					100 & IYh \\
					101 & IYl \\
					111 & A \\
				\end{tabular}
			}
		}
	\end{instruction}

	\begin{instruction}{SUB s\See{2}}
		\Symbol{}
			\Flags{\FS}{\FS}{\FS}{\FPV}{1}{\FS}
			\OpCode{..}{\fbox{010}}{...}
	\end{instruction}

	\begin{instruction}{SBC A,s\See{2}}
		\Symbol{A$\leftarrow$A-s-CF}
			\Flags{\FS}{\FS}{\FS}{\FPV}{1}{\FS}
			\OpCode{..}{\fbox{011}}{...}
	\end{instruction}

	\begin{instruction}{AND s\See{2}}
		\Symbol{A$\leftarrow$A$\wedge$s}
			\Flags{\FS}{\FS}{1}{\FPP}{0}{0}
			\OpCode{..}{\fbox{100}}{...}
	\end{instruction}

	\begin{instruction}{OR s\See{2}}	
		\Symbol{A$\leftarrow$A$\vee$s}
			\Flags{\FS}{\FS}{0}{\FPP}{0}{0}
			\OpCode{..}{\fbox{110}}{...}
	\end{instruction}

	\begin{instruction}{XOR s\See{2}}
		\Symbol{A$\leftarrow$A$\bullet$s}
			\Flags{\FS}{\FS}{0}{\FPP}{0}{0}
			\OpCode{..}{\fbox{101}}{...}
	\end{instruction}

	\begin{instruction}{CP s\See{1,2}}
		\Symbol{A-s}
			\Flags{\FS}{\FS}{\FS}{\FPV}{1}{\FS}
			\OpCode{..}{\fbox{111}}{...}
	\end{instruction}

	\Empty{}

	\begin{instruction}{INC r} 
			\Symbol{r$\leftarrow$r+1}
			\Flags{\FS}{\FS}{\FS}{\FPV}{0}{\FN}
			\OpCode{00}{r}{\fbox{100}}
			\Hex{..}{1}
			\Cycles{1}{4}
	\end{instruction}

	\begin{instruction}{INC p}
		\Symbol{p$\leftarrow$p+1}
			\Flags{\FS}{\FS}{\FS}{\FPV}{0}{\FN}
			\OpCode{11}{011}{101}
			\Hex{DD}{2}
			\Cycles{2}{8}
		\SkipToOpCode
			\OpCode{00}{p}{\fbox{100}}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{INC q}
		\Symbol{q$\leftarrow$q+1}
			\Flags{\FS}{\FS}{\FS}{\FPV}{0}{\FN}
			\OpCode{11}{111}{101}
			\Hex{FD}{2}
			\Hex{2}{8}
		\SkipToOpCode
			\OpCode{00}{q}{\fbox{100}}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{INC (HL)}
		\Symbol{(HL)$\leftarrow$(HL)+1}
			\Flags{\FS}{\FS}{\FS}{\FPV}{0}{\FN}
			\OpCode{00}{110}{\fbox{100}}
			\Hex{34}{1}
			\Cycles{3}{11}
	\end{instruction}

	\begin{instruction}{INC (IX+d)}
		\Symbol{(IX+d)$\leftarrow$}
			\Flags{\FS}{\FS}{\FS}{\FPV}{0}{\FN}
			\OpCode{11}{011}{101}
			\Hex{DD}{3}
			\Cycles{6}{23}
		\SkipToSymbol
			\Symbol{~~(IX+d)+1}
			\FromSymbolToOpCode
			\OpCode{00}{110}{\fbox{100}}
			\Hex{34}{}
		\SkipToOpCode
			\OpRange{d}
	\end{instruction}

	\begin{instruction}{INC (IY+d)}
		\Symbol{(IY+d)$\leftarrow$}
			\Flags{\FS}{\FS}{\FS}{\FPV}{0}{\FN}
			\OpCode{11}{111}{101}
			\Hex{FD}{3}
			\Cycles{6}{23}
		\SkipToSymbol
			\Symbol{~~(IY+d)+1}
			\FromSymbolToOpCode
			\OpCode{00}{110}{\fbox{100}}
			\Hex{34}{}
		\SkipToOpCode
			\OpRange{d}
	\end{instruction}

	\StartWithOpCode\OpCode{}{}{$\uparrow$} \\

	\begin{lastinstruction}{DEC m\See{3}}
		\Symbol{m$\leftarrow$m-1}
			\Flags{\FS}{\FS}{\FS}{\FPV}{1}{\FN}
			\OpCode{..}{...}{\fbox{101}}
	\end{lastinstruction}

\end{instrtable}

\begin{notestable}
	\NoteItem{\See{1}YF and XF flags are copied from the operand {\tt s}, not the result {\tt A-s}}

	\NoteItem{\See{2}{\tt s} is any of {\tt r}, {\tt p}, {\tt q}, {\tt n}, {\tt (HL)}, {\tt (IX+d)}, {\tt (IY+d)} as shown for {\tt ADD}. Replace \fbox{{\tt 000}} in the {\tt ADD} set above}

	\NoteItem{\See{3}{\tt m} is any of {\tt r}, {\tt p}, {\tt q}, {\tt n}, {\tt (HL)}, {\tt (IX+d)}, {\tt (IY+d)} as shown for {\tt INC}. Replace \fbox{{\tt 100}} with \fbox{{\tt 101}} in opcode}
\end{notestable}

\end{minipage}


\section{16-Bit Arithmetic}

\begin{minipage}{\textwidth}

\begin{instrtable}
	\begin{instruction}{ADD HL,ss} 
		\Symbol{HL$\leftarrow$HL+ss}
			\Flags{\FN}{\FN}{\FU\See{2}}{\FN}{0}{\FS\See{1}}
			\OpCode{00}{ss1}{001}
			\Hex{..}{1}
			\Cycles{3}{11}
			\Comment{
				\tt
				\multirow{4}{*}{
					\begin{tabular}{ll}
						ss & Reg \\
						\hline
						00 & BC \\
						01 & DE \\
						10 & HL \\
						11 & SP \\
					\end{tabular}
				}
			}
	\end{instruction}

	\begin{instruction}{ADC HL,ss} 
		\Symbol{HL$\leftarrow$HL+ss+CF}
			\Flags{\FS\See{1}}{\FS\See{1}}{\FU\See{2}}{\FPV\See{1}}{0}{\FS\See{1}}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{4}{15}
		\SkipToOpCode
			\OpCode{01}{ss1}{010}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{SBC HL,ss} 
		\Symbol{HL$\leftarrow$HL-ss-CF}
			\Flags{\FS\See{1}}{\FS\See{1}}{\FU\See{2}}{\FPV\See{1}}{1}{\FS\See{1}}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{4}{15}
		\SkipToOpCode
			\OpCode{01}{ss0}{010}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{ADD IX,pp} 
		\Symbol{IX$\leftarrow$IX+pp}
			\Flags{\FN}{\FN}{\FS\See{2}}{\FN}{0}{\FS\See{1}}
			\OpCode{11}{011}{110}
			\Hex{DD}{2}
			\Cycles{4}{15}
			\Comment{
				\multirow{4}{*}{
					\tt
					\begin{tabular}{ll}
						pp & Reg \\
						\hline
						00 & BC \\
						01 & DE \\
						10 & IX \\
						11 & SP \\
					\end{tabular}
				}
			}
		\SkipToOpCode
			\OpCode{00}{pp1}{001}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{ADD IY,qq} 
		\Symbol{IY$\leftarrow$IY+qq}
			\Flags{\FN}{\FN}{\FS\See{2}}{\FN}{0}{\FS\See{1}}
			\OpCode{11}{111}{110}
			\Hex{FD}{2}
			\Cycles{4}{15}
		\SkipToOpCode
			\OpCode{00}{qq1}{001}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{INC ss} 
		\Symbol{ss$\leftarrow$ss+1}
		\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
		\OpCode{00}{ss0}{011}
		\Hex{..}{1}
		\Cycles{1}{6}
	\end{instruction}

	\begin{instruction}{INC IX} 
		\Symbol{IX$\leftarrow$IX+1}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{011}{101}
			\Hex{DD}{2}
			\Cycles{2}{10}
			\Comment{
				\multirow{4}{*}{
					\tt
					\begin{tabular}{ll}
						qq & Reg \\
						\hline
						00 & BC \\
						01 & DE \\
						10 & IY \\
						11 & SP \\
					\end{tabular}
				}
			}
		\SkipToOpCode
			\OpCode{00}{100}{011}
			\Hex{23}{}
	\end{instruction}

	\begin{instruction}{INC IY} 
		\Symbol{IY$\leftarrow$IY+1}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{111}{101}
			\Hex{FD}{2}
			\Cycles{2}{10}
		\SkipToOpCode
			\OpCode{00}{100}{011}
			\Hex{23}{}
	\end{instruction}

	\begin{instruction}{DEC ss} 
		\Symbol{ss$\leftarrow$ss-1}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{00}{ss1}{011}
			\Hex{..}{1}
			\Cycles{1}{6}
	\end{instruction}

	\begin{instruction}{DEC IX} 
		\Symbol{IX$\leftarrow$IX-1}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{011}{101}
			\Hex{DD}{2}
			\Cycles{2}{10}
		\SkipToOpCode
			\OpCode{00}{101}{011}
			\Hex{2B}{}
	\end{instruction}

	\begin{lastinstruction}{DEC IY} 
		\Symbol{IY$\leftarrow$IY-1}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{111}{101}
			\Hex{FD}{2}
			\Cycles{2}{10}
		\SkipToOpCode
			\OpCode{00}{101}{011}
			\Hex{2B}{}
	\end{lastinstruction}

\end{instrtable}

\begin{notestable}
	\NoteItem{\See{1}Flag is affected by the 16 bit result.}
	\NoteItem{\See{2}Flag is affected by the high-byte addition.}
\end{notestable}

\end{minipage}



\section{8-Bit Load}

\begin{instrtable}	

	\begin{instruction}{LD r,r'}
		\Symbol{r$\leftarrow$r'}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{01}{r}{r'}
			\Hex{..}{1}
			\Cycles{1}{4}
			\Comment{
				\tt
				\multirow{7}{*}{
					\begin{tabular}{ll}
						r,r' & Reg \\
						\hline
						000 & B \\
						001 & C \\
						010 & D \\
						011 & E \\
						100 & H \\
						101 & L \\
						111 & A \\
					\end{tabular}
				}
			}
	\end{instruction}

	\begin{instruction}{LD r,r'}
		\Symbol{r$\leftarrow$r'}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{01}{r}{r'}
			\Hex{..}{1}
			\Cycles{1}{4}
	\end{instruction}
		
	\begin{instruction}{LD p,p'}
		\Symbol{p$\leftarrow$p'}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{011}{101} 
			\Hex{DD}{2}
			\Cycles{2}{8}
		\SkipToOpCode
			\OpCode{01}{p}{p'}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{LD q,q'}
		\Symbol{q$\leftarrow$q'}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{111}{101}
			\Hex{FD}{2} 
			\Cycles{2}{8}
	\SkipToOpCode
		\OpCode{01}{q}{q'}
		\Hex{..}{}
	\end{instruction}

	\begin{instruction}{LD r,n}
		\Symbol{r$\leftarrow$n}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{00}{r}{110}
			\Hex{..}{2} 
			\Cycles{2}{7}
		\SkipToOpCode
			\OpRange{n}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{LD p,n}
		\Symbol{p$\leftarrow$n}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{011}{101}
			\Hex{DD}{3} 
			\Cycles{3}{11}
		\SkipToOpCode
			\OpCode{00}{p}{110}
			\Hex{..}{}
		\SkipToOpCode
			\OpRange{n}
			\Hex{..}{}
	\end{instruction}
	
	\begin{instruction}{LD q,n}
		\Symbol{q$\leftarrow$n} 
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{111}{101}
			\Hex{FD}{3}
			\Cycles{3}{11}
			\Comment{
				\multirow{7}{*}{
					\tt
					\begin{tabular}{ll}
						p,p' & Reg \\
						\hline
						000 & B \\
						001 & C \\
						010 & D \\
						011 & E \\
						100 & IXh \\
						101 & IXl \\
						111 & A \\
					\end{tabular}
				}
			}
		\SkipToOpCode
			\OpCode{00}{q}{110}
			\Hex{..}{}
		\SkipToOpCode
			\OpRange{n}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{LD r,(HL)}
		\Symbol{r$\leftarrow$(HL)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{01}{r}{110}
			\Hex{..}{1}
			\Cycles{2}{7}
	\end{instruction}

	\begin{instruction}{LD r,(IX+d)}
		\Symbol{r$\leftarrow$(IX+d)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{011}{101}
			\Hex{DD}{3}
			\Cycles{5}{19}
		\SkipToOpCode
			\OpCode{01}{r}{110}
			\Hex{..}{}
		\SkipToOpCode
			\OpRange{d}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{LD r,(IY+d)}
		\Symbol{r$\leftarrow$(IY+d)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{111}{101}
			\Hex{FD}{3}
			\Cycles{5}{19}
		\SkipToOpCode
			\OpCode{01}{r}{110}
			\Hex{..}{}
		\SkipToOpCode
			\OpRange{d}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{LD (HL),r}
		\Symbol{(HL)$\leftarrow$r}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{01}{110}{r}
			\Hex{..}{1} 
			\Cycles{2}{7}
	\end{instruction}

	\begin{instruction}{LD (IX+d),r}
		\Symbol{(IX+d)$\leftarrow$r}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{011}{101}
			\Hex{DD}{3}
			\Cycles{5}{19}
			\Comment{
				\multirow{7}{*}{
					\tt
					\begin{tabular}{ll}
						q,q' & Reg \\
						\hline
						000 & B \\
						001 & C \\
						010 & D \\
						011 & E \\
						100 & IYh \\
						101 & IYl \\
						111 & A \\
					\end{tabular}
				}
			}
		\SkipToOpCode
			\OpCode{01}{110}{r}
			\Hex{..}{}
		\SkipToOpCode
			\OpRange{d}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{LD (IY+d),r}
		\Symbol{(IY+d)$\leftarrow$r}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{111}{101} 
			\Hex{FD}{3} 
			\Cycles{5}{19}
		\SkipToOpCode
			\OpCode{01}{110}{r}
			\Hex{..}{}
		\SkipToOpCode
			\OpRange{d}
			\Hex{..}{}
	\end{instruction}

	\begin{lastinstruction}{LD (HL),n}
		\Symbol{(HL)$\leftarrow$n}
		\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
		\OpCode{00}{110}{110}
		\Hex{36}{2}
		\Cycles{3}{10}
	\SkipToOpCode
		\OpRange{n}
		\Hex{..}{}
	\end{lastinstruction}

\end{instrtable}

\InstrTableContinue
\pagebreak
\vspace*{0.4cm}

\begin{instrtable}

	\begin{instruction}{LD (IX+d),n} 
		\Symbol{(IX+d)$\leftarrow$n}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{011}{101}
			\Hex{DD}{4}
			\Cycles{5}{19}
		\SkipToOpCode
			\OpCode{00}{110}{110}
			\Hex{36}{}
		\SkipToOpCode
			\OpRange{d}
			\Hex{..}{}
		\SkipToOpCode
			\OpRange{n}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{LD (IY+d),n} 
		\Symbol{(IY+d)$\leftarrow$n}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{111}{101}
			\Hex{FD}{4}
			\Cycles{5}{19}
		\SkipToOpCode
			\OpCode{00}{110}{110}
			\Hex{36}{}
		\SkipToOpCode
			\OpRange{d}
			\Hex{..}{}
		\SkipToOpCode
			\OpRange{n}
			\Hex{..}{}
	\end{instruction}
	
	\begin{instruction}{LD A,(BC)} 
		\Symbol{A$\leftarrow$(BC)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{00}{001}{010}
			\Hex{0A}{1}
			\Cycles{2}{7}
	\end{instruction}

	\begin{instruction}{LD A,(DE)} 
		\Symbol{A$\leftarrow$(DE)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{00}{011}{01}
			\Hex{1A}{1}
			\Cycles{2}{7}
	\end{instruction}

	\begin{instruction}{LD A,(nm)} 
		\Symbol{A$\leftarrow$(nm)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{00}{111}{010}
			\Hex{3A}{3}
			\Cycles{4}{13}
		\SkipToOpCode
			\OpRange{m}
			\Hex{..}{}
		\SkipToOpCode
			\OpRange{n}
			\Hex{..}{}
	\end{instruction}
	
	\begin{instruction}{LD (BC),A} 
		\Symbol{(BC)$\leftarrow$A}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{00}{000}{010}
			\Hex{02}{1}
			\Cycles{2}{7}
	\end{instruction}

	\begin{instruction}{LD (DE),A} 
		\Symbol{(DE)$\leftarrow$A}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{00}{010}{010}
			\Hex{12}{1}
			\Cycles{2}{7}
	\end{instruction}

	\begin{instruction}{LD (nm),A} 
		\Symbol{(nm)$\leftarrow$A}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{00}{110}{010}
			\Hex{32}{3}
			\Cycles{4}{13}
		\SkipToOpCode
			\OpRange{m}
			\Hex{..}{}
		\SkipToOpCode
			\OpRange{n}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{LD A,I} 
		\Symbol{A$\leftarrow$I}
			\Flags{\FS}{\FS}{0}{{\tiny FF2}}{0}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{2}{9}
		\SkipToOpCode
			\OpCode{01}{010}{111}
			\Hex{57}{}
	\end{instruction}

	\begin{instruction}{LD A,R} 
		\Symbol{A$\leftarrow$R}
			\Flags{\FS}{\FS}{0}{{\tiny IFF2}}{0}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{2}{9}
		\SkipToOpCode
			\OpCode{01}{011}{111}
			\Hex{5F}{}
	\end{instruction}

	\begin{instruction}{LD I,A} 
		\Symbol{I$\leftarrow$A}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{2}{9}
		\SkipToOpCode
			\OpCode{01}{000}{111}
			\Hex{47}{}
	\end{instruction}

	\begin{lastinstruction}{LD R,A} 
		\Symbol{R$\leftarrow$A}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{2}{9}
		\SkipToOpCode
			\OpCode{01}{001}{111}
			\Hex{4F}{}
	\end{lastinstruction}

\end{instrtable}


\section{16-Bit Load}

\begin{instrtable}

	\begin{instruction}{LD dd,nm} 
		\Symbol{dd$\leftarrow$nm}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{00}{dd0}{001} 
			\Hex{..}{3} 
			\Cycles{3}{10}
			\Comment{
				\tt
				\multirow{4}{*}{
					\begin{tabular}{ll}
						dd & Reg \\
						\hline
						00 & BC \\
						01 & DE \\
						10 & HL \\
						11 & SP \\
					\end{tabular}
				}
			}
		\SkipToOpCode 
			\OpRange{m} 
			\Hex{..}{}
		\SkipToOpCode 
			\OpRange{n} 
			\Hex{..}{} 
	\end{instruction}

	\begin{instruction}{LD IX,nm} 
		\Symbol{IX$\leftarrow$nm}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{011}{101}
			\Hex{DD}{4}
			\Cycles{4}{14}
		\SkipToOpCode 
			\OpCode{00}{100}{001}
			\Hex{21}{}
		\SkipToOpCode 
			\OpRange{m} 
			\Hex{..}{}
		\SkipToOpCode 
			\OpRange{n} 
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{LD IY,nm} 
		\Symbol{IX$\leftarrow$nm}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{111}{101}
			\Hex{FD}{4}
			\Cycles{4}{14}
		\SkipToOpCode 
			\OpCode{00}{100}{001}
			\Hex{21}{}
		\SkipToOpCode 
			\OpRange{m} 
			\Hex{..}{}
		\SkipToOpCode 
			\OpRange{n} 
			\Hex{..}{} 
	\end{instruction}

	\begin{instruction}{LD HL,(nm)} 
		\Symbol{H$\leftarrow$(nm+1)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{00}{101}{010}
			\Hex{2A}{3}
			\Cycles{5}{16}
		\SkipToSymbol
			\Symbol{L$\leftarrow$(nm)}
			\FromSymbolToOpCode
			\OpRange{m}
			\Hex{..}{}
		\SkipToOpCode 
			\OpRange{n} 
			\Hex{..}{} 
	\end{instruction}

	\begin{instruction}{LD dd,(nm)} 
		\Symbol{ddh$\leftarrow$(nm+1)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{4}
			\Cycles{6}{20}
		\SkipToSymbol
			\Symbol{ddl$\leftarrow$(nm)}
			\FromSymbolToOpCode
			\OpCode{01}{dd1}{011}
			\Hex{..}{}
		\SkipToOpCode 
			\OpRange{m} 
			\Hex{..}{}
		\SkipToOpCode 
			\OpRange{n} 
			\Hex{..}{} 
	\end{instruction}

	\begin{instruction}{LD IX,(nm)}
		\Symbol{IXh$\leftarrow$(nm+1)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{011}{101}
			\Hex{DD}{4}
			\Cycles{6}{20}
		\SkipToSymbol
			\Symbol{IXl$\leftarrow$(nm)}
			\FromSymbolToOpCode
			\OpCode{00}{101}{010}
			\Hex{2A}{}
		\SkipToOpCode
			\OpRange{m}
			\Hex{..}{}
		\SkipToOpCode
			\OpRange{n}
			\Hex{..}{}
	\end{instruction}

	\begin{lastinstruction}{LD IY,(nm)}
		\Symbol{IYh$\leftarrow$(nm+1)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{111}{101}
			\Hex{FD}{4}
			\Cycles{6}{20}
		\SkipToSymbol
			\Symbol{IYl$\leftarrow$(nn)}
			\FromSymbolToOpCode
			\OpCode{00}{101}{010}
			\Hex{2A}{}
		\SkipToOpCode 
			\OpRange{n} 
			\Hex{..}{}
		\SkipToOpCode 
			\OpRange{n} 
			\Hex{..}{} 
	\end{lastinstruction}

\end{instrtable}

\InstrTableContinue
\pagebreak
\vspace*{0.4cm}

\begin{instrtable}
	\begin{instruction}{LD (nm),HL}
		\Symbol{(nn+1)$\leftarrow$H}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{00}{100}{010}
			\Hex{22}{3} 
			\Cycles{5}{16}
		\SkipToSymbol
			\Symbol{(nm)$\leftarrow$L}
			\FromSymbolToOpCode
			\OpRange{m} 
			\Hex{..}{}
		\SkipToOpCode 
			\OpRange{n} 
			\Hex{..}{} 
	\end{instruction}

	\begin{instruction}{LD (nm),dd} 
		\Symbol{(nm+1)$\leftarrow$ddh}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{4}
			\Cycles{6}{20}
		\SkipToSymbol
			\Symbol{(nm)$\leftarrow$ddl}
			\FromSymbolToOpCode
			\OpCode{01}{dd0}{011}
			\Hex{..}{}
		\SkipToOpCode 
			\OpRange{m} 
			\Hex{..}{}
		\SkipToOpCode 
			\OpRange{n} 
			\Hex{..}{} 
	\end{instruction}

	\begin{instruction}{LD (nm),IX} 
		\Symbol{(nm+1)$\leftarrow$IXh}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{011}{101}
			\Hex{DD}{4}
			\Cycles{6}{20}
		\SkipToSymbol
			\Symbol{(nm)$\leftarrow$IXl}
			\FromSymbolToOpCode
			\OpCode{00}{100}{010}
			\Hex{22}{}
		\SkipToOpCode 
			\OpRange{m}
			\Hex{..}{}
		\SkipToOpCode 
			\OpRange{n}
			\Hex{..}{} 
	\end{instruction}

	\begin{instruction}{LD (nm),IY} 
		\Symbol{(nm+1)$\leftarrow$IYh}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{111}{101}
			\Hex{FD}{4}
			\Cycles{6}{20}
		\SkipToSymbol
			\Symbol{(nm)$\leftarrow$IYl}
			\FromSymbolToOpCode
			\OpCode{00}{100}{010}
			\Hex{22}{}
		\SkipToOpCode 
			\OpRange{m} 
			\Hex{..}{}
		\SkipToOpCode 
			\OpRange{n} 
			\Hex{..}{} 
	\end{instruction}

	\begin{instruction}{LD SP,HL} 
		\Symbol{SP$\leftarrow$HL}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{111}{001}
			\Hex{F9}{1}
			\Cycles{1}{6}
	\end{instruction}

	\begin{instruction}{LD SP,IX} 
		\Symbol{SP$\leftarrow$IX}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{011}{101}
			\Hex{DD}{2}
			\Cycles{2}{10}
		\SkipToOpCode 
			\OpCode{11}{111}{001}
			\Hex{F9}{}
	\end{instruction}

	\begin{lastinstruction}{LD SP,IY} 
		\Symbol{SP$\leftarrow$IY}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{111}{101}
			\Hex{FD}{2}
			\Cycles{2}{10}
		\SkipToOpCode 
			\OpCode{11}{111}{001}
			\Hex{F9}{}
	\end{lastinstruction}

\end{instrtable}


\section{Bit Set, Reset and Test}

\begin{minipage}{\textwidth}

\begin{instrtable}

	\begin{instruction}{BIT b,r} 
		\Symbol{ZF$\leftarrow\mathtt{\overline{r_b}}$}
			\Flags{\FU\See{1}}{\FS}{1}{\FU\See{1}}{0}{\FN}
			\OpCode{11}{001}{011}
			\Hex{CB}{2}
			\Cycles{2}{8}
			\Comment{
				\multirow{6}{*}{
					\tt
					\begin{tabular}{ll}
						r & Reg \\
						\hline
						000 & B \\
						001 & C \\
						010 & D \\
						011 & E \\
						100 & H \\
						101 & L \\
						111 & A \\
					\end{tabular}
				}
			}
		\SkipToOpCode 
			\OpCode{01}{b}{r}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{BIT b,(HL)} 
		\Symbol{\mbox{ZF$\leftarrow\mathtt{\overline{(HL)_b}}$}}
			\Flags{\FU\See{1}}{\FS}{1}{\FU\See{1}}{0}{\FN}
			\OpCode{11}{001}{011}
			\Hex{CB}{2}
			\Cycles{3}{12}
		\SkipToOpCode 
			\OpCode{01}{b}{110}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{BIT b,(IX+d)\See{2}} 
		\Symbol{ZF$\leftarrow\mathtt{\overline{(IX+d)_b}}$}
			\Flags{\FU\See{1}}{\FS}{1}{\FU\See{1}}{0}{\FN}
			\OpCode{11}{011}{101}
			\Hex{DD}{4}
			\Cycles{5}{20}
		\SkipToOpCode 
			\OpCode{11}{001}{011}
			\Hex{CB}{}
		\SkipToOpCode
			\OpRange{d}
			\Hex{..}{}
		\SkipToOpCode 
			\OpCode{01}{b}{110}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{BIT b,(IY+d)\See{2}} 
		\Symbol{ZF$\leftarrow\mathtt{\overline{(IY+d)_b}}$}
			\Flags{\FU\See{1}}{\FS}{1}{\FU\See{1}}{0}{\FN}
			\OpCode{11}{111}{101}
			\Hex{FD}{4}
			\Cycles{5}{20}
		\SkipToOpCode 
			\OpCode{11}{001}{011}
			\Hex{CB}{}
		\SkipToOpCode 
			\OpRange{d} 
			\Hex{..}{}
		\SkipToOpCode 
			\OpCode{01}{b}{110}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{SET b,r} 
		\Symbol{$\mathtt{r_b}\leftarrow$1}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{001}{011}
			\Hex{CB}{2}
			\Cycles{2}{8}
			\Comment{
				\multirow{7}{*}{
					\tt
					\begin{tabular}{ll}
						b & Bit \\
						\hline
						000 & 0 \\
						001 & 1 \\
						010 & 2 \\
						011 & 3 \\
						100 & 4 \\
						101 & 5 \\
						110 & 6 \\
						111 & 7 \\
					\end{tabular}
				}
			}
		\SkipToOpCode 
			\OpCode{\fbox{11}}{b}{r}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{SET b,(HL)} 
		\Symbol{$\mathtt{(HL)_b}\leftarrow$1}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{001}{011}
			\Hex{CB}{2}
			\Cycles{4}{15}
		\SkipToOpCode 
			\OpCode{\fbox{11}}{b}{110}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{SET b,(IX+d)} 
		\Symbol{$\mathtt{(IX+d)_b}\leftarrow$1}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{011}{101}
			\Hex{DD}{4}
			\Cycles{6}{23}
		\SkipToOpCode 
			\OpCode{11}{001}{011}
			\Hex{CB}{}
		\SkipToOpCode 
			\OpRange{d} 
			\Hex{..}{}
		\SkipToOpCode 
			\OpCode{\fbox{11}}{b}{110}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{SET b,(IY+d)} 
		\Symbol{$\mathtt{(IY+d)_b}\leftarrow$1}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{111}{101}
			\Hex{FD}{4}
			\Cycles{6}{23}
		\SkipToOpCode 
			\OpCode{11}{001}{011}
			\Hex{CB}{}
		\SkipToOpCode 
			\OpRange{d} 
			\Hex{..}{}
		\SkipToOpCode 
			\OpCode{\fbox{11}}{b}{110}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{\footnotesize SET b,(IX+d),r} 
		\Symbol{r$\leftarrow$(IX+d)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{011}{101}
			\Hex{DD}{4}
			\Cycles{6}{23}
		\SkipToSymbol
			\Symbol{$\mathtt{r_b}\leftarrow$1}
			\FromSymbolToOpCode
			\OpCode{11}{001}{011}
			\Hex{CB}{}
		\SkipToSymbol
			\Symbol{(IX+d)$\leftarrow$r}
			\FromSymbolToOpCode
			\OpRange{d} 
			\Hex{..}{}
		\SkipToOpCode 
			\OpCode{\fbox{11}}{b}{r}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{\footnotesize SET b,(IY+d),r} 
		\Symbol{r$\leftarrow$(IY+d)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{111}{101}
			\Hex{FD}{4}
			\Cycles{6}{23}
		\SkipToSymbol 
			\Symbol{$\mathtt{r_b}\leftarrow$1}
			\FromSymbolToOpCode
			\OpCode{11}{001}{011}
			\Hex{CB}{}
		\SkipToSymbol
			\Symbol{(IY+d)$\leftarrow$r}
			\FromSymbolToOpCode
			\OpRange{d} 
			\Hex{..}{}
		\SkipToOpCode 
			\OpCode{\fbox{11}}{b}{r}
			\Hex{..}{}
	\end{instruction}

	\StartWithOpCode\OpCode{$\uparrow$}{}{} \\

	\begin{lastinstruction}{RES b,m\See{3}} 
		\Symbol{$\mathtt{m_b}\leftarrow$0}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{\fbox{10}}{...}{...}
	\end{lastinstruction} 
						
\end{instrtable}

\begin{notestable}
	\NoteItem{\See{1}See section \ref{bit_flags} for a complete description.\noteb}
	\NoteItem{\See{2}Instruction has other undocumented opcodes.\noteb}
	\NoteItem{\See{3}{\tt m} is one of {\tt r}, {\tt (HL)}, {\tt (IX+d)}, {\tt (IY+d)}. To form RES instruction, replace \fbox{{\tt 11}} with \fbox{{\tt 10}}.}
\end{notestable}

\end{minipage}



\section{Rotate and Shift}

\begin{minipage}{\textwidth}
	
\begin{instrtable}

	\begin{instruction}{RLCA}
		\Symbol{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,5)
				\put(0,0){\framebox(4,3){CF}}
				\put(8,0){\framebox(7,3){7$\leftarrow$0}}
				\put(8,1.5){\vector(-1,0){4}}
				\put(6,1.5){\line(0,1){2.5}}
				\put(6,4){\line(1,0){11}}
				\put(17,4){\line(0,-1){2.5}}
				\put(17,1.5){\vector(-1,0){2}}
			\end{picture}}
			\Flags{\FN}{\FN}{0}{\FN}{0}{\FX}
			\OpCode{00}{000}{111}
			\Hex{07}{1}
			\Cycles{1}{4}
			\Comment{
				\multirow{7}{*}{
					\tt
					\begin{tabular}{ll}
						r & Reg \\
						\hline
						000 & B \\
						001 & C \\
						010 & D \\
						011 & E \\
						100 & H \\
						101 & L \\
						111 & A \\
					\end{tabular}
				}
			}
	\end{instruction}

	\begin{instruction}{RLA}
		\Symbol{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,4)
				\put(2,0){\framebox(4,3){CF}}
				\put(9,0){\framebox(7,3){7$\leftarrow$0}}
				\put(9,1.5){\vector(-1,0){3}}
				\put(2,1.5){\line(-1,0){2}}
				\put(0,1.5){\line(0,1){2.5}}
				\put(0,4){\line(1,0){17.5}}
				\put(17.5,4){\line(0,-1){2.5}}
				\put(17.5,1.5){\vector(-1,0){1.5}}
			\end{picture}}
			\Flags{\FN}{\FN}{0}{\FN}{0}{\FX}
			\OpCode{00}{010}{111}
			\Hex{17}{1}
			\Cycles{1}{4}
	\end{instruction}

	\begin{instruction}{RRCA}
		\Symbol{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,4)
				\put(13,0){\framebox(4,3){CF}}
				\put(2,0){\framebox(7,3){7$\leftarrow$0}}
				\put(0,1.5){\vector(1,0){2}}
				\put(9,1.5){\vector(1,0){4}}
				\put(0,1.5){\line(0,1){2.5}}
				\put(0,4){\line(1,0){11}}
				\put(11,4){\line(0,-1){2.5}}
			\end{picture}}
			\Flags{\FN}{\FN}{0}{\FN}{0}{\FX}
			\OpCode{00}{001}{111}
			\Hex{0F}{1}
			\Cycles{1}{4}
	\end{instruction}

	\begin{instruction}{RRA}
		\Symbol{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,4)
				\put(12,0){\framebox(4,3){CF}}
				\put(2,0){\framebox(7,3){7$\leftarrow$0}}
				\put(0,1.5){\vector(1,0){2}}
				\put(9,1.5){\vector(1,0){3}}
				\put(0,1.5){\line(0,1){2.5}}
				\put(0,4){\line(1,0){17.5}}
				\put(17.5,4){\line(0,-1){2.5}}
				\put(16,1.5){\line(1,0){1.5}}
			\end{picture}}
			\Flags{\FN}{\FN}{0}{\FN}{0}{\FX}
			\OpCode{00}{011}{111}
			\Hex{1F}{1}
			\Cycles{1}{4}
	\end{instruction}

	\begin{instruction}{RLC r}
		\Symbol{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,5)
				\put(0,0){\framebox(4,3){CF}}
				\put(8,0){\framebox(7,3){7$\leftarrow$0}}
				\put(8,1.5){\vector(-1,0){4}}
				\put(6,1.5){\line(0,1){2.5}}
				\put(6,4){\line(1,0){11}}
				\put(17,4){\line(0,-1){2.5}}
				\put(17,1.5){\vector(-1,0){2}}
			\end{picture}}
			\Flags{\FS}{\FS}{0}{\FPP}{0}{\FX}
			\OpCode{11}{001}{011}
			\Hex{CB}{2}
			\Cycles{2}{8}
		\SkipToOpCode 
			\OpCode{00}{\fbox{000}}{r}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{RLC (HL)}
		\Symbol{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,5)
				\put(0,0){\framebox(4,3){CF}}
				\put(8,0){\framebox(7,3){7$\leftarrow$0}}
				\put(8,1.5){\vector(-1,0){4}}
				\put(6,1.5){\line(0,1){2.5}}
				\put(6,4){\line(1,0){11}}
				\put(17,4){\line(0,-1){2.5}}
				\put(17,1.5){\vector(-1,0){2}}
			\end{picture}}
			\Flags{\FS}{\FS}{0}{\FPP}{0}{\FX}
			\OpCode{11}{001}{011}
			\Hex{CB}{2}
			\Cycles{4}{15}
		\SkipToOpCode 
			\OpCode{00}{\fbox{000}}{110}
			\Hex{06}{}
	\end{instruction}

	\begin{instruction}{RLC (IX+d)}
		\Symbol{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,5)
				\put(0,0){\framebox(4,3){CF}}
				\put(8,0){\framebox(7,3){7$\leftarrow$0}}
				\put(8,1.5){\vector(-1,0){4}}
				\put(6,1.5){\line(0,1){2.5}}
				\put(6,4){\line(1,0){11}}
				\put(17,4){\line(0,-1){2.5}}
				\put(17,1.5){\vector(-1,0){2}}
			\end{picture}}
			\Flags{\FS}{\FS}{0}{\FPP}{0}{\FX}
			\OpCode{11}{011}{101}
			\Hex{DD}{4}
			\Cycles{6}{23}
		\SkipToOpCode 
			\OpCode{11}{001}{011}
			\Hex{CB}{}
		\SkipToOpCode 
			\OpRange{d} 
			\Hex{..}{}
		\SkipToOpCode 
			\OpCode{00}{\fbox{000}}{110}
			\Hex{06}{}
	\end{instruction}

	\begin{instruction}{RLC (IY+d)}
		\Symbol{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,5)
				\put(0,0){\framebox(4,3){CF}}
				\put(8,0){\framebox(7,3){7$\leftarrow$0}}
				\put(8,1.5){\vector(-1,0){4}}
				\put(6,1.5){\line(0,1){2.5}}
				\put(6,4){\line(1,0){11}}
				\put(17,4){\line(0,-1){2.5}}
				\put(17,1.5){\vector(-1,0){2}}
			\end{picture}}
			\Flags{\FS}{\FS}{0}{\FPP}{0}{\FX}
			\OpCode{11}{111}{101}
			\Hex{FD}{4}
			\Cycles{6}{23}
		\SkipToOpCode 
			\OpCode{11}{001}{011}
			\Hex{CB}{}
		\SkipToOpCode 
			\OpRange{d} 
			\Hex{..}{}
		\SkipToOpCode 
			\OpCode{00}{\fbox{000}}{110}
			\Hex{06}{}
	\end{instruction}

	\begin{instruction}{RLC r,(IX+d)}
		\Symbol{r$\leftarrow$(IX+d)}
			\Flags{\FS}{\FS}{0}{\FPP}{0}{\FX}
			\OpCode{11}{011}{101}
			\Hex{DD}{4}
			\Cycles{6}{23}
		\SkipToSymbol
			\Symbol{RLC r}
			\FromSymbolToOpCode
			\OpCode{11}{001}{011}
			\Hex{CB}{}
		\SkipToSymbol
			\Symbol{(IX+d)$\leftarrow$r}
			\FromSymbolToOpCode
			\OpRange{d} 
			\Hex{..}{}
		\SkipToOpCode 
			\OpCode{00}{\fbox{000}}{r}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{RLC r,(IY+d)}
		\Symbol{r$\leftarrow$(IY+d)}
			\Flags{\FS}{\FS}{0}{\FPP}{0}{\FX}
			\OpCode{11}{111}{101}
			\Hex{FD}{4}
			\Cycles{6}{23}
		\SkipToSymbol
			\Symbol{RLC r}
			\FromSymbolToOpCode
			\OpCode{11}{001}{011}
			\Hex{CB}{}
		\SkipToSymbol
			\Symbol{(IY+d)$\leftarrow$r}
			\FromSymbolToOpCode
			\OpRange{d} 
			\Hex{..}{}
		\SkipToOpCode
			\OpCode{00}{\fbox{000}}{r}
			\Hex{..}{}
	\end{instruction}

	\StartWithOpCode\OpCode{}{$\uparrow$}{} \\

	\begin{instruction}{RL m\See{1}}
		\Symbol{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,4)
				\put(2,0){\framebox(4,3){CF}}
				\put(9,0){\framebox(7,3){7$\leftarrow$0}}
				\put(9,1.5){\vector(-1,0){3}}
				\put(2,1.5){\line(-1,0){2}}
				\put(0,1.5){\line(0,1){2.5}}
				\put(0,4){\line(1,0){17.5}}
				\put(17.5,4){\line(0,-1){2.5}}
				\put(17.5,1.5){\vector(-1,0){1.5}}
			\end{picture}}
			\Flags{\FS}{\FS}{0}{\FPP}{0}{\FX}
			\OpCode{..}{\fbox{010}}{...}
	\end{instruction}

	\begin{instruction}{RRC m\See{1}}
		\Symbol{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,4)
				\put(13,0){\framebox(4,3){CF}}
				\put(2,0){\framebox(7,3){7$\leftarrow$0}}
				\put(0,1.5){\vector(1,0){2}}
				\put(9,1.5){\vector(1,0){4}}
				\put(0,1.5){\line(0,1){2.5}}
				\put(0,4){\line(1,0){11}}
				\put(11,4){\line(0,-1){2.5}}
			\end{picture}}
			\Flags{\FS}{\FS}{0}{\FPP}{0}{\FX}
			\OpCode{..}{\fbox{001}}{...}
	\end{instruction}

	\begin{instruction}{RR m\See{1}}
		\Symbol{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,4)
				\put(12,0){\framebox(4,3){CF}}
				\put(2,0){\framebox(7,3){7$\leftarrow$0}}
				\put(0,1.5){\vector(1,0){2}}
				\put(9,1.5){\vector(1,0){3}}
				\put(0,1.5){\line(0,1){2.5}}
				\put(0,4){\line(1,0){17.5}}
				\put(17.5,4){\line(0,-1){2.5}}
				\put(16,1.5){\line(1,0){1.5}}
			\end{picture}}
			\Flags{\FS}{\FS}{0}{\FPP}{0}{\FX}
			\OpCode{..}{\fbox{011}}{...}
	\end{instruction}

	\begin{instruction}{SLA m\See{1}}
		\Symbol{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,4)
				\put(0,0){\framebox(4,3){CF}}
				\put(7,0){\framebox(7,3){7$\leftarrow$0}}
				\put(7,1.5){\vector(-1,0){3}}
				\put(17,1.5){\vector(-1,0){3}}
				\put(16,0){\makebox(4,3){0}}
			\end{picture}}
			\Flags{\FS}{\FS}{0}{\FPP}{0}{\FX}
			\OpCode{..}{\fbox{100}}{...}
	\end{instruction}

	\begin{instruction}{SLL m\See{1}}
		\Symbol{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,4)
				\put(0,0){\framebox(4,3){CF}}
				\put(7,0){\framebox(7,3){7$\leftarrow$0}}
				\put(7,1.5){\vector(-1,0){3}}
				\put(17,1.5){\vector(-1,0){3}}
				\put(16,0){\makebox(4,3){1}}
			\end{picture}}
			\Flags{\FS}{\FS}{0}{\FPP}{0}{\FX}
			\OpCode{..}{\fbox{110}}{...}
	\end{instruction}

	\begin{instruction}{SRA m\See{1}}
		\Symbol{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,4)
				\put(13,0){\framebox(4,3){CF}}
				\put(3,0){\framebox(7,3){7$\rightarrow$0}}
				\put(10,1.5){\vector(1,0){3}}
				\put(1,1.5){\vector(1,0){2}}
				\put(1,-1.5){\line(0,1){3}}
				\put(1,-1.5){\line(1,0){2.5}}
				\put(3.5,-1.5){\line(0,1){1.5}}
			\end{picture}}
			\Flags{\FS}{\FS}{0}{\FPP}{0}{\FX}
			\OpCode{..}{\fbox{101}}{...}
	\end{instruction}

	\begin{instruction}{SRL m\See{1}}
		\Symbol{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,4)
				\put(-0.5,0){\makebox(1,3){0}}
				\put(13,0){\framebox(4,3){CF}}
				\put(3,0){\framebox(7,3){7$\rightarrow$0}}
				\put(10,1.5){\vector(1,0){3}}
				\put(1,1.5){\vector(1,0){2}}
			\end{picture}}
			\Flags{\FS}{\FS}{0}{\FPP}{0}{\FX}
			\OpCode{..}{\fbox{111}}{...}
	\end{instruction}

	\Empty{}

	\begin{instruction}{RLD}
		\Symbol{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(25,5.5)
				\put(-7,0){\makebox(4,3){A}}
				\put(20,0){\makebox(4,3){(HL)}}
				\put(-2,0){\framebox(4.5,3){7-4}}
				\put(2.65,0){\framebox(4.5,3){3-0}}
				\put(9,0){\framebox(4.5,3){7-4}}
				\put(13.65,0){\framebox(4.5,3){3-0}}
				\put(5,4.45){\line(0,-1){1.45}}
				\put(5,4.45){\line(1,0){11.5}}
				\put(16.5,4.45){\vector(0,-1){1.45}}
				\put(12,-1.45){\vector(0,1){1.45}}
				\put(12,-1.45){\line(1,0){3.75}}
				\put(15.75,-1.45){\line(0,1){1.45}}
				\put(5,-1.45){\vector(0,1){1.45}}
				\put(10.5,-1.45){\line(-1,0){5.5}}
				\put(10.5,-1.45){\line(0,1){1.45}}
			\end{picture}}
			\Flags{\FS}{\FS}{0}{\FPP}{0}{\FN} 
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{5}{18}
		\SkipToOpCode 
			\OpCode{01}{101}{111}
			\Hex{6F}
	\end{instruction}
		
	\begin{lastinstruction}{RRD}
		\Symbol{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(25,5.5)
				\put(-7,0){\makebox(4,3){A}}
				\put(20,0){\makebox(4,3){(HL)}}
				\put(-2,0){\framebox(4.5,3){7-4}}
				\put(2.65,0){\framebox(4.5,3){3-0}}
				\put(9,0){\framebox(4.5,3){7-4}}
				\put(13.65,0){\framebox(4.5,3){3-0}}
				\put(16.5,-1.45){\line(0,1){1.45}}
				\put(5,-1.45){\line(1,0){11.5}}
				\put(5,-1.45){\vector(0,1){1.45}}
				\put(15.75,4.45){\vector(0,-1){1.45}}
				\put(12,4.45){\line(1,0){3.75}}
				\put(12,4.45){\line(0,-1){1.45}}
				\put(10.5,4.45){\vector(0,-1){1.45}}
				\put(10.5,4.45){\line(-1,0){5.5}}
				\put(5,4.45){\line(0,-1){1.45}}
			\end{picture}}
			\Flags{\FS}{\FS}{0}{\FPP}{0}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{5}{18}
		\SkipToOpCode 
			\OpCode{01}{100}{111}
			\Hex{67}{}
	\end{lastinstruction}
	
\end{instrtable}

\NoteTableSingleItemSpaceCorrection

\begin{notestable}
	\NoteItem{\See{1}{\tt m} is one of {\tt r}, {\tt (HL)}, {\tt (IX+d)}, {\tt (IY+d)}. To form new opcode replace \fbox{000} of {\tt RLC}s with shown code.}
\end{notestable}

\end{minipage}


\section{Jump}

\begin{minipage}{\textwidth}
	
\begin{instrtable}

	\begin{instruction}{JP nm} 
		\Symbol{PC$\leftarrow$nm}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{000}{011}
			\Hex{C3}{3}
			\Cycles{3}{10}
			\Comment{
				\multirow{8}{*}{
					\tt
					\begin{tabular}{ll}
						cc & Condition \\
						\hline
						000 & NZ \\
						001 & Z \\
						010 & NC \\
						011 & C \\
						100 & PO \\
						101 & PE \\
						110 & P \\
						111 & M \\
					\end{tabular}
				}
			}
		\SkipToOpCode 
			\OpRange{m} 
			\Hex{..}{}
		\SkipToOpCode 
			\OpRange{n} 
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{JP cc,nm} 
		\Symbol{if cc}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{cc}{010}
			\Hex{..}{3}
			\Cycles{3}{10}
		\SkipToSymbol
			\Symbol{PC$\leftarrow$nm}
			\FromSymbolToOpCode
			\OpRange{m} 
			\Hex{..}{}
		\SkipToOpCode 
			\OpRange{n} 
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{JR e} 
		\Symbol{PC$\leftarrow$PC+e}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{00}{011}{000}
			\Hex{18}{2}
			\Cycles{3}{12}
		\SkipToOpCode 
			\OpCode{$|\leftarrow$}{e-2}{$\rightarrow|$}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{JR ss,e} 
		\Symbol{if ss}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{00}{1ss}{000}
			\Hex{..}{2}
			\Cycles{3}{12}
			\Comment{if {\tt ss} is true}
		\SkipToSymbol
			\Symbol{PC$\leftarrow$PC+e}
			\FromSymbolToOpCode
			\OpCode{$|\leftarrow$}{e-2}{$\rightarrow|$}
			\Hex{..}{}
			\Cycles{2}{7}
			\Comment{if {\tt ss} is false}
	\end{instruction}

	\begin{instruction}{JP (HL)}
		\Symbol{PC$\leftarrow$HL}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{001}
			\Hex{E9}{1}
			\Cycles{1}{4}
			\Comment{
				\multirow{6}{*}{
					\tt
					\begin{tabular}{ll}
						ss & Condition \\
						\hline
						00 & NZ \\
						01 & Z \\
						10 & NC \\
						11 & C \\
					\end{tabular}
				}
			}
	\end{instruction}

	\begin{instruction}{JP (IX)} 
		\Symbol{PC$\leftarrow$IX}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{011}{101}
			\Hex{DD}{2}
			\Cycles{2}{8}
		\SkipToOpCode 
			\OpCode{11}{101}{001}
			\Hex{E9}{}
	\end{instruction}

	\begin{instruction}{JP (IY)} 
		\Symbol{PC$\leftarrow$IY}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{111}{101}
			\Hex{FD}{2}
			\Cycles{2}{8}
		\SkipToOpCode 
			\OpCode{11}{101}{001}
			\Hex{E9}{}
	\end{instruction}

	\begin{lastinstruction}{DJNZ e} 
		\Symbol{B$\leftarrow$B-1}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{00}{010}{000}
			\Hex{10}{2}
			\Cycles{2}{8}
			\Comment{if {\tt B}=0}
		\SkipToSymbol
			\Symbol{if B$\not=$0}
			\FromSymbolToOpCode
			\OpCode{$|\leftarrow$}{e-2}{$\rightarrow|$}
			\Hex{..}{}
			\Cycles{3}{13}
			\Comment{if {\tt B}$\not=$0}
		\SkipToSymbol
			\Symbol{PC$\leftarrow$PC+e}
	\end{lastinstruction} 
		
\end{instrtable}

\begin{notestable}
	\NoteItem{{\tt e} is a signed two-complement in the range -127, 129.}
	\NoteItem{{\tt e-2} in the opcode provides an effective number of {\tt PC+e} as {\tt PC} is incremented by two prior to the addition of {\tt e}.}
\end{notestable}

\end{minipage}


\section{Call and Return}

\begin{minipage}{\textwidth}
	
\begin{instrtable}

	\begin{instruction}{CALL nm} 
		\Symbol{(SP-1)$\leftarrow$PCh}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{001}{101}
			\Hex{CD}{3}
			\Cycles{5}{17}
		\SkipToSymbol
			\Symbol{(SP-2)$\leftarrow$PCl}
			\FromSymbolToOpCode
			\OpRange{m} 
			\Hex{..}{}
		\SkipToSymbol
			\Symbol{SP$\leftarrow$SP-2}
			\FromSymbolToOpCode
			\OpRange{n} 
			\Hex{..}{}
		\SkipToSymbol
			\Symbol{PC$\leftarrow$nm}
	\end{instruction}

	\begin{instruction}{CALL c,nm} 
		\Symbol{if c is true}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{tt}{100}
			\Hex{..}{3}
			\Cycles{3}{10}
			\Comment{if {\tt c}=false}
		\SkipToSymbol
			\Symbol{(SP-1)$\leftarrow$PCh}
			\FromSymbolToOpCode
			\OpRange{m} 
			\Hex{..}{}
			\Cycles{5}{17}
			\Comment{if {\tt c}=true}
		\SkipToSymbol
			\Symbol{(SP-2)$\leftarrow$PCl}
			\FromSymbolToOpCode
			\OpRange{n} 
			\Hex{..}{}
		\SkipToSymbol
			\Symbol{SP$\leftarrow$SP-2}
		\SkipToSymbol
			\Symbol{PC$\leftarrow$nn}
	\end{instruction}

	\begin{instruction}{RET} 
		\Symbol{PCl$\leftarrow$(SP)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{001}{001}
			\Hex{C9}{1}
			\Cycles{3}{10}
		\SkipToSymbol
			\Symbol{PCh$\leftarrow$(SP+1)}
		\SkipToSymbol
			\Symbol{SP$\leftarrow$SP+2}
	\end{instruction}

	\begin{instruction}{RET c} 
		\Symbol{if c is true}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{tt}{000}
			\Hex{..}{1}
			\Cycles{1}{5}
			\Comment{if {\tt c}=false}
		\SkipToSymbol
			\Symbol{PCl$\leftarrow$(SP)}
			\FromSymbolToOpCode
			\OpCode{}{}{}
			\Hex{}{}
			\Cycles{3}{11}
			\Comment{if {\tt c}=true}
		\SkipToSymbol
			\Symbol{PCh$\leftarrow$(SP+1)}
		\SkipToSymbol
			\Symbol{SP$\leftarrow$SP+2}
	\end{instruction}

	\begin{instruction}{RETI\See{1}} 
		\Symbol{PCl$\leftarrow$(SP)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{4}{14}
			\Comment{
				\multirow{9}{*}{
					\tt
					\begin{tabular}{ll}
						tt & c \\
						\hline
						000 & NZ \\
						001 & Z \\
						010 & NC \\
						011 & C \\
						100 & PO \\
						101 & PE \\
						110 & P \\
						111 & M \\
					\end{tabular}
				}
			}
			\SkipToSymbol
				\Symbol{PCh$\leftarrow$(SP+1)}
				\FromSymbolToOpCode
				\OpCode{01}{001}{101}
				\Hex{4D}{}
			\SkipToSymbol
				\Symbol{SP$\leftarrow$SP+2}
	\end{instruction}

	\begin{instruction}{RETN\See{2}} 
		\Symbol{PCl$\leftarrow$(SP)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{4}{14}
		\SkipToSymbol
			\Symbol{PCh$\leftarrow$(SP+1)}
			\FromSymbolToOpCode
			\OpCode{01}{000}{101}
			\Hex{45}{}
		\SkipToSymbol
			\Symbol{SP$\leftarrow$SP+2}
		\SkipToSymbol
			\Symbol{IFF1$\leftarrow$IFF2}
	\end{instruction}

	\begin{lastinstruction}{RST p} 
		\Symbol{(SP-1)$\leftarrow$PCh}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{tt}{111}
			\Hex{..}{1}
			\Cycles{3}{11}
			\Comment{
				\multirow{9}{*}{
					\tt
					\begin{tabular}{ll}
						tt & p \\
						\hline
						000 & \$0 \\
						001 & \$8 \\
						010 & \$10 \\
						011 & \$18 \\
						100 & \$20 \\
						101 & \$28 \\
						110 & \$30 \\
						111 & \$38 \\
					\end{tabular}
				}
			}
		\SkipToSymbol
			\Symbol{(SP-2)$\leftarrow$PCl}
		\SkipToSymbol
			\Symbol{SP$\leftarrow$SP-2}
		\SkipToSymbol
			\Symbol{PC$\leftarrow$p}
	\end{lastinstruction}

	\\[11ex] % note we need to add some manual spacing after this instruction so that tt/p comment table is visible in full (we don't have enough rows for multirow command)

\end{instrtable}

\begin{notestable}
	\NoteItem{\See{1} RETI also copies IFF2 into IFF1, like RETN.}
	\NoteItem{\See{2} This instruction has other undocumented opcodes.}
\end{notestable}

\end{minipage}


\section{Stack}
	
\begin{instrtable}

	\begin{instruction}{PUSH qq} 
		\Symbol{(SP-2)$\leftarrow$qql}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{qq0}{101}
			\Hex{..}{1}
			\Cycles{3}{11}
			\Comment{
				\multirow{4}{*}{
					\tt
					\begin{tabular}{ll}
						qq & Reg \\
						\hline
						00 & BC \\
						01 & DE \\
						10 & HL \\
						11 & AF \\
					\end{tabular}
				}
			}
		\SkipToSymbol
			\Symbol{(SP-1)$\leftarrow$qqh}
		\SkipToSymbol
			\Symbol{SP$\leftarrow$SP-2}
	\end{instruction}

	\begin{instruction}{PUSH IX} 
		\Symbol{(SP-2)$\leftarrow$IXl}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{011}{101}
			\Hex{DD}{2}
			\Cycles{4}{15}
		\SkipToSymbol
			\Symbol{(SP-1)$\leftarrow$IXh}
			\FromSymbolToOpCode
			\OpCode{11}{100}{101}
			\Hex{E5}{}
		\SkipToSymbol
			\Symbol{SP$\leftarrow$SP-2}
	\end{instruction}

	\begin{instruction}{PUSH IY} 
		\Symbol{(SP-2)$\leftarrow$IYl}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{111}{101}
			\Hex{FD}{2}
			\Cycles{4}{15}
		\SkipToSymbol
			\Symbol{(SP-1)$\leftarrow$IYh}
			\FromSymbolToOpCode
			\OpCode{11}{100}{101}
			\Hex{E5}{}
		\SkipToSymbol
			\Symbol{SP$\leftarrow$SP-2}
	\end{instruction}

	\begin{instruction}{POP qq} 
		\Symbol{qqh$\leftarrow$(SP+1)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{qq0}{001}
			\Hex{..}{1}
			\Cycles{3}{10}
		\SkipToSymbol
			\Symbol{qql$\leftarrow$(SP)}
		\SkipToSymbol
			\Symbol{SP$\leftarrow$SP+2}
	\end{instruction}

	\begin{instruction}{POP IX} 
		\Symbol{IXh$\leftarrow$(SP+1)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{011}{101}
			\Hex{DD}{2}
			\Cycles{4}{14}
		\SkipToSymbol
			\Symbol{IXl$\leftarrow$(SP)}
			\FromSymbolToOpCode
			\OpCode{11}{100}{001}
			\Hex{E1}{}
		\SkipToSymbol
			\Symbol{SP$\leftarrow$SP+2}
	\end{instruction}

	\begin{lastinstruction}{POP IY}
		\Symbol{IYh$\leftarrow$(SP+1)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{111}{101}
			\Hex{FD}{2}
			\Cycles{4}{14}
		\SkipToSymbol
			\Symbol{IYl$\leftarrow$(SP)}
			\FromSymbolToOpCode
			\OpCode{11}{100}{001}
			\Hex{E1}{}
		\SkipToSymbol
			\Symbol{SP$\leftarrow$SP+2}
	\end{lastinstruction}

\end{instrtable}


\section{Exchange}

\begin{instrtable}	

	\begin{instruction}{EX DE,HL} 
		\Symbol{DE$\leftrightarrow$HL}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{011}
			\Hex{EB}{1}
			\Cycles{1}{4}
	\end{instruction}

	\begin{instruction}{EX AF,AF'} 
		\Symbol{AF$\leftrightarrow$AF'}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{00}{001}{000}
			\Hex{08}{1}
			\Cycles{1}{4}
	\end{instruction}

	\begin{instruction}{EXX} 
		\Symbol{BC$\leftrightarrow$BC'}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{011}{001}
			\Hex{D9}{1}
			\Cycles{1}{4}
		\SkipToSymbol
			\Symbol{DE$\leftrightarrow$DE'}
		\SkipToSymbol
			\Symbol{HL$\leftrightarrow$HL'}
	\end{instruction}

	\begin{instruction}{EX (SP),HL} 
		\Symbol{H$\leftrightarrow$(SP+1)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{100}{011}
			\Hex{E3}{1}
			\Cycles{5}{19}
		\SkipToSymbol 
			\Symbol{L$\leftrightarrow$(SP)}
	\end{instruction}

	\begin{instruction}{EX (SP),IX} 
		\Symbol{IXh$\leftrightarrow$(SP+1)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{011}{101}
			\Hex{DD}{2}
			\Cycles{6}{2}
		\SkipToSymbol
			\Symbol{IXl$\leftrightarrow$(SP)}
			\FromSymbolToOpCode
			\OpCode{11}{100}{011}
			\Hex{E3}{}
	\end{instruction}

	\begin{lastinstruction}{EX (SP),IY} 
		\Symbol{IYh$\leftrightarrow$(SP+1)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{111}{101}
			\Hex{FD}{2}
			\Cycles{6}{23}
		\SkipToSymbol
			\Symbol{IYl$\leftrightarrow$(SP)}
			\FromSymbolToOpCode
			\OpCode{11}{100}{011}
			\Hex{E3}{}
	\end{lastinstruction}

\end{instrtable}


\section{Block Transfer, Search}

\begin{minipage}{\textwidth}
	
\begin{instrtable}	

	\begin{instruction}{LDI}
		\Symbol{(DE)$\leftarrow$(HL)}
			\Flags{\FN}{\FN}{0}{\FX\See{1}}{0}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{4}{16}
		\SkipToSymbol
			\Symbol{DE$\leftarrow$DE+1}
			\FromSymbolToOpCode
			\OpCode{10}{100}{000}
			\Hex{A0}{}
		\SkipToSymbol
			\Symbol{HL$\leftarrow$HL+1}
		\SkipToSymbol
			\Symbol{BC$\leftarrow$BC-1}
	\end{instruction}

	\begin{instruction}{LDIR} 
		\Symbol{(DE)$\leftarrow$(HL)}
			\Flags{\FN}{\FN}{0}{0\See{2}}{0}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{5}{21}
			\Comment{if {\tt BC}$\not=$0}
		\SkipToSymbol
			\Symbol{DE$\leftarrow$DE+1}
			\FromSymbolToOpCode
			\OpCode{10}{110}{000}
			\Hex{B0}{}
			\Cycles{4}{16}
			\Comment{if {\tt BC}=0}
		\SkipToSymbol
			\Symbol{HL$\leftarrow$HL+1}
		\SkipToSymbol
			\Symbol{BC$\leftarrow$BC-1}
		\SkipToSymbol
			\Symbol{Repeat until}
		\SkipToSymbol
			\Symbol{BC=0}
	\end{instruction}

	\begin{instruction}{LDD} 
		\Symbol{(DE)$\leftarrow$(HL)}
			\Flags{\FN}{\FN}{0}{\FX\See{1}}{0}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{4}{16}
		\SkipToSymbol
			\Symbol{DE$\leftarrow$DE-1}
			\FromSymbolToOpCode
			\OpCode{10}{101}{000}
			\Hex{A8}{}
		\SkipToSymbol
			\Symbol{HL$\leftarrow$HL-1}
		\SkipToSymbol
			\Symbol{BC$\leftarrow$BC-1}
	\end{instruction}

	\begin{instruction}{LDDR} 
		\Symbol{(DE)$\leftarrow$(HL)}
			\Flags{\FN}{\FN}{0}{0\See{2}}{0}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{5}{21}
			\Comment{if {\tt C}$\not=$0}
		\SkipToSymbol
			\Symbol{DE$\leftarrow$DE-1}
			\FromSymbolToOpCode
			\OpCode{10}{111}{000}
			\Hex{B8}{}
			\Cycles{4}{16}
			\Comment{if {\tt BC}=0}
		\SkipToSymbol
			\Symbol{HL$\leftarrow$HL-1}
		\SkipToSymbol
			\Symbol{BC$\leftarrow$BC-1}
		\SkipToSymbol
			\Symbol{Repeat until}
		\SkipToSymbol
			\Symbol{BC=0}
	\end{instruction}

	\begin{instruction}{CPI} 
		\Symbol{A-(HL)}
			\Flags{\FS\See{4}}{\FX\See{3}}{\FS\See{4}}{\FX\See{1}}{1}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{4}{16}
		\SkipToSymbol
			\Symbol{HL$\leftarrow$HL+1}
			\FromSymbolToOpCode
			\OpCode{10}{100}{001}
			\Hex{A1}{}
		\SkipToSymbol
			\Symbol{BC$\leftarrow$BC-1}
	\end{instruction}

	\begin{instruction}{CPIR} 
		\Symbol{A-(HL)}
			\Flags{\FS\See{4}}{\FX\See{3}}{\FS\See{4}}{\FX\See{1}}{1}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{5}{21}
			\Comment{if {\tt BC}$\not=$0}
		\SkipToSymbol
			\Symbol{HL$\leftarrow$HL+1}
			\FromSymbolToOpCode
			\OpCode{10}{110}{001}
			\Hex{B1}{}
			\Cycles{}{}
			\Comment{and {\tt A}$\not=$(HL)}
		\SkipToSymbol
			\Symbol{BC$\leftarrow$BC-1}
			\FromSymbolToOpCode
			\OpCode{}{}{}
			\Hex{}{}
			\Cycles{4}{16}
			\Comment{if {\tt BC}=0}
		\SkipToSymbol
			\Symbol{Repeat until}
			\FromSymbolToOpCode
			\OpCode{}{}{}
			\Hex{}{}
			\Cycles{}{}
			\Comment{or {\tt A}=(HL)}
		\SkipToSymbol
			\Symbol{A=(HL) or}
		\SkipToSymbol
			\Symbol{BC=0}
	\end{instruction}

	\begin{instruction}{CPD} 
		\Symbol{A-(HL)}
			\Flags{\FS\See{4}}{\FX\See{3}}{\FS\See{4}}{\FX\See{1}}{1}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{4}{16}
		\SkipToSymbol
			\Symbol{HL$\leftarrow$HL-1}
			\FromSymbolToOpCode
			\OpCode{10}{101}{001}
			\Hex{A9}{}
		\SkipToSymbol
			\Symbol{BC$\leftarrow$BC-1}
	\end{instruction}

	\begin{lastinstruction}{CPDR} 
		\Symbol{A-(HL)}
			\Flags{\FS\See{4}}{\FX\See{3}}{\FS\See{4}}{\FX\See{1}}{1}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{5}{21}
			\Comment{if {\tt BC}$\not=$0}
		\SkipToSymbol
			\Symbol{HL$\leftarrow$HL-1}
			\FromSymbolToOpCode
			\OpCode{10}{111}{001}
			\Hex{B9}{}
			\Cycles{}{}
			\Comment{and {\tt A}$\not=$(HL)}
		\SkipToSymbol
			\Symbol{BC$\leftarrow$BC-1}
			\FromSymbolToOpCode
			\OpCode{}{}{}
			\Hex{}{}
			\Cycles{4}{16}
			\Comment{if {\tt BC}=0}
		\SkipToSymbol
			\Symbol{Repeat until}
			\FromSymbolToOpCode
			\OpCode{}{}{}
			\Hex{}{}
			\Cycles{}{}
			\Comment{or {\tt A}=({\tt HL})}
		\SkipToSymbol
			\Symbol{A=(HL) or}	
		\SkipToSymbol
			\Symbol{BC=0} 
	\end{lastinstruction}

\end{instrtable}

\begin{notestable}	
	\NoteItem{\See{1}PF is 0 the result of BC-1=0, otherwise PF is set.}
	\NoteItem{\See{2}PF is 0 only at completion of the instruction.}
	\NoteItem{\See{3}ZF is set if {\tt A=(HL)}, otherwise ZF is reset.}
	\NoteItem{\See{4}See section \ref{block_mem} for a description.}
\end{notestable}

\end{minipage}



\section{Input}

\begin{minipage}{\textwidth}

\begin{instrtable}

	\begin{instruction}{IN A,(n)\See{1}} 
		\Symbol{A$\leftarrow$(n)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{011}{011}
			\Hex{DB}{2}
			\Cycles{3}{11}
			\Comment{
				\multirow{7}{*}{
					\tt
					\begin{tabular}{ll}
						r & Reg \\
						\hline
						000 & B \\
						001 & C \\
						010 & D \\
						011 & E \\
						100 & H \\
						101 & L \\
						111 & A \\
					\end{tabular}
				}
			}
		\SkipToOpCode	
			\OpRange{n} 
			\Hex{..}
	\end{instruction}

	\begin{instruction}{IN r,(C)} 
		\Symbol{r$\leftarrow$(C)}
			\Flags{\FS}{\FS}{0}{\FPP}{0}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{3}{12}
		\SkipToOpCode 
			\OpCode{01}{r}{000}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{IN F,(n)} 
		\Symbol{F$\leftarrow$(C)}
			\Flags{\FS}{\FS}{0}{\FPP}{0}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{3}{12}
		\SkipToOpCode 
			\OpCode{01}{110}{000}
			\Hex{70}{}
	\end{instruction}

	\begin{instruction}{INI} 
		\Symbol{(HL)$\leftarrow$(C)}
			\Flags{\FU}{\FX\See{2}}{\FU\See{3}}{\FU\See{3}}{1}{\FN\See{3}}
			\OpCode{11}{101}{101} 
			\Hex{ED}{2}
			\Cycles{4}{16}
		\SkipToSymbol
			\Symbol{HL$\leftarrow$HL+1}
			\FromSymbolToOpCode
			\OpCode{10}{100}{010}
			\Hex{A2}{}
		\SkipToSymbol
			\Symbol{B$\leftarrow$B-1}
	\end{instruction}

	\begin{instruction}{INIR} 
		\Symbol{(HL)$\leftarrow$(C)}
			\Flags{\FU}{1}{\FU\See{3}}{\FU\See{3}}{1}{\FN\See{3}}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{5}{21}
			\Comment{if {\tt B}$\not=$0}
		\SkipToSymbol
			\Symbol{HL$\leftarrow$HL+1}
			\FromSymbolToOpCode
			\OpCode{10}{110}{010}
			\Hex{B2}{}
			\Cycles{4}{16}
			\Comment{if {\tt B}=0}
		\SkipToSymbol
			\Symbol{B$\leftarrow$B-1}
		\SkipToSymbol
			\Symbol{Repeat until}
		\SkipToSymbol
			\Symbol{B=0}
	\end{instruction}

	\begin{instruction}{IND} 
		\Symbol{(HL)$\leftarrow$(C)}
			\Flags{\FU}{\FX\See{2}}{\FU\See{3}}{\FU\See{3}}{1}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{4}{16}
		\SkipToSymbol
			\Symbol{HL$\leftarrow$HL-1}
			\FromSymbolToOpCode
			\OpCode{10}{101}{010}
			\Hex{AA}{}
		\SkipToSymbol
			\Symbol{B$\leftarrow$B-1}
	\end{instruction}

	\begin{lastinstruction}{INDR} 
		\Symbol{(HL)$\leftarrow$(C)}
			\Flags{\FU}{1}{\FU\See{3}}{\FU\See{3}}{1}{\FN\See{3}}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{5}{21}
			\Comment{if {\tt B}$\not=$0}
		\SkipToSymbol
			\Symbol{HL$\leftarrow$HL-1}
			\FromSymbolToOpCode
			\OpCode{10}{111}{010}
			\Hex{BA}{}
			\Cycles{4}{16}
			\Comment{if {\tt B}=0}
		\SkipToSymbol
			\Symbol{B$\leftarrow$B-1}
		\SkipToSymbol
			\Symbol{Repeat until}
		\SkipToSymbol
			\Symbol{B=0}
	\end{lastinstruction}
		
\end{instrtable}

\begin{notestable}
	\NoteItem{\See{1} {\tt LD (n)} is interpretted as {\tt LD A,(n)}}
	\NoteItem{\See{2} flag is affected by the result of {\tt B$\leftarrow$B-1} as in {\tt DEC B}.}
	\NoteItem{\See{3} This flag is bizarre, see section \ref{block_io}.}
\end{notestable}
	
\end{minipage}



\section{Output}

\begin{minipage}{\textwidth}

\begin{instrtable}

	\begin{instruction}{OUT (n),A} 
		\Symbol{(n)$\leftarrow$A}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{010}{011}
			\Hex{D3}{2}
			\Cycles{3}{11}
			\Comment{
				\multirow{7}{*}{
					\tt
					\begin{tabular}{ll}
						r & Reg \\
						\hline
						000 & B \\
						001 & C \\
						010 & D \\
						011 & E \\
						100 & H \\
						101 & L \\
						111 & A \\
					\end{tabular}
				}
			}
		\SkipToOpCode 
			\OpRange{n} 
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{OUT (C),r} 
		\Symbol{(C)$\leftarrow$r}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{3}{12}
		\SkipToOpCode 
			\OpCode{01}{r}{001}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{OUT (C),0} 
		\Symbol{(C)$\leftarrow$0}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{3}{12}
		\SkipToOpCode 
			\OpCode{01}{110}{001}
			\Hex{71}{}
	\end{instruction}

	\begin{instruction}{OUTI} 
		\Symbol{(C)$\leftarrow$(HL)}
			\Flags{\FU}{\FX\See{1}}{\FU\See{3}}{\FU\See{3}}{1\See{2}}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{4}{16}
		\SkipToSymbol
			\Symbol{HL$\leftarrow$HL+1}
			\FromSymbolToOpCode
			\OpCode{10}{100}{011}
			\Hex{A3}{}
		\SkipToSymbol
			\Symbol{B$\leftarrow$B-1}
	\end{instruction}

	\begin{instruction}{OTIR} 
		\Symbol{(C)$\leftarrow$(HL)}
			\Flags{\FU}{1}{\FU\See{3}}{\FU\See{3}}{1\See{2}}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{5}{21}
			\Comment{if {\tt B}$\not=$0}
		\SkipToSymbol
			\Symbol{HL$\leftarrow$HL+1}
			\FromSymbolToOpCode
			\OpCode{10}{110}{011}
			\Hex{B3}{}
			\Cycles{4}{16}
			\Comment{if {\tt B}=0}
		\SkipToSymbol
			\Symbol{B$\leftarrow$B-1}
		\SkipToSymbol
			\Symbol{Repeat until}
		\SkipToSymbol
			\Symbol{B=0}
	\end{instruction}

	\begin{instruction}{OUTD} 
		\Symbol{(C)$\leftarrow$(HL)}
			\Flags{\FU}{\FX\See{1}}{\FU\See{3}}{\FU\See{3}}{1\See{2}}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{4}{16}
		\SkipToSymbol
			\Symbol{HL$\leftarrow$HL-1}
			\FromSymbolToOpCode
			\OpCode{10}{101}{011}
			\Hex{AB}{}
		\SkipToSymbol
			\Symbol{B$\leftarrow$B-1}
	\end{instruction}

	\begin{lastinstruction}{OTDR} 
		\Symbol{(C)$\leftarrow$(HL)}
			\Flags{\FU}{1}{\FU\See{3}}{\FU\See{3}}{1\See{2}}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{5}{21}
			\Comment{if {\tt B}$\not=$0}
		\SkipToSymbol
			\Symbol{HL$\leftarrow$HL-1}
			\FromSymbolToOpCode
			\OpCode{10}{111}{011}
			\Hex{BB}{}
			\Cycles{4}{16}
			\Comment{if {\tt B}=0}
		\SkipToSymbol
			\Symbol{B$\leftarrow$B-1}
		\SkipToSymbol
			\Symbol{Repeat until}
		\SkipToSymbol
			\Symbol{B=0}
	\end{lastinstruction}

\end{instrtable}

\begin{notestable}
	\NoteItem{\See{1} Flag is affected by the result of {\tt B$\leftarrow$B-1}.}
	\NoteItem{\See{2} NF is a copy of bit 7 of the transferred byte.}
	\NoteItem{\See{3} This flag is bizarre, see section \ref{block_io}.}
\end{notestable}
	
\end{minipage}



\section{General-Purpose Arithmetic and CPU Control}

\begin{minipage}{\textwidth}

\begin{instrtable}

	\begin{instruction}{DAA}
		\Symbol{}
			\Flags{\FS}{\FS}{\FS}{\FPP}{\FN}{\FS}
			\OpCode{00}{100}{111}
			\Hex{27}{1}
			\Cycles{1}{4}
	\end{instruction}

	\begin{instruction}{CPL} 
		\Symbol{A$\leftarrow\mathtt{\overline{A}}$}
			\Flags{\FN}{\FN}{1}{\FN}{1}{\FN}
			\OpCode{00}{101}{111}
			\Hex{2F}{1}
			\Cycles{1}{4}
	\end{instruction}

	\begin{instruction}{NEG} 
		\Symbol{A$\leftarrow$0-A}
			\Flags{\FS}{\FS}{\FS}{\FPV}{1}{\FS}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{2}{8}
		\SkipToOpCode 
			\OpCode{01}{000}{100}
			\Hex{44}{}
	\end{instruction}

	\begin{instruction}{CCF\See{1}} 
		\Symbol{CF$\leftarrow\mathtt{\overline{CF}}$}
			\Flags{\FN}{\FN}{\FU\See{2}}{\FN}{0}{\FS}
			\OpCode{00}{111}{111}
			\Hex{3F}{1}
			\Cycles{1}{4}
	\end{instruction}

	\begin{instruction}{SCF\See{1}} 
		\Symbol{CF$\leftarrow$1}
			\Flags{\FN}{\FN}{0}{\FN}{0}{1}
			\OpCode{00}{110}{111}
			\Hex{37}{1}
			\Cycles{1}{4}
	\end{instruction}

	\begin{instruction}{NOP}
		\Symbol{}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{00}{000}{000}
			\Hex{00}{1}
			\Cycles{1}{4}
	\end{instruction}

	\begin{instruction}{HALT}
		\Symbol{}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{01}{110}{110}
			\Hex{76}{1}
			\Cycles{1}{4}
	\end{instruction}

	\begin{instruction}{DI\See{3}} 
		\Symbol{IFF1,2$\leftarrow$0}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{110}{011}
			\Hex{F3}{1}
			\Cycles{1}{4}
	\end{instruction}

	\begin{instruction}{EI\See{3}} 
		\Symbol{IFF1,2$\leftarrow$1}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{111}{011}
			\Hex{FB}{1}
			\Cycles{1}{4}
	\end{instruction}

	\begin{instruction}{IM 0\See{4}}
		\Symbol{}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{2}{8}
		\SkipToOpCode 
			\OpCode{01}{000}{110}
			\Hex{46}{}
	\end{instruction}

	\begin{instruction}{IM 1\See{4}}
		\Symbol{}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{2}{8}
		\SkipToOpCode 
			\OpCode{01}{010}{110}
			\Hex{56}{}
	\end{instruction}

	\begin{lastinstruction}{IM 2\See{4}}
		\Symbol{}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{2}{8}
		\SkipToOpCode 
			\OpCode{01}{011}{110}
			\Hex{5E}{}
	\end{lastinstruction}
	
\end{instrtable}

\begin{notestable}
	\NoteItem{\See{1}YF and XF are copied from register {\tt A}.}
	\NoteItem{\See{2}HF is like CF before the instruction.}
	\NoteItem{\See{3}No interrupts are accepted directly after {\tt EI} or {\tt DI}.}
	\NoteItem{\See{4}This instruction has other undocumented opcodes.}
\end{notestable}
	
\end{minipage}


\pagebreak
\intentiallyempty
\pagebreak


\section{ZX Spectrum Next Extended}
\label{zx_next_instructions_table}

\begin{minipage}{\textwidth}

\begin{instrtablesymbol}

	\begin{instruction}{ADD ss,A} 
		\Symbol{ss$\leftarrow$ss+A}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{2}{8}
			\Comment{
				\multirow{3}{*}{
					\tt
					\begin{tabular}{ll}
						ss & Reg \\
						\hline
						01 & HL \\
						10 & DE \\
						11 & BC \\
					\end{tabular}
				}
			}
		\SkipToOpCode 
			\OpCode{00}{110}{0ss}
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{ADD pp,nm} 
		\Symbol{pp$\leftarrow$pp+nm}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{4}{16}
			\Comment{
				\multirow{6}{*}{
					\tt
					\begin{tabular}{ll}
						pp & Reg \\
						\hline
						00 & HL \\
						01 & DE \\
						10 & BC \\
					\end{tabular}
				}
			}
		\SkipToOpCode 
			\OpCode{00}{110}{1pp}
			\Hex{..}{}
		\SkipToOpCode 
			\OpRange{m} 
			\Hex{..}{}
		\SkipToOpCode 
			\OpRange{n} 
			\Hex{..}{} 
	\end{instruction}

	\begin{instruction}{BSLA DE,B\See{1}} 
		\Symbol{DE$\leftarrow$DE<<(B$\wedge$\$1F)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{2}{8}
		\SkipToOpCode 
			\OpCode{00}{101}{000}
			\Hex{28}
	\end{instruction}

	\begin{instruction}{BSRA DE,B\See{1}} 
		\SymbolS{DE$\leftarrow$signed(DE)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{2}{8}
		\SkipToSymbol
			\SymbolP{>>(B$\wedge$\$1F)}
			\FromSymbolToOpCode
			\OpCode{00}{101}{001}
			\Hex{29}{}
	\end{instruction}

	\begin{instruction}{BSRL DE,B\See{1}} 
		\SymbolS{DE$\leftarrow$uns(DE)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{2}{8}
		\SkipToSymbol
			\SymbolP{>>(B$\wedge$\$1F)}
			\FromSymbolToOpCode
			\OpCode{00}{101}{010}
			\Hex{2A}{}
	\end{instruction}

	\begin{instruction}{BSRF DE,B\See{1}} 
		\SymbolS{DE$\leftarrow\sim$(uns($\sim$DE)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{2}{8}
		\SkipToSymbol
			\SymbolP{>>(B$\wedge$\$1F))}
			\FromSymbolToOpCode
			\OpCode{00}{101}{011}
			\Hex{2B}
	\end{instruction}
		
	\begin{instruction}{BRLC DE,B\See{1}} 
		\Symbol{DE$\leftarrow$DE<<(B$\wedge$\$0F)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{2}{8}
		\SkipToSymbol
			\Symbol{DE$\leftarrow$DE>>(16-B$\wedge$\$0F)}
			\FromSymbolToOpCode
			\OpCode{00}{101}{100}
			\Hex{2C}{}
	\end{instruction}

	\begin{instruction}{LDDX} 
		\Symbol{if (HL)$\neq$A:}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{4}{16}
		\SkipToSymbol
			\Symbol{~~(DE)$\leftarrow$(HL)}
			\FromSymbolToOpCode
			\OpCode{10}{101}{100}
			\Hex{AC}{}
		\SkipToSymbol
			\Symbol{DE$\leftarrow$DE+1}
		\SkipToSymbol
			\Symbol{HL$\leftarrow$HL-1}
		\SkipToSymbol
			\Symbol{BC$\leftarrow$BC+1}
	\end{instruction}

	\begin{instruction}{LDDRX} 
		\Symbol{do LDDX}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{5}{21}
			\Comment{if {\tt BC}$\neq$0}
		\SkipToSymbol
			\Symbol{while BC>0}
			\FromSymbolToOpCode
			\OpCode{10}{111}{100}
			\Hex{BC}{}
			\Cycles{4}{16}
			\Comment{if {\tt BC}=0}
	\end{instruction}

	\begin{instruction}{LDIX} 
		\Symbol{if (HL)$\neq$A:}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{4}{16}
		\SkipToSymbol
			\Symbol{~~(DE)$\leftarrow$(HL)}
			\FromSymbolToOpCode
			\OpCode{10}{100}{100}
			\Hex{A4}{}
		\SkipToSymbol
			\Symbol{DE$\leftarrow$DE+1}
		\SkipToSymbol
			\Symbol{HL$\leftarrow$HL+1}
		\SkipToSymbol
			\Symbol{BC$\leftarrow$BC-1}
	\end{instruction}

	\begin{instruction}{LDDIX} 
		\Symbol{do LDIX}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{5}{21}
			\Comment{if {\tt BC}$\neq$0}
		\SkipToSymbol
			\Symbol{while BC>0}
			\FromSymbolToOpCode
			\OpCode{10}{110}{100}
			\Hex{B4}{}
			\Cycles{4}{16}
			\Comment{if {\tt BC}=0}
	\end{instruction}

	\begin{instruction}{LDPIRX} 
		\Symbol{do}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{5}{21}
			\Comment{if {\tt BC}$\neq$0}
		\SkipToSymbol
			\Symbol{~~t$\leftarrow$(HL$\wedge$\$FFF8+E$\wedge$7)}
			\FromSymbolToOpCode
			\OpCode{10}{110}{111}
			\Hex{B7}{}
			\Cycles{4}{16}
			\Comment{if {\tt BC}=0}
		\SkipToSymbol
			\Symbol{~~if~t$\neq$A:~(DE)$\leftarrow$t}
		\SkipToSymbol
			\Symbol{~~DE$\leftarrow$DE+1}
		\SkipToSymbol
			\Symbol{~~BC$\leftarrow$BC-1}
		\SkipToSymbol
			\Symbol{Until BC=0}
	\end{instruction}

	\begin{lastinstruction}{LDWS} 
		\Symbol{(DE)$\leftarrow$(HL)}
			\Flags{\FS}{\FS}{\FS}{\FPV}{0}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{4}{16}
		\SkipToSymbol
			\Symbol{INC L}
			\FromSymbolToOpCode
			\OpCode{10}{100}{101}
			\Hex{A5}{}
		\SkipToSymbol
			\Symbol{INC D}
	\end{lastinstruction}

\end{instrtablesymbol}

\NoteTableSingleItemSpaceCorrection

\begin{notestable}
	\NoteItem{\See{1} Core v2+ only!}
\end{notestable}

% we need to have "continue" within minipage, and pagebreak outside...
\InstrTableContinue
	
\end{minipage}

\pagebreak
\vspace*{0.45cm}

\begin{minipage}{\textwidth}

\begin{instrtablesymbol}	

	\begin{instruction}{SWAPNIB}
		\Symbol{
			\scriptsize
			\multirow{3}{*}{
				\setlength{\unitlength}{0.9mm}
				\put(-1.5,1){\makebox(4,3){A}}
				\begin{picture}(25,5.5)
					\put(2,1){\framebox(6,3){7654}}
					\put(8.2,1){\framebox(6,3){3210}}

					\put(11.5,0.5){\line(0,-1){2}}
					\put(11.5,-1.5){\line(-1,0){6.8}}
					\put(4.7,-1.5){\vector(0,1){2}}

					\put(4.7,6.5){\line(0,-1){2}}
					\put(11.5,6.5){\line(-1,0){6.8}}
					\put(11.5,6.5){\vector(0,-1){2}}
				\end{picture}
			}
		}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{2}{8}
		\SkipToOpCode 
			\OpCode{00}{100}{011}
			\Hex{23}
	\end{instruction}
	
	% we need some extra spacing to accomodate the image
	\\[0.1em]
			
	\begin{instruction}{MIRROR A}
		\Symbol{
			\scriptsize
			\multirow{3}{*}{
				\setlength{\unitlength}{0.9mm}
				\put(-1.5,-2){\makebox(4,3){A}}
				\begin{picture}(25,5.5)
					\put(2,-2){\framebox(6,3){7654}}
					\put(8.2,-2){\framebox(6,3){3210}}

					\put(13.5,-2.5){\line(0,-1){5}}
					\put(13.5,-7.5){\line(-1,0){11}}
					\put(2.5,-7.5){\vector(0,1){5}}

					\put(12,-2.5){\line(0,-1){4}}
					\put(12,-6.5){\line(-1,0){7.8}}
					\put(4.2,-6.5){\vector(0,1){4}}

					\put(10.5,-2.5){\line(0,-1){3}}
					\put(10.5,-5.5){\line(-1,0){4.7}}
					\put(5.8,-5.5){\vector(0,1){3}}

					\put(9,-2.5){\line(0,-1){2}}
					\put(9,-4.5){\line(-1,0){1.8}}
					\put(7.3,-4.5){\vector(0,1){2}}

					\put(2.5,6.5){\line(0,-1){5}}
					\put(13.5,6.5){\line(-1,0){11}}
					\put(13.5,6.5){\vector(0,-1){5}}

					\put(4.2,5.5){\line(0,-1){4}}
					\put(12,5.5){\line(-1,0){7.8}}
					\put(12,5.5){\vector(0,-1){4}}

					\put(5.8,4.5){\line(0,-1){3}}
					\put(10.5,4.5){\line(-1,0){4.7}}
					\put(10.5,4.5){\vector(0,-1){3}}

					\put(7.3,3.5){\line(0,-1){2}}
					\put(9,3.5){\line(-1,0){1.8}}
					\put(9,3.5){\vector(0,-1){2}}
				\end{picture}
			}
		}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{2}{8}
		\SkipToOpCode 
			\OpCode{00}{100}{100}
			\Hex{24}
	\end{instruction}
	
	% we need some extra spacing to accomodate the image
	\\[1em]

	\begin{instruction}{NEXTREG r,A} 
		\Symbol{HwNextReg[r]$\leftarrow$A}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101} 
			\Hex{ED}{3}
			\Cycles{4}{17}
		\SkipToOpCode 
			\OpCode{10}{010}{010}
			\Hex{92}{}
		\SkipToOpCode 
			\OpRange{r} 
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{NEXTREG r,n}
		\Symbol{HwNextReg[r]$\leftarrow$n}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{3}
			\Cycles{5}{20}
		\SkipToOpCode 
			\OpCode{10}{010}{001}
			\Hex{91}{}
		\SkipToOpCode 
			\OpRange{r} 
			\Hex{..}{}
		\SkipToOpCode 
			\OpRange{n} 
			\Hex{..}{}
	\end{instruction}

	\begin{instruction}{PIXELAD} 
		\Symbol{HL$\leftarrow$\$4000}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{3}
			\Cycles{2}{8}
		\SkipToSymbol
			\Symbol{~~+((D$\wedge$\$C0)<<5)}
			\FromSymbolToOpCode
			\OpCode{10}{010}{100}
			\Hex{94}{}
		\SkipToSymbol
			\Symbol{~~+((D$\wedge$\$07)<<8)}
		\SkipToSymbol
			\Symbol{~~+((D$\wedge$\$38)<<2)}
		\SkipToSymbol
			\Symbol{~~+(E>>3)}
	\end{instruction}

	\begin{instruction}{PIXELDN} 
		\Symbol{if~HL$\wedge$\$700$\neq$\$700}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{3}
			\Cycles{2}{8}
		\SkipToSymbol
			\Symbol{$\Rightarrow$HL$\leftarrow$HL+256}
			\FromSymbolToOpCode
			\OpCode{10}{010}{011}
			\Hex{93}{}
		\SkipToSymbol
			\Symbol{else~if~HL$\wedge$\$E0$\neq$\$E0}
		\SkipToSymbol
			\Symbol{$\Rightarrow$HL$\leftarrow$HL$\wedge$\$F8FF+\$20}
		\SkipToSymbol
			\Symbol{else}
		\SkipToSymbol
			\Symbol{$\Rightarrow$HL$\leftarrow$HL$\wedge$\$F81F+\$800}
	\end{instruction}

	\begin{instruction}{SETAE} 
		\Symbol{A$\leftarrow$uns(\$80)>>(E$\wedge$7)}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{3}
			\Cycles{2}{8}
		\SkipToOpCode 
			\OpCode{10}{010}{101}
			\Hex{95}{}
	\end{instruction}

	\begin{instruction}{MUL D,E} 
		\Symbol{DE$\leftarrow$D*E}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{2}{8}
		\SkipToOpCode 
			\OpCode{00}{110}{000}
			\Hex{30}
	\end{instruction}

	\begin{instruction}{TEST n} 
		\Symbol{A$\wedge$n}
			\Flags{\FS}{\FS}{\FS}{\FPV}{\FU}{\FS}
			\OpCode{11}{101}{101}
			\Hex{ED}{3}
			\Cycles{3}{11}
		\SkipToOpCode 
			\OpCode{00}{100}{111}
			\Hex{27}{}
	\end{instruction}

	\begin{instruction}{JP (C)} 
		\SymbolS{PC$\leftarrow$PC$\wedge$\$C000}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{3}{13}
		\SkipToSymbol
			\SymbolP{+IN(C)<<6}
			\OpCode{10}{011}{000}
			\Hex{98}{}
	\end{instruction}
		
	\begin{instruction}{OUTINB} 
		\Symbol{(C)$\leftarrow$(HL)}
			\Flags{\FU}{\FU}{\FU}{\FU}{\FU}{\FU}
			\OpCode{11}{101}{101}
			\Hex{ED}{2}
			\Cycles{4}{16}
		\SkipToSymbol
			\Symbol{HL$\leftarrow$HL+1}
			\FromSymbolToOpCode
			\OpCode{10}{010}{000}
			\Hex{90}{}
	\end{instruction}

	\begin{lastinstruction}{PUSH nm\See{1}}
		\Symbol{SP$\leftarrow$SP-2}
			\Flags{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\OpCode{11}{101}{101}
			\Hex{ED}{3}
			\Cycles{6}{23}
		\SkipToSymbol
			\Symbol{(SP)$\leftarrow$nn}
			\FromSymbolToOpCode
			\OpCode{10}{001}{010}
			\Hex{8A}{}
		\SkipToOpCode 
			\OpRange{n} 
			\Hex{..}{}
		\SkipToOpCode 
			\OpRange{m} 
			\Hex{..}{}
	\end{lastinstruction}

\end{instrtablesymbol}

\NoteTableSingleItemSpaceCorrection

\begin{notestable}
	\NoteItem{\See{1} This is not mistake, {\tt PUSH nm} operand is in fact encoded in big-endian}
\end{notestable}

\end{minipage}




\chapter{Instructions up Close}
\label{instruction_details}

\newcommand{\DetailParityOverflow}[1]{
	\IfEqCase{#1}
	{
		{p}{
			\small
			\setlength{\unitlength}{0.2mm}
			\begin{picture}(20,10)
				\put(-5.6,7){\circle{20}}
				\put(-11,0){P}
				\put(4,0){V}
			\end{picture}
		}
		{v}{
			\small
			\setlength{\unitlength}{0.2mm}
			\begin{picture}(20,10)
				\put(11,7){\circle{20}}
				\put(-11,0){P}
				\put(4,0){V}
			\end{picture}
		}
		{}{PV}
	}
}
The following pages describe all instructions. Alphabetical order is used as much as possible, but some deviations were made to better fit instructions to pages. Each instruction includes:

\begin{itemize}
	\setlength\itemsep{1pt}
	\item Mnemonic
	\item Symbolic operation for an idea of what instruction does
	\item All variants (where applicable)
	\item Description with further details
	\item Effects on flags
	\item Timing table with machine cycles, T states and time required for execution on different CPU speeds
\end{itemize}

Where possible, multiple variants of same instruction are grouped together and where multiple timings are possible, timing table is sorted from shortest to longest.

\pagebreak

\subsubsection{Abbreviations}

\begin{tabularx}{\textwidth}{lX}
	{\tt r} & 
		8-bit register {\tt A}-{\tt L} \\
	{\tt n} &
		8-bit immediate value \\
	{\tt rr} & 
		16-bit register pair {\tt AF}, {\tt BC}, {\tt DE}, {\tt HL}, {\tt IX}, {\tt IY}, {\tt SP} (note in some cases particular register pairs may use different timing from the rest; if so, those will be explicitly indicated in their own line; {\tt rr} may still be used, though in those cases it will cover the remaining registers only) \\
	{\tt nn} & 
		16-bit immediate value \\
	{\tt s} &
		Placeholder for argument when multiple variants are possible \\
	{\tt d} &
		If instruction takes 2 operands, {\tt d} indicates destination and {\tt s} source \\
	\UNDOC & Indicates undocumented instruction \\
	\ZXN & Indicates ZX Spectrum Next extended instruction \\
		
	\end{tabularx}

\subsubsection{Effects}

\begin{tabular}{cl}
	{\tt 0} & Flag is set to {\tt 0} \\
	{\tt 1} & Flag is set to {\tt 1} \\
	{\tt \FS} & Flag is modified according to operation \\
	{\tt \FN} & Flag is not affected \\
	{\tt \FU} & Effect on flag is unpredictable \\
	{\tt \FX} & Special case, see notes below effects table \\
	\DetailParityOverflow{v} & P/V flag is used as overflow \\
	\DetailParityOverflow{p} & P/V flag is used as parity \\
	\DetailParityOverflow{} & PV is undefined or indicates other result \\
\end{tabular}

\begin{basedescript}{
	% setup basedescript styling for labels
	\desclabelstyle{\multilinelabel}
	\desclabelwidth{3cm}}

	% setup spacing between items
	\setlength\itemsep{1.5em}

	\newcommand{\DetailItem}[1]{\item[{\tt \large \textbf{#1}}]}
	\newcommand{\DetailSymbol}[1]{{\tt #1}}

	\newenvironment{detailitem}[2]{
		\DetailItem{#1}
		\DetailSymbol{#2}
		% reduce spacing before and after multicols
		\setlength{\multicolsep}{1ex}

	}{
		% we want some spacing below each item
		\vspace{1em}
	}

	\environbodyname\DetailVariantsBODY
	\NewEnviron{DetailVariants}[1][3]{
		{
			\tt
			\begin{multicols}{#1}
				\DetailVariantsBODY
			\end{multicols}
		}
	}

	\environbodyname\DetailCompactListBODY
	\NewEnviron{DetailCompactList}[1][]{
		#1
		\vspace{-6pt}
		\setlist{leftmargin=1em}
		\begin{itemize}
			\setlength\itemsep{-1pt}
			\DetailCompactListBODY
		\end{itemize}
	}

	\environbodyname\DetailEffectsBODY
	\NewEnviron{DetailEffects}[1][]{
		\vspace{3pt}
		\begin{tabularx}{0.767\textwidth}{@{}lXc|c|p{2.6ex}|c|p{2.6ex}|c|c|c|}
			\cline{3-10}
			\multicolumn{2}{@{}X}{\textbf{Effects}} & 
				\multicolumn{1}{|c|}{SF} & 
				ZF & 
				& 
				HF & 
				&
				\DetailParityOverflow{#1}
				& 
				NF & 
				CF \notet\noteb\\[1pt]\cline{3-10}

			\DetailEffectsBODY

		\end{tabularx}
		\vspace{2pt}
	}
	\newcommand{\DetailFlags}[7][]{
		& 
			#1 & 
			\multicolumn{1}{|c|}{\tt #2} & 
			{\tt #3} & 
			& 
			{\tt #4} & 
			& 
			{\tt #5} & 
			{\tt #6} & 
			{\tt #7} \notet\noteb \\\cline{3-10}
	}
	\newcommand{\DetailFlagsComments}[1]{ 
		& & \multicolumn{8}{p{6.6cm}}{
			\vspace{-2ex}
			\setlist{leftmargin=1em}
			\begin{itemize}
				\setlength\itemsep{-1pt}
				#1
			\end{itemize}	
		} \\[-3ex]
	}
	\newcommand{\DetailNoEffect}{
		\begin{DetailEffects}
			\DetailFlags[No effect on flags]{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
		\end{DetailEffects}
	}
	
	\environbodyname\DetailTimingBODY
	\NewEnviron{DetailTiming}[1][Timing]{
		\vspace{1pt}
		\begin{tabularx}{0.8\textwidth}{@{}lXccrrrr}
			\multicolumn{2}{@{}X}{\textbf{#1}} & Mc & Ts & 3.5MHz & 7MHz & 14MHz & 28MHz \\[1pt]
			\DetailTimingBODY
		\end{tabularx}
	}
	\newcommand{\DetailTime}[3]{
		& {\tt #1} & #2 & #3 & 
			\nprounddigits{1}
			{\footnotesize {\tt \numprint{\fpeval{#3/3.5}}}$\mu$s} & 
			\nprounddigits{2}
			{\footnotesize {\tt \numprint{\fpeval{#3/7}}}$\mu$s} & 
			\nprounddigits{2}
			{\footnotesize {\tt \numprint{\fpeval{#3/14}}}$\mu$s} & 
			\nprounddigits{2}
			{\footnotesize {\tt \numprint{\fpeval{#3/28}}}$\mu$s} \\
	}

	\pagebreak
	\begin{detailitem}{ADC d,s}
		{d$\leftarrow$d+s+CF}

		\begin{DetailVariants}
			\textnormal{8 bit}\\
			ADC A,A\\
			ADC A,B\\
			ADC A,C\\
			ADC A,D\\
			ADC A,E\\
			ADC A,H\\
			ADC A,L\\
			ADC A,n

			\columnbreak
			\textnormal{8 bit}\\
			ADC A,(HL)\\
			ADC A,(IX+d)\\
			ADC A,(IY+d)\\
			ADC A,IXH\UNDOC\\
			ADC A,IXL\UNDOC\\
			ADC A,IYH\UNDOC\\
			ADC A,IYL\UNDOC

			\columnbreak
			\textnormal{16 bit}\\
			ADC HL,BC\\
			ADC HL,DE\\
			ADC HL,HL\\
			ADC HL,SP
		\end{DetailVariants}
		
		Source operand {\tt s} or contents of the memory location addressed by {\tt s} and carry flag are added to destination {\tt d}. Result is then stored to destination {\tt d}.

		\begin{DetailEffects}[v]
			\DetailFlags[8-bit]{\FS}{\FS}{\FS}{\FS}{0}{\FS}
			\DetailFlags[16-bit]{\FS}{\FS}{\FU}{\FS}{0}{\FS}
		\end{DetailEffects}

		\begin{DetailTiming}
			\DetailTime{A,r}{1}{4}
			\DetailTime{A,n}{2}{7}
			\DetailTime{A,(HL)}{2}{7}
			\DetailTime{HL,rr}{4}{15}
			\DetailTime{A,(IX+d)}{5}{19}
			\DetailTime{A,(IY+d)}{5}{19}
		\end{DetailTiming}
		
	\end{detailitem}

	\begin{detailitem}{ADD d,s}
		{d$\leftarrow$d+s}

		{
			\tt
			\begin{tabularx}{0.8\textwidth}{@{}p{1.7cm}Xp{2.15cm}p{2.15cm}p{2.4cm}}
				\textnormal{8-bit} & \textnormal{8-bit} & \textnormal{16-bit} & \textnormal{16-bit} & \textnormal{ZX Next} \\
				ADD A,A & 
					ADD A,(HL) & 
					ADD IX,BC & 
					ADD HL,BC & 
					ADD BC,A\ZXN \\
				ADD A,B & 
					ADD A,(IX+d) & 
					ADD IX,DE & 
					ADD HL,DE &
					ADD DE,A\ZXN \\
				ADD A,C & 
					ADD A,(IY+d) & 
					ADD IX,IX & 
					ADD HL,HL & 
					ADD HL,A\ZXN \\
				ADD A,D & 
					ADD A,IXH\UNDOC & 
					ADD IX,SP & 
					ADD HL,SP & 
					ADD BE,nn\ZXN \\ 
				ADD A,E & 
					ADD A,IXL\UNDOC & 
					ADD IY,BC & 
					& 
					ADD DE,nn\ZXN \\
				ADD A,H & 
					ADD A,IYH\UNDOC & 
					ADD IY,DE & 
					& 
					ADD HL,nn\ZXN \\
				ADD A,L & 
					ADD A,IYL\UNDOC & 
					ADD IY,IY \\
				ADD A,n &
					&
					ADD IY,SP \\
			\end{tabularx}
		}
		
		Similar to {\tt ADC} except carry flag is not used in calculation: operand {\tt s} or contents of memory location addressed by {\tt s} are added to destination {\tt d}. Result is then stored to destination {\tt d}.

		In case of ZX Next Extended instructions for adding {\tt A} to 16-bit register pair, {\tt A} is zero extended to 16-bits.

		\begin{DetailEffects}[v]
			\DetailFlags[8-bit]{\FS}{\FS}{\FS}{\FS}{0}{\FS}
			\DetailFlags[16-bit]{\FN}{\FN}{\FU}{\FN}{0}{\FS}
		\end{DetailEffects}

		\begin{DetailTiming}
			\DetailTime{A,r}{1}{4}
			\DetailTime{A,n}{2}{7}
			\DetailTime{A,(HL)}{2}{7}
			\DetailTime{rr,A\ZXN}{2}{8}
			\DetailTime{HL,rr}{3}{11}
			\DetailTime{IX,rr}{4}{15}
			\DetailTime{IY,rr}{4}{15}
			\DetailTime{rr,nn\ZXN}{4}{16}
			\DetailTime{A,(IX+d)}{5}{19}
			\DetailTime{A,(IY+d)}{5}{19}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{AND s}
		{A$\leftarrow$A$\wedge$s}

		\begin{DetailVariants}
			AND A\\
			AND B\\
			AND C\\
			AND D\\
			AND E\\
			AND H\\
			AND L
			
			\columnbreak
			AND n\\
			AND (HL)\\
			AND (IX+d)\\
			AND (IY+d)

			\columnbreak
			AND IXH\UNDOC\\
			AND IXL\UNDOC\\
			AND IYH\UNDOC\\
			AND IYL\UNDOC
		\end{DetailVariants}

		Performs logical AND between accumulator and given operand. Result is then stored back to accumulator.

		\begin{DetailEffects}[p]
			\DetailFlags{\FS}{\FS}{1}{\FS}{0}{0}
		\end{DetailEffects}

		\begin{DetailTiming}
			\DetailTime{r}{1}{4}
			\DetailTime{n}{2}{7}
			\DetailTime{(HL)}{2}{7}
			\DetailTime{(IX+d)}{5}{19}
			\DetailTime{(IY+d)}{5}{19}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{BIT b,s}
		{ZF$\leftarrow\mathtt{\overline{s_b}}$}

		\begin{DetailVariants}
			BIT b,A\\
			BIT b,B\\
			BIT b,C\\
			BIT b,D

			\columnbreak
			BIT b,E\\
			BIT b,H\\
			BIT b,L
			
			\columnbreak
			BIT b,(HL)\\
			BIT b,(IX+d)\\
			BIT b,(IY+d)
		\end{DetailVariants}

		Tests specified bit {\tt b} {\tt 0-7} of the given register {\tt s} or contents of memory addressed by {\tt s} and sets zero flag according to result; if bit was 1, {\tt ZF} is 0 and vice versa.

		\begin{DetailEffects}
			\DetailFlags{\FU}{\FS}{1}{\FU}{0}{\FN}
		\end{DetailEffects}

		\begin{DetailTiming}
			\DetailTime{b,r}{2}{8}
			\DetailTime{b,(HL)}{3}{12}
			\DetailTime{b,(IX+d)}{5}{20}
			\DetailTime{b,(IY+d)}{5}{20}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{BRLC DE,B\ZXN}
		{DE$\leftarrow$DE<<(B$\wedge$\$0F)\\
		DE$\leftarrow$DE>>(16-B$\wedge$\$0F)}

		Rotates value in register pair {\tt DE} left for the amount given in bits 3-0 (low nibble) of register {\tt B}. To rotate right, use formula: {\tt B=16-places}. Result is stored in {\tt DE}.

		\DetailNoEffect

		\begin{DetailTiming}
			\DetailTime{}{2}{8}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{BSLA DE,B\ZXN}
		{DE$\leftarrow$DE<<(B$\wedge$\$1F)}

		Performs shift left of the value in register pair {\tt DE} for amount given in lower 5 bits of register {\tt B}. Result is stored in {\tt DE}.

		\DetailNoEffect
		
		\begin{DetailTiming}
			\DetailTime{}{2}{8}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{BSRA DE,B\ZXN}
		{DE$\leftarrow$signed(DE)>>(B$\wedge$\$1F)}

		Performs arithmetical shift right of the value in register pair {\tt DE} for amount given in lower 5 bits of register {\tt B}. Result is stored in {\tt DE}.

		\DetailNoEffect
		
		\begin{DetailTiming}
			\DetailTime{}{2}{8}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{BSRF DE,B\ZXN}
		{DE$\leftarrow\sim$(unsigned($\sim$DE)>>(B$\wedge$\$1F))}

		Performs logical shift right of the value in register pair {\tt DE} for amount given in lower 5 bits of register {\tt B}. Result is stored in {\tt DE}.

		\DetailNoEffect
		
		\begin{DetailTiming}
			\DetailTime{}{2}{8}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{BSRL DE,B\ZXN}
		{DE$\leftarrow$unsigned(DE)>>(B$\wedge$\$1F)}

		Performs fill-one-way shift right of the value in register pair {\tt DE} for amount given in lower 5 bits of register {\tt B}. Result is stored in {\tt DE}.

		\DetailNoEffect
		
		\begin{DetailTiming}
			\DetailTime{}{2}{8}
		\end{DetailTiming}

	\end{detailitem}
	
	\pagebreak
	\begin{detailitem}{CALL nn}
		{(SP-1)$\leftarrow$PCh\\
		(SP-2)$\leftarrow$PCl\\
		SP$\leftarrow$SP-2\\
		PC$\leftarrow$nn}

		Pushes {\tt PC} to stack and calls subroutine at the given location {\tt nn} by changing {\tt PC} to point to address {\tt nn}.

		\DetailNoEffect
		
		\begin{DetailTiming}
			\DetailTime{}{5}{17}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{CALL c,nn}
		{if c is true: CALL nn}

		\vspace{1ex} % we need some vertical space to achieve same separation as multicols
		\begin{tabular}{@{}llcll}			
			{\tt CALL C,nn} & calls if {\tt CF} is set & &
				{\tt CALL M,nn} & calls if {\tt SF} is set\\
			{\tt CALL NC,nn} & calls if {\tt CF} is reset & &
				{\tt CALL P,nn} & calls if {\tt SF} is reset\\
			{\tt CALL Z,nn} & calls if {\tt ZF} is set & &
				{\tt CALL PE,nn} & calls if {\tt PF} is set\\
			{\tt CALL NZ,nn} & calls if {\tt ZF} is reset & &
				{\tt CALL PO,nn} & calls if {\tt PF} is reset\\
		\end{tabular}

		If given condition is met, {\tt CALL nn} is performed, as described above.

		\DetailNoEffect
				
		\begin{DetailTiming}
			\DetailTime{c\normalfont{ false}}{3}{10}
			\DetailTime{c\normalfont{ true}}{5}{17}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{CCF}
		{CF$\leftarrow\mathtt{\overline{CF}}$}

		Complements (inverts) carry flag; if {\tt CF} was {\tt 0} it's now {\tt 1} and vice versa. Previous value of {\tt CF} is copied to {\tt HF}.

		\begin{DetailEffects}
			\DetailFlags{\FN}{\FN}{\FU}{\FN}{0}{\FS}
		\end{DetailEffects}
		
		\begin{DetailTiming}
			\DetailTime{}{1}{4}
		\end{DetailTiming}

	\end{detailitem}
	
	\pagebreak
	\begin{detailitem}{CP s}
		{A-s}

		\begin{DetailVariants}
			CP A\\
			CP B\\
			CP C\\
			CP D\\
			CP E\\
			CP H\\
			CP L

			\columnbreak
			CP n\\
			CP (IX+d)\\
			CP (IY+d)

			\columnbreak
			CP IXH\UNDOC\\
			CP IXL\UNDOC\\
			CP IYH\UNDOC\\
			CP IYL\UNDOC
		\end{DetailVariants}

		Operand {\tt s} or content of the memory location addressed by {\tt s} is subtracted from {\tt A}. Status flags are updated according to result, but result is then discarded (value of {\tt A} is not changed). Some general rules:

		\begin{multicols}{2}
			\begin{DetailCompactList}[Signed]
				\item {\tt A=s}: {\tt ZF} set
				\item {\tt A$\not$=s}: {\tt ZF} reset
				\item {\tt A<s}: {\tt CF} set
				\item {\tt A$\geqslant$s}: {\tt CF} reset	
			\end{DetailCompactList}

			\columnbreak
			\begin{DetailCompactList}[Unsigned]
				\item {\tt A=s}: {\tt ZF} set
				\item {\tt A$\not$=s}: {\tt ZF} reset
				\item {\tt A<s}: {\tt SF} and {\tt PF} different
				\item {\tt A$\geqslant$s}: {\tt SF} and {\tt PF} the same				
			\end{DetailCompactList}
		\end{multicols}

		\begin{DetailEffects}[v]
			\DetailFlags{\FS}{\FS}{\FS}{\FS}{1}{\FS}
		\end{DetailEffects}
		
		\begin{DetailTiming}
			\DetailTime{r}{1}{4}
			\DetailTime{n}{2}{7}
			\DetailTime{(HL)}{2}{7}
			\DetailTime{(IX+d)}{5}{19}
			\DetailTime{(IY+d)}{5}{19}
		\end{DetailTiming}

	\end{detailitem}

	\pagebreak
	\begin{detailitem}{CPD}
		{A-(HL)\\
		HL$\leftarrow$HL-1\\
		BC$\leftarrow$BC-1}

		Subtracts contents of memory location addressed by {\tt HL} register pair from accumulator {\tt A}. Result is then discarded. Afterwards both {\tt HL} and {\tt BC} are decremented.

		\begin{DetailEffects}
			\DetailFlags{\FS}{\FX}{\FS}{\FX}{1}{\FN}
			\DetailFlagsComments{
				\item {\tt ZF} set if {\tt A=(HL)} before {\tt HL} is decremented, reset otherwise
				\item {\tt PF} reset if {\tt BC=0} after execution, set otherwise
			}
		\end{DetailEffects}

		\begin{DetailTiming}
			\DetailTime{}{4}{16}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{CPDR}
		{A-(HL)\\
		HL$\leftarrow$HL-1\\
		BC$\leftarrow$BC-1\\
		Repeat until A=(HL) or BC=0}

		Repeats {\tt CPD} until either {\tt A=(HL)} or {\tt BC=0}. See {\tt CPIR} for example.

		\begin{DetailEffects}
			\DetailFlags{\FS}{\FX}{\FS}{\FX}{1}{\FN}
			\DetailFlagsComments{
				\item {\tt ZF} set if {\tt A=(HL)} before {\tt HL} is decremented, reset otherwise
				\item {\tt PF} reset if {\tt BC=0} after execution, set otherwise
			}
		\end{DetailEffects}
				
		\begin{DetailTiming}
			\DetailTime{BC=0 or A=(HL)}{4}{16}
			\DetailTime{BC$\not=$0 and A$\not=$(HL)}{5}{21}
		\end{DetailTiming}

	\end{detailitem}

	\pagebreak
	\begin{detailitem}{CPI}
		{A-(HL)\\
		HL$\leftarrow$HL+1\\
		BC$\leftarrow$BC-1}

		Subtracts contents of memory location addressed by {\tt HL} register pair from accumulator {\tt A}. Result is then discarded. Afterwards {\tt HL} is incremented and {\tt BC} decremented.

		\begin{DetailEffects}
			\DetailFlags{\FS}{\FX}{\FS}{\FX}{1}{\FN}
			\DetailFlagsComments{
				\item {\tt ZF} set if {\tt A=(HL)} before {\tt HL} is incremented, reset otherwise
				\item {\tt PF} reset if {\tt BC=0} after execution, set otherwise
			}
		\end{DetailEffects}
		
		\begin{DetailTiming}
			\DetailTime{}{4}{16}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{CPIR}
		{A-(HL)\\
		HL$\leftarrow$HL+1\\
		BC$\leftarrow$BC-1\\
		Repeat until A=(HL) or BC=0}

		Repeats {\tt CPI} until either {\tt A=(HL)} or {\tt BC=0}.

		Example, searching for {\tt \$AB} in memory from {\tt \$0000-\$999}:

		\begin{multicols}{2}
			{\tt CPIR} = finding first occurrence:
			\begin{Verbatim}[gobble=4]
				LD HL, $0000
				LD BC, $0999
				LD A, $AB
				CPIR
			\end{Verbatim}

			{\tt CPDR} = finding last occurrence:
			\begin{Verbatim}[gobble=4]
				LD HL, $0999
				LD BC, $0999
				LD A, $AB
				CPDR
			\end{Verbatim}
		\end{multicols}

		\begin{DetailEffects}
			\DetailFlags{\FS}{\FX}{\FS}{\FX}{1}{\FN}
			\DetailFlagsComments{
				\item {\tt ZF} set if {\tt A=(HL)} before {\tt HL} is incremented, reset otherwise
				\item {\tt PF} reset if {\tt BC=0} after execution, set otherwise
			}
		\end{DetailEffects}
				
		\begin{DetailTiming}
			\DetailTime{BC=0 or A=(HL)}{4}{16}
			\DetailTime{BC$\not=$0 and A$\not=$(HL)}{5}{21}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{CPL}
		{A$\leftarrow\mathtt{\overline{A}}$}

		Complements (inverts) all bits of {\tt A} and stores result in {\tt A}.

		\begin{DetailEffects}
			\DetailFlags{\FN}{\FN}{1}{\FN}{1}{\FN}
		\end{DetailEffects}
		
		\begin{DetailTiming}
			\DetailTime{}{1}{4}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{DAA}
		{}

		Updates {\tt A} for BCD correction after arithmetic operations using the following algorithm:

		\begin{enumerate}
			\item If least significant 4 bits of {\tt A} (low nibble) contain invalid BCD number (greater than 9), or {\tt HF} is set, {\tt \$06} is added to {\tt A}
			\item Then 4 most significant bits (high nibble) of {\tt A} are checked; if they contain invalid BCD number, or {\tt CF} is set, {\tt \$60} is added to {\tt A}
		\end{enumerate}
		
		\begin{DetailEffects}[p]
			\DetailFlags{\FS}{\FS}{\FS}{\FS}{\FN}{\FS}
			\DetailFlagsComments{
				\item {\tt CF} set if second addition was required
			}
		\end{DetailEffects}
		
		\begin{DetailTiming}
			\DetailTime{}{1}{4}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{DEC s}
		{s$\leftarrow$s-1}

		\begin{DetailVariants}
			\textnormal{8-bit}\\
			DEC A\\
			DEC B\\
			DEC C\\
			DEC D\\
			DEC E\\
			DEC H\\
			DEC L\\
			\textnormal{8-bit}\\
			DEC (HL)\\
			DEC (IX+d)\\
			DEC (IY+d)\\
			DEC IXH\UNDOC\\
			DEC IXL\UNDOC\\
			DEC IYH\UNDOC\\
			DEC IYL\UNDOC\\
			\textnormal{16-bit}\\
			DEC BC\\
			DEC DE\\
			DEC HL\\
			DEC IX\\
			DEC IY\\
			DEC SP
		\end{DetailVariants}

		Decrements the operand {\tt s} or memory addressed by the operand {\tt s} by 1.

		\begin{DetailEffects}[v]
			\DetailFlags[8-bit]{\FS}{\FS}{\FS}{\FS}{1}{\FN}
			\DetailFlags[16-bit (no effect)]{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
		\end{DetailEffects}
		
		\begin{DetailTiming}
			\DetailTime{r}{1}{4}
			\DetailTime{rr}{1}{6}
			\DetailTime{IX}{2}{10}
			\DetailTime{IY}{2}{10}
			\DetailTime{(HL)}{3}{11}
			\DetailTime{(IX+d)}{6}{23}
			\DetailTime{(IY+d)}{6}{23}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{DI}
		{}

		Disables all maskable interrupts (mode 1 and 2). Interrupts are disabled after execution of the instruction following {\tt DI}. See section \ref{interrupts} for more details on interrupts.
		
		\DetailNoEffect
				
		\begin{DetailTiming}
			\DetailTime{}{1}{4}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{DJNZ e}
		{B$\leftarrow$B-1\\
		if B$\not=$0 PC$\leftarrow$PC+e}

		Decrements {\tt B} register and jumps to given relative address if {\tt B$\not=$0}. Given offset is added to the value of {\tt PC} after parsing {\tt DJNZ} instruction, so effective offset it {\tt -126} to {\tt +129}. Assembler automatically subtracts {\tt 2} from offset value {\tt e} to generate opcode.

		\DetailNoEffect
				
		\begin{DetailTiming}
			\DetailTime{B=0}{2}{8}
			\DetailTime{B$\not=$0}{3}{13}
		\end{DetailTiming}

	\end{detailitem}

	\pagebreak
	\begin{detailitem}{EI}
		{}

		Enables maskable interrupts (mode 1 and 2). Interrupts are enabled after execution of the instruction following {\tt EI}. See section \ref{interrupts} for more details on interrupts.

		\DetailNoEffect
				
		\begin{DetailTiming}
			\DetailTime{}{1}{4}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{EX d,s}
		{d$\leftrightarrow$s}

		\begin{DetailVariants}
			EX AF,AF'\\
			EX DE,HL

			\columnbreak
			EX (SP),IX\\
			EX (SP),IY
			
			\columnbreak
			EX (SP),HL
		\end{DetailVariants}

		Exchanges contents of two register pairs or register pair and last value pushed to stack. For example:

		\begin{tabular}{llcl}
			\multicolumn{2}{c}{BEFORE} & & AFTER \\[5pt]
			Reg & \multicolumn{3}{l}{Value} \\[5pt]
			{\tt HL} & 
				{\tt \$ABCD} & 
				\multirow{5}{*}{$\rightarrow$ {\tt EX (SP),HL} $\rightarrow$} & 
				{\tt \$3412}\\
			{\tt SP} & {\tt \$0B00} & & {\tt \$0B00}\\[5pt]
			Mem & Value \\[5pt]
			{\tt \$0B00} & {\tt \$12} & & {\tt \$CD}\\
			{\tt \$0B01} & {\tt \$34} & & {\tt \$AB}\\
		\end{tabular}\\[5pt] % some spacing between table and effects

		\DetailNoEffect
						
		\begin{DetailTiming}
			\DetailTime{rr,rr}{1}{4}
			\DetailTime{(SP),HL}{5}{19}
			\DetailTime{(SP),IX}{6}{23}
			\DetailTime{(SP),IY}{6}{23}
		\end{DetailTiming}

	\end{detailitem}

	\pagebreak
	\begin{detailitem}{EXX}
		{BC$\leftrightarrow$BC'\\
		DE$\leftrightarrow$DE'\\
		HL$\leftrightarrow$HL'}

		Exchanges contents of registers {\tt BC}, {\tt DE} and {\tt HL} with shadow registers {\tt BC'}, {\tt DE'} and {\tt HL'}. Most frequent use is in interrupt handlers as alternative of using stack for saving and restoring register values. If using outside interrupt handlers, interrupts must be disabled before using this instruction.

		\DetailNoEffect
				
		\begin{DetailTiming}
			\DetailTime{}{1}{4}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{HALT}
		{}

		Suspends CPU and executes {\tt NOP}s (to continue memory refresh cycles), until the next interrupt or reset. This effectively creates a delay. You can chain {\tt HALT}s. But make sure that there will be an interrupt, otherwise {\tt HALT} will run forever.

		\DetailNoEffect
						
		\begin{DetailTiming}
			\DetailTime{}{1}{4}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{IM n}
		{}

		\begin{DetailVariants}[1]
			IM 0\\
			IM 1\\
			IM 2
			
			\columnbreak
			~
		\end{DetailVariants}

		Sets the interrupt mode. All 3 interrupts are maskable, meaning they can be disabled using {\tt DI} instruction. See section \ref{interrupts} for details and example.

		\DetailNoEffect		

		\begin{DetailTiming}
			\DetailTime{}{2}{8}
		\end{DetailTiming}

	\end{detailitem}

	\pagebreak
	\begin{detailitem}{IN r,(s)}
		{r$\leftarrow$(s)}

		\begin{DetailVariants}
			IN A,(n)\\
			IN A,(C)\\
			IN B,(C)\\
			IN C,(C)\\
			IN D,(C)\\
			IN E,(C)\\
			IN H,(C)\\
			IN L,(C)\\
			IN F,(C)\UNDOC\\
			IN (C)\UNDOC
		\end{DetailVariants}

		Reads peripheral device addressed by {\tt BC} or combination of {\tt A} and immediate value and stores result in given register. Address is provided as follows:

		\begin{tabular}{ccc}
			& \multicolumn{2}{c}{Address Bits} \\
			Variant & {\tt 15-8} & {\tt 7-0} \\
			\hline
			{\tt IN A,(n)} & {\tt A} & {\tt n} \\
			{\tt IN r,(C)} & {\tt B} & {\tt C} \\
		\end{tabular}
		\vspace{1ex} % some spacing before next text for less cluttered layout

		So these 2 have exactly the same result (though, as mentioned in section \ref{zx_next_keyboard}, variant on the right is slightly faster, 18 vs 22 T states):

		\begin{multicols}{2}
			\begin{Verbatim}[gobble=4]
				LD BC, $DFFE
				IN A, (C)
			\end{Verbatim}
			\columnbreak
			\begin{Verbatim}[gobble=4]
				LD A, $DF
				IN A, ($FE)
			\end{Verbatim}
		\end{multicols}

		Note: {\tt IN (C)} (or its alternative form {\tt IN F,(C)}) variant performs an input, but does not store the result, only sets the flags.

		\begin{DetailEffects}[p]
			\DetailFlags[\tt IN r,(C)]{\FS}{\FS}{0}{\FS}{0}{\FN}
			\DetailFlags[{\tt IN A,(n)} (no effect)]{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
		\end{DetailEffects}
						
		\begin{DetailTiming}
			\DetailTime{r,(n)}{3}{11}
			\DetailTime{r,(C)}{3}{12}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{INC s}
		{s$\leftarrow$s+1}

		\begin{DetailVariants}
			\textnormal{8-bit}\\
			INC A\\
			INC B\\
			INC C\\
			INC D\\
			INC E\\
			INC H\\
			INC L

			\textnormal{8-bit}\\
			INC (HL)\\
			INC (IX+d)\\
			INC (IY+d)\\
			INC IXh\UNDOC\\
			INC IXl\UNDOC\\
			INC IYh\UNDOC\\
			INC IYl\UNDOC

			\textnormal{16-bit}\\
			INC BC\\
			INC DE\\
			INC HL\\
			INC IX\\
			INC IY\\
			INC SP
		\end{DetailVariants}

		Increments the operand or memory addressed by the operand by 1.

		\begin{DetailEffects}[v]
			\DetailFlags[8-bit]{\FS}{\FS}{\FS}{\FX}{0}{\FN}
			\DetailFlags[16-bit (no effect)]{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
			\DetailFlagsComments{
				\item {\tt PV} is set if value was {\tt \$7F}
			}
		\end{DetailEffects}
				
		\begin{DetailTiming}
			\DetailTime{r}{1}{6}
			\DetailTime{rr}{1}{6}
			\DetailTime{IX}{2}{10}
			\DetailTime{IY}{2}{10}
			\DetailTime{(HL)}{3}{11}
			\DetailTime{(IX+d)}{6}{23}
			\DetailTime{(IY+d)}{6}{23}
		\end{DetailTiming}

	\end{detailitem}

 	\begin{detailitem}{IND}
		{(HL)$\leftarrow$(C)\\
		HL$\leftarrow$HL-1\\
		B$\leftarrow$B-1}

		Reads peripheral device addressed by {\tt BC} and stores result in memory addressed by {\tt HL} register pair. Then {\tt HL} and {\tt B} are decremented.

		\begin{DetailEffects}
			\DetailFlags{\FU}{\FX}{\FU}{\FU}{1}{\FN}
			\DetailFlagsComments{
				\item {\tt ZF} set if {\tt B} becomes zero after decrementing, otherwise reset
			}
		\end{DetailEffects}
				
		\begin{DetailTiming}
			\DetailTime{}{4}{16}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{INDR}
		{do IND\\
		Repeat until B=0}

		Repeats {\tt IND} until {\tt B=0}.

		\begin{DetailEffects}
			\DetailFlags{\FU}{1}{\FU}{\FU}{1}{\FN}
		\end{DetailEffects}
				
		\begin{DetailTiming}
			\DetailTime{B=0}{4}{16}
			\DetailTime{B$\not=$0}{5}{21}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{INI}
		{(HL)$\leftarrow$(C)\\
		HL$\leftarrow$HL+1\\
		B$\leftarrow$B-1}

		Reads peripheral device addressed by {\tt BC} and stores result in memory addressed by {\tt HL} register pair. Then the value of {\tt HL} is incremented and {\tt B} decremented.

		\begin{DetailEffects}
			\DetailFlags{\FU}{\FX}{\FU}{\FU}{1}{\FN}
			\DetailFlagsComments{
				\item {\tt ZF} set if {\tt B} becomes zero after decrementing, otherwise reset
			}
		\end{DetailEffects}
				
		\begin{DetailTiming}
			\DetailTime{}{4}{16}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{INIR}
		{do INI\\
		Repeat until B=0}

		Repeats {\tt INI} until {\tt B=0}.

		\begin{DetailEffects}
			\DetailFlags{\FU}{1}{\FU}{\FU}{1}{\FN}
		\end{DetailEffects}
				
		\begin{DetailTiming}
			\DetailTime{B=0}{4}{16}
			\DetailTime{B$\not=$0}{5}{21}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{JP n}
		{PC$\leftarrow$nm}

		\begin{DetailVariants}
			JP nn
			
			\columnbreak
			JP (HL)
			
			\columnbreak
			JP (IX)\\
			JP (IY)
		\end{DetailVariants}

		Unconditionally jumps (aka changes {\tt PC} to point) to given absolute address or the memory location addressed by register pair. Unconditional jumps are the fastest way of changing program counter, even faster than {\tt JR}, but they take more bytes.

		\DetailNoEffect
				
		\begin{DetailTiming}
			\DetailTime{(HL)}{1}{4}
			\DetailTime{(IX)}{2}{8}
			\DetailTime{(IY)}{2}{8}
			\DetailTime{nn}{3}{10}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{JP c,nn}
		{if c is true: JP nn}

		\vspace{1ex} % we need some vertical space to achieve same separation as multicols
		\begin{tabular}{@{}llcll}			
			{\tt JP C,nn} & jumps if {\tt CF} is set & &
				{\tt JP M,nn} & jumps if {\tt SF} is set\\

			{\tt JP NC,nn} & jumps if {\tt CF} is reset & &
				{\tt JP P,nn} & jumps if {\tt SF} is reset\\

			{\tt JP Z,nn} & jumps if {\tt ZF} is set & &
				{\tt JP PE,nn} & jumps if {\tt PF} is set\\

			{\tt JP NZ,nn} & jumps if {\tt ZF} is reset & &
				{\tt JP PO,nn} & jumps if {\tt PF} is reset\\
		\end{tabular}

		Conditionally jumps to given absolute address. See {\tt CP} above for more details.

		\DetailNoEffect
				
		\begin{DetailTiming}
			\DetailTime{}{3}{10}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{JP (C)\ZXN}
		{PC$\leftarrow$PC$\wedge$\$C000+IN(C)<<6}

		Sets bottom 14 bits of current {\tt PC} to value read from I/O port: {\tt PC[13-0] = (IN (C) << 6)}. Can be used to execute code block read from a disk stream. "Current PC" is address of next instruction after {\tt JP (C)}, as the {\tt PC} is advanced by fetching op code from memory and is already advanced when execution happens - if {\tt JP (C)} instruction is located at the very end of 16K memory block (..FE or ..FF address), then new {\tt PC} value will land into following 16K block.

		\DetailNoEffect
				
		\begin{DetailTiming}
			\DetailTime{}{3}{13}
		\end{DetailTiming}

	\end{detailitem}

	\pagebreak
	\begin{detailitem}{JR e}
		{PC$\leftarrow$PC+e}
		
		Unconditionally performs relative jump. Given offset {\tt e} is added to value of {\tt PC} as signed value to allow jumps forward and backward. Offset is added to {\tt PC} after {\tt JR} instruction is read (aka {\tt PC+2}), so offset is {\tt -126} to {\tt 129}. Assembler automatically subtracts {\tt 2} from offset value {\tt e} to generate opcode.

		\DetailNoEffect
				
		\begin{DetailTiming}
			\DetailTime{}{3}{12}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{JR c,n}
		{if c is true: JR n}

		\vspace{1ex} % we need some vertical space to achieve same separation as multicols
		\begin{tabular}{@{}ll}
			{\tt JR C,e} & jumps if {\tt CF} is set\\
			{\tt JR NC,e} & jumps if {\tt CF} is reset\\
			{\tt JR Z,e} & jumps if {\tt ZF} is set\\
			{\tt JR NZ,e} & jumps if {\tt ZF} is reset\\
		\end{tabular}
		
		Conditionally performs relative jump. Note: in contrast to {\tt JP}, {\tt JR} only supports above 4 conditions. See {\tt CP} above for more details.

		\DetailNoEffect
						
		\begin{DetailTiming}
			\DetailTime{c false}{2}{7}
			\DetailTime{c true}{3}{12}
		\end{DetailTiming}

	\end{detailitem}

	\pagebreak
	\begin{detailitem}{LDD}
		{(DE)$\leftarrow$(HL)\\
		DE$\leftarrow$DE-1\\
		HL$\leftarrow$HL-1\\
		BC$\leftarrow$BC-1}

		Loads contents of memory location addressed by {\tt HL} to memory location addressed by {\tt DE}. Then decrements {\tt DE}, {\tt HL} and {\tt BC} register pairs.

		\begin{DetailEffects}
			\DetailFlags{\FN}{\FN}{0}{\FX}{0}{\FN}
			\DetailFlagsComments{
				\item {\tt PF} reset if {\tt BC=0} after execution, set otherwise
			}
		\end{DetailEffects}
				
		\begin{DetailTiming}
			\DetailTime{}{4}{16}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{LDDR}
		{do LDD\\
		Repeat until BC=0}

		Repeats {\tt LDD} until {\tt BC=0}. {\tt LDDR} can be used for block transfer. See {\tt LDIR} below for an example and comparison of both instructions.

		\begin{DetailEffects}
			\DetailFlags{\FN}{\FN}{0}{0}{0}{\FN}
		\end{DetailEffects}
				
		\begin{DetailTiming}
			\DetailTime{BC=0}{4}{16}
			\DetailTime{BC$\not=$0}{5}{21}
		\end{DetailTiming}

	\end{detailitem}

	\pagebreak
	\begin{detailitem}{LD d,s}
		{d$\leftarrow$s}

		Loads source {\tt s} into destination {\tt d}. The following combinations are allowed (source {\tt s} is represented horizontally, destination {\tt d} vertically):

		{
			\scriptsize
			\definecolor{llgray}{rgb}{0.9, 0.9, 0.9}
			\setlength{\tabcolsep}{1pt}
			\newcommand{\X}{$\bullet$}
			\newcommand{\n}{\cellcolor{llgray}}

			\begin{tabular}{@{}|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|}
				\arrayrulecolor{lightgray}
				\hline
				& {\tt A} & {\tt B} & {\tt C} & {\tt D} & {\tt E} & {\tt H} & {\tt L} & {\tt I} & {\tt R} & {\tt IXH} & {\tt IXL} & {\tt IYH} & {\tt IYL} & {\tt BC} & {\tt DE} & {\tt HL} & {\tt SP} & {\tt IX} & {\tt IY} & {\tt (BC)} & {\tt (DE)} & {\tt (HL)} & {\tt (IX+d)} & {\tt (IY+d)} & {\tt n} & {\tt nn} & {\tt (nn)} \\
				\hline

				{\tt A}      &\X&\X&\X&\X&\X&\X&\X&\X&\X&\X&\X&\X&\X&\n&\n&\n&\n&\n&\n&\X&\X&\X&\X&\X&\X&\n&\X \\ \hline
				{\tt B}      &\X&\X&\X&\X&\X&\X&\X&\n&\n&\X&\X&\X&\X&\n&\n&\n&\n&\n&\n&\n&\n&\X&\X&\X&\X&\n&\n \\ \hline
				{\tt C}      &\X&\X&\X&\X&\X&\X&\X&\n&\n&\X&\X&\X&\X&\n&\n&\n&\n&\n&\n&\n&\n&\X&\X&\X&\X&\n&\n \\ \hline
				{\tt D}      &\X&\X&\X&\X&\X&\X&\X&\n&\n&\X&\X&\X&\X&\n&\n&\n&\n&\n&\n&\n&\n&\X&\X&\X&\X&\n&\n \\ \hline
				{\tt E}      &\X&\X&\X&\X&\X&\X&\X&\n&\n&\X&\X&\X&\X&\n&\n&\n&\n&\n&\n&\n&\n&\X&\X&\X&\X&\n&\n \\ \hline
				{\tt H}      &\X&\X&\X&\X&\X&\X&\X&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\X&\X&\X&\X&\n&\n \\ \hline
				{\tt L}      &\X&\X&\X&\X&\X&\X&\X&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\X&\X&\X&\X&\n&\n \\ \hline
				{\tt I}      &\X&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n \\ \hline
				{\tt R}      &\X&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n \\ \hline
				{\tt IXH}    &\X&\X&\X&\X&\n&\n&\n&\n&\n&\X&\X&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\X&\n&\n \\ \hline
				{\tt IXL}    &\X&\X&\X&\X&\n&\n&\n&\n&\n&\X&\X&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\X&\n&\n \\ \hline
				{\tt IYH}    &\X&\X&\X&\X&\n&\n&\n&\n&\n&\n&\n&\X&\X&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\X&\n&\n \\ \hline
				{\tt IYL}    &\X&\X&\X&\X&\n&\n&\n&\n&\n&\n&\n&\X&\X&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\X&\n&\n \\ \hline
				{\tt BC}     &\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\X&\X \\ \hline
				{\tt DE}     &\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\X&\X \\ \hline
				{\tt HL}     &\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\X&\X \\ \hline
				{\tt SP}     &\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\X&\n&\X&\X&\n&\n&\n&\n&\n&\n&\X&\X \\ \hline
				{\tt IX}     &\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\X&\X \\ \hline
				{\tt IY}     &\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\X&\X \\ \hline
				{\tt (BC)}   &\X&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n \\ \hline
				{\tt (DE)}   &\X&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n \\ \hline
				{\tt (HL)}   &\X&\X&\X&\X&\X&\X&\X&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n \\ \hline
				{\tt (IX+d)} &\X&\X&\X&\X&\X&\X&\X&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n \\ \hline
				{\tt (IY+d)} &\X&\X&\X&\X&\X&\X&\X&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n \\ \hline
				{\tt (nn)}   &\X&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\n&\X&\X&\X&\X&\X&\X&\n&\n&\n&\n&\n&\n&\n&\n \\ \hline
			\end{tabular}
		}

		\begin{DetailEffects}
			\DetailFlags[{\tt LD A,I} and {\tt LD A,R}]{\FS}{\FS}{0}{\tt IFF2}{0}{\FN}
			\DetailFlags[Other variants]{\FN}{\FN}{\FN}{\FN}{\FN}{\FN}
		\end{DetailEffects}
						
		% this table is too big to fit to single page, so we split it to 2
		\begin{DetailTiming}
			\DetailTime{r,r}{1}{4}
			\DetailTime{SP,HL}{1}{6}
			\DetailTime{r,n}{2}{7}
			\DetailTime{rr,A}{2}{7}
			\DetailTime{A,(rr)}{2}{7}
			\DetailTime{r,(HL)}{2}{7}
			\DetailTime{(HL),r}{2}{7}
			\DetailTime{A,I}{2}{9}
			\DetailTime{A,R}{2}{9}
		\end{DetailTiming}

		\begin{DetailTiming}[Timing Cont.]
			\DetailTime{I,A}{2}{9}
			\DetailTime{R,A}{2}{9}
			\DetailTime{SP,IX}{2}{10}
			\DetailTime{SP,IY}{2}{10}
			\DetailTime{(HL),n}{3}{10}
			\DetailTime{rr,nn}{3}{10}
			\DetailTime{A,(nn)}{4}{13}
			\DetailTime{(nn),A}{4}{13}
			\DetailTime{IX,nn}{4}{14}
			\DetailTime{IY,nn}{4}{14}
			\DetailTime{(HL),nn}{5}{16}
			\DetailTime{(nn),HL}{5}{16}
			\DetailTime{r,(IX+d)}{5}{19}
			\DetailTime{r,(IY+d)}{5}{19}
			\DetailTime{(IX+d),r}{5}{19}
			\DetailTime{(IX+d),n}{5}{19}
			\DetailTime{(IY+d),r}{5}{19}
			\DetailTime{(IY+d),n}{5}{19}
			\DetailTime{(IX),nn}{6}{20}
			\DetailTime{(IY),nn}{6}{20}
			\DetailTime{rr,(nn)}{6}{20}
			\DetailTime{(nn),rr}{6}{20}
		\end{DetailTiming}

	\end{detailitem}
	
	\pagebreak
	\begin{detailitem}{LDI}
		{(DE)$\leftarrow$(HL)\\
		DE$\leftarrow$DE+1\\
		HL$\leftarrow$HL+1\\
		BC$\leftarrow$BC-1}

		Same as {\tt LDD}, except it increments {\tt DE} and {\tt HL}.

		\begin{DetailEffects}
			\DetailFlags{\FN}{\FN}{0}{\FX}{0}{\FN}
			\DetailFlagsComments{
				\item {\tt PF} reset if {\tt BC=0} after execution, set otherwise
			}
		\end{DetailEffects}
				
		\begin{DetailTiming}
			\DetailTime{}{4}{16}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{LDIR}
		{do LDI\\
		Repeat until BC=0}

		Repeats {\tt LDI} until {\tt BC=0}. Example of copying 100 bytes from {\tt source} to {\tt destination} with {\tt LDIR} and {\tt LDDR}:

		\begin{multicols}{2}
			{\tt LDIR}
			\begin{Verbatim}[gobble=4]
				LD HL, source
				LD DE, destination
				LD BC, 100
				LDIR
			\end{Verbatim}
			
			{\tt LDDR}
			\begin{Verbatim}[gobble=4]
				LD HL, source+99
				LD DE, destination+99
				LD BC, 100
				LDDR
			\end{Verbatim}
		\end{multicols}

		\begin{DetailEffects}
			\DetailFlags{\FN}{\FN}{0}{0}{0}{\FN}
		\end{DetailEffects}
				
		\begin{DetailTiming}
			\DetailTime{BC=0}{4}{16}
			\DetailTime{BC$\not=$0}{5}{21}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{LDDX\ZXN}
		{if (HL)$\neq$A: (DE)$\leftarrow$(HL)\\
		DE$\leftarrow$DE+1\\
		HL$\leftarrow$HL-1\\
		BC$\leftarrow$BC+1}

		Works similar to {\tt LDD} except:
		\begin{DetailCompactList}
			\item Byte is only copied if it's different from {\tt A}
			\item {\tt DE} is incremented instead of decremented
			\item Doesn't change flags
		\end{DetailCompactList}

		\DetailNoEffect
				
		\begin{DetailTiming}
			\DetailTime{}{4}{16}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{LDDRX\ZXN}
		{do LDDX\\
		Repeat until BC=0}

		Works similar to {\tt LDDR} except the differences noted at {\tt LDDX} above.

		\DetailNoEffect
					
		\begin{DetailTiming}
			\DetailTime{BC=0}{4}{16}
			\DetailTime{BC$\not=$0}{5}{21}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{LDIX\ZXN}
		{if (HL)$\neq$A: (DE)$\leftarrow$(HL)\\
		DE$\leftarrow$DE+1\\
		HL$\leftarrow$HL+1\\
		BC$\leftarrow$BC-1}

		Works similar to {\tt LDI} except:
		\begin{DetailCompactList}
			\item Byte is only copied if it's different from {\tt A}
			\item Doesn't change flags
		\end{DetailCompactList}

		\DetailNoEffect
				
		\begin{DetailTiming}
			\DetailTime{}{4}{16}
		\end{DetailTiming}

	\end{detailitem}

	\pagebreak
	\begin{detailitem}{LDIRX\ZXN}
		{do LDIX\\
		Repeat until BC=0}

		Works similar to {\tt LDIR} except the differences noted at {\tt LDIX} above.

		\DetailNoEffect
				
		\begin{DetailTiming}
			\DetailTime{BC=0}{4}{16}
			\DetailTime{BC$\not=$0}{5}{21}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{LDPIRX\ZXN}
		{do\\
		\phantom{>>}t$\leftarrow$(HL$\wedge$\$FFF8+E$\wedge$7)\\
		\phantom{>>}if t$\neq$A: (DE)$\leftarrow$t\\
		\phantom{>>}DE$\leftarrow$DE+1\\
		\phantom{>>}BC$\leftarrow$BC-1\\
		Repeat until BC=0}

		Similar to {\tt LDIRX} except the source byte address is not just {\tt HL}, but is obtained by using the top 13 bits of {\tt HL} and lower 3 bits of {\tt DE}. Furthermore {\tt HL} is not incremented during loop; it serves as base address of aligned 8 byte lookup table. {\tt DE} works as destination and also wrapping index 0..7 into table. This instruction is intended for ``pattern fill'' functionality.

		\DetailNoEffect
				
		\begin{DetailTiming}
			\DetailTime{BC=0}{4}{16}
			\DetailTime{BC$\not=$0}{5}{21}
		\end{DetailTiming}

	\end{detailitem}
	
	\pagebreak
	\begin{detailitem}{LDWS\ZXN}
		{(DE)$\leftarrow$(HL)\\
		INC L\\
		INC D}

		Copies the byte pointed to by {\tt HL} to the address pointed to by {\tt DE}. Then increments {\tt L} and {\tt D}. This is used for vertically copying bytes to the Layer 2 display.
			
		Note the source data are read only from single 256B (aligned) block of memory, because only {\tt L} is incremented, not {\tt HL} pair.

		\begin{DetailEffects}[v]
			\DetailFlags{\FS}{\FS}{\FS}{\FX}{0}{\FN}
			\DetailFlagsComments{
				\item {\tt PV} is set if value was {\tt \$7F}
				\item Flags are identical to what {\tt INC D} would produce
			}
		\end{DetailEffects}
				
		\begin{DetailTiming}
			\DetailTime{}{4}{14}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{MIRROR A\ZXN}
		{
			\scriptsize
			\multirow{3}{*}{
				\setlength{\unitlength}{0.9mm}
				\put(-1.5,-2){\makebox(4,3){A}}
				\begin{picture}(25,5.5)
					\put(2,-2){\framebox(6,3){7654}}
					\put(8.2,-2){\framebox(6,3){3210}}

					\put(13.5,-2.5){\line(0,-1){5}}
					\put(13.5,-7.5){\line(-1,0){11}}
					\put(2.5,-7.5){\vector(0,1){5}}

					\put(12,-2.5){\line(0,-1){4}}
					\put(12,-6.5){\line(-1,0){7.8}}
					\put(4.2,-6.5){\vector(0,1){4}}

					\put(10.5,-2.5){\line(0,-1){3}}
					\put(10.5,-5.5){\line(-1,0){4.7}}
					\put(5.8,-5.5){\vector(0,1){3}}

					\put(9,-2.5){\line(0,-1){2}}
					\put(9,-4.5){\line(-1,0){1.8}}
					\put(7.3,-4.5){\vector(0,1){2}}

					\put(2.5,6.5){\line(0,-1){5}}
					\put(13.5,6.5){\line(-1,0){11}}
					\put(13.5,6.5){\vector(0,-1){5}}

					\put(4.2,5.5){\line(0,-1){4}}
					\put(12,5.5){\line(-1,0){7.8}}
					\put(12,5.5){\vector(0,-1){4}}

					\put(5.8,4.5){\line(0,-1){3}}
					\put(10.5,4.5){\line(-1,0){4.7}}
					\put(10.5,4.5){\vector(0,-1){3}}

					\put(7.3,3.5){\line(0,-1){2}}
					\put(9,3.5){\line(-1,0){1.8}}
					\put(9,3.5){\vector(0,-1){2}}
				\end{picture}
			}
		}

		\vspace{7ex}
		Mirrors (reverses the order) of bits in the accumulator. Note: Older core versions supported {\tt MIRROR DE}, but this was removed.

		\DetailNoEffect
				
		\begin{DetailTiming}
			\DetailTime{}{2}{8}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{MUL D,E\ZXN}
		{DE$\leftarrow$D*E}

		Multiplies {\tt D} by {\tt E}, storing 16-bit result into {\tt DE}.

		\DetailNoEffect
				
		\begin{DetailTiming}
			\DetailTime{}{2}{8}
		\end{DetailTiming}

	\end{detailitem}

	\pagebreak
	\begin{detailitem}{NEG}
		{A$\leftarrow$0-A}

		Negates contents of accumulator and stores result back to {\tt A}.

		\begin{DetailEffects}[p]
			\DetailFlags{\FS}{\FS}{\FS}{\FS}{1}{\FS}
		\end{DetailEffects}
				
		\begin{DetailTiming}
			\DetailTime{}{2}{8}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{NEXTREG r,s\ZXN}
		{HwNextReg[r]$\leftarrow$s}

		\begin{DetailVariants}
			NEXTREG r,n\\
			NEXTREG r,A
		\end{DetailVariants}

		Directly sets the Next Feature Control Registers without going through ports TBBlue Register Select. See section \ref{zx_next_tbblue_registers} for ports list.

		\DetailNoEffect
				
		\begin{DetailTiming}
			\DetailTime{r,A}{4}{17}
			\DetailTime{r,n}{5}{20}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{NOP}
		{}

		Does nothing for 4 cycles.
		
		\DetailNoEffect
						
		\begin{DetailTiming}
			\DetailTime{}{1}{4}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{OR s}
		{A$\leftarrow$A$\vee$s}

		\begin{DetailVariants}
			OR A\\
			OR B\\
			OR C\\
			OR D\\
			OR E\\
			OR H\\
			OR L

			\columnbreak
			OR n\\
			OR (HL)\\
			OR (IX+d)\\
			OR (IY+d)

			\columnbreak
			OR IXH\UNDOC\\
			OR IXL\UNDOC\\
			OR IYH\UNDOC\\
			OR IYL\UNDOC
		\end{DetailVariants}

		Performs logical or between accumulator and operand {\tt s} or contents of memory addressed by {\tt s}. Then stores the result back to {\tt A}.

		\begin{DetailEffects}[p]
			\DetailFlags{\FS}{\FS}{0}{\FS}{0}{0}
		\end{DetailEffects}
				
		\begin{DetailTiming}
			\DetailTime{r}{1}{4}
			\DetailTime{n}{2}{7}
			\DetailTime{(HL)}{2}{7}
			\DetailTime{(IX+d)}{5}{19}
			\DetailTime{(IY+d)}{5}{19}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{OTDR}
		{(C)$\leftarrow$(HL)\\
		HL$\leftarrow$HL-1\\
		B$\leftarrow$B-1\\
		Repeat until B=0}

		Reads from memory location addressed by {\tt HL} and writes to port at {\tt BC}. Afterwards {\tt HL} and {\tt B} are decremented. This is repeated until {\tt B=0}.

		\begin{DetailEffects}
			\DetailFlags{\FU}{1}{\FU}{\FU}{1}{\FN}
		\end{DetailEffects}
				
		\begin{DetailTiming}
			\DetailTime{B=0}{4}{16}
			\DetailTime{B$\not=$0}{5}{21}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{OTIR}
		{(C)$\leftarrow$(HL)\\
		HL$\leftarrow$HL+1\\
		B$\leftarrow$B-1\\
		Repeat until B=0}

		Similar to {\tt OTDR} except {\tt HL} is incremented instead of decremented.

		\begin{DetailEffects}
			\DetailFlags{\FU}{1}{\FU}{\FU}{1}{\FN}
		\end{DetailEffects}
				
		\begin{DetailTiming}
			\DetailTime{B=0}{4}{16}
			\DetailTime{B$\not=$0}{5}{21}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{OUT (d),s}
		{(d)$\leftarrow$s}

		\begin{DetailVariants}
			OUT (n),A\\
			OUT (C),A\\
			OUT (C),B\\
			OUT (C),C\\
			OUT (C),D\\
			OUT (C),E\\
			OUT (C),H\\
			OUT (C),L\\
			OUT (C),0\UNDOC
		\end{DetailVariants}

		Writes the value of operand {\tt s} into port at address {\tt n}. Port address is defined:

		\begin{tabular}{ccc}
			& \multicolumn{2}{c}{Address Bits} \\
			Variant & {\tt 15-8} & {\tt 7-0} \\
			\hline
			{\tt OUT (n),A} & {\tt A} & {\tt n} \\
			{\tt OUT (C),r} & {\tt B} & {\tt C} \\
		\end{tabular}
		\vspace{1ex} % some spacing before next text for less cluttered layout

		Note: {\tt OUT (C),0} variant outputs {\tt 0} on the port {\tt BC} on the Next FPGA, but some Z80 chips may output different value like 255, so it is not recommended to use {\tt OUT (C),0} if you want to reuse your code also on classic ZX Spectrum.

		\DetailNoEffect
				
		\begin{DetailTiming}
			\DetailTime{(n),A}{3}{11}
			\DetailTime{(C),r}{3}{12}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{OUTD}
		{(C)$\leftarrow$(HL)\\
		HL$\leftarrow$HL-1\\
		B$\leftarrow$B-1}

		Outputs the value from contents of memory addressed by {\tt HL} to port addressed by {\tt BC}. Then decrements both, {\tt HL} and {\tt B}.

		\begin{DetailEffects}
			\DetailFlags{\FU}{\FX}{\FU}{\FU}{1}{\FN}
			\DetailFlagsComments{
				\item {\tt ZF} set if {\tt B=0} after decrement, reset otherwise
			}
		\end{DetailEffects}
				
		\begin{DetailTiming}
			\DetailTime{}{4}{16}
		\end{DetailTiming}

	\end{detailitem}

	\pagebreak
	\begin{detailitem}{OUTI}
		{(C)$\leftarrow$(HL)\\
		HL$\leftarrow$HL+1\\
		B$\leftarrow$B-1}

		Similar to {\tt OUTD} except {\tt HL} is incremented.
		
		\begin{DetailEffects}
			\DetailFlags{\FU}{\FX}{\FU}{\FU}{1}{\FN}
			\DetailFlagsComments{
				\item {\tt ZF} set if {\tt B=0} after decrement, reset otherwise
			}
		\end{DetailEffects}
				
		\begin{DetailTiming}
			\DetailTime{}{4}{16}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{OUTINB\ZXN}
		{(C)$\leftarrow$(HL)\\
		HL$\leftarrow$HL+1}

		Similar to {\tt OUTI} except it doesn't decrement {\tt B}.

		\begin{DetailEffects}
			\DetailFlags{\FU}{\FU}{\FU}{\FU}{\FU}{\FU}
		\end{DetailEffects}
				
		\begin{DetailTiming}
			\DetailTime{}{4}{16}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{PIXELAD\ZXN}
		{HL$\leftarrow$\$4000+((D$\wedge$\$C0)<<5)+((D$\wedge$\$07)<<8)+((D$\wedge$\$38)<<2)+(E>>3)}

		Takes {\tt E} and {\tt D} as the X,Y coordinate of a point and calculates the address of the byte containing this pixel in the pixel area of standard ULA screen 0. Result is stored in {\tt HL}.

		\DetailNoEffect
				
		\begin{DetailTiming}
			\DetailTime{}{2}{8}
		\end{DetailTiming}

	\end{detailitem}
	
	\pagebreak
	\begin{detailitem}{PIXELDN\ZXN}
		{if (HL$\wedge$\$700)$\neq$\$700\\
		$\Rightarrow$HL$\leftarrow$HL+256\\
		else if (HL$\wedge$\$E0)$\neq$\$E0\\
		$\Rightarrow$HL$\leftarrow$HL$\wedge$\$F8FF+\$20\\
		else\\
		$\Rightarrow$HL$\leftarrow$HL$\wedge$\$F81F+\$800}

		Updates the address in {\tt HL} to move down by one line of pixels of standard ULA screen 0.

		\DetailNoEffect
				
		\begin{DetailTiming}
			\DetailTime{}{2}{8}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{POP nn}
		{nnh$\leftarrow$(SP+1)\\
		nnl$\leftarrow$(SP)\\
		SP$\leftarrow$SP+2}

		\begin{DetailVariants}
			POP AF\\
			POP BC\\
			POP DE\\
			POP HL

			\columnbreak
			POP IX\\
			POP IY

			\columnbreak
			~
		\end{DetailVariants}

		Copies 2 bytes from {\tt SP} into contents of the given register pair and increments {\tt SP} by {\tt 2}.

		\DetailNoEffect
				
		\begin{DetailTiming}
			\DetailTime{rr}{3}{10}
			\DetailTime{IX}{4}{14}
			\DetailTime{IY}{4}{14}
		\end{DetailTiming}

	\end{detailitem}

	\pagebreak
	\begin{detailitem}{PUSH nn}
		{(SP-2)$\leftarrow$nnl\\
		(SP-1)$\leftarrow$nnh\\
		SP$\leftarrow$SP-2}

		\begin{DetailVariants}
			PUSH AF\\
			PUSH BC\\
			PUSH DE\\
			PUSH HL

			\columnbreak
			PUSH IX\\
			PUSH IY\\

			\columnbreak
			PUSH nn\ZXN
		\end{DetailVariants}

		Copies contents of a register pair to top of {\tt SP}, then decrements it by {\tt 2}. ZX Next extended {\tt PUSH nn} also allows pushing immediate 16-bit value.

		\DetailNoEffect
				
		\begin{DetailTiming}
			\DetailTime{rr}{3}{11}
			\DetailTime{IX}{4}{15}
			\DetailTime{IY}{4}{15}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{RES b,s}
		{$\mathtt{s_b}\leftarrow$0}

		% we use tabularx instead of multicols because some columns need to be wider to accomodate instructions. And then tabularx instead of tabular to fit whole width
		\begin{tabularx}{0.8\textwidth}{@{}p{1.8cm}XXp{2.7cm}}
			{\tt RES b,A} &
				{\tt RES b,(IX+d),A\UNDOC} &
				{\tt RES b,(IY+d),A\UNDOC} &
				{\tt RES b,(HL)} \\
			{\tt RES b,B} &
				{\tt RES b,(IX+d),B\UNDOC} &
				{\tt RES b,(IY+d),B\UNDOC} &
				{\tt RES b,(IX+d)} \\
			{\tt RES b,C} &
				{\tt RES b,(IX+d),C\UNDOC} &
				{\tt RES b,(IY+d),C\UNDOC} &
				{\tt RES b,(IY+d)} \\
			{\tt RES b,D} &
				{\tt RES b,(IX+d),D\UNDOC} &
				{\tt RES b,(IY+d),D\UNDOC} \\
			{\tt RES b,E} &
				{\tt RES b,(IX+d),E\UNDOC} &
				{\tt RES b,(IY+d),E\UNDOC}\\
			{\tt RES b,H} &
				{\tt RES b,(IX+d),H\UNDOC} &
				{\tt RES b,(IY+d),H\UNDOC} \\
			{\tt RES b,L} &
				{\tt RES b,(IX+d),L\UNDOC} &
				{\tt RES b,(IY+d),L\UNDOC} \\
		\end{tabularx}

		Resets bit {\tt b} ({\tt 0-7}) of the given register {\tt s} or memory location addressed by operand {\tt s}.

		\DetailNoEffect
						
		\begin{DetailTiming}
			\DetailTime{r}{2}{8}
			\DetailTime{(HL)}{4}{15}
			\DetailTime{(IX+d)}{6}{23}
			\DetailTime{(IY+d)}{6}{23}
		\end{DetailTiming}

	\end{detailitem}

	\pagebreak
	\begin{detailitem}{RET}
		{PCl$\leftarrow$(SP)\\
		PCh$\leftarrow$(SP+1)\\
		SP$\leftarrow$SP+2}

		Unconditionally returns from subroutine. The contents of program counter {\tt PC} is {\tt POP}-ed from stack so next instruction will be loaded from there.

		\DetailNoEffect
				
		\begin{DetailTiming}
			\DetailTime{}{3}{10}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{RET c}
		{if c is true: RET}

		\vspace{1ex} % we need some vertical space to achieve same separation as multicols
		\begin{tabular}{@{}llcll}
			{\tt RET C,nn} & returns if {\tt CF} is set & & 
				{\tt RET M,nn} & returns if {\tt SF} is set\\
			{\tt RET NC,nn} & returns if {\tt CF} is reset & & 
				{\tt RET P,nn} & returns if {\tt SF} is reset\\
			{\tt RET Z,nn} & returns if {\tt ZF} is set & & 
				{\tt RET PE,nn} & returns if {\tt PF} is set\\
			{\tt RET NZ,nn} & returns if {\tt ZF} is reset & & 
				{\tt RET PO,nn} & returns if {\tt PF} is reset\\
		\end{tabular}

		If given condition is met, {\tt RET} is performed, as described above.

		\DetailNoEffect
						
		\begin{DetailTiming}
			\DetailTime{c false}{1}{5}
			\DetailTime{c true}{3}{11}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{RETI}
		{PCl$\leftarrow$(SP)\\
		PCh$\leftarrow$(SP+1)\\
		SP$\leftarrow$SP+2}

		Returns from maskable interrupt; restores stack pointer {\tt SP} and signals to I/O device that interrupt routine is completed.
		
		Note that it doesn't re-enable interrupts that were disabled when interrupt routine started - {\tt EI} should be called before {\tt RETI} to do that. See {\tt IM} instruction above for example of use.

		\DetailNoEffect
				
		\begin{DetailTiming}
			\DetailTime{}{4}{14}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{RETN}
		{PCl$\leftarrow$(SP)\\
		PCh$\leftarrow$(SP+1)\\
		SP$\leftarrow$SP+2\\
		IFF1$\leftarrow$IFF2}

		Returns from non-maskable interrupt; restores stack pointer {\tt SP} and copies state of {\tt IFF2} back to {\tt IFF1} so that maskable interrupts are re-enabled.

		\DetailNoEffect
				
		\begin{DetailTiming}
			\DetailTime{}{4}{14}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{RL s}
		{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,4)
				\put(2,0){\framebox(4,3){CF}}
				\put(9,0){\framebox(7,3){7$\leftarrow$0}}
				\put(9,1.5){\vector(-1,0){3}}
				\put(2,1.5){\line(-1,0){2}}
				\put(0,1.5){\line(0,1){2.5}}
				\put(0,4){\line(1,0){17.5}}
				\put(17.5,4){\line(0,-1){2.5}}
				\put(17.5,1.5){\vector(-1,0){1.5}}
			\end{picture}
		}

		\begin{DetailVariants}
			RL A\\
			RL B\\
			RL C\\
			RL D\\
			RL E\\
			RL H\\
			RL L\\
			RL (HL)\\
			RL (IX+d)\\
			RL (IY+d)

			\columnbreak
			RL (IX+d),A\UNDOC\\
			RL (IX+d),B\UNDOC\\
			RL (IX+d),C\UNDOC\\
			RL (IX+d),D\UNDOC\\
			RL (IX+d),E\UNDOC\\
			RL (IX+d),H\UNDOC\\
			RL (IX+d),L\UNDOC

			\columnbreak
			RL (IY+d),A\UNDOC\\
			RL (IY+d),B\UNDOC\\
			RL (IY+d),C\UNDOC\\
			RL (IY+d),D\UNDOC\\
			RL (IY+d),E\UNDOC\\
			RL (IY+d),H\UNDOC\\
			RL (IY+d),L\UNDOC
		\end{DetailVariants}

		Performs 9-bit left rotation of the contens of the operand {\tt s} or memory addressed by {\tt s} through carry {\tt CF} so that contents of {\tt CF} are moved to bit {\tt 0} and bit {\tt 7} to {\tt CF}. Result is then stored back to {\tt s}.

		\begin{DetailEffects}[p]
			\DetailFlags{\FS}{\FS}{0}{\FS}{0}{\FX}
			\DetailFlagsComments{
				\item {\tt CF} set to bit {\tt 7} of {\tt s} before operation
			}
		\end{DetailEffects}
						
		\begin{DetailTiming}
			\DetailTime{r}{2}{8}
			\DetailTime{(HL)}{4}{15}
			\DetailTime{(IX+d)}{6}{23}
			\DetailTime{(IY+d)}{6}{23}
		\end{DetailTiming}

	\end{detailitem}

	\pagebreak
	\begin{detailitem}{RLA}
		{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,4)
				\put(2,0){\framebox(4,3){CF}}
				\put(9,0){\framebox(7,3){7$\leftarrow$0}}
				\put(9,1.5){\vector(-1,0){3}}
				\put(2,1.5){\line(-1,0){2}}
				\put(0,1.5){\line(0,1){2.5}}
				\put(0,4){\line(1,0){17.5}}
				\put(17.5,4){\line(0,-1){2.5}}
				\put(17.5,1.5){\vector(-1,0){1.5}}
			\end{picture}
		}

		Performs {\tt RL A}, but twice faster and preserves {\tt SF} and {\tt ZF}.

		\begin{DetailEffects}
			\DetailFlags{\FN}{\FN}{0}{\FN}{0}{\FX}
			\DetailFlagsComments{
				\item {\tt CF} set to bit {\tt 7} of {\tt s} before operation
			}
		\end{DetailEffects}
						
		\begin{DetailTiming}
			\DetailTime{}{1}{4}
		\end{DetailTiming}

	\end{detailitem}
	
	\begin{detailitem}{RLC s}
		{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,5)
				\put(0,0){\framebox(4,3){CF}}
				\put(8,0){\framebox(7,3){7$\leftarrow$0}}
				\put(8,1.5){\vector(-1,0){4}}
				\put(6,1.5){\line(0,1){2.5}}
				\put(6,4){\line(1,0){11}}
				\put(17,4){\line(0,-1){2.5}}
				\put(17,1.5){\vector(-1,0){2}}
			\end{picture}
		}

		\begin{DetailVariants}
			RLC A\\
			RLC B\\
			RLC C\\
			RLC D\\
			RLC E\\
			RLC H\\
			RLC L\\
			RLC (HL)\\
			RLC (IX+d)\\
			RLC (IY+d)

			\columnbreak
			RLC (IX+d),A\UNDOC\\
			RLC (IX+d),B\UNDOC\\
			RLC (IX+d),C\UNDOC\\
			RLC (IX+d),D\UNDOC\\
			RLC (IX+d),E\UNDOC\\
			RLC (IX+d),H\UNDOC\\
			RLC (IX+d),L\UNDOC

			\columnbreak
			RLC (IY+d),A\UNDOC\\
			RLC (IY+d),B\UNDOC\\
			RLC (IY+d),C\UNDOC\\
			RLC (IY+d),D\UNDOC\\
			RLC (IY+d),E\UNDOC\\
			RLC (IY+d),H\UNDOC\\
			RLC (IY+d),L\UNDOC
		\end{DetailVariants}

		Performs 8-bit rotation to the left. Bit {\tt 7} is moved to {\tt CF} as well as to bit {\tt 0}. Result is then stored back to {\tt s}.

		\begin{DetailEffects}[p]
			\DetailFlags{\FS}{\FS}{0}{\FS}{0}{\FX}
			\DetailFlagsComments{
				\item {\tt CF} set to bit {\tt 7} of {\tt s} before operation
			}
		\end{DetailEffects}
						
		\begin{DetailTiming}
			\DetailTime{r}{2}{8}
			\DetailTime{(HL)}{4}{15}
			\DetailTime{(IX+d)}{6}{23}
			\DetailTime{(IY+d)}{6}{23}
		\end{DetailTiming}

	\end{detailitem}

	\pagebreak
	\begin{detailitem}{RLCA}
		{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,5)
				\put(0,0){\framebox(4,3){CF}}
				\put(8,0){\framebox(7,3){7$\leftarrow$0}}
				\put(8,1.5){\vector(-1,0){4}}
				\put(6,1.5){\line(0,1){2.5}}
				\put(6,4){\line(1,0){11}}
				\put(17,4){\line(0,-1){2.5}}
				\put(17,1.5){\vector(-1,0){2}}
			\end{picture}
		}
		
		Performs {\tt RLC A}, but twice faster and preserves {\tt SF} and {\tt ZF}.

		\begin{DetailEffects}
			\DetailFlags{\FN}{\FN}{0}{\FN}{0}{\FX}
			\DetailFlagsComments{
				\item {\tt CF} set to bit {\tt 7} of {\tt s} before operation
			}
		\end{DetailEffects}
						
		\begin{DetailTiming}
			\DetailTime{}{1}{4}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{RLD}
		{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(25,5.5)
				\put(-7,0){\makebox(4,3){A}}
				\put(20,0){\makebox(4,3){(HL)}}
				\put(-2,0){\framebox(4.5,3){7-4}}
				\put(2.65,0){\framebox(4.5,3){3-0}}
				\put(9,0){\framebox(4.5,3){7-4}}
				\put(13.65,0){\framebox(4.5,3){3-0}}
				\put(5,4.45){\line(0,-1){1.45}}
				\put(5,4.45){\line(1,0){11.5}}
				\put(16.5,4.45){\vector(0,-1){1.45}}
				\put(12,-1.45){\vector(0,1){1.45}}
				\put(12,-1.45){\line(1,0){3.75}}
				\put(15.75,-1.45){\line(0,1){1.45}}
				\put(5,-1.45){\vector(0,1){1.45}}
				\put(10.5,-1.45){\line(-1,0){5.5}}
				\put(10.5,-1.45){\line(0,1){1.45}}
			\end{picture}
		}

		Performs leftward 12-bit rotation of 4-bit nibbles where 2 least significant nibbles are stored in memory location addressed by {\tt HL} and most significant digit as lower 4 bits of {\tt A}.
		
		If used with BCD numbers: as shift happens by 1 digit to the left, this effectively results in multiplication with {\tt 10}. {\tt A} acts as a sort of decimal carry in the operation. Example of multiplying BCD encoded number of any length by {\tt 10}:

		\begin{Verbatim}[gobble=2]
			LD HL, number  ; number to multiply        | progress:
			LD B, digits   ; number of repeats         | B A number+HL
			XOR A          ; reset "carry"             | 3 0 0123
		lp: RLD            ; multiply by 10            |     ^^ 
			INC HL         ; move to next digit        | 2 0 1023
			DJNZ lp        ; number = 1230             |      ^^
			                                           | 1 0 1203
		number:                                        |       ^^
			DB 0,1,2,3                                 | 0 0 1230
		digits = $ - number - 1 ; (3)                  |        ^^
		\end{Verbatim}

		Note: instruction doesn't assume any format of the data; it simply rotates nibbles. So while it's most frequently associated with BCD numbers, it can be used for shifting hexadecimal values (in which case it would represent multiplication by {\tt 16}), or any other content.

		\begin{DetailEffects}[p]
			\DetailFlags{\FS}{\FS}{0}{\FS}{0}{\FN}
		\end{DetailEffects}
						
		\begin{DetailTiming}
			\DetailTime{}{5}{18}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{RR s}
		{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,4)
				\put(12,0){\framebox(4,3){CF}}
				\put(2,0){\framebox(7,3){7$\leftarrow$0}}
				\put(0,1.5){\vector(1,0){2}}
				\put(9,1.5){\vector(1,0){3}}
				\put(0,1.5){\line(0,1){2.5}}
				\put(0,4){\line(1,0){17.5}}
				\put(17.5,4){\line(0,-1){2.5}}
				\put(16,1.5){\line(1,0){1.5}}
			\end{picture}
		}

		\begin{DetailVariants}
			RR A\\
			RR B\\
			RR C\\
			RR D\\
			RR E\\
			RR H\\
			RR L\\
			RR (HL)\\
			RR (IX+d)\\
			RR (IY+d)

			\columnbreak
			RR (IX+d),A\UNDOC\\
			RR (IX+d),B\UNDOC\\
			RR (IX+d),C\UNDOC\\
			RR (IX+d),D\UNDOC\\
			RR (IX+d),E\UNDOC\\
			RR (IX+d),H\UNDOC\\
			RR (IX+d),L\UNDOC

			\columnbreak
			RR (IY+d),A\UNDOC\\
			RR (IY+d),B\UNDOC\\
			RR (IY+d),C\UNDOC\\
			RR (IY+d),D\UNDOC\\
			RR (IY+d),E\UNDOC\\
			RR (IY+d),H\UNDOC\\
			RR (IY+d),L\UNDOC
		\end{DetailVariants}

		Performs 9-bit right rotation of the contens of the operand {\tt s} or memory addressed by {\tt s} through carry {\tt CF} so that contents of {\tt CF} are moved to bit {\tt 7} and bit {\tt 0} to {\tt CF}. Result is then stored back to {\tt s}.

		\begin{DetailEffects}[p]
			\DetailFlags{\FS}{\FS}{0}{\FS}{0}{\FX}
			\DetailFlagsComments{
				\item {\tt CF} set to bit {\tt 0} of {\tt s} before operation
			}
		\end{DetailEffects}
						
		\begin{DetailTiming}
			\DetailTime{r}{2}{8}
			\DetailTime{(HL)}{4}{15}
			\DetailTime{(IX+d)}{6}{23}
			\DetailTime{(IY+d)}{6}{23}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{RRA}
		{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,4)
				\put(12,0){\framebox(4,3){CF}}
				\put(2,0){\framebox(7,3){7$\leftarrow$0}}
				\put(0,1.5){\vector(1,0){2}}
				\put(9,1.5){\vector(1,0){3}}
				\put(0,1.5){\line(0,1){2.5}}
				\put(0,4){\line(1,0){17.5}}
				\put(17.5,4){\line(0,-1){2.5}}
				\put(16,1.5){\line(1,0){1.5}}
			\end{picture}
		}

		Performs {\tt RR A}, but twice faster and preserves {\tt SF} and {\tt ZF}.

		\begin{DetailEffects}
			\DetailFlags{\FN}{\FN}{0}{\FN}{0}{\FX}
			\DetailFlagsComments{
				\item {\tt CF} set to bit {\tt 0} of {\tt s} before operation
			}
		\end{DetailEffects}
						
		\begin{DetailTiming}
			\DetailTime{}{1}{4}
		\end{DetailTiming}

	\end{detailitem}

	\pagebreak
	\begin{detailitem}{RRC s}
		{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,4)
				\put(13,0){\framebox(4,3){CF}}
				\put(2,0){\framebox(7,3){7$\leftarrow$0}}
				\put(0,1.5){\vector(1,0){2}}
				\put(9,1.5){\vector(1,0){4}}
				\put(0,1.5){\line(0,1){2.5}}
				\put(0,4){\line(1,0){11}}
				\put(11,4){\line(0,-1){2.5}}
			\end{picture}
		}

		\begin{DetailVariants}
			RRC A\\
			RRC B\\
			RRC C\\
			RRC D\\
			RRC E\\
			RRC H\\
			RRC L\\
			RRC (HL)\\
			RRC (IX+d)\\
			RRC (IY+d)

			\columnbreak
			RRC (IX+d),A\UNDOC\\
			RRC (IX+d),B\UNDOC\\
			RRC (IX+d),C\UNDOC\\
			RRC (IX+d),D\UNDOC\\
			RRC (IX+d),E\UNDOC\\
			RRC (IX+d),H\UNDOC\\
			RRC (IX+d),L\UNDOC

			\columnbreak
			RRC (IY+d),A\UNDOC\\
			RRC (IY+d),B\UNDOC\\
			RRC (IY+d),C\UNDOC\\
			RRC (IY+d),D\UNDOC\\
			RRC (IY+d),E\UNDOC\\
			RRC (IY+d),H\UNDOC\\
			RRC (IY+d),L\UNDOC
		\end{DetailVariants}

		Performs 8-bit rotation to the right. Bit {\tt 0} is moved to {\tt CF} as well as to bit {\tt 7}. Result is then stored back to {\tt s}.

		\begin{DetailEffects}[p]
			\DetailFlags{\FS}{\FS}{0}{\FS}{0}{\FX}
			\DetailFlagsComments{
				\item {\tt CF} set to bit {\tt 0} of {\tt s} before operation
			}
		\end{DetailEffects}
						
		\begin{DetailTiming}
			\DetailTime{r}{2}{8}
			\DetailTime{(HL)}{4}{15}
			\DetailTime{(IX+d)}{6}{23}
			\DetailTime{(IY+d)}{6}{23}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{RRCA}
		{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,4)
				\put(13,0){\framebox(4,3){CF}}
				\put(2,0){\framebox(7,3){7$\leftarrow$0}}
				\put(0,1.5){\vector(1,0){2}}
				\put(9,1.5){\vector(1,0){4}}
				\put(0,1.5){\line(0,1){2.5}}
				\put(0,4){\line(1,0){11}}
				\put(11,4){\line(0,-1){2.5}}
			\end{picture}
		}

		Performs {\tt RRC A}, but twice faster and preserves {\tt SF} and {\tt ZF}.

		\begin{DetailEffects}
			\DetailFlags{\FN}{\FN}{0}{\FN}{0}{\FX}
			\DetailFlagsComments{
				\item {\tt CF} set to bit {\tt 0} of {\tt s} before operation
			}
		\end{DetailEffects}
						
		\begin{DetailTiming}
			\DetailTime{}{1}{4}
		\end{DetailTiming}

	\end{detailitem}

	\pagebreak
	\begin{detailitem}{RRD}
		{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(25,5.5)
				\put(-7,0){\makebox(4,3){A}}
				\put(20,0){\makebox(4,3){(HL)}}
				\put(-2,0){\framebox(4.5,3){7-4}}
				\put(2.65,0){\framebox(4.5,3){3-0}}
				\put(9,0){\framebox(4.5,3){7-4}}
				\put(13.65,0){\framebox(4.5,3){3-0}}
				\put(16.5,-1.45){\line(0,1){1.45}}
				\put(5,-1.45){\line(1,0){11.5}}
				\put(5,-1.45){\vector(0,1){1.45}}
				\put(15.75,4.45){\vector(0,-1){1.45}}
				\put(12,4.45){\line(1,0){3.75}}
				\put(12,4.45){\line(0,-1){1.45}}
				\put(10.5,4.45){\vector(0,-1){1.45}}
				\put(10.5,4.45){\line(-1,0){5.5}}
				\put(5,4.45){\line(0,-1){1.45}}
			\end{picture}
		}
		
		Similar to {\tt RLD} except rotation is to the right. If used with BCD values, this operation effectively divides 3-digit BCD number by {\tt 10} and stores remainder in {\tt A}.

		\begin{DetailEffects}[p]
			\DetailFlags{\FS}{\FS}{0}{\FS}{0}{\FN}
		\end{DetailEffects}
						
		\begin{DetailTiming}
			\DetailTime{}{5}{18}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{RST s}
		{(SP-1)$\leftarrow$PCh\\
		(SP-2)$\leftarrow$PCl\\
		SP$\leftarrow$SP-2\\
		PC$\leftarrow$s}

		\begin{DetailVariants}
			RST \$00\\
			RST \$08\\
			RST \$10\\
			RST \$18
			
			\columnbreak
			RST \$20\\
			RST \$28\\
			RST \$30\\
			RST \$38
		\end{DetailVariants}

		Restarts at the {\tt s}. Only above addresses are possible, all in page {\tt 0} of the memory, therefore most significant byte is loaded with {\tt \$00}. The instruction may be used as a fast response to an interrupt.

		\DetailNoEffect
						
		\begin{DetailTiming}
			\DetailTime{}{3}{11}
		\end{DetailTiming}

	\end{detailitem}

	\pagebreak
	\begin{detailitem}{SBC d,s}
		{d$\leftarrow$d-s-CF}
	
		\begin{DetailVariants}
			\textnormal{8 bit}\\
			SBC A,A\\
			SBC A,B\\
			SBC A,C\\
			SBC A,D\\
			SBC A,E\\
			SBC A,H\\
			SBC A,L\\
			SBC A,n

			\columnbreak
			\textnormal{8 bit}\\
			SBC A,IXH\UNDOC\\
			SBC A,IXL\UNDOC\\
			SBC A,IYH\UNDOC\\
			SBC A,IYL\UNDOC\\
			SBC A,(HL)\\
			SBC A,(IX+d)\\
			SBC A,(IY+d)

			\columnbreak
			\textnormal{16 bit}\\
			SBC HL,BC\\
			SBC HL,DE\\
			SBC HL,HL\\
			SBC HL,SP
		\end{DetailVariants}
		
		Source operand {\tt s} or contents of the memory location addressed by {\tt s} and carry flag are subtracted from destination {\tt d}. Result is then stored to destination {\tt d}.

		\begin{DetailEffects}[v]
			\DetailFlags[8-bit]{\FS}{\FS}{\FS}{\FS}{1}{\FS}
			\DetailFlags[16-bit]{\FS}{\FS}{\FU}{\FS}{1}{\FS}
		\end{DetailEffects}
						
		\begin{DetailTiming}
			\DetailTime{r}{1}{4}
			\DetailTime{n}{2}{7}
			\DetailTime{(HL)}{2}{7}
			\DetailTime{HL,rr}{4}{15}
			\DetailTime{(IX+d)}{5}{19}
			\DetailTime{(IY+d)}{5}{19}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{SCF}
		{CF$\leftarrow$1}

		Sets carry flag {\tt CF}.

		\begin{DetailEffects}
			\DetailFlags{\FN}{\FN}{0}{\FN}{0}{1}
		\end{DetailEffects}
						
		\begin{DetailTiming}
			\DetailTime{}{1}{4}
		\end{DetailTiming}

	\end{detailitem}

	\pagebreak
	\begin{detailitem}{SET b,s}
		{$\mathtt{s_b}\leftarrow$1}

		\begin{DetailVariants}
			SET b,A\\
			SET b,B\\
			SET b,C\\
			SET b,D\\
			SET b,E\\
			SET b,H\\
			SET b,L\\
			SET b,(HL)\\
			SET b,(IX+d)\\
			SET b,(IY+d)

			\columnbreak
			SET b,(IX+d),A\UNDOC\\
			SET b,(IX+d),B\UNDOC\\
			SET b,(IX+d),C\UNDOC\\
			SET b,(IX+d),D\UNDOC\\
			SET b,(IX+d),E\UNDOC\\
			SET b,(IX+d),H\UNDOC\\
			SET b,(IX+d),L\UNDOC

			\columnbreak
			SET b,(IY+d),A\UNDOC\\
			SET b,(IY+d),B\UNDOC\\
			SET b,(IY+d),C\UNDOC\\
			SET b,(IY+d),D\UNDOC\\
			SET b,(IY+d),E\UNDOC\\
			SET b,(IY+d),H\UNDOC\\
			SET b,(IY+d),L\UNDOC
		\end{DetailVariants}

		Sets bit {\tt b} ({\tt 0-7} of operand {\tt s} or memory location addressed by {\tt s}.

		Note: undocumented variants {\tt SET b,(IX+d),r} and {\tt SET b,(IY+d),r} work slightly differently:

		\DetailSymbol{r$\leftarrow$(IX+d)\\
		$\mathtt{r_b}\leftarrow$1\\
		(IX+d)$\leftarrow$r}

		\DetailNoEffect
						
		\begin{DetailTiming}
			\DetailTime{r}{2}{8}
			\DetailTime{(HL)}{4}{15}
			\DetailTime{(IX+d)}{6}{23}
			\DetailTime{(IY+d)}{6}{23}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{SETAE\ZXN}
		{A$\leftarrow$unsigned(\$80)>>(E$\wedge$7)}

		Takes the bit number to set from {\tt E} (only the low 3 bits) and sets whole {\tt A} to value of that bit, but counted from top to bottom ({\tt E=0} will produce {\tt A$\leftarrow$\$80}, {\tt E=7} will produce {\tt A$\leftarrow$\$01}). This works as pixel mask for ULA bitmap modes, when {\tt E} is 0..255 x-coordinate.

		\DetailNoEffect
						
		\begin{DetailTiming}
			\DetailTime{}{2}{8}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{SLA s}
		{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,4)
				\put(0,0){\framebox(4,3){CF}}
				\put(7,0){\framebox(7,3){7$\leftarrow$0}}
				\put(7,1.5){\vector(-1,0){3}}
				\put(17,1.5){\vector(-1,0){3}}
				\put(16,0){\makebox(4,3){0}}
			\end{picture}
		}
		
		\begin{DetailVariants}
			SLA A\\
			SLA B\\
			SLA C\\
			SLA D\\
			SLA E\\
			SLA H\\
			SLA L\\
			SLA (HL)\\
			SLA (IX+d)\\
			SLA (IY+d)

			\columnbreak
			SLA (IX+d),A\UNDOC\\
			SLA (IX+d),B\UNDOC\\
			SLA (IX+d),C\UNDOC\\
			SLA (IX+d),D\UNDOC\\
			SLA (IX+d),E\UNDOC\\
			SLA (IX+d),H\UNDOC\\
			SLA (IX+d),L\UNDOC

			\columnbreak
			SLA (IY+d),A\UNDOC\\
			SLA (IY+d),B\UNDOC\\
			SLA (IY+d),C\UNDOC\\
			SLA (IY+d),D\UNDOC\\
			SLA (IY+d),E\UNDOC\\
			SLA (IY+d),H\UNDOC\\
			SLA (IY+d),L\UNDOC
		\end{DetailVariants}

		Performs arithmetic shift left of the operand {\tt s} or memory location addressed by {\tt s}. Bit {\tt 0} is forced to {\tt 0} and bit {\tt 7} is moved to {\tt CF}.

		\begin{DetailEffects}[p]
			\DetailFlags{\FS}{\FS}{0}{\FS}{0}{\FX}
			\DetailFlagsComments{
				\item {\tt CF} set to bit {\tt 7} of {\tt s} before operation
			}
		\end{DetailEffects}
						
		\begin{DetailTiming}
			\DetailTime{r}{2}{8}
			\DetailTime{(HL)}{4}{15}
			\DetailTime{(IX+d)}{6}{23}
			\DetailTime{(IY+d)}{6}{23}
		\end{DetailTiming}

	\end{detailitem}

	\pagebreak
	\begin{detailitem}{SLL s}
		{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,4)
				\put(0,0){\framebox(4,3){CF}}
				\put(7,0){\framebox(7,3){7$\leftarrow$0}}
				\put(7,1.5){\vector(-1,0){3}}
				\put(17,1.5){\vector(-1,0){3}}
				\put(16,0){\makebox(4,3){1}}
			\end{picture}
		}
		
		\begin{DetailVariants}
			SLL A\\
			SLL B\\
			SLL C\\
			SLL D\\
			SLL E\\
			SLL H\\
			SLL L\\
			SLL (HL)\\
			SLL (IX+d)\\
			SLL (IY+d)

			\columnbreak
			SLL (IX+d),A\UNDOC\\
			SLL (IX+d),B\UNDOC\\
			SLL (IX+d),C\UNDOC\\
			SLL (IX+d),D\UNDOC\\
			SLL (IX+d),E\UNDOC\\
			SLL (IX+d),H\UNDOC\\
			SLL (IX+d),L\UNDOC

			\columnbreak
			SLL (IY+d),A\UNDOC\\
			SLL (IY+d),B\UNDOC\\
			SLL (IY+d),C\UNDOC\\
			SLL (IY+d),D\UNDOC\\
			SLL (IY+d),E\UNDOC\\
			SLL (IY+d),H\UNDOC\\
			SLL (IY+d),L\UNDOC
		\end{DetailVariants}

		Undocumented instruction. Similar to {\tt SLA} except {\tt 1} is moved to bit {\tt 0}.

		\begin{DetailEffects}[p]
			\DetailFlags{\FS}{\FS}{0}{\FS}{0}{\FX}
			\DetailFlagsComments{
				\item {\tt CF} set to bit {\tt 7} of {\tt s} before operation
			}
		\end{DetailEffects}
						
		\begin{DetailTiming}
			\DetailTime{r}{2}{8}
			\DetailTime{(HL)}{4}{15}
			\DetailTime{(IX+d)}{6}{23}
			\DetailTime{(IY+d)}{6}{23}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{SRA s}
		{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,4)
				\put(13,0){\framebox(4,3){CF}}
				\put(3,0){\framebox(7,3){7$\rightarrow$0}}
				\put(10,1.5){\vector(1,0){3}}
				\put(1,1.5){\vector(1,0){2}}
				\put(1,-1.5){\line(0,1){3}}
				\put(1,-1.5){\line(1,0){2.5}}
				\put(3.5,-1.5){\line(0,1){1.5}}
			\end{picture}
		}
				
		\begin{DetailVariants}
			SRA A\\
			SRA B\\
			SRA C\\
			SRA D\\
			SRA E\\
			SRA H\\
			SRA L\\
			SRA (HL)\\
			SRA (IX+d)\\
			SRA (IY+d)

			\columnbreak
			SRA (IX+d),A\UNDOC\\
			SRA (IX+d),B\UNDOC\\
			SRA (IX+d),C\UNDOC\\
			SRA (IX+d),D\UNDOC\\
			SRA (IX+d),E\UNDOC\\
			SRA (IX+d),H\UNDOC\\
			SRA (IX+d),L\UNDOC

			\columnbreak
			SRA (IY+d),A\UNDOC\\
			SRA (IY+d),B\UNDOC\\
			SRA (IY+d),C\UNDOC\\
			SRA (IY+d),D\UNDOC\\
			SRA (IY+d),E\UNDOC\\
			SRA (IY+d),H\UNDOC\\
			SRA (IY+d),L\UNDOC
		\end{DetailVariants}

		Performs arithmetic shift right of the operand {\tt s} or memory location addressed by {\tt s}. Bit {\tt 0} is moved to {\tt CF} while bit {\tt 7} remains unchanged.

		\begin{DetailEffects}[p]
			\DetailFlags{\FS}{\FS}{0}{\FS}{0}{\FX}
			\DetailFlagsComments{
				\item {\tt CF} set to bit {\tt 0} of {\tt s} before operation
			}
		\end{DetailEffects}
						
		\begin{DetailTiming}
			\DetailTime{r}{2}{8}
			\DetailTime{(HL)}{4}{15}
			\DetailTime{(IX+d)}{6}{23}
			\DetailTime{(IY+d)}{6}{23}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{SRL s}
		{
			\scriptsize
			\setlength{\unitlength}{0.9mm}
			\begin{picture}(17,4)
				\put(-0.5,0){\makebox(1,3){0}}
				\put(13,0){\framebox(4,3){CF}}
				\put(3,0){\framebox(7,3){7$\rightarrow$0}}
				\put(10,1.5){\vector(1,0){3}}
				\put(1,1.5){\vector(1,0){2}}
			\end{picture}
		}
				
		\begin{DetailVariants}
			SRL A\\
			SRL B\\
			SRL C\\
			SRL D\\
			SRL E\\
			SRL H\\
			SRL L\\
			SRL (HL)\\
			SRL (IX+d)\\
			SRL (IY+d)

			\columnbreak
			SRL (IX+d),A\UNDOC\\
			SRL (IX+d),B\UNDOC\\
			SRL (IX+d),C\UNDOC\\
			SRL (IX+d),D\UNDOC\\
			SRL (IX+d),E\UNDOC\\
			SRL (IX+d),H\UNDOC\\
			SRL (IX+d),L\UNDOC

			\columnbreak
			SRL (IY+d),A\UNDOC\\
			SRL (IY+d),B\UNDOC\\
			SRL (IY+d),C\UNDOC\\
			SRL (IY+d),D\UNDOC\\
			SRL (IY+d),E\UNDOC\\
			SRL (IY+d),H\UNDOC\\
			SRL (IY+d),L\UNDOC
		\end{DetailVariants}

		Performs logical shift right of the operand {\tt s} or memory location addressed by {\tt s}. Bit {\tt 0} is moved to {\tt CF} while {\tt 0} is moved to bit {\tt 7}.

		\begin{DetailEffects}[p]
			\DetailFlags{\FS}{\FS}{0}{\FS}{0}{\FX}
			\DetailFlagsComments{
				\item {\tt CF} set to bit {\tt 0} of {\tt s} before operation
			}
		\end{DetailEffects}
						
		\begin{DetailTiming}
			\DetailTime{r}{2}{8}
			\DetailTime{(HL)}{4}{15}
			\DetailTime{(IX+d)}{6}{23}
			\DetailTime{(IY+d)}{6}{23}
		\end{DetailTiming}

	\end{detailitem}

	\pagebreak
	\begin{detailitem}{SUB s}
		{A$\leftarrow$A-s}

		\begin{DetailVariants}
			SUB A\\
			SUB B\\
			SUB C\\
			SUB D\\
			SUB E\\
			SUB H\\
			SUB L

			\columnbreak
			SUB n\\
			SUB (HL)\\
			SUB (IX+d)\\
			SUB (IY+d)

			\columnbreak
			SUB IXh\UNDOC\\
			SUB IXl\UNDOC\\
			SUB IYh\UNDOC\\
			SUB IYl\UNDOC
		\end{DetailVariants}

		Subtracts 8-bit immediate value, operand {\tt s} or memory location addressed by {\tt c} from accumulator {\tt A}. Then stores result back to {\tt A}.

		\begin{DetailEffects}[v]
			\DetailFlags{\FS}{\FS}{\FS}{\FS}{1}{\FS}
		\end{DetailEffects}
						
		\begin{DetailTiming}
			\DetailTime{r}{1}{4}
			\DetailTime{n}{2}{7}
			\DetailTime{(HL)}{2}{7}
			\DetailTime{(IX+d)}{5}{19}
			\DetailTime{(IY+d)}{5}{19}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{SWAPNIB\ZXN}
		{
			\scriptsize
			\multirow{3}{*}{
				\setlength{\unitlength}{0.9mm}
				\put(-1.5,1){\makebox(4,3){A}}
				\begin{picture}(25,5.5)
					\put(2,1){\framebox(6,3){7654}}
					\put(8.2,1){\framebox(6,3){3210}}

					\put(11.5,0.5){\line(0,-1){2}}
					\put(11.5,-1.5){\line(-1,0){6.8}}
					\put(4.7,-1.5){\vector(0,1){2}}

					\put(4.7,6.5){\line(0,-1){2}}
					\put(11.5,6.5){\line(-1,0){6.8}}
					\put(11.5,6.5){\vector(0,-1){2}}
				\end{picture}
			}
		}

		\vspace{3ex} % we need some vertical spacing to avoid clipping above image

		Swaps the high and low nibbles of accumulator {\tt A}.

		\DetailNoEffect
						
		\begin{DetailTiming}
			\DetailTime{}{2}{8}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{TEST n\ZXN}
		{A$\wedge$n}

		Similar to {\tt CP}, but performs an {\tt AND} instead of a subtraction.

		\begin{DetailEffects}[v]
			\DetailFlags{\FS}{\FS}{\FS}{\FS}{\FU}{\FS}
		\end{DetailEffects}
						
		\begin{DetailTiming}
			\DetailTime{}{3}{11}
		\end{DetailTiming}

	\end{detailitem}

	\begin{detailitem}{XOR s}
		{A$\leftarrow$A$\bullet$s}

		\begin{DetailVariants}
			XOR A\\
			XOR B\\
			XOR C\\
			XOR D\\
			XOR E\\
			XOR H\\
			XOR L

			\columnbreak
			XOR n\\
			XOR (HL)\\
			XOR (IX+d)\\
			XOR (IY+d)

			\columnbreak
			XOR IXh\UNDOC\\
			XOR IXl\UNDOC\\
			XOR IYh\UNDOC\\
			XOR IYl\UNDOC
		\end{DetailVariants}

		Performs exclusive or between accumulator and 8-bit immediate value, operand {\tt s} or memory location addressed by {\tt s}. Result is then stored back to {\tt A}

		\begin{DetailEffects}[p]
			\DetailFlags{\FS}{\FS}{0}{\FS}{0}{0}
		\end{DetailEffects}
						
		\begin{DetailTiming}
			\DetailTime{r}{1}{4}
			\DetailTime{n}{2}{7}
			\DetailTime{(HL)}{2}{7}
			\DetailTime{(IX+d)}{5}{19}
			\DetailTime{(IY+d)}{5}{19}
		\end{DetailTiming}

	\end{detailitem}

\end{basedescript}



\appendix

% only print chapters in appendices, not sections and subsections
\addtocontents{toc}{\protect\setcounter{tocdepth}{0}}

\chapter{Instructions Sorted by Mnemonic}

Instructions marked with \UNDOC ~are undocumented.\\
Instructions marked with \ZXN ~are ZX Spectrum Next extended.
% TODO: and any instruction not listed has no effect? (same behaviour as an equal amount of NOP instructions)
\setlength\columnsep{4em}
\begin{multicols}{3}
{
	\tt 
	\small
	\begin{tabbing}
	ADC A,(HL){\qquad}{\quad}\=8E\\
	ADC A,(IX+d)\>DD8E d\\
	ADC A,(IY+d)\>FD8E d\\
	ADC A,A\>8F\\
	ADC A,B\>88\\
	ADC A,C\>89\\
	ADC A,D\>8A\\
	ADC A,E\>8B\\
	ADC A,H\>8C\\
	ADC A,IXh\UNDOC\>DD8C\\
	ADC A,IXl\UNDOC\>DD8D\\
	ADC A,IYh\UNDOC\>FD8C\\
	ADC A,IYl\UNDOC\>FD8D\\
	ADC A,L\>8D\\
	ADC A,n\>CE n\\
	ADC HL,BC\>ED4A\\
	ADC HL,DE\>ED5A\\
	ADC HL,HL\>ED6A\\
	ADC HL,SP\>ED7A\\
	ADD A,(HL)\>86\\
	ADD A,(IX+d)\>DD86 d\\
	ADD A,(IY+d)\>FD86 d\\
	ADD A,A\>87\\
	ADD A,B\>80\\
	ADD A,C\>81\\
	ADD A,D\>82\\
	ADD A,E\>83\\
	ADD A,H\>84\\
	ADD A,IXh\UNDOC\>DD84\\
	ADD A,IXl\UNDOC\>DD85\\
	ADD A,IYh\UNDOC\>FD84\\
	ADD A,IYl\UNDOC\>FD85\\
	ADD A,L\>85\\
	ADD A,n\>C6 n\\
	ADD BC,A\ZXN\>ED33\\
	ADD BC,nn\ZXN\>ED36	n n\\
	ADD DE,A\ZXN\>ED32\\
	ADD DE,nn\ZXN\>ED35 n n\\
	ADD HL,A\ZXN\>ED31\\
	ADD HL,BC\>09\\
	ADD HL,DE\>19\\
	ADD HL,HL\>29\\
	ADD HL,SP\>39\\
	ADD HL,nn\ZXN\>ED34 n n\\
	ADD IX,BC\>DD09\\
	ADD IX,DE\>DD19\\
	ADD IX,IX\>DD29\\
	ADD IX,SP\>DD39\\
	ADD IY,BC\>FD09\\
	ADD IY,DE\>FD19\\
	ADD IY,IY\>FD29\\
	ADD IY,SP\>FD39\\
	AND (HL)\>A6\\
	AND (IX+d)\>DDA6 d\\
	AND (IY+d)\>FDA6 d\\
	AND A\>A7\\
	AND B\>A0\\
	AND C\>A1\\
	AND D\>A2\\
	AND E\>A3\\
	AND H\>A4\\
	AND IXh\UNDOC\>DDA4\\
	AND IXl\UNDOC\>DDA5\\
	AND IYh\UNDOC\>FDA4\\
	AND IYl\UNDOC\>FDA5\\
	AND L\>A5\\
	AND n\>E6 n\\
	BIT 0,(HL)\>CB46\\
	BIT 0,(IX+d)\UNDOC\>DDCB d 40\\
	BIT 0,(IX+d)\UNDOC\>DDCB d 41\\
	BIT 0,(IX+d)\UNDOC\>DDCB d 42\\
	BIT 0,(IX+d)\UNDOC\>DDCB d 43\\
	BIT 0,(IX+d)\UNDOC\>DDCB d 44\\
	BIT 0,(IX+d)\UNDOC\>DDCB d 45\\
	BIT 0,(IX+d)\UNDOC\>DDCB d 47\\
	BIT 0,(IX+d)\>DDCB d 46\\
	BIT 0,(IY+d)\UNDOC\>FDCB d 40\\
	BIT 0,(IY+d)\UNDOC\>FDCB d 41\\
	BIT 0,(IY+d)\UNDOC\>FDCB d 42\\
	BIT 0,(IY+d)\UNDOC\>FDCB d 43\\
	BIT 0,(IY+d)\UNDOC\>FDCB d 44\\
	BIT 0,(IY+d)\UNDOC\>FDCB d 45\\
	BIT 0,(IY+d)\UNDOC\>FDCB d 47\\
	BIT 0,(IY+d)\>FDCB d 46\\
	BIT 0,A\>CB47\\
	BIT 0,B\>CB40\\
	BIT 0,C\>CB41\\
	BIT 0,D\>CB42\\
	BIT 0,E\>CB43\\
	BIT 0,H\>CB44\\
	BIT 0,L\>CB45\\
	BIT 1,(HL)\>CB4E\\
	BIT 1,(IX+d)\UNDOC\>DDCB d 48\\
	BIT 1,(IX+d)\UNDOC\>DDCB d 49\\
	BIT 1,(IX+d)\UNDOC\>DDCB d 4A\\
	BIT 1,(IX+d)\UNDOC\>DDCB d 4B\\
	BIT 1,(IX+d)\UNDOC\>DDCB d 4C\\
	BIT 1,(IX+d)\UNDOC\>DDCB d 4D\\
	BIT 1,(IX+d)\UNDOC\>DDCB d 4F\\
	BIT 1,(IX+d)\>DDCB d 4E\\
	BIT 1,(IY+d)\UNDOC\>FDCB d 48\\
	BIT 1,(IY+d)\UNDOC\>FDCB d 49\\
	BIT 1,(IY+d)\UNDOC\>FDCB d 4A\\
	BIT 1,(IY+d)\UNDOC\>FDCB d 4B\\
	BIT 1,(IY+d)\UNDOC\>FDCB d 4C\\
	BIT 1,(IY+d)\UNDOC\>FDCB d 4D\\
	BIT 1,(IY+d)\UNDOC\>FDCB d 4F\\
	BIT 1,(IY+d)\>FDCB d 4E\\
	BIT 1,A\>CB4F\\
	BIT 1,B\>CB48\\
	BIT 1,C\>CB49\\
	BIT 1,D\>CB4A\\
	BIT 1,E\>CB4B\\
	BIT 1,H\>CB4C\\
	BIT 1,L\>CB4D\\
	BIT 2,(HL)\>CB56\\
	BIT 2,(IX+d)\UNDOC\>DDCB d 50\\
	BIT 2,(IX+d)\UNDOC\>DDCB d 51\\
	BIT 2,(IX+d)\UNDOC\>DDCB d 52\\
	BIT 2,(IX+d)\UNDOC\>DDCB d 53\\
	BIT 2,(IX+d)\UNDOC\>DDCB d 54\\
	BIT 2,(IX+d)\UNDOC\>DDCB d 55\\
	BIT 2,(IX+d)\UNDOC\>DDCB d 57\\
	BIT 2,(IX+d)\>DDCB d 56\\
	BIT 2,(IY+d)\UNDOC\>FDCB d 50\\
	BIT 2,(IY+d)\UNDOC\>FDCB d 51\\
	BIT 2,(IY+d)\UNDOC\>FDCB d 52\\
	BIT 2,(IY+d)\UNDOC\>FDCB d 53\\
	BIT 2,(IY+d)\UNDOC\>FDCB d 54\\
	BIT 2,(IY+d)\UNDOC\>FDCB d 55\\
	BIT 2,(IY+d)\UNDOC\>FDCB d 57\\
	BIT 2,(IY+d)\>FDCB d 56\\
	BIT 2,A\>CB57\\
	BIT 2,B\>CB50\\
	BIT 2,C\>CB51\\
	BIT 2,D\>CB52\\
	BIT 2,E\>CB53\\
	BIT 2,H\>CB54\\
	BIT 2,L\>CB55\\
	BIT 3,(HL)\>CB5E\\
	BIT 3,(IX+d)\UNDOC\>DDCB d 58\\
	BIT 3,(IX+d)\UNDOC\>DDCB d 59\\
	BIT 3,(IX+d)\UNDOC\>DDCB d 5A\\
	BIT 3,(IX+d)\UNDOC\>DDCB d 5B\\
	BIT 3,(IX+d)\UNDOC\>DDCB d 5C\\
	BIT 3,(IX+d)\UNDOC\>DDCB d 5D\\
	BIT 3,(IX+d)\UNDOC\>DDCB d 5F\\
	BIT 3,(IX+d)\>DDCB d 5E\\
	BIT 3,(IY+d)\UNDOC\>FDCB d 58\\
	BIT 3,(IY+d)\UNDOC\>FDCB d 59\\
	BIT 3,(IY+d)\UNDOC\>FDCB d 5A\\
	BIT 3,(IY+d)\UNDOC\>FDCB d 5B\\
	BIT 3,(IY+d)\UNDOC\>FDCB d 5C\\
	BIT 3,(IY+d)\UNDOC\>FDCB d 5D\\
	BIT 3,(IY+d)\UNDOC\>FDCB d 5F\\
	BIT 3,(IY+d)\>FDCB d 5E\\
	BIT 3,A\>CB5F\\
	BIT 3,B\>CB58\\
	BIT 3,C\>CB59\\
	BIT 3,D\>CB5A\\
	BIT 3,E\>CB5B\\
	BIT 3,H\>CB5C\\
	BIT 3,L\>CB5D\\
	BIT 4,(HL)\>CB66\\
	BIT 4,(IX+d)\UNDOC\>DDCB d 60\\
	BIT 4,(IX+d)\UNDOC\>DDCB d 61\\
	BIT 4,(IX+d)\UNDOC\>DDCB d 62\\
	BIT 4,(IX+d)\UNDOC\>DDCB d 63\\
	BIT 4,(IX+d)\UNDOC\>DDCB d 64\\
	BIT 4,(IX+d)\UNDOC\>DDCB d 65\\
	BIT 4,(IX+d)\UNDOC\>DDCB d 67\\
	BIT 4,(IX+d)\>DDCB d 66\\
	BIT 4,(IY+d)\UNDOC\>FDCB d 60\\
	BIT 4,(IY+d)\UNDOC\>FDCB d 61\\
	BIT 4,(IY+d)\UNDOC\>FDCB d 62\\
	BIT 4,(IY+d)\UNDOC\>FDCB d 63\\
	BIT 4,(IY+d)\UNDOC\>FDCB d 64\\
	BIT 4,(IY+d)\UNDOC\>FDCB d 65\\
	BIT 4,(IY+d)\UNDOC\>FDCB d 67\\
	BIT 4,(IY+d)\>FDCB d 66\\
	BIT 4,A\>CB67\\
	BIT 4,B\>CB60\\
	BIT 4,C\>CB61\\
	BIT 4,D\>CB62\\
	BIT 4,E\>CB63\\
	BIT 4,H\>CB64\\
	BIT 4,L\>CB65\\
	BIT 5,(HL)\>CB6E\\
	BIT 5,(IX+d)\UNDOC\>DDCB d 68\\
	BIT 5,(IX+d)\UNDOC\>DDCB d 69\\
	BIT 5,(IX+d)\UNDOC\>DDCB d 6A\\
	BIT 5,(IX+d)\UNDOC\>DDCB d 6B\\
	BIT 5,(IX+d)\UNDOC\>DDCB d 6C\\
	BIT 5,(IX+d)\UNDOC\>DDCB d 6D\\
	BIT 5,(IX+d)\UNDOC\>DDCB d 6F\\
	BIT 5,(IX+d)\>DDCB d 6E\\
	BIT 5,(IY+d)\UNDOC\>FDCB d 68\\
	BIT 5,(IY+d)\UNDOC\>FDCB d 69\\
	BIT 5,(IY+d)\UNDOC\>FDCB d 6A\\
	BIT 5,(IY+d)\UNDOC\>FDCB d 6B\\
	BIT 5,(IY+d)\UNDOC\>FDCB d 6C\\
	BIT 5,(IY+d)\UNDOC\>FDCB d 6D\\
	BIT 5,(IY+d)\UNDOC\>FDCB d 6F\\
	BIT 5,(IY+d)\>FDCB d 6E\\
	BIT 5,A\>CB6F\\
	BIT 5,B\>CB68\\
	BIT 5,C\>CB69\\
	BIT 5,D\>CB6A\\
	BIT 5,E\>CB6B\\
	BIT 5,H\>CB6C\\
	BIT 5,L\>CB6D\\
	BIT 6,(HL)\>CB76\\
	BIT 6,(IX+d)\UNDOC\>DDCB d 70\\
	BIT 6,(IX+d)\UNDOC\>DDCB d 71\\
	BIT 6,(IX+d)\UNDOC\>DDCB d 72\\
	BIT 6,(IX+d)\UNDOC\>DDCB d 73\\
	BIT 6,(IX+d)\UNDOC\>DDCB d 74\\
	BIT 6,(IX+d)\UNDOC\>DDCB d 75\\
	BIT 6,(IX+d)\UNDOC\>DDCB d 77\\
	BIT 6,(IX+d)\>DDCB d 76\\
	BIT 6,(IY+d)\UNDOC\>FDCB d 70\\
	BIT 6,(IY+d)\UNDOC\>FDCB d 71\\
	BIT 6,(IY+d)\UNDOC\>FDCB d 72\\
	BIT 6,(IY+d)\UNDOC\>FDCB d 73\\
	BIT 6,(IY+d)\UNDOC\>FDCB d 74\\
	BIT 6,(IY+d)\UNDOC\>FDCB d 75\\
	BIT 6,(IY+d)\UNDOC\>FDCB d 77\\
	BIT 6,(IY+d)\>FDCB d 76\\
	BIT 6,A\>CB77\\
	BIT 6,B\>CB70\\
	BIT 6,C\>CB71\\
	BIT 6,D\>CB72\\
	BIT 6,E\>CB73\\
	BIT 6,H\>CB74\\
	BIT 6,L\>CB75\\
	BIT 7,(HL)\>CB7E\\
	BIT 7,(IX+d)\UNDOC\>DDCB d 78\\
	BIT 7,(IX+d)\UNDOC\>DDCB d 79\\
	BIT 7,(IX+d)\UNDOC\>DDCB d 7A\\
	BIT 7,(IX+d)\UNDOC\>DDCB d 7B\\
	BIT 7,(IX+d)\UNDOC\>DDCB d 7C\\
	BIT 7,(IX+d)\UNDOC\>DDCB d 7D\\
	BIT 7,(IX+d)\UNDOC\>DDCB d 7F\\
	BIT 7,(IX+d)\>DDCB d 7E\\
	BIT 7,(IY+d)\UNDOC\>FDCB d 78\\
	BIT 7,(IY+d)\UNDOC\>FDCB d 79\\
	BIT 7,(IY+d)\UNDOC\>FDCB d 7A\\
	BIT 7,(IY+d)\UNDOC\>FDCB d 7B\\
	BIT 7,(IY+d)\UNDOC\>FDCB d 7C\\
	BIT 7,(IY+d)\UNDOC\>FDCB d 7D\\
	BIT 7,(IY+d)\UNDOC\>FDCB d 7F\\
	BIT 7,(IY+d)\>FDCB d 7E\\
	BIT 7,A\>CB7F\\
	BIT 7,B\>CB78\\
	BIT 7,C\>CB79\\
	BIT 7,D\>CB7A\\
	BIT 7,E\>CB7B\\
	BIT 7,H\>CB7C\\
	BIT 7,L\>CB7D\\
	BRLC DE,B\ZXN\>ED2C\\
	BSLA DE,B\ZXN\>ED28\\
	BSRA DE,B\ZXN\>ED29\\
	BSRF DE,B\ZXN\>ED2B\\
	BSRL DE,B\ZXN\>ED2A\\
	CALL nn\>CD n n\\
	CALL C,nn\>DC n n\\
	CALL M,nn\>FC n n\\
	CALL NC,nn\>D4 n n\\
	CALL NZ,nn\>C4 n n\\
	CALL P,nn\>F4 n n\\
	CALL PE,nn\>EC n n\\
	CALL PO,nn\>E4 n n\\
	CALL Z,nn\>CC n n\\
	CCF\>3F\\
	CP (HL)\>BE\\
	CP (IX+d)\>DDBE d\\
	CP (IY+d)\>FDBE d\\
	CP A\>BF\\
	CP B\>B8\\
	CP C\>B9\\
	CP D\>BA\\
	CP E\>BB\\
	CP H\>BC\\
	CP IXh\UNDOC\>DDBC\\
	CP IXl\UNDOC\>DDBD\\
	CP IYh\UNDOC\>FDBC\\
	CP IYl\UNDOC\>FDBD\\
	CP L\>BD\\
	CP n\>FE n\\
	CPDR\>EDB9\\
	CPD\>EDA9\\
	CPIR\>EDB1\\
	CPI\>EDA1\\
	CPL\>2F\\
	DAA\>27\\
	DEC (HL)\>35\\
	DEC (IX+d)\>DD35 d\\
	DEC (IY+d)\>FD35 d\\
	DEC A\>3D\\
	DEC BC\>0B\\
	DEC B\>05\\
	DEC C\>0D\\
	DEC DE\>1B\\
	DEC D\>15\\
	DEC E\>1D\\
	DEC HL\>2B\\
	DEC H\>25\\
	DEC IX\>DD2B\\
	DEC IXh\UNDOC\>DD25\\
	DEC IXl\UNDOC\>DD2D\\
	DEC IY\>FD2B\\
	DEC IYh\UNDOC\>FD25\\
	DEC IYl\UNDOC\>FD2D\\
	DEC L\>2D\\
	DEC SP\>3B\\
	DI\>F3\\
	DJNZ (PC+e)\>10 e\\
	EI\>FB\\
	EX (SP),HL\>E3\\
	EX (SP),IX\>DDE3\\
	EX (SP),IY\>FDE3\\
	EX AF,AF'\>08\\
	EX DE,HL\>EB\\
	EXX\>D9\\
	HALT\>76\\
	IM 0\UNDOC\>ED4E\\
	IM 0\UNDOC\>ED66\\
	IM 0\UNDOC\>ED6E\\
	IM 0\>ED46\\
	IM 1\UNDOC\>ED76\\
	IM 1\>ED56\\
	IM 2\UNDOC\>ED7E\\
	IM 2\>ED5E\\
	IN A,(C)\>ED78\\
	IN A,(n)\>DB n\\
	IN B,(C)\>ED40\\
	IN C,(C)\>ED48\\
	IN D,(C)\>ED50\\
	IN E,(C)\>ED58\\
	IN F,(C)\UNDOC\>ED70\\
	IN (C)\UNDOC\>ED70\\
	IN H,(C)\>ED60\\
	IN L,(C)\>ED68\\
	INC (HL)\>34\\
	INC (IX+d)\>DD34 d\\
	INC (IY+d)\>FD34 d\\
	INC A\>3C\\
	INC BC\>03\\
	INC B\>04\\
	INC C\>0C\\
	INC DE\>13\\
	INC D\>14\\
	INC E\>1C\\
	INC HL\>23\\
	INC H\>24\\
	INC IX\>DD23\\
	INC IXh\UNDOC\>DD24\\
	INC IXl\UNDOC\>DD2C\\
	INC IY\>FD23\\
	INC IYh\UNDOC\>FD24\\
	INC IYl\UNDOC\>FD2C\\
	INC L\>2C\\
	INC SP\>33\\
	INDR\>EDBA\\
	IND\>EDAA\\
	INIR\>EDB2\\
	INI\>EDA2\\
	JP (C)\ZXN\>ED98\\
	JP (HL)\>E9\\
	JP (IX)\>DDE9\\
	JP (IY)\>FDE9\\
	JP nn\>C3 n n\\
	JP C,nn\>DA n n\\
	JP M,nn\>FA n n\\
	JP NC,nn\>D2 n n\\
	JP NZ,nn\>C2 n n\\
	JP P,nn\>F2 n n\\
	JP PE,nn\>EA n n\\
	JP PO,nn\>E2 n n\\
	JP Z,nn\>CA n n\\
	JR e\>18 e\\
	JR C,e\>38 e\\
	JR NC,e\>30 e\\
	JR NZ,e\>20 e\\
	JR Z,e\>28 e\\
	LD (BC),A\>02\\
	LD (DE),A\>12\\
	LD (HL),A\>77\\
	LD (HL),B\>70\\
	LD (HL),C\>71\\
	LD (HL),D\>72\\
	LD (HL),E\>73\\
	LD (HL),H\>74\\
	LD (HL),L\>75\\
	LD (HL),n\>36 n\\
	LD (IX+d),A\>DD77 d\\
	LD (IX+d),B\>DD70 d\\
	LD (IX+d),C\>DD71 d\\
	LD (IX+d),D\>DD72 d\\
	LD (IX+d),E\>DD73 d\\
	LD (IX+d),H\>DD74 d\\
	LD (IX+d),L\>DD75 d\\
	LD (IX+d),n\>DD36 d n\\
	LD (IY+d),A\>FD77 d\\
	LD (IY+d),B\>FD70 d\\
	LD (IY+d),C\>FD71 d\\
	LD (IY+d),D\>FD72 d\\
	LD (IY+d),E\>FD73 d\\
	LD (IY+d),H\>FD74 d\\
	LD (IY+d),L\>FD75 d\\
	LD (IY+d),n\>FD36 d n\\
	LD (nn),A\>32 n n\\
	LD (nn),BC\>ED43 n n\\
	LD (nn),DE\>ED53 n n\\
	LD (nn),HL\>22 n n\\
	LD (nn),HL\>ED63 n n\\
	LD (nn),IX\>DD22 n n\\
	LD (nn),IY\>FD22 n n\\
	LD (nn),SP\>ED73 n n\\
	LD A,(BC)\>0A\\
	LD A,(DE)\>1A\\
	LD A,(HL)\>7E\\
	LD A,(IX+d)\>DD7E d\\
	LD A,(IY+d)\>FD7E d\\
	LD A,(nn)\>3A n n\\
	LD A,A\>7F\\
	LD A,B\>78\\
	LD A,C\>79\\
	LD A,D\>7A\\
	LD A,E\>7B\\
	LD A,H\>7C\\
	LD A,IXh\UNDOC\>DD7C\\
	LD A,IXl\UNDOC\>DD7D\\
	LD A,IYh\UNDOC\>FD7C\\
	LD A,IYl\UNDOC\>FD7D\\
	LD A,I\>ED57\\
	LD A,L\>7D\\
	LD A,R\>ED5F\\
	LD A,n\>3E n\\
	LD B,(HL)\>46\\
	LD B,(IX+d)\>DD46 d\\
	LD B,(IY+d)\>FD46 d\\
	LD B,A\>47\\
	LD B,B\>40\\
	LD B,C\>41\\
	LD B,D\>42\\
	LD B,E\>43\\
	LD B,H\>44\\
	LD B,IXh\UNDOC\>DD44\\
	LD B,IXl\UNDOC\>DD45\\
	LD B,IYh\UNDOC\>FD44\\
	LD B,IYl\UNDOC\>FD45\\
	LD B,L\>45\\
	LD B,n\>06 n\\
	LD BC,(nn)\>ED4B n n\\
	LD BC,nn\>01 n n\\
	LD C,(HL)\>4E\\
	LD C,(IX+d)\>DD4E d\\
	LD C,(IY+d)\>FD4E d\\
	LD C,A\>4F\\
	LD C,B\>48\\
	LD C,C\>49\\
	LD C,D\>4A\\
	LD C,E\>4B\\
	LD C,H\>4C\\
	LD C,IXh\UNDOC\>DD4C\\
	LD C,IXl\UNDOC\>DD4D\\
	LD C,IYh\UNDOC\>FD4C\\
	LD C,IYl\UNDOC\>FD4D\\
	LD C,L\>4D\\
	LD C,n\>0E n\\
	LD D,(HL)\>56\\
	LD D,(IX+d)\>DD56 d\\
	LD D,(IY+d)\>FD56 d\\
	LD D,A\>57\\
	LD D,B\>50\\
	LD D,C\>51\\
	LD D,D\>52\\
	LD D,E\>53\\
	LD D,H\>54\\
	LD D,IXh\UNDOC\>DD54\\
	LD D,IXl\UNDOC\>DD55\\
	LD D,IYh\UNDOC\>FD54\\
	LD D,IYl\UNDOC\>FD55\\
	LD D,L\>55\\
	LD D,n\>16 n\\
	LD DE,(nn)\>ED5B n n\\
	LD DE,nn\>11 n n\\
	LD E,(HL)\>5E\\
	LD E,(IX+d)\>DD5E d\\
	LD E,(IY+d)\>FD5E d\\
	LD E,A\>5F\\
	LD E,B\>58\\
	LD E,C\>59\\
	LD E,D\>5A\\
	LD E,E\>5B\\
	LD E,H\>5C\\
	LD E,IXh\UNDOC\>DD5C\\
	LD E,IXl\UNDOC\>DD5D\\
	LD E,IYh\UNDOC\>FD5C\\
	LD E,IYl\UNDOC\>FD5D\\
	LD E,L\>5D\\
	LD E,n\>1E n\\
	LD H,(HL)\>66\\
	LD H,(IX+d)\>DD66 d\\
	LD H,(IY+d)\>FD66 d\\
	LD H,A\>67\\
	LD H,B\>60\\
	LD H,C\>61\\
	LD H,D\>62\\
	LD H,E\>63\\
	LD H,H\>64\\
	LD H,L\>65\\
	LD H,n\>26 n\\
	LD HL,(nn)\>2A n n\\
	LD HL,(nn)\>ED6B n n\\
	LD HL,nn\>21 n n\\
	LD I,A\>ED47\\
	LD IX,(nn)\>DD2A n n\\
	LD IX,nn\>DD21 n n\\
	LD IXh,A\UNDOC\>DD67\\
	LD IXh,B\UNDOC\>DD60\\
	LD IXh,C\UNDOC\>DD61\\
	LD IXh,D\UNDOC\>DD62\\
	LD IXh,E\UNDOC\>DD63\\
	LD IXh,IXh\UNDOC\>DD64\\
	LD IXh,IXl\UNDOC\>DD65\\
	LD IXh,n\UNDOC\>DD26 n \\
	LD IXl,A\UNDOC\>DD6F\\
	LD IXl,B\UNDOC\>DD68\\
	LD IXl,C\UNDOC\>DD69\\
	LD IXl,D\UNDOC\>DD6A\\
	LD IXl,E\UNDOC\>DD6B\\
	LD IXl,IXh\UNDOC\>DD6C\\
	LD IXl,IXl\UNDOC\>DD6D\\
	LD IXl,n\UNDOC\>DD2E n\\
	LD IY,(nn)\>FD2A n n\\
	LD IY,nn\>FD21 n n\\
	LD IYh,A\UNDOC\>FD67\\
	LD IYh,B\UNDOC\>FD60\\
	LD IYh,C\UNDOC\>FD61\\
	LD IYh,D\UNDOC\>FD62\\
	LD IYh,E\UNDOC\>FD63\\
	LD IYh,IYh\UNDOC\>FD64\\
	LD IYh,IYl\UNDOC\>FD65\\
	LD IYh,n\UNDOC\>FD26 n\\
	LD IYl,A\UNDOC\>FD6F\\
	LD IYl,B\UNDOC\>FD68\\
	LD IYl,C\UNDOC\>FD69\\
	LD IYl,D\UNDOC\>FD6A\\
	LD IYl,E\UNDOC\>FD6B\\
	LD IYl,IYh\UNDOC\>FD6C\\
	LD IYl,IYl\UNDOC\>FD6D\\
	LD IYl,n\UNDOC\>FD2E n\\
	LD L,(HL)\>6E\\
	LD L,(IX+d)\>DD6E d\\
	LD L,(IY+d)\>FD6E d\\
	LD L,A\>6F\\
	LD L,B\>68\\
	LD L,C\>69\\
	LD L,D\>6A\\
	LD L,E\>6B\\
	LD L,H\>6C\\
	LD L,L\>6D\\
	LD L,n\>2E n\\
	LD R,A\>ED4F\\
	LD SP,(nn)\>ED7B n n\\
	LD SP,HL\>F9\\
	LD SP,IX\>DDF9\\
	LD SP,IY\>FDF9\\
	LD SP,nn\>31 n n\\
	LDD\>EDA8\\
	LDDR\>EDB8\\
	LDDX\ZXN\>EDAC\\
	LDDRX\ZXN\>EDBC\\
	LDI\>EDA0\\
	LDIR\>EDB0\\
	LDIX\ZXN\>EDA4\\
	LDIRX\ZXN\>EDB4\\
	LDPIRX\ZXN\>EDB7\\
	LDWS\ZXN\>EDA5\\
	MIRROR A\ZXN\>ED24\\
	MUL D,E\ZXN\>ED30\\
	NEG\UNDOC\>ED4C\\
	NEG\UNDOC\>ED54\\
	NEG\UNDOC\>ED5C\\
	NEG\UNDOC\>ED64\\
	NEG\UNDOC\>ED6C\\
	NEG\UNDOC\>ED74\\
	NEG\UNDOC\>ED7C\\
	NEG\>ED44\\
	NEXTREG r,n\ZXN\>ED91 r n\\
	NEXTREG r,A\ZXN\>ED92 r\\
	NOP\>00\\
	OR (HL)\>B6\\
	OR (IX+d)\>DDB6 d\\
	OR (IY+d)\>FDB6 d\\
	OR A\>B7\\
	OR B\>B0\\
	OR C\>B1\\
	OR D\>B2\\
	OR E\>B3\\
	OR H\>B4\\
	OR IXh\UNDOC\>DDB4\\
	OR IXl\UNDOC\>DDB5\\
	OR IYh\UNDOC\>FDB4\\
	OR IYl\UNDOC\>FDB5\\
	OR L\>B5\\
	OR n\>F6 n\\
	OTDR\>EDBB\\
	OTIR\>EDB3\\
	OUT (C),0\UNDOC\>ED71\\
	OUT (C),A\>ED79\\
	OUT (C),B\>ED41\\
	OUT (C),C\>ED49\\
	OUT (C),D\>ED51\\
	OUT (C),E\>ED59\\
	OUT (C),H\>ED61\\
	OUT (C),L\>ED69\\
	OUT (n),A\>D3 n\\
	OUTD\>EDAB\\
	OUTI\>EDA3\\
	OUTINB\ZXN\>ED90\\
	PIXELAD\ZXN\>ED94\\
	PIXELDN\ZXN\>ED93\\
	POP AF\>F1\\
	POP BC\>C1\\
	POP DE\>D1\\
	POP HL\>E1\\
	POP IX\>DDE1\\
	POP IY\>FDE1\\
	PUSH AF\>F5\\
	PUSH BC\>C5\\
	PUSH DE\>D5\\
	PUSH HL\>E5\\
	PUSH IX\>DDE5\\
	PUSH IY\>FDE5\\
	PUSH nm\ZXN\>ED8A n m\\
	RES 0,(HL)\>CB86\\
	RES 0,(IX+d),A\UNDOC\>DDCB d 87\\
	RES 0,(IX+d),B\UNDOC\>DDCB d 80\\
	RES 0,(IX+d),C\UNDOC\>DDCB d 81\\
	RES 0,(IX+d),D\UNDOC\>DDCB d 82\\
	RES 0,(IX+d),E\UNDOC\>DDCB d 83\\
	RES 0,(IX+d),H\UNDOC\>DDCB d 84\\
	RES 0,(IX+d),L\UNDOC\>DDCB d 85\\
	RES 0,(IX+d)\>DDCB d 86\\
	RES 0,(IY+d),A\UNDOC\>FDCB d 87\\
	RES 0,(IY+d),B\UNDOC\>FDCB d 80\\
	RES 0,(IY+d),C\UNDOC\>FDCB d 81\\
	RES 0,(IY+d),D\UNDOC\>FDCB d 82\\
	RES 0,(IY+d),E\UNDOC\>FDCB d 83\\
	RES 0,(IY+d),H\UNDOC\>FDCB d 84\\
	RES 0,(IY+d),L\UNDOC\>FDCB d 85\\
	RES 0,(IY+d)\>FDCB d 86\\
	RES 0,A\>CB87\\
	RES 0,B\>CB80\\
	RES 0,C\>CB81\\
	RES 0,D\>CB82\\
	RES 0,E\>CB83\\
	RES 0,H\>CB84\\
	RES 0,L\>CB85\\
	RES 1,(HL)\>CB8E\\
	RES 1,(IX+d),A\UNDOC\>DDCB d 8F\\
	RES 1,(IX+d),B\UNDOC\>DDCB d 88\\
	RES 1,(IX+d),C\UNDOC\>DDCB d 89\\
	RES 1,(IX+d),D\UNDOC\>DDCB d 8A\\
	RES 1,(IX+d),E\UNDOC\>DDCB d 8B\\
	RES 1,(IX+d),H\UNDOC\>DDCB d 8C\\
	RES 1,(IX+d),L\UNDOC\>DDCB d 8D\\
	RES 1,(IX+d)\>DDCB d 8E\\
	RES 1,(IY+d),A\UNDOC\>FDCB d 8F\\
	RES 1,(IY+d),B\UNDOC\>FDCB d 88\\
	RES 1,(IY+d),C\UNDOC\>FDCB d 89\\
	RES 1,(IY+d),D\UNDOC\>FDCB d 8A\\
	RES 1,(IY+d),E\UNDOC\>FDCB d 8B\\
	RES 1,(IY+d),H\UNDOC\>FDCB d 8C\\
	RES 1,(IY+d),L\UNDOC\>FDCB d 8D\\
	RES 1,(IY+d)\>FDCB d 8E\\
	RES 1,A\>CB8F\\
	RES 1,B\>CB88\\
	RES 1,C\>CB89\\
	RES 1,D\>CB8A\\
	RES 1,E\>CB8B\\
	RES 1,H\>CB8C\\
	RES 1,L\>CB8D\\
	RES 2,(HL)\>CB96\\
	RES 2,(IX+d),A\UNDOC\>DDCB d 97\\
	RES 2,(IX+d),B\UNDOC\>DDCB d 90\\
	RES 2,(IX+d),C\UNDOC\>DDCB d 91\\
	RES 2,(IX+d),D\UNDOC\>DDCB d 92\\
	RES 2,(IX+d),E\UNDOC\>DDCB d 93\\
	RES 2,(IX+d),H\UNDOC\>DDCB d 94\\
	RES 2,(IX+d),L\UNDOC\>DDCB d 95\\
	RES 2,(IX+d)\>DDCB d 96\\
	RES 2,(IY+d),A\UNDOC\>FDCB d 97\\
	RES 2,(IY+d),B\UNDOC\>FDCB d 90\\
	RES 2,(IY+d),C\UNDOC\>FDCB d 91\\
	RES 2,(IY+d),D\UNDOC\>FDCB d 92\\
	RES 2,(IY+d),E\UNDOC\>FDCB d 93\\
	RES 2,(IY+d),H\UNDOC\>FDCB d 94\\
	RES 2,(IY+d),L\UNDOC\>FDCB d 95\\
	RES 2,(IY+d)\>FDCB d 96\\
	RES 2,A\>CB97\\
	RES 2,B\>CB90\\
	RES 2,C\>CB91\\
	RES 2,D\>CB92\\
	RES 2,E\>CB93\\
	RES 2,H\>CB94\\
	RES 2,L\>CB95\\
	RES 3,(HL)\>CB9E\\
	RES 3,(IX+d),A\UNDOC\>DDCB d 9F\\
	RES 3,(IX+d),B\UNDOC\>DDCB d 98\\
	RES 3,(IX+d),C\UNDOC\>DDCB d 99\\
	RES 3,(IX+d),D\UNDOC\>DDCB d 9A\\
	RES 3,(IX+d),E\UNDOC\>DDCB d 9B\\
	RES 3,(IX+d),H\UNDOC\>DDCB d 9C\\
	RES 3,(IX+d),L\UNDOC\>DDCB d 9D\\
	RES 3,(IX+d)\>DDCB d 9E\\
	RES 3,(IY+d),A\UNDOC\>FDCB d 9F\\
	RES 3,(IY+d),B\UNDOC\>FDCB d 98\\
	RES 3,(IY+d),C\UNDOC\>FDCB d 99\\
	RES 3,(IY+d),D\UNDOC\>FDCB d 9A\\
	RES 3,(IY+d),E\UNDOC\>FDCB d 9B\\
	RES 3,(IY+d),H\UNDOC\>FDCB d 9C\\
	RES 3,(IY+d),L\UNDOC\>FDCB d 9D\\
	RES 3,(IY+d)\>FDCB d 9E\\
	RES 3,A\>CB9F\\
	RES 3,B\>CB98\\
	RES 3,C\>CB99\\
	RES 3,D\>CB9A\\
	RES 3,E\>CB9B\\
	RES 3,H\>CB9C\\
	RES 3,L\>CB9D\\
	RES 4,(HL)\>CBA6\\
	RES 4,(IX+d),A\UNDOC\>DDCB d A7\\
	RES 4,(IX+d),B\UNDOC\>DDCB d A0\\
	RES 4,(IX+d),C\UNDOC\>DDCB d A1\\
	RES 4,(IX+d),D\UNDOC\>DDCB d A2\\
	RES 4,(IX+d),E\UNDOC\>DDCB d A3\\
	RES 4,(IX+d),H\UNDOC\>DDCB d A4\\
	RES 4,(IX+d),L\UNDOC\>DDCB d A5\\
	RES 4,(IX+d)\>DDCB d A6\\
	RES 4,(IY+d),A\UNDOC\>FDCB d A7\\
	RES 4,(IY+d),B\UNDOC\>FDCB d A0\\
	RES 4,(IY+d),C\UNDOC\>FDCB d A1\\
	RES 4,(IY+d),D\UNDOC\>FDCB d A2\\
	RES 4,(IY+d),E\UNDOC\>FDCB d A3\\
	RES 4,(IY+d),H\UNDOC\>FDCB d A4\\
	RES 4,(IY+d),L\UNDOC\>FDCB d A5\\
	RES 4,(IY+d)\>FDCB d A6\\
	RES 4,A\>CBA7\\
	RES 4,B\>CBA0\\
	RES 4,C\>CBA1\\
	RES 4,D\>CBA2\\
	RES 4,E\>CBA3\\
	RES 4,H\>CBA4\\
	RES 4,L\>CBA5\\
	RES 5,(HL)\>CBAE\\
	RES 5,(IX+d),A\UNDOC\>DDCB d AF\\
	RES 5,(IX+d),B\UNDOC\>DDCB d A8\\
	RES 5,(IX+d),C\UNDOC\>DDCB d A9\\
	RES 5,(IX+d),D\UNDOC\>DDCB d AA\\
	RES 5,(IX+d),E\UNDOC\>DDCB d AB\\
	RES 5,(IX+d),H\UNDOC\>DDCB d AC\\
	RES 5,(IX+d),L\UNDOC\>DDCB d AD\\
	RES 5,(IX+d)\>DDCB d AE\\
	RES 5,(IY+d),A\UNDOC\>FDCB d AF\\
	RES 5,(IY+d),B\UNDOC\>FDCB d A8\\
	RES 5,(IY+d),C\UNDOC\>FDCB d A9\\
	RES 5,(IY+d),D\UNDOC\>FDCB d AA\\
	RES 5,(IY+d),E\UNDOC\>FDCB d AB\\
	RES 5,(IY+d),H\UNDOC\>FDCB d AC\\
	RES 5,(IY+d),L\UNDOC\>FDCB d AD\\
	RES 5,(IY+d)\>FDCB d AE\\
	RES 5,A\>CBAF\\
	RES 5,B\>CBA8\\
	RES 5,C\>CBA9\\
	RES 5,D\>CBAA\\
	RES 5,E\>CBAB\\
	RES 5,H\>CBAC\\
	RES 5,L\>CBAD\\
	RES 6,(HL)\>CBB6\\
	RES 6,(IX+d),A\UNDOC\>DDCB d B7\\
	RES 6,(IX+d),B\UNDOC\>DDCB d B0\\
	RES 6,(IX+d),C\UNDOC\>DDCB d B1\\
	RES 6,(IX+d),D\UNDOC\>DDCB d B2\\
	RES 6,(IX+d),E\UNDOC\>DDCB d B3\\
	RES 6,(IX+d),H\UNDOC\>DDCB d B4\\
	RES 6,(IX+d),L\UNDOC\>DDCB d B5\\
	RES 6,(IX+d)\>DDCB d B6\\
	RES 6,(IY+d),A\UNDOC\>FDCB d B7\\
	RES 6,(IY+d),B\UNDOC\>FDCB d B0\\
	RES 6,(IY+d),C\UNDOC\>FDCB d B1\\
	RES 6,(IY+d),D\UNDOC\>FDCB d B2\\
	RES 6,(IY+d),E\UNDOC\>FDCB d B3\\
	RES 6,(IY+d),H\UNDOC\>FDCB d B4\\
	RES 6,(IY+d),L\UNDOC\>FDCB d B5\\
	RES 6,(IY+d)\>FDCB d B6\\
	RES 6,A\>CBB7\\
	RES 6,B\>CBB0\\
	RES 6,C\>CBB1\\
	RES 6,D\>CBB2\\
	RES 6,E\>CBB3\\
	RES 6,H\>CBB4\\
	RES 6,L\>CBB5\\
	RES 7,(HL)\>CBBE\\
	RES 7,(IX+d),A\UNDOC\>DDCB d BF\\
	RES 7,(IX+d),B\UNDOC\>DDCB d B8\\
	RES 7,(IX+d),C\UNDOC\>DDCB d B9\\
	RES 7,(IX+d),D\UNDOC\>DDCB d BA\\
	RES 7,(IX+d),E\UNDOC\>DDCB d BB\\
	RES 7,(IX+d),H\UNDOC\>DDCB d BC\\
	RES 7,(IX+d),L\UNDOC\>DDCB d BD\\
	RES 7,(IX+d)\>DDCB d BE\\
	RES 7,(IY+d),A\UNDOC\>FDCB d BF\\
	RES 7,(IY+d),B\UNDOC\>FDCB d B8\\
	RES 7,(IY+d),C\UNDOC\>FDCB d B9\\
	RES 7,(IY+d),D\UNDOC\>FDCB d BA\\
	RES 7,(IY+d),E\UNDOC\>FDCB d BB\\
	RES 7,(IY+d),H\UNDOC\>FDCB d BC\\
	RES 7,(IY+d),L\UNDOC\>FDCB d BD\\
	RES 7,(IY+d)\>FDCB d BE\\
	RES 7,A\>CBBF\\
	RES 7,B\>CBB8\\
	RES 7,C\>CBB9\\
	RES 7,D\>CBBA\\
	RES 7,E\>CBBB\\
	RES 7,H\>CBBC\\
	RES 7,L\>CBBD\\
	RET C\>D8\\
	RET M\>F8\\
	RET NC\>D0\\
	RET NZ\>C0\\
	RET PE\>E8\\
	RET PO\>E0\\
	RET P\>F0\\
	RET Z\>C8\\
	RETI\>ED4D\\
	RETN\UNDOC\>ED55\\
	RETN\UNDOC\>ED5D\\
	RETN\UNDOC\>ED65\\
	RETN\UNDOC\>ED6D\\
	RETN\UNDOC\>ED75\\
	RETN\UNDOC\>ED7D\\
	RETN\>ED45\\
	RET\>C9\\
	RL (HL)\>CB16\\
	RL (IX+d),A\UNDOC\>DDCB d 17\\
	RL (IX+d),B\UNDOC\>DDCB d 10\\
	RL (IX+d),C\UNDOC\>DDCB d 11\\
	RL (IX+d),D\UNDOC\>DDCB d 12\\
	RL (IX+d),E\UNDOC\>DDCB d 13\\
	RL (IX+d),H\UNDOC\>DDCB d 14\\
	RL (IX+d),L\UNDOC\>DDCB d 15\\
	RL (IX+d)\>DDCB d 16\\
	RL (IY+d),A\UNDOC\>FDCB d 17\\
	RL (IY+d),B\UNDOC\>FDCB d 10\\
	RL (IY+d),C\UNDOC\>FDCB d 11\\
	RL (IY+d),D\UNDOC\>FDCB d 12\\
	RL (IY+d),E\UNDOC\>FDCB d 13\\
	RL (IY+d),H\UNDOC\>FDCB d 14\\
	RL (IY+d),L\UNDOC\>FDCB d 15\\
	RL (IY+d)\>FDCB d 16\\
	RL A\>CB17\\
	RL B\>CB10\\
	RL C\>CB11\\
	RL D\>CB12\\
	RL E\>CB13\\
	RL H\>CB14\\
	RL L\>CB15\\
	RLA\>17\\
	RLC (HL)\>CB06\\
	RLC (IX+d),A\UNDOC\>DDCB d 07\\
	RLC (IX+d),B\UNDOC\>DDCB d 00\\
	RLC (IX+d),C\UNDOC\>DDCB d 01\\
	RLC (IX+d),D\UNDOC\>DDCB d 02\\
	RLC (IX+d),E\UNDOC\>DDCB d 03\\
	RLC (IX+d),H\UNDOC\>DDCB d 04\\
	RLC (IX+d),L\UNDOC\>DDCB d 05\\
	RLC (IX+d)\>DDCB d 06\\
	RLC (IY+d),A\UNDOC\>FDCB d 07\\
	RLC (IY+d),B\UNDOC\>FDCB d 00\\
	RLC (IY+d),C\UNDOC\>FDCB d 01\\
	RLC (IY+d),D\UNDOC\>FDCB d 02\\
	RLC (IY+d),E\UNDOC\>FDCB d 03\\
	RLC (IY+d),H\UNDOC\>FDCB d 04\\
	RLC (IY+d),L\UNDOC\>FDCB d 05\\
	RLC (IY+d)\>FDCB d 06\\
	RLC A\>CB07\\
	RLC B\>CB00\\
	RLC C\>CB01\\
	RLC D\>CB02\\
	RLC E\>CB03\\
	RLC H\>CB04\\
	RLC L\>CB05\\
	RLCA\>07\\
	RLD\>ED6F\\
	RR (HL)\>CB1E\\
	RR (IX+d),A\UNDOC\>DDCB d 1F\\
	RR (IX+d),B\UNDOC\>DDCB d 18\\
	RR (IX+d),C\UNDOC\>DDCB d 19\\
	RR (IX+d),D\UNDOC\>DDCB d 1A\\
	RR (IX+d),E\UNDOC\>DDCB d 1B\\
	RR (IX+d),H\UNDOC\>DDCB d 1C\\
	RR (IX+d),L\UNDOC\>DDCB d 1D\\
	RR (IX+d)\>DDCB d 1E\\
	RR (IY+d),A\UNDOC\>FDCB d 1F\\
	RR (IY+d),B\UNDOC\>FDCB d 18\\
	RR (IY+d),C\UNDOC\>FDCB d 19\\
	RR (IY+d),D\UNDOC\>FDCB d 1A\\
	RR (IY+d),E\UNDOC\>FDCB d 1B\\
	RR (IY+d),H\UNDOC\>FDCB d 1C\\
	RR (IY+d),L\UNDOC\>FDCB d 1D\\
	RR (IY+d)\>FDCB d 1E\\
	RR A\>CB1F\\
	RR B\>CB18\\
	RR C\>CB19\\
	RR D\>CB1A\\
	RR E\>CB1B\\
	RR H\>CB1C\\
	RR L\>CB1D\\
	RRA\>1F\\
	RRC (HL)\>CB0E\\
	RRC (IX+d),A\UNDOC\>DDCB d 0F\\
	RRC (IX+d),B\UNDOC\>DDCB d 08\\
	RRC (IX+d),C\UNDOC\>DDCB d 09\\
	RRC (IX+d),D\UNDOC\>DDCB d 0A\\
	RRC (IX+d),E\UNDOC\>DDCB d 0B\\
	RRC (IX+d),H\UNDOC\>DDCB d 0C\\
	RRC (IX+d),L\UNDOC\>DDCB d 0D\\
	RRC (IX+d)\>DDCB d 0E\\
	RRC (IY+d),A\UNDOC\>FDCB d 0F\\
	RRC (IY+d),B\UNDOC\>FDCB d 08\\
	RRC (IY+d),C\UNDOC\>FDCB d 09\\
	RRC (IY+d),D\UNDOC\>FDCB d 0A\\
	RRC (IY+d),E\UNDOC\>FDCB d 0B\\
	RRC (IY+d),H\UNDOC\>FDCB d 0C\\
	RRC (IY+d),L\UNDOC\>FDCB d 0D\\
	RRC (IY+d)\>FDCB d 0E\\
	RRC A\>CB0F\\
	RRC B\>CB08\\
	RRC C\>CB09\\
	RRC D\>CB0A\\
	RRC E\>CB0B\\
	RRC H\>CB0C\\
	RRC L\>CB0D\\
	RRCA\>0F\\
	RRD\>ED67\\
	RST 0H\>C7\\
	RST 10H\>D7\\
	RST 18H\>DF\\
	RST 20H\>E7\\
	RST 28H\>EF\\
	RST 30H\>F7\\
	RST 38H\>FF\\
	RST 8H\>CF\\
	SBC A,(HL)\>9E\\
	SBC A,(IX+d)\>DD9E d\\
	SBC A,(IY+d)\>FD9E d\\
	SBC A,A\>9F\\
	SBC A,B\>98\\
	SBC A,C\>99\\
	SBC A,D\>9A\\
	SBC A,E\>9B\\
	SBC A,H\>9C\\
	SBC A,IXh\UNDOC\>DD9C\\
	SBC A,IXl\UNDOC\>DD9D\\
	SBC A,IYh\UNDOC\>FD9C\\
	SBC A,IYl\UNDOC\>FD9D\\
	SBC A,L\>9D\\
	SBC A,n\>DE n\\
	SBC HL,BC\>ED42\\
	SBC HL,DE\>ED52\\
	SBC HL,HL\>ED62\\
	SBC HL,SP\>ED72\\
	SCF\>37\\
	SET 0,(HL)\>CBC6\\
	SET 0,(IX+d),A\UNDOC\>DDCB d C7\\
	SET 0,(IX+d),B\UNDOC\>DDCB d C0\\
	SET 0,(IX+d),C\UNDOC\>DDCB d C1\\
	SET 0,(IX+d),D\UNDOC\>DDCB d C2\\
	SET 0,(IX+d),E\UNDOC\>DDCB d C3\\
	SET 0,(IX+d),H\UNDOC\>DDCB d C4\\
	SET 0,(IX+d),L\UNDOC\>DDCB d C5\\
	SET 0,(IX+d)\>DDCB d C6\\
	SET 0,(IY+d),A\UNDOC\>FDCB d C7\\
	SET 0,(IY+d),B\UNDOC\>FDCB d C0\\
	SET 0,(IY+d),C\UNDOC\>FDCB d C1\\
	SET 0,(IY+d),D\UNDOC\>FDCB d C2\\
	SET 0,(IY+d),E\UNDOC\>FDCB d C3\\
	SET 0,(IY+d),H\UNDOC\>FDCB d C4\\
	SET 0,(IY+d),L\UNDOC\>FDCB d C5\\
	SET 0,(IY+d)\>FDCB d C6\\
	SET 0,A\>CBC7\\
	SET 0,B\>CBC0\\
	SET 0,C\>CBC1\\
	SET 0,D\>CBC2\\
	SET 0,E\>CBC3\\
	SET 0,H\>CBC4\\
	SET 0,L\>CBC5\\
	SET 1,(HL)\>CBCE\\
	SET 1,(IX+d),A\UNDOC\>DDCB d CF\\
	SET 1,(IX+d),B\UNDOC\>DDCB d C8\\
	SET 1,(IX+d),C\UNDOC\>DDCB d C9\\
	SET 1,(IX+d),D\UNDOC\>DDCB d CA\\
	SET 1,(IX+d),E\UNDOC\>DDCB d CB\\
	SET 1,(IX+d),H\UNDOC\>DDCB d CC\\
	SET 1,(IX+d),L\UNDOC\>DDCB d CD\\
	SET 1,(IX+d)\>DDCB d CE\\
	SET 1,(IY+d),A\UNDOC\>FDCB d CF\\
	SET 1,(IY+d),B\UNDOC\>FDCB d C8\\
	SET 1,(IY+d),C\UNDOC\>FDCB d C9\\
	SET 1,(IY+d),D\UNDOC\>FDCB d CA\\
	SET 1,(IY+d),E\UNDOC\>FDCB d CB\\
	SET 1,(IY+d),H\UNDOC\>FDCB d CC\\
	SET 1,(IY+d),L\UNDOC\>FDCB d CD\\
	SET 1,(IY+d)\>FDCB d CE\\
	SET 1,A\>CBCF\\
	SET 1,B\>CBC8\\
	SET 1,C\>CBC9\\
	SET 1,D\>CBCA\\
	SET 1,E\>CBCB\\
	SET 1,H\>CBCC\\
	SET 1,L\>CBCD\\
	SET 2,(HL)\>CBD6\\
	SET 2,(IX+d),A\UNDOC\>DDCB d D7\\
	SET 2,(IX+d),B\UNDOC\>DDCB d D0\\
	SET 2,(IX+d),C\UNDOC\>DDCB d D1\\
	SET 2,(IX+d),D\UNDOC\>DDCB d D2\\
	SET 2,(IX+d),E\UNDOC\>DDCB d D3\\
	SET 2,(IX+d),H\UNDOC\>DDCB d D4\\
	SET 2,(IX+d),L\UNDOC\>DDCB d D5\\
	SET 2,(IX+d)\>DDCB d D6\\
	SET 2,(IY+d),A\UNDOC\>FDCB d D7\\
	SET 2,(IY+d),B\UNDOC\>FDCB d D0\\
	SET 2,(IY+d),C\UNDOC\>FDCB d D1\\
	SET 2,(IY+d),D\UNDOC\>FDCB d D2\\
	SET 2,(IY+d),E\UNDOC\>FDCB d D3\\
	SET 2,(IY+d),H\UNDOC\>FDCB d D4\\
	SET 2,(IY+d),L\UNDOC\>FDCB d D5\\
	SET 2,(IY+d)\>FDCB d D6\\
	SET 2,A\>CBD7\\
	SET 2,B\>CBD0\\
	SET 2,C\>CBD1\\
	SET 2,D\>CBD2\\
	SET 2,E\>CBD3\\
	SET 2,H\>CBD4\\
	SET 2,L\>CBD5\\
	SET 3,(HL)\>CBDE\\
	SET 3,(IX+d),A\UNDOC\>DDCB d DF\\
	SET 3,(IX+d),B\UNDOC\>DDCB d D8\\
	SET 3,(IX+d),C\UNDOC\>DDCB d D9\\
	SET 3,(IX+d),D\UNDOC\>DDCB d DA\\
	SET 3,(IX+d),E\UNDOC\>DDCB d DB\\
	SET 3,(IX+d),H\UNDOC\>DDCB d DC\\
	SET 3,(IX+d),L\UNDOC\>DDCB d DD\\
	SET 3,(IX+d)\>DDCB d DE\\
	SET 3,(IY+d),A\UNDOC\>FDCB d DF\\
	SET 3,(IY+d),B\UNDOC\>FDCB d D8\\
	SET 3,(IY+d),C\UNDOC\>FDCB d D9\\
	SET 3,(IY+d),D\UNDOC\>FDCB d DA\\
	SET 3,(IY+d),E\UNDOC\>FDCB d DB\\
	SET 3,(IY+d),H\UNDOC\>FDCB d DC\\
	SET 3,(IY+d),L\UNDOC\>FDCB d DD\\
	SET 3,(IY+d)\>FDCB d DE\\
	SET 3,A\>CBDF\\
	SET 3,B\>CBD8\\
	SET 3,C\>CBD9\\
	SET 3,D\>CBDA\\
	SET 3,E\>CBDB\\
	SET 3,H\>CBDC\\
	SET 3,L\>CBDD\\
	SET 4,(HL)\>CBE6\\
	SET 4,(IX+d),A\UNDOC\>DDCB d E7\\
	SET 4,(IX+d),B\UNDOC\>DDCB d E0\\
	SET 4,(IX+d),C\UNDOC\>DDCB d E1\\
	SET 4,(IX+d),D\UNDOC\>DDCB d E2\\
	SET 4,(IX+d),E\UNDOC\>DDCB d E3\\
	SET 4,(IX+d),H\UNDOC\>DDCB d E4\\
	SET 4,(IX+d),L\UNDOC\>DDCB d E5\\
	SET 4,(IX+d)\>DDCB d E6\\
	SET 4,(IY+d),A\UNDOC\>FDCB d E7\\
	SET 4,(IY+d),B\UNDOC\>FDCB d E0\\
	SET 4,(IY+d),C\UNDOC\>FDCB d E1\\
	SET 4,(IY+d),D\UNDOC\>FDCB d E2\\
	SET 4,(IY+d),E\UNDOC\>FDCB d E3\\
	SET 4,(IY+d),H\UNDOC\>FDCB d E4\\
	SET 4,(IY+d),L\UNDOC\>FDCB d E5\\
	SET 4,(IY+d)\>FDCB d E6\\
	SET 4,A\>CBE7\\
	SET 4,B\>CBE0\\
	SET 4,C\>CBE1\\
	SET 4,D\>CBE2\\
	SET 4,E\>CBE3\\
	SET 4,H\>CBE4\\
	SET 4,L\>CBE5\\
	SET 5,(HL)\>CBEE\\
	SET 5,(IX+d),A\UNDOC\>DDCB d EF\\
	SET 5,(IX+d),B\UNDOC\>DDCB d E8\\
	SET 5,(IX+d),C\UNDOC\>DDCB d E9\\
	SET 5,(IX+d),D\UNDOC\>DDCB d EA\\
	SET 5,(IX+d),E\UNDOC\>DDCB d EB\\
	SET 5,(IX+d),H\UNDOC\>DDCB d EC\\
	SET 5,(IX+d),L\UNDOC\>DDCB d ED\\
	SET 5,(IX+d)\>DDCB d EE\\
	SET 5,(IY+d),A\UNDOC\>FDCB d EF\\
	SET 5,(IY+d),B\UNDOC\>FDCB d E8\\
	SET 5,(IY+d),C\UNDOC\>FDCB d E9\\
	SET 5,(IY+d),D\UNDOC\>FDCB d EA\\
	SET 5,(IY+d),E\UNDOC\>FDCB d EB\\
	SET 5,(IY+d),H\UNDOC\>FDCB d EC\\
	SET 5,(IY+d),L\UNDOC\>FDCB d ED\\
	SET 5,(IY+d)\>FDCB d EE\\
	SET 5,A\>CBEF\\
	SET 5,B\>CBE8\\
	SET 5,C\>CBE9\\
	SET 5,D\>CBEA\\
	SET 5,E\>CBEB\\
	SET 5,H\>CBEC\\
	SET 5,L\>CBED\\
	SET 6,(HL)\>CBF6\\
	SET 6,(IX+d),A\UNDOC\>DDCB d F7\\
	SET 6,(IX+d),B\UNDOC\>DDCB d F0\\
	SET 6,(IX+d),C\UNDOC\>DDCB d F1\\
	SET 6,(IX+d),D\UNDOC\>DDCB d F2\\
	SET 6,(IX+d),E\UNDOC\>DDCB d F3\\
	SET 6,(IX+d),H\UNDOC\>DDCB d F4\\
	SET 6,(IX+d),L\UNDOC\>DDCB d F5\\
	SET 6,(IX+d)\>DDCB d F6\\
	SET 6,(IY+d),A\UNDOC\>FDCB d F7\\
	SET 6,(IY+d),B\UNDOC\>FDCB d F0\\
	SET 6,(IY+d),C\UNDOC\>FDCB d F1\\
	SET 6,(IY+d),D\UNDOC\>FDCB d F2\\
	SET 6,(IY+d),E\UNDOC\>FDCB d F3\\
	SET 6,(IY+d),H\UNDOC\>FDCB d F4\\
	SET 6,(IY+d),L\UNDOC\>FDCB d F5\\
	SET 6,(IY+d)\>FDCB d F6\\
	SET 6,A\>CBF7\\
	SET 6,B\>CBF0\\
	SET 6,C\>CBF1\\
	SET 6,D\>CBF2\\
	SET 6,E\>CBF3\\
	SET 6,H\>CBF4\\
	SET 6,L\>CBF5\\
	SET 7,(HL)\>CBFE\\
	SET 7,(IX+d),A\UNDOC\>DDCB d FF\\
	SET 7,(IX+d),B\UNDOC\>DDCB d F8\\
	SET 7,(IX+d),C\UNDOC\>DDCB d F9\\
	SET 7,(IX+d),D\UNDOC\>DDCB d FA\\
	SET 7,(IX+d),E\UNDOC\>DDCB d FB\\
	SET 7,(IX+d),H\UNDOC\>DDCB d FC\\
	SET 7,(IX+d),L\UNDOC\>DDCB d FD\\
	SET 7,(IX+d)\>DDCB d FE\\
	SET 7,(IY+d),A\UNDOC\>FDCB d FF\\
	SET 7,(IY+d),B\UNDOC\>FDCB d F8\\
	SET 7,(IY+d),C\UNDOC\>FDCB d F9\\
	SET 7,(IY+d),D\UNDOC\>FDCB d FA\\
	SET 7,(IY+d),E\UNDOC\>FDCB d FB\\
	SET 7,(IY+d),H\UNDOC\>FDCB d FC\\
	SET 7,(IY+d),L\UNDOC\>FDCB d FD\\
	SET 7,(IY+d)\>FDCB d FE\\
	SET 7,A\>CBFF\\
	SET 7,B\>CBF8\\
	SET 7,C\>CBF9\\
	SET 7,D\>CBFA\\
	SET 7,E\>CBFB\\
	SET 7,H\>CBFC\\
	SET 7,L\>CBFD\\
	SETAE\ZXN\>ED95\\
	SLA (HL)\>CB26\\
	SLA (IX+d),A\UNDOC\>DDCB d 27\\
	SLA (IX+d),B\UNDOC\>DDCB d 20\\
	SLA (IX+d),C\UNDOC\>DDCB d 21\\
	SLA (IX+d),D\UNDOC\>DDCB d 22\\
	SLA (IX+d),E\UNDOC\>DDCB d 23\\
	SLA (IX+d),H\UNDOC\>DDCB d 24\\
	SLA (IX+d),L\UNDOC\>DDCB d 25\\
	SLA (IX+d)\>DDCB d 26\\
	SLA (IY+d),A\UNDOC\>FDCB d 27\\
	SLA (IY+d),B\UNDOC\>FDCB d 20\\
	SLA (IY+d),C\UNDOC\>FDCB d 21\\
	SLA (IY+d),D\UNDOC\>FDCB d 22\\
	SLA (IY+d),E\UNDOC\>FDCB d 23\\
	SLA (IY+d),H\UNDOC\>FDCB d 24\\
	SLA (IY+d),L\UNDOC\>FDCB d 25\\
	SLA (IY+d)\>FDCB d 26\\
	SLA A\>CB27\\
	SLA B\>CB20\\
	SLA C\>CB21\\
	SLA D\>CB22\\
	SLA E\>CB23\\
	SLA H\>CB24\\
	SLA L\>CB25\\
	SLL (HL)\UNDOC\>CB36\\
	SLL (IX+d)\UNDOC\>DDCB d 36\\
	SLL (IX+d),A\UNDOC\>DDCB d 37\\
	SLL (IX+d),B\UNDOC\>DDCB d 30\\
	SLL (IX+d),C\UNDOC\>DDCB d 31\\
	SLL (IX+d),D\UNDOC\>DDCB d 32\\
	SLL (IX+d),E\UNDOC\>DDCB d 33\\
	SLL (IX+d),H\UNDOC\>DDCB d 34\\
	SLL (IX+d),L\UNDOC\>DDCB d 35\\
	SLL (IY+d)\UNDOC\>FDCB d 36\\
	SLL (IY+d),A\UNDOC\>FDCB d 37\\
	SLL (IY+d),B\UNDOC\>FDCB d 30\\
	SLL (IY+d),C\UNDOC\>FDCB d 31\\
	SLL (IY+d),D\UNDOC\>FDCB d 32\\
	SLL (IY+d),E\UNDOC\>FDCB d 33\\
	SLL (IY+d),H\UNDOC\>FDCB d 34\\
	SLL (IY+d),L\UNDOC\>FDCB d 35\\
	SLL A\UNDOC\>CB37\\
	SLL B\UNDOC\>CB30\\
	SLL C\UNDOC\>CB31\\
	SLL D\UNDOC\>CB32\\
	SLL E\UNDOC\>CB33\\
	SLL H\UNDOC\>CB34\\
	SLL L\UNDOC\>CB35\\
	SRA (HL)\>CB2E\\
	SRA (IX+d),A\UNDOC\>DDCB d 2F\\
	SRA (IX+d),B\UNDOC\>DDCB d 28\\
	SRA (IX+d),C\UNDOC\>DDCB d 29\\
	SRA (IX+d),D\UNDOC\>DDCB d 2A\\
	SRA (IX+d),E\UNDOC\>DDCB d 2B\\
	SRA (IX+d),H\UNDOC\>DDCB d 2C\\
	SRA (IX+d),L\UNDOC\>DDCB d 2D\\
	SRA (IX+d)\>DDCB d 2E\\
	SRA (IY+d),A\UNDOC\>FDCB d 2F\\
	SRA (IY+d),B\UNDOC\>FDCB d 28\\
	SRA (IY+d),C\UNDOC\>FDCB d 29\\
	SRA (IY+d),D\UNDOC\>FDCB d 2A\\
	SRA (IY+d),E\UNDOC\>FDCB d 2B\\
	SRA (IY+d),H\UNDOC\>FDCB d 2C\\
	SRA (IY+d),L\UNDOC\>FDCB d 2D\\
	SRA (IY+d)\>FDCB d 2E\\
	SRA A\>CB2F\\
	SRA B\>CB28\\
	SRA C\>CB29\\
	SRA D\>CB2A\\
	SRA E\>CB2B\\
	SRA H\>CB2C\\
	SRA L\>CB2D\\
	SRL (HL)\>CB3E\\
	SRL (IX+d),A\UNDOC\>DDCB d 3F\\
	SRL (IX+d),B\UNDOC\>DDCB d 38\\
	SRL (IX+d),C\UNDOC\>DDCB d 39\\
	SRL (IX+d),D\UNDOC\>DDCB d 3A\\
	SRL (IX+d),E\UNDOC\>DDCB d 3B\\
	SRL (IX+d),H\UNDOC\>DDCB d 3C\\
	SRL (IX+d),L\UNDOC\>DDCB d 3D\\
	SRL (IX+d)\>DDCB d 3E\\
	SRL (IY+d),A\UNDOC\>FDCB d 3F\\
	SRL (IY+d),B\UNDOC\>FDCB d 38\\
	SRL (IY+d),C\UNDOC\>FDCB d 39\\
	SRL (IY+d),D\UNDOC\>FDCB d 3A\\
	SRL (IY+d),E\UNDOC\>FDCB d 3B\\
	SRL (IY+d),H\UNDOC\>FDCB d 3C\\
	SRL (IY+d),L\UNDOC\>FDCB d 3D\\
	SRL (IY+d)\>FDCB d 3E\\
	SRL A\>CB3F\\
	SRL B\>CB38\\
	SRL C\>CB39\\
	SRL D\>CB3A\\
	SRL E\>CB3B\\
	SRL H\>CB3C\\
	SRL L\>CB3D\\
	SUB (HL)\>96\\
	SUB (IX+d)\>DD96 d\\
	SUB (IY+d)\>FD96 d\\
	SUB A\>97\\
	SUB B\>90\\
	SUB C\>91\\
	SUB D\>92\\
	SUB E\>93\\
	SUB H\>94\\
	SUB IXh\UNDOC\>DD94\\
	SUB IXl\UNDOC\>DD95\\
	SUB IYh\UNDOC\>FD94\\
	SUB IYl\UNDOC\>FD95\\
	SUB L\>95\\
	SUB n\>D6 n\\
	SWAPNIB\ZXN\>ED23\\
	TEST n\ZXN\>ED27 n\\
	XOR (HL)\>AE\\
	XOR (IX+d)\>DDAE d\\
	XOR (IY+d)\>FDAE d\\
	XOR A\>AF\\
	XOR B\>A8\\
	XOR C\>A9\\
	XOR D\>AA\\
	XOR E\>AB\\
	XOR H\>AC\\
	XOR IXh\UNDOC\>DDAC\\
	XOR IXl\UNDOC\>DDAD\\
	XOR IYh\UNDOC\>FDAC\\
	XOR IYl\UNDOC\>FDAD\\
	XOR L\>AD\\
	XOR n\>EE n

	\end{tabbing}
}
\end{multicols}
\normalsize


\chapter{Instructions Sorted by Opcode}

Instructions marked with \UNDOC ~are undocumented.\\
Instructions marked with \ZXN ~are ZX Spectrum Next extended.

% TODO: and any instruction not listed has no effect? (same behaviour as an equal amount of NOP instructions)
\setlength\columnsep{4em}
\begin{multicols}{3}
{
	\tt 
	\small
	\begin{tabbing}
	00{\qquad}{\qquad}{\quad}\=NOP\\
	01 n n\>LD BC,nn\\
	02\>LD (BC),A\\
	03\>INC BC\\
	04\>INC B\\
	05\>DEC B\\
	06 n\>LD B,n\\
	07\>RLCA\\
	08\>EX AF,AF'\\
	09\>ADD HL,BC\\
	0A\>LD A,(BC)\\
	0B\>DEC BC\\
	0C\>INC C\\
	0D\>DEC C\\
	0E n\>LD C,n\\
	0F\>RRCA\\
	10 e\>DJNZ (PC+e)\\
	11 n n\>LD DE,nn\\
	12\>LD (DE),A\\
	13\>INC DE\\
	14\>INC D\\
	15\>DEC D\\
	16 n\>LD D,n\\
	17\>RLA\\
	18 e\>JR e\\
	19\>ADD HL,DE\\
	1A\>LD A,(DE)\\
	1B\>DEC DE\\
	1C\>INC E\\
	1D\>DEC E\\
	1E n\>LD E,n\\
	1F\>RRA\\
	20 e\>JR NZ,e\\
	21 n n\>LD HL,nn\\
	22 n n\>LD (nn),HL\\
	23\>INC HL\\
	24\>INC H\\
	25\>DEC H\\
	26 n\>LD H,n\\
	27\>DAA\\
	28 e\>JR Z,e\\
	29\>ADD HL,HL\\
	2A n n\>LD HL,(nn)\\
	2B\>DEC HL\\
	2C\>INC L\\
	2D\>DEC L\\
	2E n\>LD L,n\\
	2F\>CPL\\
	30 e\>JR NC,e\\
	31 n n\>LD SP,nn\\
	32 n n\>LD (nn),A\\
	33\>INC SP\\
	34\>INC (HL)\\
	35\>DEC (HL)\\
	36 n\>LD (HL),n\\
	37\>SCF\\
	38 e\>JR C,e\\
	39\>ADD HL,SP\\
	3A n n\>LD A,(nn)\\
	3B\>DEC SP\\
	3C\>INC A\\
	3D\>DEC A\\
	3E n\>LD A,n\\
	3F\>CCF\\
	40\>LD B,B\\
	41\>LD B,C\\
	42\>LD B,D\\
	43\>LD B,E\\
	44\>LD B,H\\
	45\>LD B,L\\
	46\>LD B,(HL)\\
	47\>LD B,A\\
	48\>LD C,B\\
	49\>LD C,C\\
	4A\>LD C,D\\
	4B\>LD C,E\\
	4C\>LD C,H\\
	4D\>LD C,L\\
	4E\>LD C,(HL)\\
	4F\>LD C,A\\
	50\>LD D,B\\
	51\>LD D,C\\
	52\>LD D,D\\
	53\>LD D,E\\
	54\>LD D,H\\
	55\>LD D,L\\
	56\>LD D,(HL)\\
	57\>LD D,A\\
	58\>LD E,B\\
	59\>LD E,C\\
	5A\>LD E,D\\
	5B\>LD E,E\\
	5C\>LD E,H\\
	5D\>LD E,L\\
	5E\>LD E,(HL)\\
	5F\>LD E,A\\
	60\>LD H,B\\
	61\>LD H,C\\
	62\>LD H,D\\
	63\>LD H,E\\
	64\>LD H,H\\
	65\>LD H,L\\
	66\>LD H,(HL)\\
	67\>LD H,A\\
	68\>LD L,B\\
	69\>LD L,C\\
	6A\>LD L,D\\
	6B\>LD L,E\\
	6C\>LD L,H\\
	6D\>LD L,L\\
	6E\>LD L,(HL)\\
	6F\>LD L,A\\
	70\>LD (HL),B\\
	71\>LD (HL),C\\
	72\>LD (HL),D\\
	73\>LD (HL),E\\
	74\>LD (HL),H\\
	75\>LD (HL),L\\
	76\>HALT\\
	77\>LD (HL),A\\
	78\>LD A,B\\
	79\>LD A,C\\
	7A\>LD A,D\\
	7B\>LD A,E\\
	7C\>LD A,H\\
	7D\>LD A,L\\
	7E\>LD A,(HL)\\
	7F\>LD A,A\\
	80\>ADD A,B\\
	81\>ADD A,C\\
	82\>ADD A,D\\
	83\>ADD A,E\\
	84\>ADD A,H\\
	85\>ADD A,L\\
	86\>ADD A,(HL)\\
	87\>ADD A,A\\
	88\>ADC A,B\\
	89\>ADC A,C\\
	8A\>ADC A,D\\
	8B\>ADC A,E\\
	8C\>ADC A,H\\
	8D\>ADC A,L\\
	8E\>ADC A,(HL)\\
	8F\>ADC A,A\\
	90\>SUB B\\
	91\>SUB C\\
	92\>SUB D\\
	93\>SUB E\\
	94\>SUB H\\
	95\>SUB L\\
	96\>SUB (HL)\\
	97\>SUB A\\
	98\>SBC A,B\\
	99\>SBC A,C\\
	9A\>SBC A,D\\
	9B\>SBC A,E\\
	9C\>SBC A,H\\
	9D\>SBC A,L\\
	9E\>SBC A,(HL)\\
	9F\>SBC A,A\\
	A0\>AND B\\
	A1\>AND C\\
	A2\>AND D\\
	A3\>AND E\\
	A4\>AND H\\
	A5\>AND L\\
	A6\>AND (HL)\\
	A7\>AND A\\
	A8\>XOR B\\
	A9\>XOR C\\
	AA\>XOR D\\
	AB\>XOR E\\
	AC\>XOR H\\
	AD\>XOR L\\
	AE\>XOR (HL)\\
	AF\>XOR A\\
	B0\>OR B\\
	B1\>OR C\\
	B2\>OR D\\
	B3\>OR E\\
	B4\>OR H\\
	B5\>OR L\\
	B6\>OR (HL)\\
	B7\>OR A\\
	B8\>CP B\\
	B9\>CP C\\
	BA\>CP D\\
	BB\>CP E\\
	BC\>CP H\\
	BD\>CP L\\
	BE\>CP (HL)\\
	BF\>CP A\\
	C0\>RET NZ\\
	C1\>POP BC\\
	C2 n n\>JP NZ,nn\\
	C3 n n\>JP nn\\
	C4 n n\>CALL NZ,nn\\
	C5\>PUSH BC\\
	C6 n\>ADD A,n\\
	C7\>RST 0H\\
	C8\>RET Z\\
	C9\>RET\\
	CA n n\>JP Z,nn\\
	CB00\>RLC B\\
	CB01\>RLC C\\
	CB02\>RLC D\\
	CB03\>RLC E\\
	CB04\>RLC H\\
	CB05\>RLC L\\
	CB06\>RLC (HL)\\
	CB07\>RLC A\\
	CB08\>RRC B\\
	CB09\>RRC C\\
	CB0A\>RRC D\\
	CB0B\>RRC E\\
	CB0C\>RRC H\\
	CB0D\>RRC L\\
	CB0E\>RRC (HL)\\
	CB0F\>RRC A\\
	CB10\>RL B\\
	CB11\>RL C\\
	CB12\>RL D\\
	CB13\>RL E\\
	CB14\>RL H\\
	CB15\>RL L\\
	CB16\>RL (HL)\\
	CB17\>RL A\\
	CB18\>RR B\\
	CB19\>RR C\\
	CB1A\>RR D\\
	CB1B\>RR E\\
	CB1C\>RR H\\
	CB1D\>RR L\\
	CB1E\>RR (HL)\\
	CB1F\>RR A\\
	CB20\>SLA B\\
	CB21\>SLA C\\
	CB22\>SLA D\\
	CB23\>SLA E\\
	CB24\>SLA H\\
	CB25\>SLA L\\
	CB26\>SLA (HL)\\
	CB27\>SLA A\\
	CB28\>SRA B\\
	CB29\>SRA C\\
	CB2A\>SRA D\\
	CB2B\>SRA E\\
	CB2C\>SRA H\\
	CB2D\>SRA L\\
	CB2E\>SRA (HL)\\
	CB2F\>SRA A\\
	CB30\>SLL B\UNDOC\\
	CB31\>SLL C\UNDOC\\
	CB32\>SLL D\UNDOC\\
	CB33\>SLL E\UNDOC\\
	CB34\>SLL H\UNDOC\\
	CB35\>SLL L\UNDOC\\
	CB36\>SLL (HL)\UNDOC\\
	CB37\>SLL A\UNDOC\\
	CB38\>SRL B\\
	CB39\>SRL C\\
	CB3A\>SRL D\\
	CB3B\>SRL E\\
	CB3C\>SRL H\\
	CB3D\>SRL L\\
	CB3E\>SRL (HL)\\
	CB3F\>SRL A\\
	CB40\>BIT 0,B\\
	CB41\>BIT 0,C\\
	CB42\>BIT 0,D\\
	CB43\>BIT 0,E\\
	CB44\> 	BIT 0,H\\
	CB45\> 	BIT 0,L\\
	CB46\> 	BIT 0,(HL)\\
	CB47\> 	BIT 0,A\\
	CB48\>BIT 1,B\\
	CB49\> 	BIT 1,C\\
	CB4A\> 	BIT 1,D\\
	CB4B\> 	BIT 1,E\\
	CB4C\> 	BIT 1,H\\
	CB4D\> 	BIT 1,L\\
	CB4E\> 	BIT 1,(HL)\\
	CB4F\> 	BIT 1,A\\
	CB50\>BIT 2,B\\
	CB51\> 	BIT 2,C\\
	CB52\> 	BIT 2,D\\
	CB53\> 	BIT 2,E\\
	CB54\> 	BIT 2,H\\
	CB55\> 	BIT 2,L\\
	CB56\> 	BIT 2,(HL)\\
	CB57\> 	BIT 2,A\\
	CB58\>BIT 3,B\\
	CB59\> 	BIT 3,C\\
	CB5A\> 	BIT 3,D\\
	CB5B\> 	BIT 3,E\\
	CB5C\> 	BIT 3,H\\
	CB5D\> 	BIT 3,L\\
	CB5E\> 	BIT 3,(HL)\\
	CB5F\> 	BIT 3,A\\
	CB60\>BIT 4,B\\
	CB61\> 	BIT 4,C\\
	CB62\> 	BIT 4,D\\
	CB63\> 	BIT 4,E\\
	CB64\> 	BIT 4,H\\
	CB65\> 	BIT 4,L\\
	CB66\> 	BIT 4,(HL)\\
	CB67\> 	BIT 4,A\\
	CB68\>BIT 5,B\\
	CB69\> 	BIT 5,C\\
	CB6A\> 	BIT 5,D\\
	CB6B\> 	BIT 5,E\\
	CB6C\> 	BIT 5,H\\
	CB6D\> 	BIT 5,L\\
	CB6E\> 	BIT 5,(HL)\\
	CB6F\> 	BIT 5,A\\
	CB70\>BIT 6,B\\
	CB71\> 	BIT 6,C\\
	CB72\> 	BIT 6,D\\
	CB73\> 	BIT 6,E\\
	CB74\> 	BIT 6,H\\
	CB75\> 	BIT 6,L\\
	CB76\> 	BIT 6,(HL)\\
	CB77\> 	BIT 6,A\\
	CB78\>BIT 7,B\\
	CB79\> 	BIT 7,C\\
	CB7A\> 	BIT 7,D\\
	CB7B\> 	BIT 7,E\\
	CB7C\> 	BIT 7,H\\
	CB7D\> 	BIT 7,L\\
	CB7E\> 	BIT 7,(HL)\\
	CB7F\> 	BIT 7,A\\
	CB80\>RES 0,B\\
	CB81\>RES 0,C\\
	CB82\>RES 0,D\\
	CB83\>RES 0,E\\
	CB84\> 	RES 0,H\\
	CB85\> 	RES 0,L\\
	CB86\> 	RES 0,(HL)\\
	CB87\> 	RES 0,A\\
	CB88\>RES 1,B\\
	CB89\> 	RES 1,C\\
	CB8A\> 	RES 1,D\\
	CB8B\> 	RES 1,E\\
	CB8C\> 	RES 1,H\\
	CB8D\> 	RES 1,L\\
	CB8E\> 	RES 1,(HL)\\
	CB8F\> 	RES 1,A\\
	CB90\>RES 2,B\\
	CB91\> 	RES 2,C\\
	CB92\> 	RES 2,D\\
	CB93\> 	RES 2,E\\
	CB94\> 	RES 2,H\\
	CB95\> 	RES 2,L\\
	CB96\> 	RES 2,(HL)\\
	CB97\> 	RES 2,A\\
	CB98\>RES 3,B\\
	CB99\> 	RES 3,C\\
	CB9A\> 	RES 3,D\\
	CB9B\> 	RES 3,E\\
	CB9C\> 	RES 3,H\\
	CB9D\> 	RES 3,L\\
	CB9E\> 	RES 3,(HL)\\
	CB9F\> 	RES 3,A\\
	CBA0\>RES 4,B\\
	CBA1\> 	RES 4,C\\
	CBA2\> 	RES 4,D\\
	CBA3\> 	RES 4,E\\
	CBA4\> 	RES 4,H\\
	CBA5\> 	RES 4,L\\
	CBA6\> 	RES 4,(HL)\\
	CBA7\> 	RES 4,A\\
	CBA8\>RES 5,B\\
	CBA9\> 	RES 5,C\\
	CBAA\> 	RES 5,D\\
	CBAB\> 	RES 5,E\\
	CBAC\> 	RES 5,H\\
	CBAD\> 	RES 5,L\\
	CBAE\> 	RES 5,(HL)\\
	CBAF\> 	RES 5,A\\
	CBB0\>RES 6,B\\
	CBB1\> 	RES 6,C\\
	CBB2\> 	RES 6,D\\
	CBB3\> 	RES 6,E\\
	CBB4\> 	RES 6,H\\
	CBB5\> 	RES 6,L\\
	CBB6\> 	RES 6,(HL)\\
	CBB7\> 	RES 6,A\\
	CBB8\>RES 7,B\\
	CBB9\> 	RES 7,C\\
	CBBA\> 	RES 7,D\\
	CBBB\> 	RES 7,E\\
	CBBC\> 	RES 7,H\\
	CBBD\> 	RES 7,L\\
	CBBE\> 	RES 7,(HL)\\
	CBBF\> 	RES 7,A\\
	CBC0\>SET 0,B\\
	CBC1\>SET 0,C\\
	CBC2\>SET 0,D\\
	CBC3\>SET 0,E\\
	CBC4\> 	SET 0,H\\
	CBC5\> 	SET 0,L\\
	CBC6\> 	SET 0,(HL)\\
	CBC7\> 	SET 0,A\\
	CBC8\>SET 1,B\\
	CBC9\> 	SET 1,C\\
	CBCA\> 	SET 1,D\\
	CBCB\> 	SET 1,E\\
	CBCC\> 	SET 1,H\\
	CBCD\> 	SET 1,L\\
	CBCE\> 	SET 1,(HL)\\
	CBCF\> 	SET 1,A\\
	CBD0\>SET 2,B\\
	CBD1\> 	SET 2,C\\
	CBD2\> 	SET 2,D\\
	CBD3\> 	SET 2,E\\
	CBD4\> 	SET 2,H\\
	CBD5\> 	SET 2,L\\
	CBD6\> 	SET 2,(HL)\\
	CBD7\> 	SET 2,A\\
	CBD8\>SET 3,B\\
	CBD9\> 	SET 3,C\\
	CBDA\> 	SET 3,D\\
	CBDB\> 	SET 3,E\\
	CBDC\> 	SET 3,H\\
	CBDD\> 	SET 3,L\\
	CBDE\> 	SET 3,(HL)\\
	CBDF\> 	SET 3,A\\
	CBE0\>SET 4,B\\
	CBE1\> 	SET 4,C\\
	CBE2\> 	SET 4,D\\
	CBE3\> 	SET 4,E\\
	CBE4\> 	SET 4,H\\
	CBE5\> 	SET 4,L\\
	CBE6\> 	SET 4,(HL)\\
	CBE7\> 	SET 4,A\\
	CBE8\>SET 5,B\\
	CBE9\> 	SET 5,C\\
	CBEA\> 	SET 5,D\\
	CBEB\> 	SET 5,E\\
	CBEC\> 	SET 5,H\\
	CBED\> 	SET 5,L\\
	CBEE\> 	SET 5,(HL)\\
	CBEF\> 	SET 5,A\\
	CBF0\>SET 6,B\\
	CBF1\> 	SET 6,C\\
	CBF2\> 	SET 6,D\\
	CBF3\> 	SET 6,E\\
	CBF4\> 	SET 6,H\\
	CBF5\> 	SET 6,L\\
	CBF6\> 	SET 6,(HL)\\
	CBF7\> 	SET 6,A\\
	CBF8\>SET 7,B\\
	CBF9\> 	SET 7,C\\
	CBFA\> 	SET 7,D\\
	CBFB\> 	SET 7,E\\
	CBFC\> 	SET 7,H\\
	CBFD\> 	SET 7,L\\
	CBFE\> 	SET 7,(HL)\\
	CBFF\> 	SET 7,A\\
	CC n n\>CALL Z,nn\\
	CD n n\>CALL nn\\
	CE n\>ADC A,n\\
	CF\>RST 8H\\
	D0\>RET NC\\
	D1\>POP DE\\
	D2 n n\>JP NC,nn\\
	D3 n\>OUT (n),A\\
	D4 n n\>CALL NC,nn\\
	D5\>PUSH DE\\
	D6 n\>SUB n\\
	D7\>RST 10H\\
	D8\>RET C\\
	D9\>EXX\\
	DA n n\>JP C,nn\\
	DB n\>IN A,(n)\\
	DC n n\>CALL C,nn\\
	DD09\>ADD IX,BC\\
	DD19\>ADD IX,DE\\
	DD21 n n\>LD IX,nn\\
	DD22 n n\>LD (nn),IX\\
	DD23\>INC IX\\
	DD24\>INC IXh\UNDOC\\
	DD25\>DEC IXh\UNDOC\\
	DD26 n \>LD IXh,n\UNDOC\\
	DD29\>ADD IX,IX\\
	DD2A n n\>LD IX,(nn)\\
	DD2B\>DEC IX\\
	DD2C\>INC IXl\UNDOC\\
	DD2D\>DEC IXl\UNDOC\\
	DD2E n\>LD IXl,n\UNDOC\\
	DD34 d\>INC (IX+d)\\
	DD35 d\>DEC (IX+d)\\
	DD36 d n\>LD (IX+d),n\\
	DD39\>ADD IX,SP\\
	DD44\>LD B,IXh\UNDOC\\
	DD45\>LD B,IXl\UNDOC\\
	DD46 d\>LD B,(IX+d)\\
	DD4C\>LD C,IXh\UNDOC\\
	DD4D\>LD C,IXl\UNDOC\\
	DD4E d\>LD C,(IX+d)\\
	DD54\>LD D,IXh\UNDOC\\
	DD55\>LD D,IXl\UNDOC\\
	DD56 d\>LD D,(IX+d)\\
	DD5C\>LD E,IXh\UNDOC\\
	DD5D\>LD E,IXl\UNDOC\\
	DD5E d\>LD E,(IX+d)\\
	DD60\>LD IXh,B\UNDOC\\
	DD61\>LD IXh,C\UNDOC\\
	DD62\>LD IXh,D\UNDOC\\
	DD63\>LD IXh,E\UNDOC\\
	DD64\>LD IXh,IXh\UNDOC\\
	DD65\>LD IXh,IXl\UNDOC\\
	DD66 d\>LD H,(IX+d)\\
	DD67\>LD IXh,A\UNDOC\\
	DD68\>LD IXl,B\UNDOC\\
	DD69\>LD IXl,C\UNDOC\\
	DD6A\>LD IXl,D\UNDOC\\
	DD6B\>LD IXl,E\UNDOC\\
	DD6C\>LD IXl,IXh\UNDOC\\
	DD6D\>LD IXl,IXl\UNDOC\\
	DD6E d\>LD L,(IX+d)\\
	DD6F\>LD IXl,A\UNDOC\\
	DD70 d\>LD (IX+d),B\\
	DD71 d\>LD (IX+d),C\\
	DD72 d\>LD (IX+d),D\\
	DD73 d\>LD (IX+d),E\\
	DD74 d\>LD (IX+d),H\\
	DD75 d\>LD (IX+d),L\\
	DD77 d\>LD (IX+d),A\\
	DD7C\>LD A,IXh\UNDOC\\
	DD7D\>LD A,IXl\UNDOC\\
	DD7E d\>LD A,(IX+d)\\
	DD84\>ADD A,IXh\UNDOC\\
	DD85\>ADD A,IXl\UNDOC\\
	DD86 d\>ADD A,(IX+d)\\
	DD8C\>ADC A,IXh\UNDOC\\
	DD8D\>ADC A,IXl\UNDOC\\
	DD8E d\>ADC A,(IX+d)\\
	DD94\>SUB IXh\UNDOC\\
	DD95\>SUB IXl\UNDOC\\
	DD96 d\>SUB (IX+d)\\
	DD9C\>SBC A,IXh\UNDOC\\
	DD9D\>SBC A,IXl\UNDOC\\
	DD9E d\>SBC A,(IX+d)\\
	DDA4\>AND IXh\UNDOC\\
	DDA5\>AND IXl\UNDOC\\
	DDA6 d\>AND (IX+d)\\
	DDAC\>XOR IXh\UNDOC\\
	DDAD\>XOR IXl\UNDOC\\
	DDAE d\>XOR (IX+d)\\
	DDB4\>OR IXh\UNDOC\\
	DDB5\>OR IXl\UNDOC\\
	DDB6 d\>OR (IX+d)\\
	DDBC\>CP IXh\UNDOC\\
	DDBD\>CP IXl\UNDOC\\
	DDBE d\>CP (IX+d)\\
	DDCB d 00\>RLC (IX+d),B\UNDOC\\
	DDCB d 01\>RLC (IX+d),C\UNDOC\\
	DDCB d 02\>RLC (IX+d),D\UNDOC\\
	DDCB d 03\>RLC (IX+d),E\UNDOC\\
	DDCB d 04\>RLC (IX+d),H\UNDOC\\
	DDCB d 05\>RLC (IX+d),L\UNDOC\\
	DDCB d 06\>RLC (IX+d)\\
	DDCB d 07\>RLC (IX+d),A\UNDOC\\
	DDCB d 08\>RRC (IX+d),B\UNDOC\\
	DDCB d 09\>RRC (IX+d),C\UNDOC\\
	DDCB d 0A\>RRC (IX+d),D\UNDOC\\
	DDCB d 0B\>RRC (IX+d),E\UNDOC\\
	DDCB d 0C\>RRC (IX+d),H\UNDOC\\
	DDCB d 0D\>RRC (IX+d),L\UNDOC\\
	DDCB d 0E\>RRC (IX+d)\\
	DDCB d 0F\>RRC (IX+d),A\UNDOC\\
	DDCB d 10\>RL (IX+d),B\UNDOC\\
	DDCB d 11\>RL (IX+d),C\UNDOC\\
	DDCB d 12\>RL (IX+d),D\UNDOC\\
	DDCB d 13\>RL (IX+d),E\UNDOC\\
	DDCB d 14\>RL (IX+d),H\UNDOC\\
	DDCB d 15\>RL (IX+d),L\UNDOC\\
	DDCB d 16\>RL (IX+d)\\
	DDCB d 17\>RL (IX+d),A\UNDOC\\
	DDCB d 18\>RR (IX+d),B\UNDOC\\
	DDCB d 19\>RR (IX+d),C\UNDOC\\
	DDCB d 1A\>RR (IX+d),D\UNDOC\\
	DDCB d 1B\>RR (IX+d),E\UNDOC\\
	DDCB d 1C\>RR (IX+d),H\UNDOC\\
	DDCB d 1D\>RR (IX+d),L\UNDOC\\
	DDCB d 1E\>RR (IX+d)\\
	DDCB d 1F\>RR (IX+d),A\UNDOC\\
	DDCB d 20\>SLA (IX+d),B\UNDOC\\
	DDCB d 21\>SLA (IX+d),C\UNDOC\\
	DDCB d 22\>SLA (IX+d),D\UNDOC\\
	DDCB d 23\>SLA (IX+d),E\UNDOC\\
	DDCB d 24\>SLA (IX+d),H\UNDOC\\
	DDCB d 25\>SLA (IX+d),L\UNDOC\\
	DDCB d 26\>SLA (IX+d)\\
	DDCB d 27\>SLA (IX+d),A\UNDOC\\
	DDCB d 28\>SRA (IX+d),B\UNDOC\\
	DDCB d 29\>SRA (IX+d),C\UNDOC\\
	DDCB d 2A\>SRA (IX+d),D\UNDOC\\
	DDCB d 2B\>SRA (IX+d),E\UNDOC\\
	DDCB d 2C\>SRA (IX+d),H\UNDOC\\
	DDCB d 2D\>SRA (IX+d),L\UNDOC\\
	DDCB d 2E\>SRA (IX+d)\\
	DDCB d 2F\>SRA (IX+d),A\UNDOC\\
	DDCB d 30\>SLL (IX+d),B\UNDOC\\
	DDCB d 31\>SLL (IX+d),C\UNDOC\\
	DDCB d 32\>SLL (IX+d),D\UNDOC\\
	DDCB d 33\>SLL (IX+d),E\UNDOC\\
	DDCB d 34\>SLL (IX+d),H\UNDOC\\
	DDCB d 35\>SLL (IX+d),L\UNDOC\\
	DDCB d 36\>SLL (IX+d)\UNDOC\\
	DDCB d 37\>SLL (IX+d),A\UNDOC\\
	DDCB d 38\>SRL (IX+d),B\UNDOC\\
	DDCB d 39\>SRL (IX+d),C\UNDOC\\
	DDCB d 3A\>SRL (IX+d),D\UNDOC\\
	DDCB d 3B\>SRL (IX+d),E\UNDOC\\
	DDCB d 3C\>SRL (IX+d),H\UNDOC\\
	DDCB d 3D\>SRL (IX+d),L\UNDOC\\
	DDCB d 3E\>SRL (IX+d)\\
	DDCB d 3F\>SRL (IX+d),A\UNDOC\\
	DDCB d 40\>BIT 0,(IX+d)\UNDOC\\
	DDCB d 41\>BIT 0,(IX+d)\UNDOC\\
	DDCB d 42\>BIT 0,(IX+d)\UNDOC\\
	DDCB d 43\>BIT 0,(IX+d)\UNDOC\\
	DDCB d 44\>BIT 0,(IX+d)\UNDOC\\
	DDCB d 45\>BIT 0,(IX+d)\UNDOC\\
	DDCB d 46\>BIT 0,(IX+d)\\
	DDCB d 47\>BIT 0,(IX+d)\UNDOC\\
	DDCB d 48\>BIT 1,(IX+d)\UNDOC\\
	DDCB d 49\>BIT 1,(IX+d)\UNDOC\\
	DDCB d 4A\>BIT 1,(IX+d)\UNDOC\\
	DDCB d 4B\>BIT 1,(IX+d)\UNDOC\\
	DDCB d 4C\>BIT 1,(IX+d)\UNDOC\\
	DDCB d 4D\>BIT 1,(IX+d)\UNDOC\\
	DDCB d 4E\>BIT 1,(IX+d)\\
	DDCB d 4F\>BIT 1,(IX+d)\UNDOC\\
	DDCB d 50\>BIT 2,(IX+d)\UNDOC\\
	DDCB d 51\>BIT 2,(IX+d)\UNDOC\\
	DDCB d 52\>BIT 2,(IX+d)\UNDOC\\
	DDCB d 53\>BIT 2,(IX+d)\UNDOC\\
	DDCB d 54\>BIT 2,(IX+d)\UNDOC\\
	DDCB d 55\>BIT 2,(IX+d)\UNDOC\\
	DDCB d 56\>BIT 2,(IX+d)\\
	DDCB d 57\>BIT 2,(IX+d)\UNDOC\\
	DDCB d 58\>BIT 3,(IX+d)\UNDOC\\
	DDCB d 59\>BIT 3,(IX+d)\UNDOC\\
	DDCB d 5A\>BIT 3,(IX+d)\UNDOC\\
	DDCB d 5B\>BIT 3,(IX+d)\UNDOC\\
	DDCB d 5C\>BIT 3,(IX+d)\UNDOC\\
	DDCB d 5D\>BIT 3,(IX+d)\UNDOC\\
	DDCB d 5E\>BIT 3,(IX+d)\\
	DDCB d 5F\>BIT 3,(IX+d)\UNDOC\\
	DDCB d 60\>BIT 4,(IX+d)\UNDOC\\
	DDCB d 61\>BIT 4,(IX+d)\UNDOC\\
	DDCB d 62\>BIT 4,(IX+d)\UNDOC\\
	DDCB d 63\>BIT 4,(IX+d)\UNDOC\\
	DDCB d 64\>BIT 4,(IX+d)\UNDOC\\
	DDCB d 65\>BIT 4,(IX+d)\UNDOC\\
	DDCB d 66\>BIT 4,(IX+d)\\
	DDCB d 67\>BIT 4,(IX+d)\UNDOC\\
	DDCB d 68\>BIT 5,(IX+d)\UNDOC\\
	DDCB d 69\>BIT 5,(IX+d)\UNDOC\\
	DDCB d 6A\>BIT 5,(IX+d)\UNDOC\\
	DDCB d 6B\>BIT 5,(IX+d)\UNDOC\\
	DDCB d 6C\>BIT 5,(IX+d)\UNDOC\\
	DDCB d 6D\>BIT 5,(IX+d)\UNDOC\\
	DDCB d 6E\>BIT 5,(IX+d)\\
	DDCB d 6F\>BIT 5,(IX+d)\UNDOC\\
	DDCB d 70\>BIT 6,(IX+d)\UNDOC\\
	DDCB d 71\>BIT 6,(IX+d)\UNDOC\\
	DDCB d 72\>BIT 6,(IX+d)\UNDOC\\
	DDCB d 73\>BIT 6,(IX+d)\UNDOC\\
	DDCB d 74\>BIT 6,(IX+d)\UNDOC\\
	DDCB d 75\>BIT 6,(IX+d)\UNDOC\\
	DDCB d 76\>BIT 6,(IX+d)\\
	DDCB d 77\>BIT 6,(IX+d)\UNDOC\\
	DDCB d 78\>BIT 7,(IX+d)\UNDOC\\
	DDCB d 79\>BIT 7,(IX+d)\UNDOC\\
	DDCB d 7A\>BIT 7,(IX+d)\UNDOC\\
	DDCB d 7B\>BIT 7,(IX+d)\UNDOC\\
	DDCB d 7C\>BIT 7,(IX+d)\UNDOC\\
	DDCB d 7D\>BIT 7,(IX+d)\UNDOC\\
	DDCB d 7E\>BIT 7,(IX+d)\\
	DDCB d 7F\>BIT 7,(IX+d)\UNDOC\\
	DDCB d 80\>RES 0,(IX+d),B\UNDOC\\
	DDCB d 81\>RES 0,(IX+d),C\UNDOC\\
	DDCB d 82\>RES 0,(IX+d),D\UNDOC\\
	DDCB d 83\>RES 0,(IX+d),E\UNDOC\\
	DDCB d 84\>RES 0,(IX+d),H\UNDOC\\
	DDCB d 85\>RES 0,(IX+d),L\UNDOC\\
	DDCB d 86\>RES 0,(IX+d)\\
	DDCB d 87\>RES 0,(IX+d),A\UNDOC\\
	DDCB d 88\>RES 1,(IX+d),B\UNDOC\\
	DDCB d 89\>RES 1,(IX+d),C\UNDOC\\
	DDCB d 8A\>RES 1,(IX+d),D\UNDOC\\
	DDCB d 8B\>RES 1,(IX+d),E\UNDOC\\
	DDCB d 8C\>RES 1,(IX+d),H\UNDOC\\
	DDCB d 8D\>RES 1,(IX+d),L\UNDOC\\
	DDCB d 8E\>RES 1,(IX+d)\\
	DDCB d 8F\>RES 1,(IX+d),A\UNDOC\\
	DDCB d 90\>RES 2,(IX+d),B\UNDOC\\
	DDCB d 91\>RES 2,(IX+d),C\UNDOC\\
	DDCB d 92\>RES 2,(IX+d),D\UNDOC\\
	DDCB d 93\>RES 2,(IX+d),E\UNDOC\\
	DDCB d 94\>RES 2,(IX+d),H\UNDOC\\
	DDCB d 95\>RES 2,(IX+d),L\UNDOC\\
	DDCB d 96\>RES 2,(IX+d)\\
	DDCB d 97\>RES 2,(IX+d),A\UNDOC\\
	DDCB d 98\>RES 3,(IX+d),B\UNDOC\\
	DDCB d 99\>RES 3,(IX+d),C\UNDOC\\
	DDCB d 9A\>RES 3,(IX+d),D\UNDOC\\
	DDCB d 9B\>RES 3,(IX+d),E\UNDOC\\
	DDCB d 9C\>RES 3,(IX+d),H\UNDOC\\
	DDCB d 9D\>RES 3,(IX+d),L\UNDOC\\
	DDCB d 9E\>RES 3,(IX+d)\\
	DDCB d 9F\>RES 3,(IX+d),A\UNDOC\\
	DDCB d A0\>RES 4,(IX+d),B\UNDOC\\
	DDCB d A1\>RES 4,(IX+d),C\UNDOC\\
	DDCB d A2\>RES 4,(IX+d),D\UNDOC\\
	DDCB d A3\>RES 4,(IX+d),E\UNDOC\\
	DDCB d A4\>RES 4,(IX+d),H\UNDOC\\
	DDCB d A5\>RES 4,(IX+d),L\UNDOC\\
	DDCB d A6\>RES 4,(IX+d)\\
	DDCB d A7\>RES 4,(IX+d),A\UNDOC\\
	DDCB d A8\>RES 5,(IX+d),B\UNDOC\\
	DDCB d A9\>RES 5,(IX+d),C\UNDOC\\
	DDCB d AA\>RES 5,(IX+d),D\UNDOC\\
	DDCB d AB\>RES 5,(IX+d),E\UNDOC\\
	DDCB d AC\>RES 5,(IX+d),H\UNDOC\\
	DDCB d AD\>RES 5,(IX+d),L\UNDOC\\
	DDCB d AE\>RES 5,(IX+d)\\
	DDCB d AF\>RES 5,(IX+d),A\UNDOC\\
	DDCB d B0\>RES 6,(IX+d),B\UNDOC\\
	DDCB d B1\>RES 6,(IX+d),C\UNDOC\\
	DDCB d B2\>RES 6,(IX+d),D\UNDOC\\
	DDCB d B3\>RES 6,(IX+d),E\UNDOC\\
	DDCB d B4\>RES 6,(IX+d),H\UNDOC\\
	DDCB d B5\>RES 6,(IX+d),L\UNDOC\\
	DDCB d B6\>RES 6,(IX+d)\\
	DDCB d B7\>RES 6,(IX+d),A\UNDOC\\
	DDCB d B8\>RES 7,(IX+d),B\UNDOC\\
	DDCB d B9\>RES 7,(IX+d),C\UNDOC\\
	DDCB d BA\>RES 7,(IX+d),D\UNDOC\\
	DDCB d BB\>RES 7,(IX+d),E\UNDOC\\
	DDCB d BC\>RES 7,(IX+d),H\UNDOC\\
	DDCB d BD\>RES 7,(IX+d),L\UNDOC\\
	DDCB d BE\>RES 7,(IX+d)\\
	DDCB d BF\>RES 7,(IX+d),A\UNDOC\\
	DDCB d C0\>SET 0,(IX+d),B\UNDOC\\
	DDCB d C1\>SET 0,(IX+d),C\UNDOC\\
	DDCB d C2\>SET 0,(IX+d),D\UNDOC\\
	DDCB d C3\>SET 0,(IX+d),E\UNDOC\\
	DDCB d C4\>SET 0,(IX+d),H\UNDOC\\
	DDCB d C5\>SET 0,(IX+d),L\UNDOC\\
	DDCB d C6\>SET 0,(IX+d)\\
	DDCB d C7\>SET 0,(IX+d),A\UNDOC\\
	DDCB d C8\>SET 1,(IX+d),B\UNDOC\\
	DDCB d C9\>SET 1,(IX+d),C\UNDOC\\
	DDCB d CA\>SET 1,(IX+d),D\UNDOC\\
	DDCB d CB\>SET 1,(IX+d),E\UNDOC\\
	DDCB d CC\>SET 1,(IX+d),H\UNDOC\\
	DDCB d CD\>SET 1,(IX+d),L\UNDOC\\
	DDCB d CE\>SET 1,(IX+d)\\
	DDCB d CF\>SET 1,(IX+d),A\UNDOC\\
	DDCB d D0\>SET 2,(IX+d),B\UNDOC\\
	DDCB d D1\>SET 2,(IX+d),C\UNDOC\\
	DDCB d D2\>SET 2,(IX+d),D\UNDOC\\
	DDCB d D3\>SET 2,(IX+d),E\UNDOC\\
	DDCB d D4\>SET 2,(IX+d),H\UNDOC\\
	DDCB d D5\>SET 2,(IX+d),L\UNDOC\\
	DDCB d D6\>SET 2,(IX+d)\\
	DDCB d D7\>SET 2,(IX+d),A\UNDOC\\
	DDCB d D8\>SET 3,(IX+d),B\UNDOC\\
	DDCB d D9\>SET 3,(IX+d),C\UNDOC\\
	DDCB d DA\>SET 3,(IX+d),D\UNDOC\\
	DDCB d DB\>SET 3,(IX+d),E\UNDOC\\
	DDCB d DC\>SET 3,(IX+d),H\UNDOC\\
	DDCB d DD\>SET 3,(IX+d),L\UNDOC\\
	DDCB d DE\>SET 3,(IX+d)\\
	DDCB d DF\>SET 3,(IX+d),A\UNDOC\\
	DDCB d E0\>SET 4,(IX+d),B\UNDOC\\
	DDCB d E1\>SET 4,(IX+d),C\UNDOC\\
	DDCB d E2\>SET 4,(IX+d),D\UNDOC\\
	DDCB d E3\>SET 4,(IX+d),E\UNDOC\\
	DDCB d E4\>SET 4,(IX+d),H\UNDOC\\
	DDCB d E5\>SET 4,(IX+d),L\UNDOC\\
	DDCB d E6\>SET 4,(IX+d)\\
	DDCB d E7\>SET 4,(IX+d),A\UNDOC\\
	DDCB d E8\>SET 5,(IX+d),B\UNDOC\\
	DDCB d E9\>SET 5,(IX+d),C\UNDOC\\
	DDCB d EA\>SET 5,(IX+d),D\UNDOC\\
	DDCB d EB\>SET 5,(IX+d),E\UNDOC\\
	DDCB d EC\>SET 5,(IX+d),H\UNDOC\\
	DDCB d ED\>SET 5,(IX+d),L\UNDOC\\
	DDCB d EE\>SET 5,(IX+d)\\
	DDCB d EF\>SET 5,(IX+d),A\UNDOC\\
	DDCB d F0\>SET 6,(IX+d),B\UNDOC\\
	DDCB d F1\>SET 6,(IX+d),C\UNDOC\\
	DDCB d F2\>SET 6,(IX+d),D\UNDOC\\
	DDCB d F3\>SET 6,(IX+d),E\UNDOC\\
	DDCB d F4\>SET 6,(IX+d),H\UNDOC\\
	DDCB d F5\>SET 6,(IX+d),L\UNDOC\\
	DDCB d F6\>SET 6,(IX+d)\\
	DDCB d F7\>SET 6,(IX+d),A\UNDOC\\
	DDCB d F8\>SET 7,(IX+d),B\UNDOC\\
	DDCB d F9\>SET 7,(IX+d),C\UNDOC\\
	DDCB d FA\>SET 7,(IX+d),D\UNDOC\\
	DDCB d FB\>SET 7,(IX+d),E\UNDOC\\
	DDCB d FC\>SET 7,(IX+d),H\UNDOC\\
	DDCB d FD\>SET 7,(IX+d),L\UNDOC\\
	DDCB d FE\>SET 7,(IX+d)\\
	DDCB d FF\>SET 7,(IX+d),A\UNDOC\\
	DDE1\>POP IX\\
	DDE3\>EX (SP),IX\\
	DDE5\>PUSH IX\\
	DDE9\>JP (IX)\\
	DDF9\>LD SP,IX\\
	DE n\>SBC A,n\\
	DF\>RST 18H\\
	E0\>RET PO\\
	E1\>POP HL\\
	E2 n n\>JP PO,nn\\
	E3\>EX (SP),HL\\
	E4 n n\>CALL PO,nn\\
	E5\>PUSH HL\\
	E6 n\>AND n\\
	E7\>RST 20H\\
	E8\>RET PE\\
	E9\>JP (HL)\\
	EA n n\>JP PE,nn\\
	EB\>EX DE,HL\\
	EC n n\>CALL PE,nn\\
	ED23\>SWAPNIB\ZXN\\
	ED24\>MIRROR A\ZXN\\
	ED27 n\>TEST n\ZXN\\
	ED28\>BSLA DE,B\ZXN\\
	ED28\>BSLA DE,B\ZXN\\
	ED29\>BSRA DE,B\ZXN\\
	ED2A\>BSRL DE,B\ZXN\\
	ED2B\>BSRF DE,B\ZXN\\
	ED2C\>BRLC DE,B\ZXN\\
	ED30\>MUL D,E\ZXN\\
	ED31\>ADD HL,A\ZXN\\
	ED32\>ADD DE,A\ZXN\\
	ED33\>ADD BC,A\ZXN\\
	ED34 n n\>ADD HL,nn\ZXN\\
	ED35 n n\>ADD DE,nn\ZXN\\
	ED36 n n\>ADD BC,nn\ZXN\\
	ED40\>IN B,(C)\\
	ED41\>OUT (C),B\\
	ED42\>SBC HL,BC\\
	ED43 n n\>LD (nn),BC\\
	ED44\>NEG\\
	ED45\>RETN\\
	ED46\>IM 0\\
	ED47\>LD I,A\\
	ED48\>IN C,(C)\\
	ED49\>OUT (C),C\\
	ED4A\>ADC HL,BC\\
	ED4B n n\>LD BC,(nn)\\
	ED4C\>NEG\UNDOC\\
	ED4D\>RETI\\
	ED4E\>IM 0\UNDOC\\
	ED4F\>LD R,A\\
	ED50\>IN D,(C)\\
	ED51\>OUT (C),D\\
	ED52\>SBC HL,DE\\
	ED53 n n\>LD (nn),DE\\
	ED54\>NEG\UNDOC\\
	ED55\>RETN\UNDOC\\
	ED56\>IM 1\\
	ED57\>LD A,I\\
	ED58\>IN E,(C)\\
	ED59\>OUT (C),E\\
	ED5A\>ADC HL,DE\\
	ED5B n n\>LD DE,(nn)\\
	ED5C\>NEG\UNDOC\\
	ED5D\>RETN\UNDOC\\
	ED5E\>IM 2\\
	ED5F\>LD A,R\\
	ED60\>IN H,(C)\\
	ED61\>OUT (C),H\\
	ED62\>SBC HL,HL\\
	ED63 n n\>LD (nn),HL\\
	ED64\>NEG\UNDOC\\
	ED65\>RETN\UNDOC\\
	ED66\>IM 0\UNDOC\\
	ED67\>RRD\\
	ED68\>IN L,(C)\\
	ED69\>OUT (C),L\\
	ED6A\>ADC HL,HL\\
	ED6B n n\>LD HL,(nn)\\
	ED6C\>NEG\UNDOC\\
	ED6D\>RETN\UNDOC\\
	ED6E\>IM 0\UNDOC\\
	ED6F\>RLD\\
	ED70\>IN F,(C)\UNDOC\\
	ED70\>IN (C)\UNDOC\\
	ED71\>OUT (C),0\UNDOC\\
	ED72\>SBC HL,SP\\
	ED73 n n\>LD (nn),SP\\
	ED74\>NEG\UNDOC\\
	ED75\>RETN\UNDOC\\
	ED76\>IM 1\UNDOC\\
	ED78\>IN A,(C)\\
	ED79\>OUT (C),A\\
	ED7A\>ADC HL,SP\\
	ED7B n n\>LD SP,(nn)\\
	ED7C\>NEG\UNDOC\\
	ED7D\>RETN\UNDOC\\
	ED7E\>IM 2\UNDOC\\
	ED8A n n\>PUSH nn\ZXN\\
	ED90\>OUTINB\ZXN\\
	ED91 r n\>NEXTREG r,n\ZXN\\
	ED92 n\>NEXTREG r,A\ZXN\\
	ED93\>PIXELDN\ZXN\\
	ED94\>PIXELAD\ZXN\\
	ED95\>SETAE\ZXN\\
	ED97\>JP (C)\ZXN\\
	EDA0\>LDI\\
	EDA1\>CPI\\
	EDA2\>INI\\
	EDA3\>OUTI\\
	EDA4\>LDIX\ZXN\\
	EDA5\>LDWS\ZXN\\
	EDAC\>LDDX\ZXN\\
	EDA8\>LDD\\
	EDA9\>CPD\\
	EDAA\>IND\\
	EDAB\>OUTD\\
	EDB0\>LDIR\\
	EDB1\>CPIR\\
	EDB2\>INIR\\
	EDB3\>OTIR\\
	EDB4\>LDIRX\ZXN\\
	EDB7\>LDPIRX\ZXN\\
	EDBC\>LDDRX\ZXN\\
	EDB8\>LDDR\\
	EDB9\>CPDR\\
	EDBA\>INDR\\
	EDBB\>OTDR\\
	EE n\>XOR n\\
	EF\>RST 28H\\
	F0\>RET P\\
	F1\>POP AF\\
	F2 n n\>JP P,nn\\
	F3\>DI\\
	F4 n n\>CALL P,nn\\
	F5\>PUSH AF\\
	F6 n\>OR n\\
	F7\>RST 30H\\
	F8\>RET M\\
	F9\>LD SP,HL\\
	FA n n\>JP M,nn\\
	FB\>EI\\
	FC n n\>CALL M,nn\\
	FD09\>ADD IY,BC\\
	FD19\>ADD IY,DE\\
	FD21 n n\>LD IY,nn\\
	FD22 n n\>LD (nn),IY\\
	FD23\>INC IY\\
	FD24\>INC IYh\UNDOC\\
	FD25\>DEC IYh\UNDOC\\
	FD26 n\>LD IYh,n\UNDOC\\
	FD29\>ADD IY,IY\\
	FD2A n n\>LD IY,(nn)\\
	FD2B\>DEC IY\\
	FD2C\>INC IYl\UNDOC\\
	FD2D\>DEC IYl\UNDOC\\
	FD2E n\>LD IYl,n\UNDOC\\
	FD34 d\>INC (IY+d)\\
	FD35 d\>DEC (IY+d)\\
	FD36 d n\>LD (IY+d),n\\
	FD39\>ADD IY,SP\\
	FD44\>LD B,IYh\UNDOC\\
	FD45\>LD B,IYl\UNDOC\\
	FD46 d\>LD B,(IY+d)\\
	FD4C\>LD C,IYh\UNDOC\\
	FD4D\>LD C,IYl\UNDOC\\
	FD4E d\>LD C,(IY+d)\\
	FD54\>LD D,IYh\UNDOC\\
	FD55\>LD D,IYl\UNDOC\\
	FD56 d\>LD D,(IY+d)\\
	FD5C\>LD E,IYh\UNDOC\\
	FD5D\>LD E,IYl\UNDOC\\
	FD5E d\>LD E,(IY+d)\\
	FD60\>LD IYh,B\UNDOC\\
	FD61\>LD IYh,C\UNDOC\\
	FD62\>LD IYh,D\UNDOC\\
	FD63\>LD IYh,E\UNDOC\\
	FD64\>LD IYh,IYh\UNDOC\\
	FD65\>LD IYh,IYl\UNDOC\\
	FD66 d\>LD H,(IY+d)\\
	FD67\>LD IYh,A\UNDOC\\
	FD68\>LD IYl,B\UNDOC\\
	FD69\>LD IYl,C\UNDOC\\
	FD6A\>LD IYl,D\UNDOC\\
	FD6B\>LD IYl,E\UNDOC\\
	FD6C\>LD IYl,IYh\UNDOC\\
	FD6D\>LD IYl,IYl\UNDOC\\
	FD6E d\>LD L,(IY+d)\\
	FD6F\>LD IYl,A\UNDOC\\
	FD70 d\>LD (IY+d),B\\
	FD71 d\>LD (IY+d),C\\
	FD72 d\>LD (IY+d),D\\
	FD73 d\>LD (IY+d),E\\
	FD74 d\>LD (IY+d),H\\
	FD75 d\>LD (IY+d),L\\
	FD77 d\>LD (IY+d),A\\
	FD7C\>LD A,IYh\UNDOC\\
	FD7D\>LD A,IYl\UNDOC\\
	FD7E d\>LD A,(IY+d)\\
	FD84\>ADD A,IYh\UNDOC\\
	FD85\>ADD A,IYl\UNDOC\\
	FD86 d\>ADD A,(IY+d)\\
	FD8C\>ADC A,IYh\UNDOC\\
	FD8D\>ADC A,IYl\UNDOC\\
	FD8E d\>ADC A,(IY+d)\\
	FD94\>SUB IYh\UNDOC\\
	FD95\>SUB IYl\UNDOC\\
	FD96 d\>SUB (IY+d)\\
	FD9C\>SBC A,IYh\UNDOC\\
	FD9D\>SBC A,IYl\UNDOC\\
	FD9E d\>SBC A,(IY+d)\\
	FDA4\>AND IYh\UNDOC\\
	FDA5\>AND IYl\UNDOC\\
	FDA6 d\>AND (IY+d)\\
	FDAC\>XOR IYh\UNDOC\\
	FDAD\>XOR IYl\UNDOC\\
	FDAE d\>XOR (IY+d)\\
	FDB4\>OR IYh\UNDOC\\
	FDB5\>OR IYl\UNDOC\\
	FDB6 d\>OR (IY+d)\\
	FDBC\>CP IYh\UNDOC\\
	FDBD\>CP IYl\UNDOC\\
	FDBE d\>CP (IY+d)\\
	FDCB d 00\>RLC (IY+d),B\UNDOC\\
	FDCB d 01\>RLC (IY+d),C\UNDOC\\
	FDCB d 02\>RLC (IY+d),D\UNDOC\\
	FDCB d 03\>RLC (IY+d),E\UNDOC\\
	FDCB d 04\>RLC (IY+d),H\UNDOC\\
	FDCB d 05\>RLC (IY+d),L\UNDOC\\
	FDCB d 06\>RLC (IY+d)\\
	FDCB d 07\>RLC (IY+d),A\UNDOC\\
	FDCB d 08\>RRC (IY+d),B\UNDOC\\
	FDCB d 09\>RRC (IY+d),C\UNDOC\\
	FDCB d 0A\>RRC (IY+d),D\UNDOC\\
	FDCB d 0B\>RRC (IY+d),E\UNDOC\\
	FDCB d 0C\>RRC (IY+d),H\UNDOC\\
	FDCB d 0D\>RRC (IY+d),L\UNDOC\\
	FDCB d 0E\>RRC (IY+d)\\
	FDCB d 0F\>RRC (IY+d),A\UNDOC\\
	FDCB d 10\>RL (IY+d),B\UNDOC\\
	FDCB d 11\>RL (IY+d),C\UNDOC\\
	FDCB d 12\>RL (IY+d),D\UNDOC\\
	FDCB d 13\>RL (IY+d),E\UNDOC\\
	FDCB d 14\>RL (IY+d),H\UNDOC\\
	FDCB d 15\>RL (IY+d),L\UNDOC\\
	FDCB d 16\>RL (IY+d)\\
	FDCB d 17\>RL (IY+d),A\UNDOC\\
	FDCB d 18\>RR (IY+d),B\UNDOC\\
	FDCB d 19\>RR (IY+d),C\UNDOC\\
	FDCB d 1A\>RR (IY+d),D\UNDOC\\
	FDCB d 1B\>RR (IY+d),E\UNDOC\\
	FDCB d 1C\>RR (IY+d),H\UNDOC\\
	FDCB d 1D\>RR (IY+d),L\UNDOC\\
	FDCB d 1E\>RR (IY+d)\\
	FDCB d 1F\>RR (IY+d),A\UNDOC\\
	FDCB d 20\>SLA (IY+d),B\UNDOC\\
	FDCB d 21\>SLA (IY+d),C\UNDOC\\
	FDCB d 22\>SLA (IY+d),D\UNDOC\\
	FDCB d 23\>SLA (IY+d),E\UNDOC\\
	FDCB d 24\>SLA (IY+d),H\UNDOC\\
	FDCB d 25\>SLA (IY+d),L\UNDOC\\
	FDCB d 26\>SLA (IY+d)\\
	FDCB d 27\>SLA (IY+d),A\UNDOC\\
	FDCB d 28\>SRA (IY+d),B\UNDOC\\
	FDCB d 29\>SRA (IY+d),C\UNDOC\\
	FDCB d 2A\>SRA (IY+d),D\UNDOC\\
	FDCB d 2B\>SRA (IY+d),E\UNDOC\\
	FDCB d 2C\>SRA (IY+d),H\UNDOC\\
	FDCB d 2D\>SRA (IY+d),L\UNDOC\\
	FDCB d 2E\>SRA (IY+d)\\
	FDCB d 2F\>SRA (IY+d),A\UNDOC\\
	FDCB d 30\>SLL (IY+d),B\UNDOC\\
	FDCB d 31\>SLL (IY+d),C\UNDOC\\
	FDCB d 32\>SLL (IY+d),D\UNDOC\\
	FDCB d 33\>SLL (IY+d),E\UNDOC\\
	FDCB d 34\>SLL (IY+d),H\UNDOC\\
	FDCB d 35\>SLL (IY+d),L\UNDOC\\
	FDCB d 36\>SLL (IY+d)\UNDOC\\
	FDCB d 37\>SLL (IY+d),A\UNDOC\\
	FDCB d 38\>SRL (IY+d),B\UNDOC\\
	FDCB d 39\>SRL (IY+d),C\UNDOC\\
	FDCB d 3A\>SRL (IY+d),D\UNDOC\\
	FDCB d 3B\>SRL (IY+d),E\UNDOC\\
	FDCB d 3C\>SRL (IY+d),H\UNDOC\\
	FDCB d 3D\>SRL (IY+d),L\UNDOC\\
	FDCB d 3E\>SRL (IY+d)\\
	FDCB d 3F\>SRL (IY+d),A\UNDOC\\
	FDCB d 40\>BIT 0,(IY+d)\UNDOC\\
	FDCB d 41\>BIT 0,(IY+d)\UNDOC\\
	FDCB d 42\>BIT 0,(IY+d)\UNDOC\\
	FDCB d 43\>BIT 0,(IY+d)\UNDOC\\
	FDCB d 44\>BIT 0,(IY+d)\UNDOC\\
	FDCB d 45\>BIT 0,(IY+d)\UNDOC\\
	FDCB d 46\>BIT 0,(IY+d)\\
	FDCB d 47\>BIT 0,(IY+d)\UNDOC\\
	FDCB d 48\>BIT 1,(IY+d)\UNDOC\\
	FDCB d 49\>BIT 1,(IY+d)\UNDOC\\
	FDCB d 4A\>BIT 1,(IY+d)\UNDOC\\
	FDCB d 4B\>BIT 1,(IY+d)\UNDOC\\
	FDCB d 4C\>BIT 1,(IY+d)\UNDOC\\
	FDCB d 4D\>BIT 1,(IY+d)\UNDOC\\
	FDCB d 4E\>BIT 1,(IY+d)\\
	FDCB d 4F\>BIT 1,(IY+d)\UNDOC\\
	FDCB d 50\>BIT 2,(IY+d)\UNDOC\\
	FDCB d 51\>BIT 2,(IY+d)\UNDOC\\
	FDCB d 52\>BIT 2,(IY+d)\UNDOC\\
	FDCB d 53\>BIT 2,(IY+d)\UNDOC\\
	FDCB d 54\>BIT 2,(IY+d)\UNDOC\\
	FDCB d 55\>BIT 2,(IY+d)\UNDOC\\
	FDCB d 56\>BIT 2,(IY+d)\\
	FDCB d 57\>BIT 2,(IY+d)\UNDOC\\
	FDCB d 58\>BIT 3,(IY+d)\UNDOC\\
	FDCB d 59\>BIT 3,(IY+d)\UNDOC\\
	FDCB d 5A\>BIT 3,(IY+d)\UNDOC\\
	FDCB d 5B\>BIT 3,(IY+d)\UNDOC\\
	FDCB d 5C\>BIT 3,(IY+d)\UNDOC\\
	FDCB d 5D\>BIT 3,(IY+d)\UNDOC\\
	FDCB d 5E\>BIT 3,(IY+d)\\
	FDCB d 5F\>BIT 3,(IY+d)\UNDOC\\
	FDCB d 60\>BIT 4,(IY+d)\UNDOC\\
	FDCB d 61\>BIT 4,(IY+d)\UNDOC\\
	FDCB d 62\>BIT 4,(IY+d)\UNDOC\\
	FDCB d 63\>BIT 4,(IY+d)\UNDOC\\
	FDCB d 64\>BIT 4,(IY+d)\UNDOC\\
	FDCB d 65\>BIT 4,(IY+d)\UNDOC\\
	FDCB d 66\>BIT 4,(IY+d)\\
	FDCB d 67\>BIT 4,(IY+d)\UNDOC\\
	FDCB d 68\>BIT 5,(IY+d)\UNDOC\\
	FDCB d 69\>BIT 5,(IY+d)\UNDOC\\
	FDCB d 6A\>BIT 5,(IY+d)\UNDOC\\
	FDCB d 6B\>BIT 5,(IY+d)\UNDOC\\
	FDCB d 6C\>BIT 5,(IY+d)\UNDOC\\
	FDCB d 6D\>BIT 5,(IY+d)\UNDOC\\
	FDCB d 6E\>BIT 5,(IY+d)\\
	FDCB d 6F\>BIT 5,(IY+d)\UNDOC\\
	FDCB d 70\>BIT 6,(IY+d)\UNDOC\\
	FDCB d 71\>BIT 6,(IY+d)\UNDOC\\
	FDCB d 72\>BIT 6,(IY+d)\UNDOC\\
	FDCB d 73\>BIT 6,(IY+d)\UNDOC\\
	FDCB d 74\>BIT 6,(IY+d)\UNDOC\\
	FDCB d 75\>BIT 6,(IY+d)\UNDOC\\
	FDCB d 76\>BIT 6,(IY+d)\\
	FDCB d 77\>BIT 6,(IY+d)\UNDOC\\
	FDCB d 78\>BIT 7,(IY+d)\UNDOC\\
	FDCB d 79\>BIT 7,(IY+d)\UNDOC\\
	FDCB d 7A\>BIT 7,(IY+d)\UNDOC\\
	FDCB d 7B\>BIT 7,(IY+d)\UNDOC\\
	FDCB d 7C\>BIT 7,(IY+d)\UNDOC\\
	FDCB d 7D\>BIT 7,(IY+d)\UNDOC\\
	FDCB d 7E\>BIT 7,(IY+d)\\
	FDCB d 7F\>BIT 7,(IY+d)\UNDOC\\
	FDCB d 80\>RES 0,(IY+d),B\UNDOC\\
	FDCB d 81\>RES 0,(IY+d),C\UNDOC\\
	FDCB d 82\>RES 0,(IY+d),D\UNDOC\\
	FDCB d 83\>RES 0,(IY+d),E\UNDOC\\
	FDCB d 84\>RES 0,(IY+d),H\UNDOC\\
	FDCB d 85\>RES 0,(IY+d),L\UNDOC\\
	FDCB d 86\>RES 0,(IY+d)\\
	FDCB d 87\>RES 0,(IY+d),A\UNDOC\\
	FDCB d 88\>RES 1,(IY+d),B\UNDOC\\
	FDCB d 89\>RES 1,(IY+d),C\UNDOC\\
	FDCB d 8A\>RES 1,(IY+d),D\UNDOC\\
	FDCB d 8B\>RES 1,(IY+d),E\UNDOC\\
	FDCB d 8C\>RES 1,(IY+d),H\UNDOC\\
	FDCB d 8D\>RES 1,(IY+d),L\UNDOC\\
	FDCB d 8E\>RES 1,(IY+d)\\
	FDCB d 8F\>RES 1,(IY+d),A\UNDOC\\
	FDCB d 90\>RES 2,(IY+d),B\UNDOC\\
	FDCB d 91\>RES 2,(IY+d),C\UNDOC\\
	FDCB d 92\>RES 2,(IY+d),D\UNDOC\\
	FDCB d 93\>RES 2,(IY+d),E\UNDOC\\
	FDCB d 94\>RES 2,(IY+d),H\UNDOC\\
	FDCB d 95\>RES 2,(IY+d),L\UNDOC\\
	FDCB d 96\>RES 2,(IY+d)\\
	FDCB d 97\>RES 2,(IY+d),A\UNDOC\\
	FDCB d 98\>RES 3,(IY+d),B\UNDOC\\
	FDCB d 99\>RES 3,(IY+d),C\UNDOC\\
	FDCB d 9A\>RES 3,(IY+d),D\UNDOC\\
	FDCB d 9B\>RES 3,(IY+d),E\UNDOC\\
	FDCB d 9C\>RES 3,(IY+d),H\UNDOC\\
	FDCB d 9D\>RES 3,(IY+d),L\UNDOC\\
	FDCB d 9E\>RES 3,(IY+d)\\
	FDCB d 9F\>RES 3,(IY+d),A\UNDOC\\
	FDCB d A0\>RES 4,(IY+d),B\UNDOC\\
	FDCB d A1\>RES 4,(IY+d),C\UNDOC\\
	FDCB d A2\>RES 4,(IY+d),D\UNDOC\\
	FDCB d A3\>RES 4,(IY+d),E\UNDOC\\
	FDCB d A4\>RES 4,(IY+d),H\UNDOC\\
	FDCB d A5\>RES 4,(IY+d),L\UNDOC\\
	FDCB d A6\>RES 4,(IY+d)\\
	FDCB d A7\>RES 4,(IY+d),A\UNDOC\\
	FDCB d A8\>RES 5,(IY+d),B\UNDOC\\
	FDCB d A9\>RES 5,(IY+d),C\UNDOC\\
	FDCB d AA\>RES 5,(IY+d),D\UNDOC\\
	FDCB d AB\>RES 5,(IY+d),E\UNDOC\\
	FDCB d AC\>RES 5,(IY+d),H\UNDOC\\
	FDCB d AD\>RES 5,(IY+d),L\UNDOC\\
	FDCB d AE\>RES 5,(IY+d)\\
	FDCB d AF\>RES 5,(IY+d),A\UNDOC\\
	FDCB d B0\>RES 6,(IY+d),B\UNDOC\\
	FDCB d B1\>RES 6,(IY+d),C\UNDOC\\
	FDCB d B2\>RES 6,(IY+d),D\UNDOC\\
	FDCB d B3\>RES 6,(IY+d),E\UNDOC\\
	FDCB d B4\>RES 6,(IY+d),H\UNDOC\\
	FDCB d B5\>RES 6,(IY+d),L\UNDOC\\
	FDCB d B6\>RES 6,(IY+d)\\
	FDCB d B7\>RES 6,(IY+d),A\UNDOC\\
	FDCB d B8\>RES 7,(IY+d),B\UNDOC\\
	FDCB d B9\>RES 7,(IY+d),C\UNDOC\\
	FDCB d BA\>RES 7,(IY+d),D\UNDOC\\
	FDCB d BB\>RES 7,(IY+d),E\UNDOC\\
	FDCB d BC\>RES 7,(IY+d),H\UNDOC\\
	FDCB d BD\>RES 7,(IY+d),L\UNDOC\\
	FDCB d BE\>RES 7,(IY+d)\\
	FDCB d BF\>RES 7,(IY+d),A\UNDOC\\
	FDCB d C0\>SET 0,(IY+d),B\UNDOC\\
	FDCB d C1\>SET 0,(IY+d),C\UNDOC\\
	FDCB d C2\>SET 0,(IY+d),D\UNDOC\\
	FDCB d C3\>SET 0,(IY+d),E\UNDOC\\
	FDCB d C4\>SET 0,(IY+d),H\UNDOC\\
	FDCB d C5\>SET 0,(IY+d),L\UNDOC\\
	FDCB d C6\>SET 0,(IY+d)\\
	FDCB d C7\>SET 0,(IY+d),A\UNDOC\\
	FDCB d C8\>SET 1,(IY+d),B\UNDOC\\
	FDCB d C9\>SET 1,(IY+d),C\UNDOC\\
	FDCB d CA\>SET 1,(IY+d),D\UNDOC\\
	FDCB d CB\>SET 1,(IY+d),E\UNDOC\\
	FDCB d CC\>SET 1,(IY+d),H\UNDOC\\
	FDCB d CD\>SET 1,(IY+d),L\UNDOC\\
	FDCB d CE\>SET 1,(IY+d)\\
	FDCB d CF\>SET 1,(IY+d),A\UNDOC\\
	FDCB d D0\>SET 2,(IY+d),B\UNDOC\\
	FDCB d D1\>SET 2,(IY+d),C\UNDOC\\
	FDCB d D2\>SET 2,(IY+d),D\UNDOC\\
	FDCB d D3\>SET 2,(IY+d),E\UNDOC\\
	FDCB d D4\>SET 2,(IY+d),H\UNDOC\\
	FDCB d D5\>SET 2,(IY+d),L\UNDOC\\
	FDCB d D6\>SET 2,(IY+d)\\
	FDCB d D7\>SET 2,(IY+d),A\UNDOC\\
	FDCB d D8\>SET 3,(IY+d),B\UNDOC\\
	FDCB d D9\>SET 3,(IY+d),C\UNDOC\\
	FDCB d DA\>SET 3,(IY+d),D\UNDOC\\
	FDCB d DB\>SET 3,(IY+d),E\UNDOC\\
	FDCB d DC\>SET 3,(IY+d),H\UNDOC\\
	FDCB d DD\>SET 3,(IY+d),L\UNDOC\\
	FDCB d DE\>SET 3,(IY+d)\\
	FDCB d DF\>SET 3,(IY+d),A\UNDOC\\
	FDCB d E0\>SET 4,(IY+d),B\UNDOC\\
	FDCB d E1\>SET 4,(IY+d),C\UNDOC\\
	FDCB d E2\>SET 4,(IY+d),D\UNDOC\\
	FDCB d E3\>SET 4,(IY+d),E\UNDOC\\
	FDCB d E4\>SET 4,(IY+d),H\UNDOC\\
	FDCB d E5\>SET 4,(IY+d),L\UNDOC\\
	FDCB d E6\>SET 4,(IY+d)\\
	FDCB d E7\>SET 4,(IY+d),A\UNDOC\\
	FDCB d E8\>SET 5,(IY+d),B\UNDOC\\
	FDCB d E9\>SET 5,(IY+d),C\UNDOC\\
	FDCB d EA\>SET 5,(IY+d),D\UNDOC\\
	FDCB d EB\>SET 5,(IY+d),E\UNDOC\\
	FDCB d EC\>SET 5,(IY+d),H\UNDOC\\
	FDCB d ED\>SET 5,(IY+d),L\UNDOC\\
	FDCB d EE\>SET 5,(IY+d)\\
	FDCB d EF\>SET 5,(IY+d),A\UNDOC\\
	FDCB d F0\>SET 6,(IY+d),B\UNDOC\\
	FDCB d F1\>SET 6,(IY+d),C\UNDOC\\
	FDCB d F2\>SET 6,(IY+d),D\UNDOC\\
	FDCB d F3\>SET 6,(IY+d),E\UNDOC\\
	FDCB d F4\>SET 6,(IY+d),H\UNDOC\\
	FDCB d F5\>SET 6,(IY+d),L\UNDOC\\
	FDCB d F6\>SET 6,(IY+d)\\
	FDCB d F7\>SET 6,(IY+d),A\UNDOC\\
	FDCB d F8\>SET 7,(IY+d),B\UNDOC\\
	FDCB d F9\>SET 7,(IY+d),C\UNDOC\\
	FDCB d FA\>SET 7,(IY+d),D\UNDOC\\
	FDCB d FB\>SET 7,(IY+d),E\UNDOC\\
	FDCB d FC\>SET 7,(IY+d),H\UNDOC\\
	FDCB d FD\>SET 7,(IY+d),L\UNDOC\\
	FDCB d FE\>SET 7,(IY+d)\\
	FDCB d FF\>SET 7,(IY+d),A\UNDOC\\
	FDE1\>POP IY\\
	FDE3\>EX (SP),IY\\
	FDE5\>PUSH IY\\
	FDE9\>JP (IY)\\
	FDF9\>LD SP,IY\\
	FE n\>CP n\\
	FF\>RST 38H
\end{tabbing}
}
\end{multicols}
\normalsize



\chapter{Errors in official documentation}


In some official Zilog documentation, the are some errors. Some don't have all of these mistakes, so your documentation may not be flawed but these are just things to look out for.

\begin{itemize}

	\item
	The Flag affection summary table shows that {\tt LDI/LDIR/LDD/LDDR} instructions leave the SF and ZF in an undefined state. This is not correct; the SF and ZF flags are unaffected (like the same documentation says).

	\item
	Similarly, the same table shows that {\tt CPI/CPIR/CPD/CPDR} leave the SF and HF flags in an undefined state. Not true, they are affected as defined elsewhere in the documentation.

	\item
	Also, the table says about {\tt INI/OUTD/}etc ``Z=0 if B $<>$ 0 otherwise Z=0''; of course the latter should be Z=1.

	\item
	The {\tt INI/INIR/IND/INDR/OUTI/OUTD/OTIR/OTDR} instructions do affect the CF flag (some official documentation says they leave it unaffected, important!) and the NF flag isn't always set but may also be reset (see \ref{block_io} for exact operation).

	\item
	When an NMI is accepted, the IFF1 isn't copied to IFF2. Only IFF1 is reset.

	\item
	In the 8-bit Load Group, the last two bits of the second byte of the {\tt LD r,(IX + d)} opcode should be 10 and not 01.

	\item
	In the 16-bit Arithmetic Group, bit 6 of the second byte of the {\tt ADD IX, pp} opcode should be 0, not 1.

	\item
	{\tt IN x,(C)} resets the HF flag, it never sets it. Some documentation states it is set according to the result of the operation; this is impossible since no arithmetic is done in this instruction.

\end{itemize}

Note: In zilog's own z80cpu\_um.pdf document, there are a lot of errors, some are very confusing, so I'll mention the ones I have found here:

\begin{itemize}

	\item
	page 21, figure 2 says the Alternative Register Set contains 2 B' registers, this should ofcourse be B' and C'.  

	\item
	page 26, figure 16 shows very convincingly that the least significant bit of the address to read for Interrupt Mode 2 is always 0. I have tested this and it is not correct, it can also be 1, in my testcase the bus contained 0xFF and the address that was read did not end in 0xFE but was 0xFF.
  
\end{itemize}




\begin{thebibliography}{}

	\bibitem{mrison}  Mark Rison Z80 page for !CPC. \\
	{\tt \small http://www.acorn.co.uk/$\sim$mrison/en/cpc/tech.html}

	\bibitem{yaze} YAZE (Yet Another Z80 Emulator). This is a CPM emulator by Frank Cringle. It emulates almost every undocumented flag, very good emulator. Also includes a very good instruction exerciser and is released under the GPL. \\
	{\tt \small ftp://ftp.ping.de/pub/misc/emulators/yaze-1.10.tar.gz} \\
	Note: the instruction exerciser zexdoc/zexall does not test I/O instructions and not all normal instructions (for instance LD A,(IX+n) is tested, but not with different values of n, just n=1, values above 128 (LD A,(IX-n) are not tested) but it still gives a pretty good idea of how well a simulated Z80 works.

	\bibitem{thomas} Z80 Family Official Support Page by Thomas Scherrer. Very good -- your one-stop Z80 page. \\
	{\tt \small http://www.geocities.com/SiliconValley/Peaks/3938/z80\_home.htm}

	\bibitem{speccy_faq} Spectrum FAQ technical information. \\
	{\tt \small http://www.worldofspectrum.org/faq/}

	\bibitem{gerton} Gerton Lunter's Spectrum emulator (Z80). In the package there is a file TECHINFO.DOC, which contains a lot of interesting information. Note that the current version can only be unpacked in Windows. \\
	{\tt \small ftp://ftp.void.jump.org/pub/sinclair/emulators/pc/dos/z80-400.zip}

	\bibitem{mostek} Mostek Z80 Programming Manual -- a very good reference to the Z80.

	\bibitem{datasheet} Z80 Product Specification, from MSX2 Hardware Information. \\
	{\tt \small http://www.hardwareinfo.msx2.com/pdf/Zilog/z80.pdf}

	\bibitem{zx_next} ZX Spectrum Next information. \\
	{\tt \small \url{https://wiki.specnext.dev/}}

\end{thebibliography}




\chapter{GNU Free Documentation License}
\label{gfdl}

\begingroup
	\small

	Version 1.1, March 2000\\

	Copyright \copyright\ 2000  Free Software Foundation, Inc.\\
		59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\\
	Everyone is permitted to copy and distribute verbatim copies
	of this license document, but changing it is not allowed.

	\section*{Preamble}

	The purpose of this License is to make a manual, textbook, or other
	written document ``free'' in the sense of freedom: to assure everyone
	the effective freedom to copy and redistribute it, with or without
	modifying it, either commercially or non-commercially.  Secondarily,
	this License preserves for the author and publisher a way to get
	credit for their work, while not being considered responsible for
	modifications made by others.

	This License is a kind of ``copyleft'', which means that derivative
	works of the document must themselves be free in the same sense.  It
	complements the GNU General Public License, which is a copyleft
	license designed for free software.

	We have designed this License in order to use it for manuals for free
	software, because free software needs free documentation: a free
	program should come with manuals providing the same freedoms that the
	software does.  But this License is not limited to software manuals;
	it can be used for any textual work, regardless of subject matter or
	whether it is published as a printed book.  We recommend this License
	principally for works whose purpose is instruction or reference.

	\section{Applicability and Definitions}

	This License applies to any manual or other work that contains a
	notice placed by the copyright holder saying it can be distributed
	under the terms of this License.  The ``Document'', below, refers to any
	such manual or work.  Any member of the public is a licensee, and is
	addressed as ``you''.

	A ``Modified Version'' of the Document means any work containing the
	Document or a portion of it, either copied verbatim, or with
	modifications and/or translated into another language.

	A ``Secondary Section'' is a named appendix or a front-matter section of
	the Document that deals exclusively with the relationship of the
	publishers or authors of the Document to the Document's overall subject
	(or to related matters) and contains nothing that could fall directly
	within that overall subject.  (For example, if the Document is in part a
	textbook of mathematics, a Secondary Section may not explain any
	mathematics.)  The relationship could be a matter of historical
	connection with the subject or with related matters, or of legal,
	commercial, philosophical, ethical or political position regarding
	them.

	The ``Invariant Sections'' are certain Secondary Sections whose titles
	are designated, as being those of Invariant Sections, in the notice
	that says that the Document is released under this License.

	The ``Cover Texts'' are certain short passages of text that are listed,
	as Front-Cover Texts or Back-Cover Texts, in the notice that says that
	the Document is released under this License.

	A ``Transparent'' copy of the Document means a machine-readable copy,
	represented in a format whose specification is available to the
	general public, whose contents can be viewed and edited directly and
	straightforwardly with generic text editors or (for images composed of
	pixels) generic paint programs or (for drawings) some widely available
	drawing editor, and that is suitable for input to text formatters or
	for automatic translation to a variety of formats suitable for input
	to text formatters.  A copy made in an otherwise Transparent file
	format whose mark-up has been designed to thwart or discourage
	subsequent modification by readers is not Transparent.  A copy that is
	not ``Transparent'' is called ``Opaque''.

	Examples of suitable formats for Transparent copies include plain
	ASCII without mark-up, Texinfo input format, \LaTeX~input format, SGML
	or XML using a publicly available DTD, and standard-conforming simple
	HTML designed for human modification.  Opaque formats include
	PostScript, PDF, proprietary formats that can be read and edited only
	by proprietary word processors, SGML or XML for which the DTD and/or
	processing tools are not generally available, and the
	machine-generated HTML produced by some word processors for output
	purposes only.

	The ``Title Page'' means, for a printed book, the title page itself,
	plus such following pages as are needed to hold, legibly, the material
	this License requires to appear in the title page.  For works in
	formats which do not have any title page as such, ``Title Page'' means
	the text near the most prominent appearance of the work's title,
	preceding the beginning of the body of the text.


	\section{Verbatim Copying}

	You may copy and distribute the Document in any medium, either
	commercially or non-commercially, provided that this License, the
	copyright notices, and the license notice saying this License applies
	to the Document are reproduced in all copies, and that you add no other
	conditions whatsoever to those of this License.  You may not use
	technical measures to obstruct or control the reading or further
	copying of the copies you make or distribute.  However, you may accept
	compensation in exchange for copies.  If you distribute a large enough
	number of copies you must also follow the conditions in section 3.

	You may also lend copies, under the same conditions stated above, and
	you may publicly display copies.


	\section{Copying in Quantity}

	If you publish printed copies of the Document numbering more than 100,
	and the Document's license notice requires Cover Texts, you must enclose
	the copies in covers that carry, clearly and legibly, all these Cover
	Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on
	the back cover.  Both covers must also clearly and legibly identify
	you as the publisher of these copies.  The front cover must present
	the full title with all words of the title equally prominent and
	visible.  You may add other material on the covers in addition.
	Copying with changes limited to the covers, as long as they preserve
	the title of the Document and satisfy these conditions, can be treated
	as verbatim copying in other respects.

	If the required texts for either cover are too voluminous to fit
	legibly, you should put the first ones listed (as many as fit
	reasonably) on the actual cover, and continue the rest onto adjacent
	pages.

	If you publish or distribute Opaque copies of the Document numbering
	more than 100, you must either include a machine-readable Transparent
	copy along with each Opaque copy, or state in or with each Opaque copy
	a publicly-accessible computer-network location containing a complete
	Transparent copy of the Document, free of added material, which the
	general network-using public has access to download anonymously at no
	charge using public-standard network protocols.  If you use the latter
	option, you must take reasonably prudent steps, when you begin
	distribution of Opaque copies in quantity, to ensure that this
	Transparent copy will remain thus accessible at the stated location
	until at least one year after the last time you distribute an Opaque
	copy (directly or through your agents or retailers) of that edition to
	the public.

	It is requested, but not required, that you contact the authors of the
	Document well before redistributing any large number of copies, to give
	them a chance to provide you with an updated version of the Document.


	\section{Modifications}

	You may copy and distribute a Modified Version of the Document under
	the conditions of sections 2 and 3 above, provided that you release
	the Modified Version under precisely this License, with the Modified
	Version filling the role of the Document, thus licensing distribution
	and modification of the Modified Version to whoever possesses a copy
	of it.  In addition, you must do these things in the Modified Version:

	\begin{itemize}

	\item Use in the Title Page (and on the covers, if any) a title distinct
	from that of the Document, and from those of previous versions
	(which should, if there were any, be listed in the History section
	of the Document).  You may use the same title as a previous version
	if the original publisher of that version gives permission.
	\item List on the Title Page, as authors, one or more persons or entities
	responsible for authorship of the modifications in the Modified
	Version, together with at least five of the principal authors of the
	Document (all of its principal authors, if it has less than five).
	\item State on the Title page the name of the publisher of the
	Modified Version, as the publisher.
	\item Preserve all the copyright notices of the Document.
	\item Add an appropriate copyright notice for your modifications
	adjacent to the other copyright notices.
	\item Include, immediately after the copyright notices, a license notice
	giving the public permission to use the Modified Version under the
	terms of this License, in the form shown in the Addendum below.
	\item Preserve in that license notice the full lists of Invariant Sections
	and required Cover Texts given in the Document's license notice.
	\item Include an unaltered copy of this License.
	\item Preserve the section entitled ``History'', and its title, and add to
	it an item stating at least the title, year, new authors, and
	publisher of the Modified Version as given on the Title Page.  If
	there is no section entitled ``History'' in the Document, create one
	stating the title, year, authors, and publisher of the Document as
	given on its Title Page, then add an item describing the Modified
	Version as stated in the previous sentence.
	\item Preserve the network location, if any, given in the Document for
	public access to a Transparent copy of the Document, and likewise
	the network locations given in the Document for previous versions
	it was based on.  These may be placed in the ``History'' section.
	You may omit a network location for a work that was published at
	least four years before the Document itself, or if the original
	publisher of the version it refers to gives permission.
	\item In any section entitled ``Acknowledgements'' or ``Dedications'',
	preserve the section's title, and preserve in the section all the
	substance and tone of each of the contributor acknowledgements
	and/or dedications given therein.
	\item Preserve all the Invariant Sections of the Document,
	unaltered in their text and in their titles.  Section numbers
	or the equivalent are not considered part of the section titles.
	\item Delete any section entitled ``Endorsements''.  Such a section
	may not be included in the Modified Version.
	\item Do not retitle any existing section as ``Endorsements''
	or to conflict in title with any Invariant Section.

	\end{itemize}

	If the Modified Version includes new front-matter sections or
	appendices that qualify as Secondary Sections and contain no material
	copied from the Document, you may at your option designate some or all
	of these sections as invariant.  To do this, add their titles to the
	list of Invariant Sections in the Modified Version's license notice.
	These titles must be distinct from any other section titles.

	You may add a section entitled ``Endorsements'', provided it contains
	nothing but endorsements of your Modified Version by various
	parties -- for example, statements of peer review or that the text has
	been approved by an organization as the authoritative definition of a
	standard.

	You may add a passage of up to five words as a Front-Cover Text, and a
	passage of up to 25 words as a Back-Cover Text, to the end of the list
	of Cover Texts in the Modified Version.  Only one passage of
	Front-Cover Text and one of Back-Cover Text may be added by (or
	through arrangements made by) any one entity.  If the Document already
	includes a cover text for the same cover, previously added by you or
	by arrangement made by the same entity you are acting on behalf of,
	you may not add another; but you may replace the old one, on explicit
	permission from the previous publisher that added the old one.

	The author(s) and publisher(s) of the Document do not by this License
	give permission to use their names for publicity for or to assert or
	imply endorsement of any Modified Version.


	\section{Combining Documents}

	You may combine the Document with other documents released under this
	License, under the terms defined in section 4 above for modified
	versions, provided that you include in the combination all of the
	Invariant Sections of all of the original documents, unmodified, and
	list them all as Invariant Sections of your combined work in its
	license notice.

	The combined work need only contain one copy of this License, and
	multiple identical Invariant Sections may be replaced with a single
	copy.  If there are multiple Invariant Sections with the same name but
	different contents, make the title of each such section unique by
	adding at the end of it, in parentheses, the name of the original
	author or publisher of that section if known, or else a unique number.
	Make the same adjustment to the section titles in the list of
	Invariant Sections in the license notice of the combined work.

	In the combination, you must combine any sections entitled ``History''
	in the various original documents, forming one section entitled
	``History''; likewise combine any sections entitled ``Acknowledgements'',
	and any sections entitled ``Dedications''.  You must delete all sections
	entitled ``Endorsements.''


	\section{Collections of Documents}

	You may make a collection consisting of the Document and other documents
	released under this License, and replace the individual copies of this
	License in the various documents with a single copy that is included in
	the collection, provided that you follow the rules of this License for
	verbatim copying of each of the documents in all other respects.

	You may extract a single document from such a collection, and distribute
	it individually under this License, provided you insert a copy of this
	License into the extracted document, and follow this License in all
	other respects regarding verbatim copying of that document.



	\section{Aggregation With Independent Works}

	A compilation of the Document or its derivatives with other separate
	and independent documents or works, in or on a volume of a storage or
	distribution medium, does not as a whole count as a Modified Version
	of the Document, provided no compilation copyright is claimed for the
	compilation.  Such a compilation is called an ``aggregate'', and this
	License does not apply to the other self-contained works thus compiled
	with the Document, on account of their being thus compiled, if they
	are not themselves derivative works of the Document.

	If the Cover Text requirement of section 3 is applicable to these
	copies of the Document, then if the Document is less than one quarter
	of the entire aggregate, the Document's Cover Texts may be placed on
	covers that surround only the Document within the aggregate.
	Otherwise they must appear on covers around the whole aggregate.


	\section{Translation}

	Translation is considered a kind of modification, so you may
	distribute translations of the Document under the terms of section 4.
	Replacing Invariant Sections with translations requires special
	permission from their copyright holders, but you may include
	translations of some or all Invariant Sections in addition to the
	original versions of these Invariant Sections.  You may include a
	translation of this License provided that you also include the
	original English version of this License.  In case of a disagreement
	between the translation and the original English version of this
	License, the original English version will prevail.


	\section{Termination}

	You may not copy, modify, sublicense, or distribute the Document except
	as expressly provided for under this License.  Any other attempt to
	copy, modify, sublicense or distribute the Document is void, and will
	automatically terminate your rights under this License.  However,
	parties who have received copies, or rights, from you under this
	License will not have their licenses terminated so long as such
	parties remain in full compliance.


	\section{Future Revisions of This License}

	The Free Software Foundation may publish new, revised versions
	of the GNU Free Documentation License from time to time.  Such new
	versions will be similar in spirit to the present version, but may
	differ in detail to address new problems or concerns. See
	http://www.gnu.org/copyleft/.

	Each version of the License is given a distinguishing version number.
	If the Document specifies that a particular numbered version of this
	License "or any later version" applies to it, you have the option of
	following the terms and conditions either of that specified version or
	of any later version that has been published (not as a draft) by the
	Free Software Foundation.  If the Document does not specify a version
	number of this License, you may choose any version ever published (not
	as a draft) by the Free Software Foundation.

\endgroup

\end{document}
